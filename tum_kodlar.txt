=== PROJE DOSYA AÄACI ===
./
    jsconfig.json
    kodal.py
    package.json
    README.md
    saveal.py
    tailwind.config.js
    app/
        globals.css
        layout.js
        page.js
        components/
            DashboardContent.js
            DashboardSidebar.js
            FinancialWidget.js
            LayoutWrapper.js
            WidgetRegistry.js
            ui/
                KNumber.js
                SmartInput.js
                WidgetSkeleton.js
            widgets/
                AnalysisWidget.js
                BossSettingsWidget.js
                CharacterWidget.js
                CraftingSimulatorHub.js
                CraftingWidget.js
                DamageProgressionWidget.js
                MarketSupplyWidget.js
                MarketWidget.js
                MetinSettingsWidget.js
                analysis/
                    AnalysisChart.js
                    AnalysisKPIs.js
                    AnalysisSummaryView.js
                    AnalysisTable.js
                    BossRotationView.js
                market/
                    MarketFilters.js
                    MarketModals.js
                    MarketStatCard.js
                    MarketTable.js
                metin-settings/
                    ImportExportModal.js
                    MetinAccordionItem.js
                    MetinHeader.js
                    MetinList.js
                    MetinSummary.js
                simulators/
                    AlchemyPanel.js
                    BlacksmithPanel.js
                    SashCraftingPanel.js
                    alchemy/
                        AlchemyConfig.js
                        AlchemyResults.js
                        constants.js
                    blacksmith/
                        ConfigPanel.js
                        ResultsPanel.js
                        StrategyTable.js
                    sash/
                        constants.js
                        SashConfig.js
                        SashResults.js
        data/
            initialData.js
        hooks/
            useCraftingSync.js
            usePersistentState.js
            useSharedWidgetData.js
            useWorker.js
        lib/
            calculator.js
            excelUtils.js
            marketUtils.js
            math/
                core.js
                formatters.js
                progression.js
                simulation.js
        store/
            constants.js
            useWidgetStore.js
            slices/
                createBossSlice.js
                createCraftingSlice.js
                createMarketSlice.js
                createUISlice.js
        v2/
            page.js
            components/
                WorkstationLayout.js
            workers/
                simulation.worker.js
    public/
        workers/
            alchemy.worker.js
            blacksmith.worker.js
            sash.worker.js
    src/
        experiments/
            RoadmapFilter/
                FilterContext.tsx
                FilterSidebar.tsx
                useFilteredRoadmap.ts
    yedekler/


=== DOSYA Ä°Ã‡ERÄ°KLERÄ° ===


==================================================
DOSYA YOLU: .\jsconfig.json
==================================================
{
  "compilerOptions": {
    "paths": {
      "@/*": ["./*"]
    }
  }
}

==================================================
DOSYA YOLU: .\kodal.py
==================================================
import os

# =============================================================================
# AYARLAR (Ä°htiyacÄ±na gÃ¶re burayÄ± dÃ¼zenleyebilirsin)
# =============================================================================

# Bu klasÃ¶rler tamamen yok sayÄ±lacak
IGNORE_DIRS = {
    '.git', 'node_modules', '__pycache__', 'dist', 'build', '.next',
    '.vscode', '.idea', 'coverage', 'tmp', 'temp'
}

# Bu dosyalar yok sayÄ±lacak
IGNORE_FILES = {
    'package-lock.json', 'yarn.lock', 'pnpm-lock.yaml', '.DS_Store',
    'export_project.py', 'tum_kodlar.txt', '.env.local', '.env'
}

# Sadece bu uzantÄ±lara sahip dosyalar okunacak (Gereksiz binary/resim dosyalarÄ±nÄ± almamak iÃ§in)
ALLOWED_EXTENSIONS = {
    # Web & JS
    '.js', '.jsx', '.ts', '.tsx', '.html', '.css', '.scss', '.json',
    # Python & Backend
    '.py', '.sql', '.prisma',
    # Config & Doc
    '.md', '.txt', '.yml', '.yaml', '.xml', '.ini', '.toml',
    # Config Files
    '.babelrc', '.eslintrc', '.prettierrc', 'Dockerfile'
}

OUTPUT_FILE = "tum_kodlar.txt"

# =============================================================================
# FONKSÄ°YONLAR
# =============================================================================

def is_allowed_file(filename):
    """DosyanÄ±n okunup okunmayacaÄŸÄ±na karar verir."""
    if filename in IGNORE_FILES:
        return False
    # Dockerfile gibi uzantÄ±sÄ±z ama Ã¶nemli dosyalar iÃ§in istisna
    if filename in ALLOWED_EXTENSIONS:
        return True
    return any(filename.endswith(ext) for ext in ALLOWED_EXTENSIONS)

def get_file_content(filepath):
    """Dosya iÃ§eriÄŸini okur ve gereksiz boÅŸluklarÄ± temizler (Token tasarrufu)."""
    try:
        with open(filepath, 'r', encoding='utf-8', errors='ignore') as f:
            content = f.read()

        # Token Tasarrufu: Ã‡oklu boÅŸ satÄ±rlarÄ± tek satÄ±ra indir
        lines = content.splitlines()
        cleaned_lines = [line.rstrip() for line in lines] # SatÄ±r sonu boÅŸluklarÄ±nÄ± sil

        # BoÅŸ satÄ±rlarÄ± tamamen silmek yerine, kod okunabilirliÄŸi iÃ§in
        # ardÄ±ÅŸÄ±k boÅŸ satÄ±rlarÄ± teke dÃ¼ÅŸÃ¼rebiliriz. Ama burada direkt yazÄ±yoruz.
        # Ä°stersen filter(None, cleaned_lines) ile tÃ¼m boÅŸ satÄ±rlarÄ± silebilirsin.
        return "\n".join(cleaned_lines)
    except Exception as e:
        return f"!!! HATA: Dosya okunamadÄ± ({e}) !!!"

def generate_tree(startpath):
    """Proje klasÃ¶r yapÄ±sÄ±nÄ± aÄŸaÃ§ olarak string dÃ¶ndÃ¼rÃ¼r."""
    tree_str = "=== PROJE DOSYA AÄACI ===\n./\n"

    for root, dirs, files in os.walk(startpath):
        # YoksayÄ±lan klasÃ¶rleri yerinde filtrele (bÃ¶ylece iÃ§lerine girmez)
        dirs[:] = [d for d in dirs if d not in IGNORE_DIRS]

        level = root.replace(startpath, '').count(os.sep)
        indent = '    ' * (level)
        subindent = '    ' * (level + 1)

        if root != startpath:
            tree_str += f"{indent}{os.path.basename(root)}/\n"

        for f in files:
            if is_allowed_file(f):
                tree_str += f"{subindent}{f}\n"

    return tree_str

def main():
    print(f"ğŸš€ Ä°ÅŸlem baÅŸlatÄ±lÄ±yor... Hedef dosya: {OUTPUT_FILE}")

    current_dir = os.getcwd()

    with open(OUTPUT_FILE, 'w', encoding='utf-8') as outfile:
        # 1. BÃ–LÃœM: Dosya AÄŸacÄ± (AI'Ä±n modÃ¼ler yapÄ±yÄ± anlamasÄ± iÃ§in)
        tree = generate_tree(current_dir)
        outfile.write(tree)
        outfile.write("\n\n=== DOSYA Ä°Ã‡ERÄ°KLERÄ° ===\n\n")

        # 2. BÃ–LÃœM: Dosya Ä°Ã§erikleri
        file_count = 0
        for root, dirs, files in os.walk(current_dir):
            dirs[:] = [d for d in dirs if d not in IGNORE_DIRS]

            for file in files:
                if is_allowed_file(file):
                    filepath = os.path.join(root, file)
                    relative_path = os.path.relpath(filepath, current_dir)

                    # AI'Ä±n dosyayÄ± tanÄ±masÄ± iÃ§in baÅŸlÄ±k
                    outfile.write(f"\n{'='*50}\n")
                    outfile.write(f"DOSYA YOLU: .\\{relative_path}\n")
                    outfile.write(f"{'='*50}\n")

                    content = get_file_content(filepath)
                    outfile.write(content + "\n")
                    file_count += 1
                    print(f"Okundu: {relative_path}")

    print(f"\nâœ… Ä°ÅŸlem TamamlandÄ±!")
    print(f"ğŸ“‚ Toplam {file_count} dosya '{OUTPUT_FILE}' iÃ§ine yazÄ±ldÄ±.")
    print("ğŸ‘‰ Åimdi bu dosyayÄ± AI asistanÄ±na yÃ¼kleyebilirsin.")

if __name__ == "__main__":
    main()

==================================================
DOSYA YOLU: .\package.json
==================================================
{
  "name": "distant-prominence",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev --webpack",
    "build": "next build",
    "start": "next start",
    "lint": "eslint ."
  },
  "dependencies": {
    "clsx": "^2.1.1",
    "framer-motion": "^11.15.0",
    "immer": "^10.1.1",
    "lucide-react": "^0.468.0",
    "next": "^16.0.7",
    "react": "^19.2.1",
    "react-dom": "^19.2.1",
    "recharts": "^2.15.4",
    "tailwind-merge": "^2.5.5",
    "xlsx": "https://cdn.sheetjs.com/xlsx-0.20.3/xlsx-0.20.3.tgz",
    "zustand": "^5.0.2"
  },
  "devDependencies": {
    "autoprefixer": "^10.4.20",
    "eslint": "^9.16.0",
    "eslint-config-next": "^16.0.7",
    "postcss": "^8.4.49",
    "tailwindcss": "^3.4.16"
  },
  "overrides": {
    "react-is": "^19.0.0"
  }
}

==================================================
DOSYA YOLU: .\README.md
==================================================
This is a [Next.js](https://nextjs.org) project bootstrapped with [`create-next-app`](https://github.com/vercel/next.js/tree/canary/packages/create-next-app).

## Getting Started

First, run the development server:

```bash
npm run dev
# or
yarn dev
# or
pnpm dev
# or
bun dev
```

Open [http://localhost:3000](http://localhost:3000) with your browser to see the result.

You can start editing the page by modifying `app/page.js`. The page auto-updates as you edit the file.

This project uses [`next/font`](https://nextjs.org/docs/app/building-your-application/optimizing/fonts) to automatically optimize and load [Geist](https://vercel.com/font), a new font family for Vercel.

## Learn More

To learn more about Next.js, take a look at the following resources:

- [Next.js Documentation](https://nextjs.org/docs) - learn about Next.js features and API.
- [Learn Next.js](https://nextjs.org/learn) - an interactive Next.js tutorial.

You can check out [the Next.js GitHub repository](https://github.com/vercel/next.js) - your feedback and contributions are welcome!

## Deploy on Vercel

The easiest way to deploy your Next.js app is to use the [Vercel Platform](https://vercel.com/new?utm_medium=default-template&filter=next.js&utm_source=create-next-app&utm_campaign=create-next-app-readme) from the creators of Next.js.

Check out our [Next.js deployment documentation](https://nextjs.org/docs/app/building-your-application/deploying) for more details.

==================================================
DOSYA YOLU: .\saveal.py
==================================================
import os
import zipfile
from datetime import datetime

def backup_project():
    # 1. Yedekleme Ä°smi OluÅŸtur (Tarih-Saat)
    timestamp = datetime.now().strftime("%Y-%m-%d_%H-%M-%S")
    zip_filename = f"Yedek_{timestamp}.zip"

    # 2. YoksayÄ±lacak KlasÃ¶rler (Gereksiz aÄŸÄ±rlÄ±k yapanlar)
    IGNORE_DIRS = {
        'node_modules', '.next', '.git', 'dist', 'build', '.vscode',
        'coverage', '__pycache__'
    }

    # 3. YoksayÄ±lacak Dosyalar
    IGNORE_FILES = {
        'package-lock.json', 'yarn.lock', 'pnpm-lock.yaml',
        '.DS_Store', 'backup_project.py', zip_filename
    }

    print(f"ğŸ“¦ Yedekleme baÅŸlatÄ±lÄ±yor: {zip_filename}")

    try:
        with zipfile.ZipFile(zip_filename, 'w', zipfile.ZIP_DEFLATED) as zipf:
            for root, dirs, files in os.walk("."):
                # Gereksiz klasÃ¶rleri yerinde filtrele (iÃ§ine girmesin)
                dirs[:] = [d for d in dirs if d not in IGNORE_DIRS]

                for file in files:
                    # Kendi oluÅŸturduÄŸumuz zip'i veya scripti yedekleme
                    if file in IGNORE_FILES or file.endswith('.zip'):
                        continue

                    file_path = os.path.join(root, file)
                    # Zip iÃ§ine dosyayÄ± ekle
                    zipf.write(file_path, arcname=os.path.relpath(file_path, "."))

        print(f"âœ… BaÅŸarÄ±lÄ±! Dosya oluÅŸturuldu: {zip_filename}")
        print(f"   (Node_modules ve gereksiz dosyalar hariÃ§ tutuldu)")

    except Exception as e:
        print(f"âŒ Hata oluÅŸtu: {e}")

if __name__ == "__main__":
    backup_project()

==================================================
DOSYA YOLU: .\tailwind.config.js
==================================================
/** @type {import('tailwindcss').Config} */
module.exports = {
    content: [
        './app/**/*.{js,ts,jsx,tsx,mdx}',
        './components/**/*.{js,ts,jsx,tsx,mdx}',
        './src/**/*.{js,ts,jsx,tsx,mdx}',
    ],
    theme: {
        extend: {},
    },
    plugins: [],
}

==================================================
DOSYA YOLU: .\app\globals.css
==================================================
@tailwind base;
@tailwind components;
@tailwind utilities;

:root {
  --background: #000000;
  /* Tam Siyah */
  --foreground: #ffffff;
}

body {
  color: var(--foreground);
  background: var(--background);
  font-family: Arial, Helvetica, sans-serif;
  overflow-x: hidden;
  /* Yatay kaydÄ±rmayÄ± engelle */
}

/* Glassmorphism Utilities */
.glass-panel {
  background: rgba(20, 20, 20, 0.4);
  /* Daha ÅŸeffaf siyah */
  backdrop-filter: blur(16px);
  -webkit-backdrop-filter: blur(16px);
  border: 1px solid rgba(255, 255, 255, 0.08);
  box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
}

.glass-dock {
  background: rgba(5, 5, 5, 0.7);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.1);
  box-shadow: 0 0 40px rgba(0, 0, 0, 0.8);
}

==================================================
DOSYA YOLU: .\app\layout.js
==================================================
import { Geist, Geist_Mono } from "next/font/google";
import "./globals.css";
import LayoutWrapper from "./components/LayoutWrapper";

const geistSans = Geist({
  variable: "--font-geist-sans",
  subsets: ["latin"],
});

const geistMono = Geist_Mono({
  variable: "--font-geist-mono",
  subsets: ["latin"],
});

export const metadata = {
  title: "Create Next App",
  description: "Generated by create next app",
};

export default function RootLayout({ children }) {
  return (
    <html lang="en">
      <body
        className={`${geistSans.variable} ${geistMono.variable} antialiased`}
        suppressHydrationWarning={true}
      >
        <LayoutWrapper>{children}</LayoutWrapper>
      </body>
    </html>
  );
}

==================================================
DOSYA YOLU: .\app\page.js
==================================================
"use client";

import DashboardSidebar from "./components/DashboardSidebar";
import DashboardContent from "./components/DashboardContent";

export default function Home() {
  return (
    <div className="flex h-screen w-screen bg-zinc-950 overflow-hidden text-zinc-100 font-sans">
      <DashboardSidebar />
      <DashboardContent />
    </div>
  );
}

==================================================
DOSYA YOLU: .\app\components\DashboardContent.js
==================================================
"use client";

import useWidgetStore from "../store/useWidgetStore";
import { motion } from "framer-motion";
import { Sword, Zap, Clock } from "lucide-react";

// Import existing widgets to act as specific views
import MarketWidget from "./widgets/MarketWidget";
import AnalysisWidget from "./widgets/AnalysisWidget";
import CraftingWidget from "./widgets/CraftingWidget";
import MarketSupplyWidget from "./widgets/MarketSupplyWidget";
import BossSettingsWidget from "./widgets/BossSettingsWidget";
import MetinSettingsWidget from "./widgets/MetinSettingsWidget";
import CraftingSimulatorHub from "./widgets/CraftingSimulatorHub";
import SmartInput from "./ui/SmartInput";

// Helper: Format compact with safety check
const formatCompact = (number) => {
    if (number === undefined || number === null || isNaN(number)) return "0";
    if (number >= 1000000) return `${(number / 1000000).toFixed(1)}M`;
    if (number >= 1000) return `${(number / 1000).toFixed(1)}k`;
    return number.toString();
};

// Components for Views
const OverviewView = () => (
    <div className="p-8">
        <h1 className="text-2xl font-bold text-zinc-100 mb-6">Genel Durum</h1>
        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div className="bg-zinc-900 border border-zinc-800 p-6 rounded-xl">
                <h3 className="text-zinc-500 text-sm font-medium mb-2">Toplam Pazar Hacmi</h3>
                <p className="text-3xl font-bold text-white">450 Won</p>
            </div>
            <div className="bg-zinc-900 border border-zinc-800 p-6 rounded-xl">
                <h3 className="text-zinc-500 text-sm font-medium mb-2">GÃ¼nlÃ¼k Ciro</h3>
                <p className="text-3xl font-bold text-green-400">+12 Won</p>
            </div>
            <div className="bg-zinc-900 border border-zinc-800 p-6 rounded-xl">
                <h3 className="text-zinc-500 text-sm font-medium mb-2">Aktif Analizler</h3>
                <p className="text-3xl font-bold text-blue-400">4</p>
            </div>
        </div>
    </div>
);

// Character Stats Editor (Inline for Settings)
function CharacterStatsEditor() {
    const updateComponentData = useWidgetStore((state) => state.updateComponentData);
    const activeWorkspaceId = useWidgetStore((state) => state.activeWorkspaceId);
    const workspace = useWidgetStore((state) =>
        state.workspaces.find(ws => ws.id === state.activeWorkspaceId)
    );

    const stats = workspace?.data?.characterStats || { damage: 3000, hitsPerSecond: 2.5, findTime: 10 };

    const handleChange = (field, value) => {
        updateComponentData(activeWorkspaceId, 'characterStats', { ...stats, [field]: value });
    };

    return (
        <div className="space-y-4">
            {/* Damage */}
            <div className="bg-zinc-900/50 p-5 rounded-xl border border-zinc-800 hover:border-violet-500/30 transition-colors">
                <div className="flex items-center gap-3 mb-3">
                    <div className="p-2 bg-violet-500/10 rounded-lg border border-violet-500/20">
                        <Sword className="w-5 h-5 text-violet-400" />
                    </div>
                    <div className="flex-1">
                        <label className="block text-sm font-semibold text-white">
                            Ortalama Hasar (VuruÅŸ BaÅŸÄ±na)
                        </label>
                        <p className="text-xs text-zinc-500 mt-0.5">
                            Bir vuruÅŸta verdiÄŸiniz ortalama hasarÄ± girin
                        </p>
                    </div>
                </div>
                <SmartInput
                    value={stats.damage || 0}
                    onChange={(val) => handleChange('damage', val)}
                    className="w-full px-4 py-3 text-lg font-mono font-semibold text-white bg-zinc-950 border border-zinc-700 rounded-xl focus:outline-none focus:ring-2 focus:ring-violet-500/30 focus:border-violet-500/50 transition-all"
                    placeholder="3000"
                    min={0}
                    step={100}
                />
            </div>

            {/* Hits Per Second */}
            <div className="bg-zinc-900/50 p-5 rounded-xl border border-zinc-800 hover:border-cyan-500/30 transition-colors">
                <div className="flex items-center gap-3 mb-3">
                    <div className="p-2 bg-cyan-500/10 rounded-lg border border-cyan-500/20">
                        <Zap className="w-5 h-5 text-cyan-400" />
                    </div>
                    <div className="flex-1">
                        <label className="block text-sm font-semibold text-white">
                            Saniye BaÅŸÄ±na VuruÅŸ (SaldÄ±rÄ± HÄ±zÄ±)
                        </label>
                        <p className="text-xs text-zinc-500 mt-0.5">
                            Bir saniyede kaÃ§ kez vurduÄŸunuzu girin
                        </p>
                    </div>
                </div>
                <SmartInput
                    value={stats.hitsPerSecond || 0}
                    onChange={(val) => handleChange('hitsPerSecond', val)}
                    className="w-full px-4 py-3 text-lg font-mono font-semibold text-white bg-zinc-950 border border-zinc-700 rounded-xl focus:outline-none focus:ring-2 focus:ring-cyan-500/30 focus:border-cyan-500/50 transition-all"
                    placeholder="2.5"
                    min={0}
                    step={0.1}
                />
            </div>

            {/* Find Time */}
            <div className="bg-zinc-900/50 p-5 rounded-xl border border-zinc-800 hover:border-blue-500/30 transition-colors">
                <div className="flex items-center gap-3 mb-3">
                    <div className="p-2 bg-blue-500/10 rounded-lg border border-blue-500/20">
                        <Clock className="w-5 h-5 text-blue-400" />
                    </div>
                    <div className="flex-1">
                        <label className="block text-sm font-semibold text-white">
                            Metin Bulma SÃ¼resi (Saniye)
                        </label>
                        <p className="text-xs text-zinc-500 mt-0.5">
                            Bir metinden diÄŸerine geÃ§iÅŸ sÃ¼resi
                        </p>
                    </div>
                </div>
                <SmartInput
                    value={stats.findTime || 0}
                    onChange={(val) => handleChange('findTime', val)}
                    className="w-full px-4 py-3 text-lg font-mono font-semibold text-white bg-zinc-950 border border-zinc-700 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500/30 focus:border-blue-500/50 transition-all"
                    placeholder="10"
                    min={0}
                    step={1}
                />
            </div>

            {/* Stats Summary */}
            <div className="bg-zinc-900/30 p-4 rounded-xl border border-zinc-800">
                <h4 className="text-sm font-semibold text-zinc-400 mb-3">Hesaplanan DeÄŸerler</h4>
                <div className="grid grid-cols-2 gap-3">
                    <div className="bg-zinc-950 p-3 rounded-lg border border-zinc-800">
                        <p className="text-zinc-500 text-xs">DPS (Saniye BaÅŸÄ±na)</p>
                        <p className="text-xl font-bold text-violet-400 font-mono">
                            {formatCompact((stats.damage || 0) * (stats.hitsPerSecond || 0))}
                        </p>
                    </div>
                    <div className="bg-zinc-950 p-3 rounded-lg border border-zinc-800">
                        <p className="text-zinc-500 text-xs">Toplam DÃ¶ngÃ¼ SÃ¼resi</p>
                        <p className="text-xl font-bold text-blue-400 font-mono">
                            ~{stats.findTime || 0}+ sn
                        </p>
                    </div>
                </div>
            </div>
        </div>
    );
}

const SettingsView = () => (
    <div className="p-8 max-w-4xl">
        <h1 className="text-2xl font-bold text-zinc-100 mb-6">Sistem AyarlarÄ±</h1>
        <div className="space-y-8">
            <section>
                <div className="flex items-center gap-3 mb-4 border-b border-zinc-800 pb-2">
                    <div className="p-2 bg-violet-500/10 rounded-lg border border-violet-500/20">
                        <Sword className="w-5 h-5 text-violet-400" />
                    </div>
                    <h3 className="text-lg font-semibold text-white">Karakter YapÄ±landÄ±rmasÄ±</h3>
                </div>
                <CharacterStatsEditor />
            </section>
        </div>
    </div>
);

export default function DashboardContent() {
    const activeTab = useWidgetStore((state) => state.activeTab);

    const renderContent = () => {
        switch (activeTab) {
            case "overview": return <OverviewView />;
            case "market": return <MarketWidget />; // Needs clean up
            case "analysis": return <AnalysisWidget />;
            case "boss": return <BossSettingsWidget />;
            case "supply": return <MarketSupplyWidget />;
            case "crafting": return <CraftingWidget />;
            case "simulator": return <CraftingSimulatorHub />;
            case "metin-settings": return (
                <div className="h-full overflow-y-auto p-6">
                    <MetinSettingsWidget />
                </div>
            );
            case "settings": return <SettingsView />;
            default: return <OverviewView />;
        }
    };

    return (
        <main className="flex-1 h-full overflow-y-auto bg-zinc-950 relative custom-scrollbar">
            <motion.div
                key={activeTab}
                initial={{ opacity: 0, y: 10 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ duration: 0.2 }}
                className="h-full"
            >
                {renderContent()}
            </motion.div>
        </main>
    );
}

==================================================
DOSYA YOLU: .\app\components\DashboardSidebar.js
==================================================
"use client";

import useWidgetStore from "../store/useWidgetStore";
import {
    LayoutDashboard,
    Store,
    Calculator,
    Swords,
    Settings,
    TrendingUp,
    Hammer,
    Database,
    FlaskConical
} from "lucide-react";

const SIDEBAR_ITEMS = [
    { id: "overview", label: "Genel Durum", icon: LayoutDashboard },
    { id: "market", label: "Piyasa", icon: Store },
    { id: "analysis", label: "Metin Analizi", icon: Calculator },
    { id: "boss", label: "Boss Rotasyonu", icon: Swords },
    { id: "supply", label: "Arz / Talep", icon: TrendingUp },
    { id: "crafting", label: "Ãœretim & DÃ¶nÃ¼ÅŸÃ¼m", icon: Hammer },
    { id: "simulator", label: "SimÃ¼latÃ¶r", icon: FlaskConical },
    { id: "metin-settings", label: "Metin AyarlarÄ±", icon: Database },
    { id: "settings", label: "Ayarlar", icon: Settings },
];

export default function DashboardSidebar() {
    const activeTab = useWidgetStore((state) => state.activeTab);
    const setActiveTab = useWidgetStore((state) => state.setActiveTab);

    return (
        <aside className="w-64 bg-zinc-950/80 border-r border-zinc-800 flex flex-col h-full shrink-0">
            {/* Brand Header */}
            <div className="h-16 flex items-center px-6 border-b border-zinc-800/50">
                <div className="flex items-center gap-2">
                    <div className="w-8 h-8 rounded bg-gradient-to-br from-blue-600 to-cyan-500 flex items-center justify-center font-bold text-white text-sm">
                        W2
                    </div>
                    <span className="font-semibold text-zinc-100 tracking-tight">Economy Manager</span>
                </div>
            </div>

            {/* Navigation */}
            <nav className="flex-1 p-4 space-y-1 overflow-y-auto custom-scrollbar">
                {SIDEBAR_ITEMS.map((item) => {
                    const isActive = activeTab === item.id;
                    const Icon = item.icon;

                    return (
                        <button
                            key={item.id}
                            onClick={() => setActiveTab(item.id)}
                            className={`
                        w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-all duration-200
                        ${isActive
                                    ? "bg-blue-600 text-white shadow-lg shadow-blue-900/20"
                                    : "text-zinc-400 hover:text-zinc-100 hover:bg-zinc-900"
                                }
                    `}
                        >
                            <Icon size={18} className={isActive ? "text-white" : "text-zinc-500 group-hover:text-zinc-300"} />
                            <span>{item.label}</span>
                        </button>
                    );
                })}
            </nav>

            {/* Footer / User Profile Stub */}
            <div className="p-4 border-t border-zinc-800/50">
                <div className="flex items-center gap-3 p-2 rounded-lg bg-zinc-900/50 border border-zinc-800">
                    <div className="w-8 h-8 rounded-full bg-zinc-700 flex items-center justify-center text-xs text-zinc-300">
                        OP
                    </div>
                    <div className="flex-col flex">
                        <span className="text-xs font-semibold text-zinc-300">Admin</span>
                        <span className="text-[10px] text-zinc-500">Pro License</span>
                    </div>
                </div>
            </div>
        </aside>
    );
}

==================================================
DOSYA YOLU: .\app\components\FinancialWidget.js
==================================================
"use client";

import { motion } from "framer-motion";
import { X, EyeOff } from "lucide-react";
import * as LucideIcons from "lucide-react";
import useWidgetStore, { useWidgetDefinition } from "../store/useWidgetStore";

// Helper: Compact Number Formatting (1.5M, 20K vb.)
const formatCompactNumber = (number) => {
    if (!number) return "0";
    return new Intl.NumberFormat('tr-TR', {
        notation: "compact",
        maximumFractionDigits: 1
    }).format(number);
};

// ============================================================================
// Widget Content Map (GÃ¶rÃ¼nÃ¼m MantÄ±ÄŸÄ±)
// ============================================================================
const WIDGET_CONTENTS = {
    "money-input": {
        Summary: ({ data }) => (
            <div className="flex flex-col items-center justify-center h-full w-full overflow-hidden">
                <span className="text-3xl font-bold text-white whitespace-nowrap">
                    {data.amount ? `${formatCompactNumber(data.amount)} TL` : "DeÄŸer Girin"}
                </span>
                <span className="text-xs text-white/60 mt-1">Toplam Bakiye</span>
            </div>
        ),
        Detail: ({ data, onChange }) => (
            <div className="space-y-4">
                <div>
                    <label className="block text-sm font-medium text-white mb-2">Tutar Girin</label>
                    <div className="relative">
                        <input
                            type="number"
                            value={data.amount || ""}
                            onChange={(e) => onChange({ amount: e.target.value })}
                            className="w-full px-4 py-3 text-lg bg-black/20 border border-white/10 rounded-xl text-white placeholder:text-white/40 focus:outline-none focus:ring-2 focus:ring-white/30 focus:bg-black/30 backdrop-blur-sm transition-all"
                            placeholder="0"
                            autoFocus
                        />
                        <span className="absolute right-4 top-1/2 -translate-y-1/2 text-white/60 font-medium">TL</span>
                    </div>
                    <p className="text-sm text-white/60 mt-2">
                        Bu tutar genel bakiyenize eklenecektir. GeÃ§miÅŸ harcamalarÄ±nÄ±zÄ± grafikte gÃ¶rebilirsiniz.
                    </p>
                </div>
            </div>
        )
    },
    "note-taker": {
        Summary: ({ data }) => (
            <div className="flex flex-col items-center justify-center h-full text-center px-4 w-full overflow-hidden">
                <p className="text-lg font-medium text-white break-words line-clamp-4 w-full">
                    {data.notes || "HenÃ¼z not eklenmedi..."}
                </p>
            </div>
        ),
        Detail: ({ data, onChange }) => (
            <div className="space-y-4 h-full">
                <label className="block text-sm font-medium text-white mb-2">NotlarÄ±nÄ±z</label>
                <textarea
                    value={data.notes || ""}
                    onChange={(e) => onChange({ notes: e.target.value })}
                    className="w-full h-64 px-4 py-3 bg-black/20 border border-white/10 rounded-xl text-white placeholder:text-white/40 focus:outline-none focus:ring-2 focus:ring-white/30 focus:bg-black/30 backdrop-blur-sm resize-none transition-all"
                    placeholder="Buraya notlarÄ±nÄ±zÄ± yazÄ±n..."
                    autoFocus
                />
            </div>
        )
    },
    // DiÄŸer widgetlar iÃ§in varsayÄ±lan ÅŸablon
    "default": {
        Summary: ({ data, title }) => (
            <div className="flex flex-col items-center justify-center h-full w-full px-4 text-center">
                <span className="text-xl font-semibold text-white break-words w-full">{title}</span>
                <span className="text-sm text-white/60 mt-1">Detaylar iÃ§in tÄ±klayÄ±n</span>
            </div>
        ),
        Detail: ({ data, onChange }) => (
            <div className="space-y-4">
                <p className="text-white/60">Bu widget iÃ§in Ã¶zel bir gÃ¶rÃ¼nÃ¼m henÃ¼z tanÄ±mlanmadÄ±.</p>
                <div className="p-4 bg-black/20 rounded-lg border border-white/10 backdrop-blur-sm">
                    <pre className="text-xs text-white/80 overflow-auto">
                        {JSON.stringify(data, null, 2)}
                    </pre>
                </div>
            </div>
        )
    }
};

export default function FinancialWidget({
    id,
    type,
    isSelected,
    onClick,
    data,
    onHide
}) {
    // Store'dan update fonksiyonunu Ã§ek
    const updateWidgetData = useWidgetStore((state) => state.updateWidgetData);

    // Registry'den widget tanÄ±mÄ±nÄ± al
    const definition = useWidgetDefinition(type);

    // EÄŸer definition yoksa render etme
    if (!definition) return null;

    const { title, icon: iconName } = definition;
    const Icon = LucideIcons[iconName] || LucideIcons.HelpCircle;

    // Widget iÃ§eriÄŸini seÃ§ (Summary/Detail)
    const Content = WIDGET_CONTENTS[type] || WIDGET_CONTENTS["default"];

    // Veri gÃ¼ncelleme wrapper'Ä±
    const handleChange = (newData) => {
        updateWidgetData(id, newData);
    };

    return (
        <motion.div
            layoutId={`card-${id}`}
            layout
            onClick={!isSelected ? onClick : undefined}
            className={`group rounded-3xl shadow-2xl cursor-pointer overflow-hidden backdrop-blur-xl border border-white/10 ${isSelected
                ? "fixed inset-0 m-auto w-[90%] h-[90%] max-w-6xl z-[100] bg-black/90"
                : "relative h-64 hover:-translate-y-1 glass-panel hover:border-cyan-500/50 hover:shadow-[0_0_30px_rgba(6,182,212,0.1)] transition-all duration-300"
                }`}
            transition={{ type: "spring", stiffness: 300, damping: 30 }}
        >
            {/* SUMMARY VIEW */}
            {!isSelected && (
                <>
                    {/* Gizle Butonu (Hover'da gÃ¶rÃ¼nÃ¼r) */}
                    <motion.button
                        whileHover={{ scale: 1.1 }}
                        whileTap={{ scale: 0.9 }}
                        onClick={(e) => {
                            e.stopPropagation();
                            onHide && onHide();
                        }}
                        className="absolute top-4 right-4 z-20 p-2 bg-white/10 backdrop-blur-sm shadow-lg rounded-full opacity-0 group-hover:opacity-100 transition-opacity text-white/60 hover:text-red-400 hover:bg-red-500/20 border border-white/20"
                    >
                        <EyeOff className="w-4 h-4" />
                    </motion.button>

                    {/* Ä°Ã§erik */}
                    <div className="w-full h-full p-6 relative">
                        {/* Arkaplan Ä°konu (Dekoratif) */}
                        <Icon className="absolute -bottom-4 -right-4 w-32 h-32 text-white/5 opacity-50 rotate-12 pointer-events-none" />

                        {/* Summary Component */}
                        <Content.Summary data={data} title={title} />
                    </div>
                </>
            )}

            {/* DETAIL VIEW */}
            {isSelected && (
                <div className="flex flex-col h-full bg-transparent">
                    {/* Header */}
                    <div className="flex items-center justify-between p-8 border-b border-white/10 bg-transparent backdrop-blur-xl">
                        <div className="flex items-center gap-4">
                            <div className="p-3 bg-white/10 backdrop-blur-sm rounded-2xl border border-white/20">
                                <Icon className="w-8 h-8 text-white" />
                            </div>
                            <div>
                                <motion.h2 layoutId={`title-${id}`} className="text-2xl font-bold text-white">
                                    {title}
                                </motion.h2>
                                <p className="text-white/60">DetaylÄ± gÃ¶rÃ¼nÃ¼m ve dÃ¼zenleme modu</p>
                            </div>
                        </div>

                        {/* Kapat Butonu */}
                        <button
                            onClick={(e) => {
                                e.stopPropagation();
                                onClick();
                            }}
                            className="p-2 hover:bg-white/10 rounded-full transition-colors backdrop-blur-sm border border-white/10 hover:border-white/20"
                        >
                            <X className="w-6 h-6 text-white/80" />
                        </button>
                    </div>

                    {/* Content Grid */}
                    <div className="flex-1 p-8 overflow-y-auto">
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-8 h-full">
                            {/* Sol Kolon: Inputlar (Detail View) */}
                            <div className="bg-transparent backdrop-blur-xl p-6 rounded-2xl border border-white/10 shadow-xl">
                                <Content.Detail data={data} onChange={handleChange} />
                            </div>

                            {/* SaÄŸ Kolon: Grafik / Dashboard Placeholder */}
                            <div className="border-2 border-dashed border-white/10 rounded-2xl bg-transparent backdrop-blur-sm flex flex-col items-center justify-center text-white/50 p-6">
                                <div className="w-16 h-16 bg-white/10 backdrop-blur-sm rounded-full flex items-center justify-center mb-4 border border-white/20">
                                    <LucideIcons.BarChart3 className="w-8 h-8 text-white/70" />
                                </div>
                                <h4 className="font-medium text-white/80 mb-1">Analiz GrafiÄŸi</h4>
                                <p className="text-sm text-center max-w-xs text-white/60">
                                    {type === "money-input" ? "Gelir/Gider daÄŸÄ±lÄ±m grafiÄŸi burada gÃ¶rÃ¼ntÃ¼lenecek." :
                                        type === "note-taker" ? "Kelime bulutu ve not analizi burada yer alacak." :
                                            "Bu widget iÃ§in gÃ¶rselleÅŸtirme modÃ¼lÃ¼ hazÄ±rlanÄ±yor."}
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            )}
        </motion.div>
    );
}

==================================================
DOSYA YOLU: .\app\components\LayoutWrapper.js
==================================================
"use client";

import { MotionConfig } from "framer-motion";

export default function LayoutWrapper({ children }) {
    return (
        <MotionConfig>
            {children}
        </MotionConfig>
    );
}

==================================================
DOSYA YOLU: .\app\components\WidgetRegistry.js
==================================================
import dynamic from 'next/dynamic';
import { WIDGET_TYPES } from '../store/constants';
import WidgetSkeleton from './ui/WidgetSkeleton';
import FinancialWidget from './FinancialWidget'; // Default widget kept static

// Lazy load widgets
const MarketWidget = dynamic(() => import('./widgets/MarketWidget'), {
    loading: () => <WidgetSkeleton />,
    ssr: false // Widgets rely heavily on browser storage/state, so better client-side
});

const CharacterWidget = dynamic(() => import('./widgets/CharacterWidget'), {
    loading: () => <WidgetSkeleton />,
    ssr: false
});

const AnalysisWidget = dynamic(() => import('./widgets/AnalysisWidget'), {
    loading: () => <WidgetSkeleton />,
    ssr: false
});

const MetinSettingsWidget = dynamic(() => import('./widgets/MetinSettingsWidget'), {
    loading: () => <WidgetSkeleton />,
    ssr: false
});

const DamageProgressionWidget = dynamic(() => import('./widgets/DamageProgressionWidget'), {
    loading: () => <WidgetSkeleton />,
    ssr: false
});

const MarketSupplyWidget = dynamic(() => import('./widgets/MarketSupplyWidget'), {
    loading: () => <WidgetSkeleton />,
    ssr: false
});

const CraftingWidget = dynamic(() => import('./widgets/CraftingWidget'), {
    loading: () => <WidgetSkeleton />,
    ssr: false
});

const BossSettingsWidget = dynamic(() => import('./widgets/BossSettingsWidget'), {
    loading: () => <WidgetSkeleton />,
    ssr: false
});

// Map types to components
const WIDGET_COMPONENTS = {
    [WIDGET_TYPES.MARKET]: MarketWidget,
    [WIDGET_TYPES.CHARACTER]: CharacterWidget,
    [WIDGET_TYPES.ANALYSIS]: AnalysisWidget,
    [WIDGET_TYPES.METIN_SETTINGS]: MetinSettingsWidget,
    [WIDGET_TYPES.DAMAGE_PROGRESSION]: DamageProgressionWidget,
    [WIDGET_TYPES.MARKET_SUPPLY]: MarketSupplyWidget,
    [WIDGET_TYPES.CRAFTING]: CraftingWidget,
    [WIDGET_TYPES.BOSS_SETTINGS]: BossSettingsWidget,
};

/**
 * Returns the component associated with the given widget type.
 * Default: FinancialWidget
 */
export const getWidgetComponent = (type) => {
    return WIDGET_COMPONENTS[type] || FinancialWidget;
};

==================================================
DOSYA YOLU: .\app\components\ui\KNumber.js
==================================================
"use client";

import { useState } from "react";
import { formatCompactK, formatDetailedK } from "../../lib/math/formatters";

/**
 * KNumber - AkÄ±llÄ± SayÄ± GÃ¶sterimi
 *
 * Normal durumda: 1.5kk
 * Hover/Click durumunda: 1kkk 350kk 240k 422
 *
 * @param {number} value - GÃ¶sterilecek sayÄ±
 * @param {string} className - Ek CSS sÄ±nÄ±flarÄ±
 */
export default function KNumber({ value, className = "" }) {
    const [isHovered, setIsHovered] = useState(false);
    const [isClicked, setIsClicked] = useState(false);

    const toggleClick = () => setIsClicked(!isClicked);

    // Hangi formatÄ± gÃ¶stereceÄŸiz?
    // Hover veya Click durumunda detaylÄ±, yoksa kompakt.
    const showDetailed = isHovered || isClicked;

    return (
        <span
            className={`
                cursor-pointer transition-all duration-200
                ${className}
                ${showDetailed ? 'text-violet-300 font-bold' : ''}
            `}
            onMouseEnter={() => setIsHovered(true)}
            onMouseLeave={() => setIsHovered(false)}
            onClick={toggleClick}
            title="Tam deÄŸeri gÃ¶rmek iÃ§in tÄ±klayÄ±n"
        >
            {showDetailed ? formatDetailedK(value) : formatCompactK(value)}
        </span>
    );
}

==================================================
DOSYA YOLU: .\app\components\ui\SmartInput.js
==================================================
"use client";

import { useState, useEffect, useCallback } from "react";
import { parseSuffixValue } from "../../lib/math/formatters";

/**
 * SmartInput - SayÄ±sal input sorunlarÄ±nÄ± Ã§Ã¶zen akÄ±llÄ± bileÅŸen
 *
 * Ã–zellikler:
 * - Ara deÄŸerlere izin verir (Ã¶rn: "2.", "", "-")
 * - Sadece blur veya Enter'da global state gÃ¼ncellenir
 * - OndalÄ±k sayÄ± giriÅŸine tam destek
 * - BoÅŸ deÄŸer iÃ§in fallback (min veya 0)
 * - Suffix desteÄŸi: "40k" -> 40000, "1kk" -> 1000000, "1.5m" -> 1500000
 */
export default function SmartInput({
    value,
    onChange,
    min = 0,
    max,
    step = 1,
    className = "",
    placeholder = "",
    disabled = false,
    onFocus,
    onBlur: externalOnBlur,
}) {
    // Lokal state - kullanÄ±cÄ±nÄ±n yazdÄ±ÄŸÄ± deÄŸeri tutar
    const [localValue, setLocalValue] = useState(String(value ?? ""));
    const [isFocused, setIsFocused] = useState(false);

    // DÄ±ÅŸarÄ±dan gelen value deÄŸiÅŸirse ve focus yoksa lokal deÄŸeri gÃ¼ncelle
    useEffect(() => {
        if (!isFocused) {
            setLocalValue(String(value ?? ""));
        }
    }, [value, isFocused]);

    // KullanÄ±cÄ± yazarken - sadece lokal state gÃ¼ncellenir
    const handleChange = useCallback((e) => {
        const inputValue = e.target.value;

        // BoÅŸ deÄŸere izin ver
        if (inputValue === "") {
            setLocalValue("");
            return;
        }

        // Nokta veya virgÃ¼lle biten ara deÄŸerlere izin ver (Ã¶rn: "2.", "2,")
        // Negatif iÅŸaretine izin ver
        if (inputValue === "-" || inputValue === "." || inputValue === ",") {
            setLocalValue(inputValue);
            return;
        }

        // VirgÃ¼lÃ¼ noktaya Ã§evir
        const sanitized = inputValue.replace(",", ".");

        // GeÃ§erli bir format mÄ± kontrol et:
        // SayÄ±lar, nokta, ve k/m/b harflerine izin ver
        // Ã–rnekler: "2", "2.", "2.5", "40k", "1.5kk", "2m", "1b"
        if (/^-?[\d.]*[kmb]*$/i.test(sanitized)) {
            setLocalValue(sanitized);
        }
    }, []);

    // DeÄŸeri commit et (blur veya Enter)
    const commitValue = useCallback(() => {
        // parseSuffixValue ile suffix'leri parse et (40k -> 40000, 1kk -> 1000000)
        let finalValue = parseSuffixValue(localValue);

        // GeÃ§ersiz deÄŸer ise min veya 0 kullan
        if (isNaN(finalValue)) {
            finalValue = min ?? 0;
        }

        // Min/Max sÄ±nÄ±rlarÄ± uygula
        if (min !== undefined && finalValue < min) {
            finalValue = min;
        }
        if (max !== undefined && finalValue > max) {
            finalValue = max;
        }

        // Lokal deÄŸeri gÃ¼ncelle (formatlanmÄ±ÅŸ hali - sayÄ± olarak)
        setLocalValue(String(finalValue));

        // Global state'i gÃ¼ncelle
        if (onChange) {
            onChange(finalValue);
        }
    }, [localValue, min, max, onChange]);

    // Focus olduÄŸunda
    const handleFocus = useCallback((e) => {
        setIsFocused(true);

        // EÄŸer deÄŸer 0 ise temizle (kolay dÃ¼zenleme iÃ§in)
        if (localValue === "0" || localValue === "") {
            setLocalValue("");
        }

        // TÃ¼m metni seÃ§
        e.target.select();

        if (onFocus) {
            onFocus(e);
        }
    }, [onFocus, localValue]);

    // Blur olduÄŸunda - deÄŸeri commit et
    const handleBlur = useCallback((e) => {
        setIsFocused(false);
        commitValue();
        if (externalOnBlur) {
            externalOnBlur(e);
        }
    }, [commitValue, externalOnBlur]);

    // Enter tuÅŸuna basÄ±ldÄ±ÄŸÄ±nda - deÄŸeri commit et
    const handleKeyDown = useCallback((e) => {
        if (e.key === "Enter") {
            e.target.blur();
        }
        // Escape tuÅŸuna basÄ±ldÄ±ÄŸÄ±nda orijinal deÄŸere dÃ¶n
        if (e.key === "Escape") {
            setLocalValue(String(value ?? ""));
            e.target.blur();
        }
    }, [value]);

    return (
        <input
            type="text"
            inputMode="decimal"
            value={localValue}
            onChange={handleChange}
            onFocus={handleFocus}
            onBlur={handleBlur}
            onKeyDown={handleKeyDown}
            placeholder={placeholder}
            disabled={disabled}
            className={className}
            autoComplete="off"
        />
    );
}

==================================================
DOSYA YOLU: .\app\components\ui\WidgetSkeleton.js
==================================================
import React from 'react';

export default function WidgetSkeleton() {
    return (
        <div className="relative h-64 rounded-3xl overflow-hidden bg-white/5 backdrop-blur-sm border border-white/5 animate-pulse">
            {/* Header Skeleton */}
            <div className="absolute top-0 left-0 right-0 h-16 bg-white/5 border-b border-white/5" />

            {/* Content Skeleton */}
            <div className="absolute inset-x-6 top-24 bottom-6 space-y-4">
                <div className="h-4 bg-white/10 rounded-full w-3/4" />
                <div className="h-4 bg-white/10 rounded-full w-1/2" />
                <div className="h-4 bg-white/10 rounded-full w-2/3" />
            </div>

            {/* Shine Effect */}
            <div className="absolute inset-0 bg-gradient-to-tr from-transparent via-white/5 to-transparent -translate-x-full animate-shimmer" />
        </div>
    );
}

==================================================
DOSYA YOLU: .\app\components\widgets\AnalysisWidget.js
==================================================
"use client";

import { useState, useMemo } from "react";
import { Calculator, Filter, CheckSquare } from "lucide-react";
import useWidgetStore from "../../store/useWidgetStore";
import {
    calculateAllMetins,
    getBestMetin,
    calculateMetinProfit
} from "../../lib/calculator";
import { useSharedWidgetData } from "../../hooks/useSharedWidgetData";
import AnalysisKPIs from "./analysis/AnalysisKPIs";
import AnalysisChart from "./analysis/AnalysisChart";
import AnalysisTable from "./analysis/AnalysisTable";
import BossRotationView from "./analysis/BossRotationView";
import SmartInput from "../ui/SmartInput";

// ============================================================================
// DETAIL VIEW LOGIC (Unchanged but adapted)
// ============================================================================
function AnalysisDetailView({ userStats, metinList, prices, multipliers, marketItems }) {
    const [chartType, setChartType] = useState("comparison");
    const [hourlyCost, setHourlyCost] = useState(0);

    const calculations = useMemo(() => {
        return calculateAllMetins(metinList, prices, multipliers, userStats, marketItems);
    }, [metinList, prices, multipliers, userStats, marketItems]);

    const bestMetin = getBestMetin(calculations);
    const topMetins = calculations.slice(0, 5);

    const comparisonData = useMemo(() => {
        return topMetins.map(calc => ({
            name: calc.metinName,
            profit: calc.hourlyProfit
        }));
    }, [topMetins]);

    const efficiencyData = useMemo(() => {
        if (!bestMetin || !userStats || !userStats.damage) return null;
        const currentDamage = userStats.damage;
        const minDamage = 100;
        const maxDamage = Math.max(currentDamage * 2, 10000);
        const step = Math.max(100, Math.floor(maxDamage / 50));
        const simulations = [];
        const targetMetins = topMetins.map(calc => metinList.find(m => m.id === calc.metinId)).filter(Boolean);

        for (let dmg = minDamage; dmg <= maxDamage; dmg += step) {
            const modifiedStats = { ...userStats, damage: dmg };
            const dataPoint = { damage: dmg };
            targetMetins.forEach(metin => {
                const result = calculateMetinProfit(metin, prices, multipliers, modifiedStats, marketItems);
                dataPoint[metin.name] = result.hourlyProfit - hourlyCost;
            });
            simulations.push(dataPoint);
        }
        return simulations;
    }, [bestMetin, prices, multipliers, userStats, hourlyCost, metinList, topMetins]);

    const softcapWarning = useMemo(() => {
        if (!bestMetin || !userStats) return null;
        if (bestMetin.killTime < userStats.findTime * 0.1) {
            return {
                active: true,
                message: "Metin kesme sÃ¼reniz, bulma sÃ¼renize gÃ¶re Ã§ok dÃ¼ÅŸÃ¼k. Hasar artÄ±ÅŸÄ± artÄ±k verimsiz."
            };
        }
        return { active: false };
    }, [bestMetin, userStats]);

    if (!bestMetin) {
        return <div className="text-zinc-500">Analiz iÃ§in veri bekleniyor...</div>;
    }

    const netHourlyProfit = bestMetin.hourlyProfit - hourlyCost;

    return (
        <div className="flex flex-col space-y-6 h-full overflow-y-auto pr-2 custom-scrollbar">
            <AnalysisKPIs
                bestMetin={bestMetin}
                netHourlyProfit={netHourlyProfit}
                hourlyCost={hourlyCost}
                setHourlyCost={setHourlyCost}
            />
            <div className="bg-zinc-900 border border-zinc-800 rounded-xl p-6">
                <AnalysisChart
                    chartType={chartType}
                    setChartType={setChartType}
                    comparisonData={comparisonData}
                    efficiencyData={efficiencyData}
                    userStats={userStats}
                    topMetins={topMetins}
                />
            </div>
            <AnalysisTable
                calculations={calculations}
                softcapWarning={softcapWarning}
            />
        </div>
    );
}

// ============================================================================
// MAIN WIDGET VIEW
// ============================================================================
export default function AnalysisWidget() {
    const { userStats, metinList, prices, multipliers, marketItems, bosses } = useSharedWidgetData();

    // Store baÄŸlantÄ±sÄ± - ayarlarÄ± persist etmek iÃ§in
    const activeWorkspaceId = useWidgetStore((state) => state.activeWorkspaceId);
    const workspace = useWidgetStore((state) =>
        state.workspaces.find(ws => ws.id === state.activeWorkspaceId)
    );
    const updateWidgetData = useWidgetStore((state) => state.updateWidgetData);

    // Store'dan ayarlarÄ± oku (varsayÄ±lan deÄŸerlerle)
    const settings = workspace?.data?.analysisSettings || {};
    const dailyPlayHours = settings.dailyPlayHours ?? 4;
    const activeTab = settings.activeTab ?? "metin";
    const hiddenMetinIds = settings.hiddenMetinIds ?? [];
    const showFilter = settings.showFilter ?? false;

    // AyarlarÄ± gÃ¼ncelleme fonksiyonu
    const updateSettings = (newSettings) => {
        const currentSettings = workspace?.data?.analysisSettings || {};
        updateWidgetData(activeWorkspaceId, {
            analysisSettings: { ...currentSettings, ...newSettings }
        });
    };

    // Setter fonksiyonlarÄ±
    const setDailyPlayHours = (value) => updateSettings({ dailyPlayHours: value });
    const setActiveTab = (value) => updateSettings({ activeTab: value });
    const setShowFilter = (value) => updateSettings({ showFilter: value });
    const setHiddenMetinIds = (value) => updateSettings({ hiddenMetinIds: value });

    const filteredMetinList = useMemo(() => {
        return metinList.filter(m => !hiddenMetinIds.includes(m.id));
    }, [metinList, hiddenMetinIds]);

    const toggleMetinVisibility = (metinId) => {
        if (hiddenMetinIds.includes(metinId)) {
            setHiddenMetinIds(hiddenMetinIds.filter(id => id !== metinId));
        } else {
            setHiddenMetinIds([...hiddenMetinIds, metinId]);
        }
    };

    return (
        <div className="w-full h-full flex flex-col p-8 space-y-6">
            {/* Header */}
            <div className="flex justify-between items-center">
                <div className="flex items-center gap-4">
                    <div className="p-3 bg-blue-900/20 rounded-xl border border-blue-800/50">
                        <Calculator className="w-8 h-8 text-blue-400" />
                    </div>
                    <div>
                        <h1 className="text-3xl font-bold text-zinc-100">Getiri Analizi</h1>
                        <p className="text-zinc-500 text-sm">Metin ve Boss karlÄ±lÄ±k simÃ¼lasyonu</p>
                    </div>
                </div>

                {/* Controls */}
                <div className="flex items-center gap-4">
                    <div className="flex items-center gap-2 bg-zinc-900 px-4 py-2 rounded-lg border border-zinc-800">
                        <span className="text-zinc-500 text-sm">GÃ¼nlÃ¼k SÃ¼re:</span>
                        <SmartInput
                            min={1}
                            max={24}
                            value={dailyPlayHours}
                            onChange={(val) => setDailyPlayHours(val)}
                            className="w-12 bg-transparent text-white font-bold text-center outline-none border-b border-zinc-700 focus:border-blue-500"
                        />
                    </div>

                    <div className="flex bg-zinc-900 rounded-lg p-1 border border-zinc-800">
                        <button
                            onClick={() => setActiveTab("metin")}
                            className={`px-4 py-2 rounded-md text-sm font-medium transition-colors ${activeTab === 'metin' ? 'bg-blue-600 text-white' : 'text-zinc-400 hover:text-white'}`}
                        >
                            Metin
                        </button>
                        <button
                            onClick={() => setActiveTab("boss")}
                            className={`px-4 py-2 rounded-md text-sm font-medium transition-colors ${activeTab === 'boss' ? 'bg-fuchsia-600 text-white' : 'text-zinc-400 hover:text-white'}`}
                        >
                            Boss
                        </button>
                    </div>

                    {activeTab === 'metin' && (
                        <div className="relative">
                            <button
                                onClick={() => setShowFilter(!showFilter)}
                                className={`p-3 rounded-lg border transition-colors ${showFilter ? 'bg-zinc-800 text-white border-zinc-600' : 'bg-zinc-900 text-zinc-400 border-zinc-800 hover:text-white'}`}
                            >
                                <Filter size={20} />
                            </button>
                            {/* Filter Dropdown */}
                            {showFilter && (
                                <div className="absolute right-0 top-full mt-2 w-64 bg-zinc-900 border border-zinc-800 rounded-xl shadow-2xl p-4 z-50 max-h-96 overflow-y-auto custom-scrollbar">
                                    <h4 className="text-white font-semibold mb-2">Metin Filtresi</h4>
                                    {metinList.map(metin => (
                                        <label key={metin.id} className="flex items-center gap-2 p-2 hover:bg-zinc-800 rounded cursor-pointer">
                                            <div className={`w-4 h-4 rounded border flex items-center justify-center ${!hiddenMetinIds.includes(metin.id) ? 'bg-blue-600 border-blue-600' : 'border-zinc-600'}`}>
                                                {!hiddenMetinIds.includes(metin.id) && <CheckSquare size={12} className="text-white" />}
                                            </div>
                                            <span className="text-zinc-300 text-sm">{metin.name}</span>
                                            <input type="checkbox" className="hidden" checked={!hiddenMetinIds.includes(metin.id)} onChange={() => toggleMetinVisibility(metin.id)} />
                                        </label>
                                    ))}
                                </div>
                            )}
                        </div>
                    )}
                </div>
            </div>

            {/* Content Area */}
            <div className="flex-1 overflow-hidden">
                {activeTab === "metin" ? (
                    <AnalysisDetailView
                        userStats={userStats}
                        metinList={filteredMetinList}
                        prices={prices}
                        multipliers={multipliers}
                        marketItems={marketItems}
                    />
                ) : (
                    <BossRotationView
                        userStats={userStats}
                        bosses={bosses}
                        prices={prices}
                        marketItems={marketItems}
                        dailyPlayHours={dailyPlayHours}
                    />
                )}
            </div>
        </div>
    );
}

==================================================
DOSYA YOLU: .\app\components\widgets\BossSettingsWidget.js
==================================================
"use client";

import { useState } from "react";
import { Plus, Trash2, Shield, Search, Sparkles } from "lucide-react";
import useWidgetStore from "../../store/useWidgetStore";
import SmartInput from "../ui/SmartInput";

// Helper for classes
const cn = (...classes) => classes.filter(Boolean).join(" ");

// ============================================================================
// SUB-COMPONENTS
// ============================================================================

// 1. Drop Editor (Table Style)
function DropEditor({ drops, onUpdate }) {
    const marketItems = useWidgetStore((state) => state.masterRegistry) || [];
    const [searchQuery, setSearchQuery] = useState("");
    const [showSearch, setShowSearch] = useState(false);

    // Default new drop
    const [newDrop, setNewDrop] = useState({ itemId: "", chance: 10, count: 1 });

    const filteredMarketItems = marketItems.filter(item =>
        item.name.toLowerCase().includes(searchQuery.toLowerCase())
    ).slice(0, 10);

    const handleAdd = () => {
        if (!newDrop.itemId) return;
        onUpdate([...drops, { ...newDrop, sourceType: 'market' }]);
        setNewDrop({ itemId: "", chance: 10, count: 1 });
        setSearchQuery("");
        setShowSearch(false);
    };

    const handleRemove = (index) => {
        const newDrops = [...drops];
        newDrops.splice(index, 1);
        onUpdate(newDrops);
    };

    // Updating a specific drop row inline
    const handleRowUpdate = (index, field, value) => {
        const newDrops = [...drops];
        newDrops[index] = { ...newDrops[index], [field]: value };
        onUpdate(newDrops);
    };

    return (
        <div className="space-y-4">
            <h4 className="text-zinc-400 text-sm font-semibold flex items-center gap-2">
                <Sparkles size={16} />
                Drop Listesi
            </h4>

            {/* Drop Table */}
            <div className="w-full border border-zinc-800 rounded-lg overflow-hidden">
                <table className="w-full text-left text-sm">
                    <thead className="bg-zinc-900 border-b border-zinc-800 text-zinc-400">
                        <tr>
                            <th className="p-3 font-medium">EÅŸya AdÄ±</th>
                            <th className="p-3 font-medium w-32">Miktar</th>
                            <th className="p-3 font-medium w-32">Åans (%)</th>
                            <th className="p-3 w-12"></th>
                        </tr>
                    </thead>
                    <tbody className="divide-y divide-zinc-800 bg-zinc-950/50">
                        {drops.map((drop, idx) => {
                            const item = marketItems.find(i => i.id === drop.itemId);
                            return (
                                <tr key={idx} className="group hover:bg-zinc-900/50">
                                    <td className="p-3 text-zinc-300">
                                        <div className="flex items-center gap-2">
                                            <div className="w-6 h-6 rounded-full bg-zinc-800 border border-zinc-700 flex items-center justify-center text-xs">
                                                {/* Icon placeholder if available */}
                                                <div className="w-3 h-3 rounded-full bg-blue-500/50" />
                                            </div>
                                            {item?.name || "Bilinmeyen EÅŸya"}
                                        </div>
                                    </td>
                                    <td className="p-2">
                                        <SmartInput
                                            value={drop.count}
                                            onChange={(val) => handleRowUpdate(idx, 'count', val)}
                                            className="w-full bg-zinc-900 border border-zinc-800 rounded px-2 py-1 text-zinc-300 focus:border-blue-500 outline-none"
                                            min={1}
                                        />
                                    </td>
                                    <td className="p-2">
                                        <SmartInput
                                            value={drop.chance}
                                            onChange={(val) => handleRowUpdate(idx, 'chance', val)}
                                            className="w-full bg-zinc-900 border border-zinc-800 rounded px-2 py-1 text-zinc-300 focus:border-blue-500 outline-none"
                                            min={0}
                                            max={100}
                                        />
                                    </td>
                                    <td className="p-2 text-right">
                                        <button onClick={() => handleRemove(idx)} className="text-zinc-600 hover:text-red-400 p-1">
                                            <Trash2 size={16} />
                                        </button>
                                    </td>
                                </tr>
                            );
                        })}
                        {drops.length === 0 && (
                            <tr>
                                <td colSpan={4} className="p-4 text-center text-zinc-600 italic">HenÃ¼z drop eklenmemiÅŸ.</td>
                            </tr>
                        )}
                    </tbody>
                </table>
            </div>

            {/* Quick Add Row */}
            <div className="bg-zinc-900/50 border border-zinc-800 p-3 rounded-lg flex items-center gap-3">
                <div className="relative flex-1">
                    {!showSearch ? (
                        <button onClick={() => setShowSearch(true)} className="w-full text-left text-zinc-500 hover:text-zinc-300 text-sm flex items-center gap-2">
                            <Plus size={16} /> EÅŸya seÃ§...
                        </button>
                    ) : (
                        <div>
                            <div className="relative">
                                <Search className="absolute left-2 top-2.5 w-4 h-4 text-zinc-500" />
                                <input
                                    autoFocus
                                    type="text"
                                    placeholder="EÅŸya Ara..."
                                    className="w-full bg-zinc-950 border border-blue-500/50 rounded pl-8 p-2 text-sm text-white outline-none"
                                    value={searchQuery}
                                    onChange={e => setSearchQuery(e.target.value)}
                                    onBlur={() => setTimeout(() => !newDrop.itemId && setShowSearch(false), 200)}
                                />
                            </div>
                            {/* Autocomplete Dropdown */}
                            {searchQuery && (
                                <div className="absolute top-full left-0 w-full bg-zinc-900 border border-zinc-700 rounded-lg mt-1 max-h-40 overflow-y-auto z-50 shadow-xl">
                                    {filteredMarketItems.map(item => (
                                        <button
                                            key={item.id}
                                            className="w-full text-left p-2 hover:bg-zinc-800 text-sm text-zinc-300 flex items-center gap-2"
                                            onMouseDown={() => {
                                                setNewDrop({ ...newDrop, itemId: item.id });
                                                setSearchQuery(item.name); // keep name visible or reset? keeping name visible is better UX usually but here we just select internal ID
                                                setShowSearch(false);
                                            }}
                                        >
                                            {item.name}
                                        </button>
                                    ))}
                                </div>
                            )}
                        </div>
                    )}
                </div>

                {/* Only show inputs if item selected or searching to add directly?? Actually easier to just always show inputs enabled but button disabled */}
                <div className="w-24">
                    <SmartInput
                        placeholder="Adet"
                        className="w-full bg-zinc-950 border border-zinc-800 rounded px-2 py-2 text-sm text-white focus:border-blue-500 outline-none"
                        value={newDrop.count}
                        onChange={(val) => setNewDrop({ ...newDrop, count: val })}
                        min={1}
                    />
                </div>
                <div className="w-24">
                    <SmartInput
                        placeholder="Åans %"
                        className="w-full bg-zinc-950 border border-zinc-800 rounded px-2 py-2 text-sm text-white focus:border-blue-500 outline-none"
                        value={newDrop.chance}
                        onChange={(val) => setNewDrop({ ...newDrop, chance: val })}
                        min={0}
                        max={100}
                    />
                </div>
                <button
                    onClick={handleAdd}
                    disabled={!newDrop.itemId}
                    className="p-2 bg-blue-600 hover:bg-blue-500 text-white rounded disabled:opacity-50 disabled:cursor-not-allowed"
                >
                    <Plus size={18} />
                </button>
            </div>
        </div>
    );
}

// ============================================================================
// MAIN VIEW COMPONENT
// ============================================================================
export default function BossSettingsWidget() {
    const bosses = useWidgetStore((state) => state.bosses) || [];
    const addBoss = useWidgetStore((state) => state.addBoss);
    const updateBoss = useWidgetStore((state) => state.updateBoss);
    const removeBoss = useWidgetStore((state) => state.removeBoss);

    const [selectedBossId, setSelectedBossId] = useState(bosses[0]?.id || null);

    const activeBoss = bosses.find(b => b.id === selectedBossId);

    const handleCreateNew = () => {
        const newId = crypto.randomUUID(); // Need UUID but store might handle it or we pass it? addBoss usually generates it or we pass data.
        // Looking at previous code `addBoss({ name... })`. So likely store generates ID or pushes object.
        addBoss({
            name: "Yeni Boss",
            hp: 1000000,
            constraints: { cooldown: 60, dailyLimit: 0, minLevel: 75, cooldownType: 'entry' },
            drops: []
        });
        // Select logic might be tricky without ID return, typically we'd wait for store update or select last item effect.
        // For simplicity, we just add it, user clicks it.
    };

    return (
        <div className="w-full h-full flex bg-zinc-950 text-zinc-100 overflow-hidden font-sans">

            {/* LEFT PANEL: LIST (30%) */}
            <div className="w-[300px] flex-shrink-0 border-r border-zinc-800 flex flex-col bg-zinc-950/50">
                <div className="p-4 border-b border-zinc-800">
                    <button
                        onClick={handleCreateNew}
                        className="w-full py-2.5 bg-blue-600 hover:bg-blue-500 text-white rounded-lg font-medium shadow-lg shadow-blue-900/20 flex items-center justify-center gap-2 transition-all"
                    >
                        <Plus size={18} /> Yeni Boss Ekle
                    </button>
                </div>
                <div className="flex-1 overflow-y-auto p-2 space-y-1 custom-scrollbar">
                    {bosses.map(boss => (
                        <div
                            key={boss.id}
                            onClick={() => setSelectedBossId(boss.id)}
                            className={cn(
                                "flex items-center justify-between p-3 rounded-lg cursor-pointer transition-colors group relative",
                                selectedBossId === boss.id
                                    ? "bg-blue-600/10 border border-blue-600/50"
                                    : "hover:bg-zinc-900 border border-transparent"
                            )}
                        >
                            <div className="flex items-center gap-3">
                                <div className={cn(
                                    "w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold",
                                    selectedBossId === boss.id ? "bg-blue-600 text-white" : "bg-zinc-800 text-zinc-500"
                                )}>
                                    {boss.name.charAt(0).toUpperCase()}
                                </div>
                                <div>
                                    <div className={cn("font-medium text-sm", selectedBossId === boss.id ? "text-white" : "text-zinc-400")}>
                                        {boss.name}
                                    </div>
                                    <div className="text-[10px] text-zinc-600">{boss.constraints?.cooldown || 0}dk CD</div>
                                </div>
                            </div>

                            {/* Delete Button (visible on hover) */}
                            <button
                                onClick={(e) => { e.stopPropagation(); removeBoss(boss.id); if (selectedBossId === boss.id) setSelectedBossId(null); }}
                                className="opacity-0 group-hover:opacity-100 p-1.5 hover:bg-red-500/20 text-zinc-500 hover:text-red-400 rounded transition-all"
                            >
                                <Trash2 size={14} />
                            </button>
                        </div>
                    ))}
                </div>
            </div>

            {/* RIGHT PANEL: DETAILS (70%) */}
            <div className="flex-1 flex flex-col h-full bg-zinc-950">
                {activeBoss ? (
                    <div className="flex-1 overflow-y-auto p-8">
                        {/* Header Inputs */}
                        <div className="flex items-end gap-6 mb-8 border-b border-zinc-800 pb-6">
                            <div className="w-20 h-20 rounded-2xl bg-zinc-900 border-2 border-zinc-800 flex items-center justify-center shadow-inner">
                                <Shield size={32} className="text-zinc-600" />
                            </div>
                            <div className="flex-1 space-y-4">
                                <div>
                                    <label className="text-xs font-semibold text-zinc-500 uppercase tracking-wider block mb-1">Boss AdÄ±</label>
                                    <input
                                        type="text"
                                        value={activeBoss.name}
                                        onChange={(e) => updateBoss(activeBoss.id, { name: e.target.value })}
                                        className="w-full bg-transparent text-3xl font-bold text-white outline-none placeholder-zinc-700 border-b border-transparent focus:border-blue-500 transition-colors"
                                        placeholder="Boss AdÄ± Girin"
                                    />
                                </div>
                                <div className="flex gap-4">
                                    <div className="flex-1">
                                        <label className="text-xs text-zinc-500 block mb-1">HP (Can PuanÄ±)</label>
                                        <SmartInput
                                            value={activeBoss.hp}
                                            onChange={(val) => updateBoss(activeBoss.id, { hp: val })}
                                            className="w-full bg-zinc-900 border border-zinc-800 rounded px-3 py-2 text-sm text-zinc-200 focus:border-blue-500 outline-none"
                                            min={0}
                                        />
                                    </div>
                                    <div className="flex-1">
                                        <label className="text-xs text-zinc-500 block mb-1">Min. Seviye</label>
                                        <SmartInput
                                            value={activeBoss.constraints?.minLevel || 0}
                                            onChange={(val) => updateBoss(activeBoss.id, { constraints: { ...activeBoss.constraints, minLevel: val } })}
                                            className="w-full bg-zinc-900 border border-zinc-800 rounded px-3 py-2 text-sm text-zinc-200 focus:border-blue-500 outline-none"
                                            min={0}
                                        />
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Constraints Grid */}
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                            <div>
                                <label className="text-xs font-semibold text-zinc-500 uppercase block mb-2">SoÄŸuma (Cooldown)</label>
                                <div className="flex items-center gap-2">
                                    <SmartInput
                                        value={activeBoss.constraints?.cooldown || 0}
                                        onChange={(val) => updateBoss(activeBoss.id, { constraints: { ...activeBoss.constraints, cooldown: val } })}
                                        className="flex-1 bg-zinc-900 border border-zinc-800 rounded px-3 py-2 text-sm text-white focus:border-blue-500 outline-none"
                                        min={0}
                                    />
                                    <span className="text-zinc-600 text-sm">dk</span>
                                </div>
                            </div>
                            <div>
                                <label className="text-xs font-semibold text-zinc-500 uppercase block mb-2">Zindan SÃ¼resi</label>
                                <div className="flex items-center gap-2">
                                    <SmartInput
                                        value={activeBoss.fixedRunTime || 5}
                                        onChange={(val) => updateBoss(activeBoss.id, { fixedRunTime: val })}
                                        className="flex-1 bg-zinc-900 border border-zinc-800 rounded px-3 py-2 text-sm text-white focus:border-blue-500 outline-none"
                                        min={0}
                                    />
                                    <span className="text-zinc-600 text-sm">dk</span>
                                </div>
                            </div>
                            <div>
                                <label className="text-xs font-semibold text-zinc-500 uppercase block mb-2">GÃ¼nlÃ¼k GiriÅŸ SÄ±nÄ±rÄ±</label>
                                <div className="flex items-center gap-2">
                                    <SmartInput
                                        value={activeBoss.constraints?.dailyLimit || 0}
                                        onChange={(val) => updateBoss(activeBoss.id, { constraints: { ...activeBoss.constraints, dailyLimit: val } })}
                                        className="flex-1 bg-zinc-900 border border-zinc-800 rounded px-3 py-2 text-sm text-white focus:border-blue-500 outline-none"
                                        min={0}
                                    />
                                    <span className="text-zinc-600 text-sm">kez</span>
                                </div>
                            </div>
                        </div>

                        {/* Cooldown Type Toggle */}
                        <div className="mb-8">
                            <label className="text-xs font-semibold text-zinc-500 uppercase block mb-2">SoÄŸuma Tipi</label>
                            <div className="inline-flex bg-zinc-900 p-1 rounded-lg border border-zinc-800">
                                <button
                                    onClick={() => updateBoss(activeBoss.id, { constraints: { ...activeBoss.constraints, cooldownType: 'entry' } })}
                                    className={cn(
                                        "px-4 py-1.5 text-xs font-medium rounded transition-colors",
                                        (activeBoss.constraints?.cooldownType || 'entry') === 'entry' ? "bg-zinc-700 text-white" : "text-zinc-500 hover:text-zinc-300"
                                    )}
                                >
                                    GiriÅŸ AnÄ±nda BaÅŸlar
                                </button>
                                <button
                                    onClick={() => updateBoss(activeBoss.id, { constraints: { ...activeBoss.constraints, cooldownType: 'exit' } })}
                                    className={cn(
                                        "px-4 py-1.5 text-xs font-medium rounded transition-colors",
                                        activeBoss.constraints?.cooldownType === 'exit' ? "bg-zinc-700 text-white" : "text-zinc-500 hover:text-zinc-300"
                                    )}
                                >
                                    Ã‡Ä±kÄ±ÅŸ AnÄ±nda BaÅŸlar
                                </button>
                            </div>
                        </div>

                        {/* Drop Editor Section */}
                        <div className="pt-6 border-t border-zinc-800">
                            <DropEditor
                                drops={activeBoss.drops || []}
                                onUpdate={(newDrops) => updateBoss(activeBoss.id, { drops: newDrops })}
                            />
                        </div>

                    </div>
                ) : (
                    <div className="flex-1 flex items-center justify-center flex-col text-zinc-600">
                        <Shield size={48} className="mb-4 text-zinc-800" />
                        <p className="text-lg">DÃ¼zenlemek iÃ§in soldan bir boss seÃ§in</p>
                        <p className="text-sm">veya yeni bir tane ekleyin.</p>
                    </div>
                )}
            </div>
        </div>
    );
}

==================================================
DOSYA YOLU: .\app\components\widgets\CharacterWidget.js
==================================================
"use client";

import { motion } from "framer-motion";
import { X, EyeOff, Sword, Zap, Clock } from "lucide-react";
import useWidgetStore from "../../store/useWidgetStore";
import SmartInput from "../ui/SmartInput";

// Helper: Format compact with safety check
const formatCompact = (number) => {
    if (number === undefined || number === null || isNaN(number)) return "0";
    if (number >= 1000000) {
        return `${(number / 1000000).toFixed(1)}M`;
    } else if (number >= 1000) {
        return `${(number / 1000).toFixed(1)}k`;
    }
    return number.toString();
};

// ============================================================================
// SUMMARY VIEW
// ============================================================================
function CharacterSummaryView({ stats }) {
    return (
        <div className="flex flex-col items-center justify-center h-full w-full overflow-hidden px-4">
            <div className="flex items-center gap-3 mb-3">
                <div className="p-2 bg-white/10 backdrop-blur-sm rounded-lg border border-white/10">
                    <Sword className="w-8 h-8 text-violet-400" />
                </div>
            </div>
            <span className="text-3xl font-bold text-white whitespace-nowrap font-mono">
                {formatCompact(stats.damage)} Hasar
            </span>
            <div className="flex items-center gap-4 mt-2 text-sm text-white/60">
                <span className="flex items-center gap-1">
                    <Zap className="w-4 h-4 text-cyan-400" />
                    <span className="font-mono">{stats.hitsPerSecond || 0}</span> v/sn
                </span>
                <span className="flex items-center gap-1">
                    <Clock className="w-4 h-4 text-blue-400" />
                    <span className="font-mono">{stats.findTime || 0}</span>s
                </span>
            </div>
        </div>
    );
}

// ============================================================================
// DETAIL VIEW
// ============================================================================
function CharacterDetailView({ widgetId, stats }) {
    const updateWidgetData = useWidgetStore((state) => state.updateWidgetData);

    const handleChange = (field, value) => {
        updateWidgetData(widgetId, { [field]: value });
    };

    return (
        <div className="space-y-6 h-full flex flex-col">
            {/* Info Banner */}
            <div className="bg-black/20 backdrop-blur-xl p-4 rounded-xl border border-white/5">
                <div className="flex items-start gap-3">
                    <div className="p-2 bg-violet-500/10 backdrop-blur-sm rounded-lg border border-violet-500/20">
                        <Sword className="w-5 h-5 text-violet-400" />
                    </div>
                    <div>
                        <h3 className="font-semibold text-white mb-1">Karakter Ä°statistikleri</h3>
                        <p className="text-sm text-white/70">
                            Metin kesme hÄ±zÄ±nÄ±zÄ± ve karlÄ±lÄ±ÄŸÄ±nÄ±zÄ± hesaplamak iÃ§in gerekli bilgiler.
                            DeÄŸerler anlÄ±k olarak kaydedilir.
                        </p>
                    </div>
                </div>
            </div>

            {/* Stats Inputs */}
            <div className="flex-1 space-y-4">
                {/* Damage */}
                <div className="bg-black/20 backdrop-blur-xl p-5 rounded-2xl border border-white/5 shadow-sm hover:border-violet-500/20 transition-colors">
                    <div className="flex items-center gap-3 mb-3">
                        <div className="p-2 bg-violet-500/10 backdrop-blur-sm rounded-lg border border-violet-500/20">
                            <Sword className="w-5 h-5 text-violet-400" />
                        </div>
                        <div className="flex-1">
                            <label className="block text-sm font-semibold text-white">
                                Ortalama Hasar (VuruÅŸ BaÅŸÄ±na)
                            </label>
                            <p className="text-xs text-white/60 mt-0.5">
                                Bir vuruÅŸta verdiÄŸiniz ortalama hasarÄ± girin
                            </p>
                        </div>
                    </div>
                    <SmartInput
                        value={stats.damage || 0}
                        onChange={(val) => handleChange('damage', val)}
                        className="w-full px-4 py-3 text-lg font-mono font-semibold text-white bg-black/60 border border-white/10 rounded-xl focus:outline-none focus:ring-2 focus:ring-violet-500/20 focus:border-violet-500/50 transition-all placeholder:text-white/20"
                        placeholder="3000"
                        min={0}
                        step={100}
                    />
                </div>

                {/* Hits Per Second */}
                <div className="bg-black/20 backdrop-blur-xl p-5 rounded-2xl border border-white/5 shadow-sm hover:border-cyan-500/20 transition-colors">
                    <div className="flex items-center gap-3 mb-3">
                        <div className="p-2 bg-cyan-500/10 backdrop-blur-sm rounded-lg border border-cyan-500/20">
                            <Zap className="w-5 h-5 text-cyan-400" />
                        </div>
                        <div className="flex-1">
                            <label className="block text-sm font-semibold text-white">
                                Saniye BaÅŸÄ±na VuruÅŸ (SaldÄ±rÄ± HÄ±zÄ±)
                            </label>
                            <p className="text-xs text-white/60 mt-0.5">
                                Bir saniyede kaÃ§ kez vurduÄŸunuzu girin
                            </p>
                        </div>
                    </div>
                    <SmartInput
                        value={stats.hitsPerSecond || 0}
                        onChange={(val) => handleChange('hitsPerSecond', val)}
                        className="w-full px-4 py-3 text-lg font-mono font-semibold text-white bg-black/60 border border-white/10 rounded-xl focus:outline-none focus:ring-2 focus:ring-cyan-500/20 focus:border-cyan-500/50 transition-all placeholder:text-white/20"
                        placeholder="2.5"
                        min={0}
                        step={0.1}
                    />
                </div>

                {/* Find Time */}
                <div className="bg-black/20 backdrop-blur-xl p-5 rounded-2xl border border-white/5 shadow-sm hover:border-blue-500/20 transition-colors">
                    <div className="flex items-center gap-3 mb-3">
                        <div className="p-2 bg-blue-500/10 backdrop-blur-sm rounded-lg border border-blue-500/20">
                            <Clock className="w-5 h-5 text-blue-400" />
                        </div>
                        <div className="flex-1">
                            <label className="block text-sm font-semibold text-white">
                                Metin Bulma SÃ¼resi (Saniye)
                            </label>
                            <p className="text-xs text-white/60 mt-0.5">
                                Bir metinden diÄŸerine geÃ§iÅŸ sÃ¼resi
                            </p>
                        </div>
                    </div>
                    <SmartInput
                        value={stats.findTime || 0}
                        onChange={(val) => handleChange('findTime', val)}
                        className="w-full px-4 py-3 text-lg font-mono font-semibold text-white bg-black/60 border border-white/10 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500/50 transition-all placeholder:text-white/20"
                        placeholder="10"
                        min={0}
                        step={1}
                    />
                </div>
            </div>

            {/* Stats Summary */}
            <div className="bg-black/20 backdrop-blur-sm p-4 rounded-xl border border-white/5">
                <h4 className="text-sm font-semibold text-white/80 mb-2">Hesaplanan DeÄŸerler</h4>
                <div className="grid grid-cols-2 gap-3 text-sm">
                    <div className="bg-black/40 backdrop-blur-sm p-3 rounded-lg border border-white/5">
                        <p className="text-white/60 text-xs">DPS (Saniye BaÅŸÄ±na)</p>
                        <p className="text-lg font-bold text-violet-400 font-mono">
                            {formatCompact((stats.damage || 0) * (stats.hitsPerSecond || 0))}
                        </p>
                    </div>
                    <div className="bg-black/40 backdrop-blur-sm p-3 rounded-lg border border-white/5">
                        <p className="text-white/60 text-xs">Toplam DÃ¶ngÃ¼ SÃ¼resi</p>
                        <p className="text-lg font-bold text-blue-400 font-mono">
                            ~{stats.findTime || 0}+ sn
                        </p>
                    </div>
                </div>
            </div>
        </div>
    );
}

// ============================================================================
// MAIN WIDGET
// ============================================================================
export default function CharacterWidget({ id, data, isSelected, onClick, onHide }) {
    // Use widget data or defaults (FALLBACK)
    const stats = data || { damage: 3000, hitsPerSecond: 2.5, findTime: 10 };

    return (
        <motion.div
            layoutId={`card-${id}`}
            layout
            onClick={!isSelected ? onClick : undefined}
            className={`group rounded-3xl shadow-2xl cursor-pointer overflow-hidden ${isSelected
                ? "fixed inset-0 m-auto w-[90%] h-[90%] max-w-6xl z-[100] bg-black/80 backdrop-blur-xl border border-white/10"
                : "relative h-64 hover:-translate-y-1 glass-panel hover:border-violet-400/50 transition-all duration-300"
                }`}
            transition={{ type: "spring", stiffness: 300, damping: 30 }}
        >
            {/* Summary View */}
            {!isSelected && (
                <>
                    {/* Hide Button */}
                    <motion.button
                        whileHover={{ scale: 1.1 }}
                        whileTap={{ scale: 0.9 }}
                        onClick={(e) => {
                            e.stopPropagation();
                            onHide && onHide();
                        }}
                        className="absolute top-4 right-4 z-20 p-2 bg-white/10 backdrop-blur-sm shadow-lg rounded-full opacity-0 group-hover:opacity-100 transition-opacity text-white/60 hover:text-violet-400 hover:bg-violet-500/20 border border-white/20"
                    >
                        <EyeOff className="w-4 h-4" />
                    </motion.button>

                    <div className="w-full h-full p-6 relative">
                        <Sword className="absolute -bottom-4 -right-4 w-32 h-32 text-white/5 opacity-50 rotate-12 pointer-events-none" />
                        <CharacterSummaryView stats={stats} />
                    </div>
                </>
            )}

            {/* Detail View */}
            {isSelected && (
                <div className="flex flex-col h-full bg-black/20">
                    <div className="flex items-center justify-between p-8 border-b border-white/10 bg-black/40 backdrop-blur-xl">
                        <div className="flex items-center gap-4">
                            <div className="p-3 bg-violet-500/10 backdrop-blur-sm rounded-2xl border border-violet-500/20">
                                <Sword className="w-8 h-8 text-violet-400" />
                            </div>
                            <div>
                                <motion.h2 layoutId={`title-${id}`} className="text-2xl font-bold text-white">
                                    Karakterim
                                </motion.h2>
                                <p className="text-white/60">SavaÅŸ istatistiklerinizi yÃ¶netin</p>
                            </div>
                        </div>
                        <button
                            onClick={(e) => {
                                e.stopPropagation();
                                onClick();
                            }}
                            className="p-2 hover:bg-white/10 rounded-full transition-colors backdrop-blur-sm border border-white/10 hover:border-white/20"
                        >
                            <X className="w-6 h-6 text-white/80" />
                        </button>
                    </div>
                    <div className="flex-1 p-8 overflow-y-auto">
                        <CharacterDetailView widgetId={id} stats={stats} />
                    </div>
                </div>
            )}
        </motion.div>
    );
}

==================================================
DOSYA YOLU: .\app\components\widgets\CraftingSimulatorHub.js
==================================================
"use client";

import { useState } from "react";
import { Sparkles, FlaskConical, Hammer, Lock, Gem } from "lucide-react";
import SashCraftingPanel from "./simulators/SashCraftingPanel";
import AlchemyPanel from "./simulators/AlchemyPanel";
import BlacksmithPanel from "./simulators/BlacksmithPanel";

// ============================================================================
// SIMULATOR TABS
// ============================================================================

const SIMULATOR_TABS = [
    {
        id: "sash",
        label: "KuÅŸak Sistemi",
        icon: Sparkles,
        active: true,
        description: "KuÅŸak birleÅŸtirme maliyet simÃ¼lasyonu"
    },
    {
        id: "alchemy",
        label: "Ejderha SimyasÄ±",
        icon: Gem,
        active: true,
        description: "Dragon Soul Alchemy simÃ¼lasyonu"
    },
    {
        id: "blacksmith",
        label: "Demirci",
        icon: Hammer,
        active: true,
        description: "YÃ¼kseltme stratejisi simÃ¼lasyonu"
    }
];

// ============================================================================
// MAIN COMPONENT
// ============================================================================

export default function CraftingSimulatorHub() {
    const [activeSimulator, setActiveSimulator] = useState("sash");

    return (
        <div className="flex h-full">
            {/* Sidebar - Tab Menu */}
            <aside className="w-56 bg-zinc-900/50 border-r border-zinc-800 flex flex-col shrink-0">
                {/* Header */}
                <div className="p-4 border-b border-zinc-800/50">
                    <div className="flex items-center gap-2">
                        <div className="p-2 bg-violet-500/10 rounded-lg border border-violet-500/20">
                            <FlaskConical className="w-5 h-5 text-violet-400" />
                        </div>
                        <div>
                            <h2 className="text-sm font-semibold text-white">
                                SimÃ¼latÃ¶rler
                            </h2>
                            <p className="text-xs text-zinc-500">Monte Carlo</p>
                        </div>
                    </div>
                </div>

                {/* Tab List */}
                <nav className="flex-1 p-3 space-y-1 overflow-y-auto">
                    {SIMULATOR_TABS.map((tab) => {
                        const Icon = tab.icon;
                        const isActive = activeSimulator === tab.id;
                        const isDisabled = !tab.active;

                        return (
                            <button
                                key={tab.id}
                                onClick={() => !isDisabled && setActiveSimulator(tab.id)}
                                disabled={isDisabled}
                                className={`
                                    w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-left transition-all duration-200
                                    ${isActive
                                        ? "bg-violet-500/20 border border-violet-500/30 text-white"
                                        : isDisabled
                                            ? "text-zinc-600 cursor-not-allowed"
                                            : "text-zinc-400 hover:text-zinc-100 hover:bg-zinc-800/50 border border-transparent"
                                    }
                                `}
                            >
                                <div className={`
                                    p-1.5 rounded-md
                                    ${isActive
                                        ? "bg-violet-500/20"
                                        : isDisabled
                                            ? "bg-zinc-800/50"
                                            : "bg-zinc-800"
                                    }
                                `}>
                                    {isDisabled ? (
                                        <Lock className="w-4 h-4 text-zinc-600" />
                                    ) : (
                                        <Icon className={`w-4 h-4 ${isActive ? "text-violet-400" : "text-zinc-500"}`} />
                                    )}
                                </div>
                                <div className="flex-1 min-w-0">
                                    <p className={`text-sm font-medium truncate ${isDisabled ? "text-zinc-600" : ""}`}>
                                        {tab.label}
                                    </p>
                                    <p className={`text-xs truncate ${isActive ? "text-violet-400/70" : "text-zinc-600"}`}>
                                        {tab.description}
                                    </p>
                                </div>
                            </button>
                        );
                    })}
                </nav>

                {/* Footer Info */}
                <div className="p-3 border-t border-zinc-800/50">
                    <div className="bg-zinc-800/30 rounded-lg p-3 border border-zinc-700/50">
                        <p className="text-xs text-zinc-500 leading-relaxed">
                            ğŸ’¡ Monte Carlo simÃ¼lasyonu, binlerce deneme yaparak
                            ortalama maliyeti hesaplar.
                        </p>
                    </div>
                </div>
            </aside>

            {/* Main Content Area */}
            <main className="flex-1 overflow-hidden bg-zinc-950">
                {activeSimulator === "sash" && <SashCraftingPanel />}
                {activeSimulator === "alchemy" && <AlchemyPanel />}
                {activeSimulator === "blacksmith" && <BlacksmithPanel />}

                {/* Placeholder for disabled simulators */}
                {!['sash', 'alchemy', 'blacksmith'].includes(activeSimulator) && (
                    <div className="h-full flex items-center justify-center">
                        <div className="text-center">
                            <Lock className="w-16 h-16 text-zinc-700 mx-auto mb-4" />
                            <h3 className="text-lg font-semibold text-zinc-400 mb-2">
                                YakÄ±nda
                            </h3>
                            <p className="text-sm text-zinc-600">
                                Bu simÃ¼latÃ¶r henÃ¼z hazÄ±r deÄŸil.
                            </p>
                        </div>
                    </div>
                )}
            </main>
        </div>
    );
}

==================================================
DOSYA YOLU: .\app\components\widgets\CraftingWidget.js
==================================================
"use client";

import { useState, useMemo } from "react";
import { Wrench, Plus, Trash2, Package, Sparkles, PieChart, Search, X, Check } from "lucide-react";
import useWidgetStore from "../../store/useWidgetStore";
import { resolveItemPrice } from "../../lib/math/core";
import { formatCurrency } from "../../lib/math/formatters";
import { useSharedWidgetData } from "../../hooks/useSharedWidgetData";
import { useCraftingSync, hasCircularDependency } from "../../hooks/useCraftingSync";
import SmartInput from "../ui/SmartInput";

// ============================================================================
// SUB-COMPONENTS
// ============================================================================

// 1. Content Editor Table (Inline Edit)
function ContentEditorTable({ item, marketItems, craftingItems, onAdd, onRemove }) {
    const [newRow, setNewRow] = useState({ sourceType: 'market', itemId: '', count: 1, chance: 100 });

    // Filter out circular deps
    const availableItems = useMemo(() => {
        if (newRow.sourceType === 'market') return marketItems;
        return craftingItems.filter(ci => ci.id !== item.id && !hasCircularDependency(ci.id, item.id, craftingItems));
    }, [newRow.sourceType, marketItems, craftingItems, item.id]);

    const handleAdd = () => {
        if (!newRow.itemId) return;
        onAdd(item.id, { ...newRow, count: Number(newRow.count), chance: Number(newRow.chance) });
        setNewRow({ sourceType: 'market', itemId: '', count: 1, chance: 100 });
    };

    const getItemName = (id, type) => {
        if (type === 'market') return marketItems.find(i => i.id === id || i.originalId === id)?.name || id;
        return craftingItems.find(i => i.id === id)?.name || id;
    };

    return (
        <div className="border border-zinc-800 rounded-lg overflow-hidden bg-zinc-900/30">
            <table className="w-full text-sm text-left">
                <thead className="bg-zinc-900 text-zinc-500 font-medium">
                    <tr>
                        <th className="p-3 w-32">Kaynak</th>
                        <th className="p-3">EÅŸya</th>
                        <th className="p-3 w-24 text-right">Adet</th>
                        {item.type === 'container' && <th className="p-3 w-24 text-right">Åans %</th>}
                        <th className="p-3 w-12"></th>
                    </tr>
                </thead>
                <tbody className="divide-y divide-zinc-800">
                    {item.contents?.map((content, idx) => (
                        <tr key={idx} className="group hover:bg-zinc-800/30 transition-colors">
                            <td className="p-3">
                                <span className={`text-xs px-2 py-1 rounded ${content.sourceType === 'market' ? 'bg-cyan-900/30 text-cyan-400' : 'bg-red-900/30 text-red-400'}`}>
                                    {content.sourceType === 'market' ? 'Market' : 'Craft'}
                                </span>
                            </td>
                            <td className="p-3 text-zinc-300 font-medium">{getItemName(content.itemId, content.sourceType)}</td>
                            <td className="p-3 text-right text-zinc-400 font-mono">{content.count}</td>
                            {item.type === 'container' && (
                                <td className="p-3 text-right text-zinc-400 font-mono">%{content.chance}</td>
                            )}
                            <td className="p-3 text-right">
                                <button onClick={() => onRemove(item.id, content.id)} className="text-zinc-600 hover:text-red-400 p-1 opacity-0 group-hover:opacity-100 transition-opacity">
                                    <Trash2 size={14} />
                                </button>
                            </td>
                        </tr>
                    ))}

                    {/* Input Row */}
                    <tr className="bg-zinc-900/50">
                        <td className="p-2">
                            <select
                                value={newRow.sourceType}
                                onChange={e => setNewRow({ ...newRow, sourceType: e.target.value, itemId: "" })}
                                className="w-full bg-zinc-950 border border-zinc-800 rounded px-2 py-1.5 text-xs text-zinc-300 focus:border-blue-500 outline-none"
                            >
                                <option value="market">Market</option>
                                <option value="crafting">Craft</option>
                            </select>
                        </td>
                        <td className="p-2">
                            <select
                                value={newRow.itemId}
                                onChange={e => setNewRow({ ...newRow, itemId: e.target.value })}
                                className="w-full bg-zinc-950 border border-zinc-800 rounded px-2 py-1.5 text-xs text-zinc-300 focus:border-blue-500 outline-none"
                            >
                                <option value="">SeÃ§iniz...</option>
                                {availableItems.map(i => (
                                    <option key={i.id} value={i.id}>{i.name}</option>
                                ))}
                            </select>
                        </td>
                        <td className="p-2">
                            <SmartInput
                                min={1}
                                value={newRow.count}
                                onChange={(val) => setNewRow({ ...newRow, count: val })}
                                className="w-full bg-zinc-950 border border-zinc-800 rounded px-2 py-1.5 text-xs text-center text-zinc-300 focus:border-blue-500 outline-none"
                            />
                        </td>
                        {item.type === 'container' && (
                            <td className="p-2">
                                <SmartInput
                                    min={0}
                                    max={100}
                                    value={newRow.chance}
                                    onChange={(val) => setNewRow({ ...newRow, chance: val })}
                                    className="w-full bg-zinc-950 border border-zinc-800 rounded px-2 py-1.5 text-xs text-center text-zinc-300 focus:border-blue-500 outline-none"
                                />
                            </td>
                        )}
                        <td className="p-2 text-right">
                            <button
                                onClick={handleAdd}
                                disabled={!newRow.itemId}
                                className="p-1.5 bg-blue-600 hover:bg-blue-500 text-white rounded disabled:opacity-50 disabled:cursor-not-allowed"
                            >
                                <Plus size={14} />
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    );
}

// ============================================================================
// MAIN WIDGET
// ============================================================================
export default function CraftingWidget() {
    const { metinList, marketItems } = useSharedWidgetData();
    useCraftingSync(); // Sync logic

    const craftingItems = useWidgetStore((state) => state.craftingItems);
    const addCraftingItem = useWidgetStore((state) => state.addCraftingItem);
    const removeCraftingItem = useWidgetStore((state) => state.removeCraftingItem);
    const updateCraftingItem = useWidgetStore((state) => state.updateCraftingItem);
    const addContentToItem = useWidgetStore((state) => state.addContentToItem);
    const removeContentFromItem = useWidgetStore((state) => state.removeContentFromItem);

    const [selectedItemId, setSelectedItemId] = useState(craftingItems[0]?.id || null);
    const [searchQuery, setSearchQuery] = useState("");

    const selectedItem = craftingItems.find(i => i.id === selectedItemId);

    const filteredList = craftingItems.filter(item =>
        item.name.toLowerCase().includes(searchQuery.toLowerCase())
    );

    const handleCreate = (type) => {
        const name = type === 'recipe' ? 'Yeni ReÃ§ete' : type === 'container' ? 'Yeni SandÄ±k' : 'Yeni ParÃ§a';
        // Note: Store adds item. Usually we don't get ID back easily without async or predictable ID.
        // Assuming user creates and then clicks it in list, OR we trust it appears at end.
        addCraftingItem(name, type);
    };

    // Calculate value
    const calculatedPrice = useMemo(() => {
        if (!selectedItem) return 0;
        return resolveItemPrice(selectedItem.id, 'crafting', marketItems);
    }, [selectedItem, marketItems]); // Note: This might be slightly expensive but safe enough for one item

    return (
        <div className="w-full h-full flex bg-zinc-950 text-zinc-100 overflow-hidden font-sans">

            {/* LEFT PANEL: LIST (30%) */}
            <div className="w-[300px] flex-shrink-0 border-r border-zinc-800 flex flex-col bg-zinc-950/50">
                {/* Header / Search */}
                <div className="p-4 border-b border-zinc-800 space-y-3">
                    <div className="relative">
                        <Search className="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-zinc-500" />
                        <input
                            type="text"
                            placeholder="ReÃ§ete Ara..."
                            value={searchQuery}
                            onChange={e => setSearchQuery(e.target.value)}
                            className="w-full bg-zinc-900 border border-zinc-800 rounded-lg pl-9 p-2 text-sm text-zinc-200 outline-none focus:border-blue-500"
                        />
                    </div>
                    {/* Quick Add Buttons */}
                    <div className="flex gap-2">
                        <button onClick={() => handleCreate('recipe')} className="flex-1 py-2 bg-zinc-800 hover:bg-zinc-700 rounded text-xs text-zinc-300 border border-zinc-700 transition-colors" title="Yeni ReÃ§ete">
                            <Sparkles size={14} className="mx-auto" />
                        </button>
                        <button onClick={() => handleCreate('container')} className="flex-1 py-2 bg-zinc-800 hover:bg-zinc-700 rounded text-xs text-zinc-300 border border-zinc-700 transition-colors" title="Yeni SandÄ±k">
                            <Package size={14} className="mx-auto" />
                        </button>
                        <button onClick={() => handleCreate('fragment')} className="flex-1 py-2 bg-zinc-800 hover:bg-zinc-700 rounded text-xs text-zinc-300 border border-zinc-700 transition-colors" title="Yeni ParÃ§a">
                            <PieChart size={14} className="mx-auto" />
                        </button>
                    </div>
                </div>

                {/* List */}
                <div className="flex-1 overflow-y-auto p-2 space-y-1 custom-scrollbar">
                    {filteredList.map(item => (
                        <div
                            key={item.id}
                            onClick={() => setSelectedItemId(item.id)}
                            className={`
                                flex items-center justify-between p-3 rounded-lg cursor-pointer transition-colors group relative
                                ${selectedItemId === item.id ? "bg-fuchsia-900/20 border border-fuchsia-500/30" : "hover:bg-zinc-900 border border-transparent"}
                            `}
                        >
                            <div className="flex items-center gap-3 overflow-hidden">
                                {item.type === 'recipe' && <Sparkles size={16} className="text-cyan-400 shrink-0" />}
                                {item.type === 'container' && <Package size={16} className="text-violet-400 shrink-0" />}
                                {item.type === 'fragment' && <PieChart size={16} className="text-amber-400 shrink-0" />}
                                <span className={`text-sm truncate ${selectedItemId === item.id ? "text-white" : "text-zinc-400"}`}>{item.name}</span>
                            </div>
                        </div>
                    ))}
                </div>
            </div>

            {/* RIGHT PANEL: EDITOR (70%) */}
            <div className="flex-1 flex flex-col h-full bg-zinc-950">
                {selectedItem ? (
                    <div className="flex-1 overflow-y-auto p-8">

                        {/* Header: Name and Type */}
                        <div className="flex items-start justify-between mb-8 border-b border-zinc-800 pb-6">
                            <div className="flex-1 mr-8">
                                <label className="text-xs font-semibold text-zinc-500 uppercase tracking-wider block mb-1">
                                    {selectedItem.type === 'recipe' ? 'ReÃ§ete AdÄ±' : selectedItem.type === 'container' ? 'SandÄ±k AdÄ±' : 'ParÃ§a AdÄ±'}
                                </label>
                                <input
                                    type="text"
                                    value={selectedItem.name}
                                    onChange={(e) => updateCraftingItem(selectedItem.id, { name: e.target.value })}
                                    className="w-full bg-transparent text-3xl font-bold text-white outline-none placeholder-zinc-700 border-b border-transparent focus:border-fuchsia-500 transition-colors"
                                />
                            </div>
                            <div className="flex flex-col items-end gap-2">
                                <button
                                    onClick={() => {
                                        if (confirm("Silmek istiyor musunuz?")) {
                                            removeCraftingItem(selectedItem.id);
                                            setSelectedItemId(null);
                                        }
                                    }}
                                    className="p-2 text-zinc-600 hover:text-red-400 hover:bg-red-500/10 rounded-lg transition-colors"
                                >
                                    <Trash2 size={20} />
                                </button>
                                <div className="text-right">
                                    <div className="text-sm text-zinc-400">Tahmini DeÄŸer</div>
                                    <div className="text-xl font-bold text-fuchsia-400 font-mono">{formatCurrency(calculatedPrice)}</div>
                                </div>
                            </div>
                        </div>

                        {/* Content Editor */}
                        <div className="space-y-6">
                            {selectedItem.type === 'fragment' ? (
                                <div className="p-6 bg-zinc-900/50 border border-zinc-800 rounded-xl space-y-4">
                                    <h3 className="text-zinc-300 font-medium flex items-center gap-2"><PieChart size={18} /> ParÃ§a AyarlarÄ±</h3>
                                    <div>
                                        <label className="text-xs text-zinc-500 block mb-1">Hangi EÅŸyanÄ±n ParÃ§asÄ±?</label>
                                        <select
                                            value={selectedItem.targetId || ""}
                                            onChange={(e) => updateCraftingItem(selectedItem.id, { targetId: e.target.value })}
                                            className="w-full bg-zinc-950 border border-zinc-800 rounded px-3 py-2 text-zinc-300 focus:border-blue-500 outline-none"
                                        >
                                            <option value="">SeÃ§iniz...</option>
                                            <optgroup label="Sanal EÅŸyalar">
                                                {craftingItems.filter(i => i.id !== selectedItem.id).map(i => (
                                                    <option key={i.id} value={i.id}>{i.name}</option>
                                                ))}
                                            </optgroup>
                                            <optgroup label="Metinler">
                                                {metinList.map(m => (
                                                    <option key={m.id} value={m.id}>{m.name}</option>
                                                ))}
                                            </optgroup>
                                        </select>
                                    </div>
                                    <div>
                                        <label className="text-xs text-zinc-500 block mb-1">BirleÅŸme MiktarÄ± (KaÃ§ tane lazÄ±m?)</label>
                                        <SmartInput
                                            min={1}
                                            value={selectedItem.amount || 1}
                                            onChange={(val) => updateCraftingItem(selectedItem.id, { amount: val })}
                                            className="w-full bg-zinc-950 border border-zinc-800 rounded px-3 py-2 text-zinc-300 focus:border-blue-500 outline-none"
                                        />
                                    </div>
                                </div>
                            ) : (
                                <div className="space-y-4">
                                    <div className="flex justify-between items-center">
                                        <h3 className="text-zinc-300 font-medium flex items-center gap-2">
                                            {selectedItem.type === 'recipe' ? 'Gereken Malzemeler' : 'SandÄ±k Ä°Ã§eriÄŸi'}
                                        </h3>
                                    </div>
                                    <ContentEditorTable
                                        item={selectedItem}
                                        marketItems={marketItems}
                                        craftingItems={craftingItems}
                                        onAdd={addContentToItem}
                                        onRemove={removeContentFromItem}
                                    />
                                </div>
                            )}
                        </div>

                    </div>
                ) : (
                    <div className="flex-1 flex flex-col items-center justify-center text-zinc-600">
                        <Wrench size={48} className="mb-4 opacity-20" />
                        <p>DÃ¼zenlemek iÃ§in bir Ã¶ÄŸe seÃ§in</p>
                    </div>
                )}
            </div>

        </div>
    );
}

==================================================
DOSYA YOLU: .\app\components\widgets\DamageProgressionWidget.js
==================================================
"use client";

import { useMemo, useState } from "react";
import { motion } from "framer-motion";
import { X, EyeOff, TrendingUp, Target, ArrowDown, Check, Trophy, AlertCircle, Filter, CheckSquare } from "lucide-react";
import { calculateDamageZones, analyzeNextTier, formatCompactCurrency, formatCurrency } from "../../lib/calculator";
import { useSharedWidgetData } from "../../hooks/useSharedWidgetData";
import useWidgetStore from "../../store/useWidgetStore";

// ============================================================================
// HELPER: FIND SIBLING WIDGETS (CONTEXT-AWARE)
// ============================================================================
// ============================================================================
// HELPER: FIND SIBLING WIDGETS (CONTEXT-AWARE)
// ============================================================================
// useSiblingWidgetData replaced by useSharedWidgetData hook

// ============================================================================
// SUMMARY VIEW
// ============================================================================
function DamageProgressionSummaryView({ userStats, metinList, craftingItems, prices, multipliers }) {
    const zones = useMemo(() => {
        return calculateDamageZones(metinList, prices, multipliers, userStats, craftingItems);
    }, [metinList, prices, multipliers, userStats, craftingItems]);

    const currentDamage = userStats.damage || 0;
    const maxSimulationDamage = zones.length > 0 ? zones[zones.length - 1].maxDamage : 30000;
    const markerPosition = Math.min(100, Math.max(0, (currentDamage / maxSimulationDamage) * 100));

    return (
        <div className="flex flex-col items-center justify-center h-full w-full px-4">
            <div className="flex items-center gap-2 mb-4">
                <Target className="w-6 h-6 text-fuchsia-400 drop-shadow-[0_0_8px_rgba(232,121,249,0.5)]" />
                <span className="text-lg font-bold text-white drop-shadow-[0_0_10px_rgba(255,255,255,0.3)]">Hasar Analizi</span>
            </div>

            {/* Progress Bar Container */}
            <div className="w-full h-8 bg-black/60 rounded-full overflow-hidden relative flex border border-white/10 shadow-inner">
                {zones.map((zone, index) => {
                    const widthPercent = ((zone.maxDamage - zone.minDamage) / maxSimulationDamage) * 100;
                    return (
                        <div
                            key={index}
                            style={{ width: `${widthPercent}%` }}
                            className="h-full relative group first:rounded-l-full last:rounded-r-full hover:brightness-110 transition-all bg-gradient-to-r from-yellow-400/80 to-cyan-400/80 backdrop-blur-sm border-r border-white/10 last:border-r-0"
                        >
                            {/* Tooltip */}
                            <div className="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-2 py-1 bg-black/90 text-white text-xs rounded opacity-0 group-hover:opacity-100 whitespace-nowrap pointer-events-none transition-opacity z-10 border border-white/20">
                                {zone.bestMetinName}
                            </div>
                        </div>
                    );
                })}

                {/* User Marker */}
                <div
                    className="absolute top-0 bottom-0 w-1 bg-cyan-400 shadow-[0_0_10px_#06b6d4] z-10 transition-all duration-500"
                    style={{ left: `${markerPosition}%` }}
                >
                    <div className="absolute bottom-full left-1/2 -translate-x-1/2 mb-1">
                        <div className="bg-cyan-500 text-black text-[10px] font-bold px-1.5 py-0.5 rounded shadow-lg whitespace-nowrap">
                            Siz
                        </div>
                        <div className="w-0 h-0 border-l-[4px] border-l-transparent border-r-[4px] border-r-transparent border-t-[4px] border-t-cyan-500 mx-auto"></div>
                    </div>
                </div>
            </div>
        </div>
    );
}

// ============================================================================
// DETAIL VIEW
// ============================================================================
function DamageProgressionDetailView({ userStats, metinList, craftingItems, prices, multipliers }) {
    const zones = useMemo(() => {
        return calculateDamageZones(metinList, prices, multipliers, userStats, craftingItems);
    }, [metinList, prices, multipliers, userStats, craftingItems]);

    const currentDamage = userStats.damage || 0;

    // Analyze next tier
    const analysis = useMemo(() => {
        return analyzeNextTier(currentDamage, zones);
    }, [currentDamage, zones]);

    // Find current zone for display
    const currentZone = zones.find(z => currentDamage >= z.minDamage && currentDamage <= z.maxDamage);

    if (!currentZone || !analysis) {
        return (
            <div className="flex items-center justify-center h-full text-white/50">
                Veri bekleniyor...
            </div>
        );
    }

    return (
        <div className="h-full flex flex-col items-center justify-center max-w-2xl mx-auto w-full py-4">

            {/* 1. CURRENT STATUS CARD */}
            <motion.div
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                className="w-full bg-black/40 backdrop-blur-xl p-6 rounded-2xl border border-cyan-500/30 shadow-[0_0_20px_rgba(6,182,212,0.1)] relative overflow-hidden hover:border-cyan-500/50 transition-colors"
            >
                <div className="absolute top-0 right-0 p-4 opacity-10">
                    <Check className="w-24 h-24 text-cyan-500" />
                </div>

                <div className="relative z-10">
                    <div className="flex items-center gap-3 mb-2">
                        <div className="p-2 bg-cyan-500/20 rounded-lg border border-cyan-500/30">
                            <Check className="w-6 h-6 text-cyan-400" />
                        </div>
                        <span className="text-cyan-400 font-bold tracking-wide uppercase text-sm">Mevcut Durum</span>
                    </div>

                    <h3 className="text-2xl font-bold text-white mb-1">
                        Åu an <span className="text-cyan-400">{currentZone.bestMetinName}</span> kesiyorsun.
                    </h3>
                    <p className="text-white/60">
                        Ortalama KazanÃ§: <strong className="text-white">{formatCompactCurrency(currentZone.maxProfit)} Yang/Saat</strong>
                    </p>
                </div>
            </motion.div>

            {/* 2. PROGRESS INDICATOR */}
            <div className="h-16 flex items-center justify-center relative w-full my-2">
                <div className="absolute inset-0 flex items-center justify-center">
                    <div className="w-0.5 h-full bg-gradient-to-b from-cyan-500/50 to-fuchsia-500/50"></div>
                </div>

                {!analysis.isMaxLevel && (
                    <motion.div
                        initial={{ scale: 0 }}
                        animate={{ scale: 1 }}
                        className="relative z-10 bg-[#000000] border border-white/20 px-4 py-2 rounded-full shadow-xl flex items-center gap-2"
                    >
                        <ArrowDown className="w-4 h-4 text-white/60" />
                        <span className="text-sm font-bold text-white">
                            Sonraki Seviyeye: <span className="text-fuchsia-400">+{formatCompactCurrency(analysis.requiredDamage)} Hasar</span> KaldÄ±
                        </span>
                    </motion.div>
                )}
            </div>

            {/* 3. TARGET CARD */}
            <motion.div
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ delay: 0.1 }}
                className={`w-full p-6 rounded-2xl border shadow-lg relative overflow-hidden ${analysis.isMaxLevel
                    ? "bg-gradient-to-br from-violet-900/40 to-blue-900/40 border-violet-500/30"
                    : "bg-gradient-to-br from-fuchsia-900/40 to-purple-900/40 border-fuchsia-500/30 shadow-[0_0_30px_rgba(217,70,239,0.15)]"
                    }`}
            >
                <div className="absolute top-0 right-0 p-4 opacity-10">
                    <Trophy className="w-24 h-24 text-fuchsia-500" />
                </div>

                <div className="relative z-10">
                    {analysis.isMaxLevel ? (
                        // MAX LEVEL VIEW
                        <div className="text-center py-4">
                            <div className="inline-flex p-3 bg-violet-500/20 rounded-full border border-violet-500/30 mb-4">
                                <Trophy className="w-8 h-8 text-violet-400" />
                            </div>
                            <h3 className="text-2xl font-bold text-white mb-2">Zirvedesiniz!</h3>
                            <p className="text-white/70 max-w-md mx-auto">
                                Tebrikler! Mevcut ekipmanÄ±nÄ±zla ulaÅŸabileceÄŸiniz en yÃ¼ksek verimlilik seviyesindesiniz.
                                ArtÄ±k keyfini Ã§Ä±karma vakti! ğŸ‘‘
                            </p>
                        </div>
                    ) : (
                        // NEXT GOAL VIEW
                        <>
                            <div className="flex items-center gap-3 mb-2">
                                <div className="p-2 bg-fuchsia-500/20 rounded-lg border border-fuchsia-500/30">
                                    <Target className="w-6 h-6 text-fuchsia-400" />
                                </div>
                                <span className="text-fuchsia-400 font-bold tracking-wide uppercase text-sm">Sonraki Hedef</span>
                            </div>

                            <h3 className="text-3xl font-bold text-white mb-2">
                                {analysis.nextMetin}
                            </h3>

                            <div className="flex items-start gap-3 mt-4 bg-black/20 p-3 rounded-xl border border-white/5">
                                <TrendingUp className="w-5 h-5 text-cyan-400 mt-0.5" />
                                <div>
                                    <p className="text-white/90 font-medium">
                                        Bu hedefe ulaÅŸÄ±rsan kazancÄ±n <span className="text-cyan-400 font-bold">%{analysis.percentGain.toFixed(1)}</span> artacak!
                                    </p>
                                    <p className="text-white/50 text-xs mt-1">
                                        Tahmini ArtÄ±ÅŸ: +{formatCompactCurrency(analysis.profitIncrease)} Yang/Saat
                                    </p>
                                </div>
                            </div>
                        </>
                    )}
                </div>
            </motion.div>

            {/* Softcap Warning (if applicable) */}
            {currentZone.isSoftcap && (
                <motion.div
                    initial={{ opacity: 0 }}
                    animate={{ opacity: 1 }}
                    transition={{ delay: 0.5 }}
                    className="mt-4 flex items-center gap-2 text-xs text-red-400 bg-red-500/10 px-3 py-2 rounded-lg border border-red-500/20"
                >
                    <AlertCircle className="w-4 h-4" />
                    <span>Dikkat: Åu an softcap bÃ¶lgesindesiniz. Hasar artÄ±ÅŸÄ± verimi dÃ¼ÅŸÃ¼rebilir.</span>
                </motion.div>
            )}
        </div>
    );
}

// ============================================================================
// MAIN WIDGET
// ============================================================================
export default function DamageProgressionWidget({ id, data, isSelected, onClick, onHide }) {
    // Get context-aware data from sibling widgets
    const { userStats, metinList, marketItems, craftingItems, prices, multipliers } = useSharedWidgetData();
    const [showFilter, setShowFilter] = useState(false);

    // ModÃ¼ler Filtreleme: Hesaplama motoruna girmeden veriyi sÃ¼zÃ¼yoruz
    const filteredMetinList = useMemo(() => {
        const hiddenIds = data.hiddenMetinIds || [];
        return metinList.filter(m => !hiddenIds.includes(m.id));
    }, [metinList, data.hiddenMetinIds]);

    // Filter Logic
    const toggleMetinVisibility = (metinId) => {
        const currentHidden = data.hiddenMetinIds || [];
        const isHidden = currentHidden.includes(metinId);

        let newHidden;
        if (isHidden) {
            newHidden = currentHidden.filter(id => id !== metinId); // GÃ¶ster
        } else {
            newHidden = [...currentHidden, metinId]; // Gizle
        }

        // Widget hafÄ±zasÄ±na kaydet
        const updateWidgetData = useWidgetStore.getState().updateWidgetData;
        updateWidgetData(id, { hiddenMetinIds: newHidden });
    };

    const showAllMetins = () => {
        const updateWidgetData = useWidgetStore.getState().updateWidgetData;
        updateWidgetData(id, { hiddenMetinIds: [] });
    };

    return (
        <motion.div
            layoutId={`card-${id}`}
            layout
            onClick={!isSelected ? onClick : undefined}
            className={`group rounded-3xl shadow-2xl cursor-pointer overflow-hidden ${isSelected
                ? "fixed inset-0 m-auto w-[90%] h-[90%] max-w-6xl z-[100] bg-black/90 backdrop-blur-xl border border-white/10"
                : "relative h-64 hover:-translate-y-1 glass-panel hover:border-cyan-500/50 hover:shadow-[0_0_30px_rgba(6,182,212,0.1)] transition-all duration-300"
                }`}
            transition={{ type: "spring", stiffness: 300, damping: 30 }}
        >
            {/* Summary View */}
            {!isSelected && (
                <>
                    {/* Hide Button */}
                    <motion.button
                        whileHover={{ scale: 1.1 }}
                        whileTap={{ scale: 0.9 }}
                        onClick={(e) => {
                            e.stopPropagation();
                            onHide && onHide();
                        }}
                        className="absolute top-4 right-4 z-20 p-2 bg-white/10 backdrop-blur-sm shadow-lg rounded-full opacity-0 group-hover:opacity-100 transition-opacity text-white/60 hover:text-red-400 hover:bg-red-500/20 border border-white/20"
                    >
                        <EyeOff className="w-4 h-4" />
                    </motion.button>

                    <div className="w-full h-full p-6 relative">
                        <TrendingUp className="absolute -bottom-4 -right-4 w-32 h-32 text-white/5 opacity-50 rotate-12 pointer-events-none" />
                        <DamageProgressionSummaryView
                            userStats={userStats}
                            metinList={filteredMetinList}
                            craftingItems={craftingItems}
                            prices={prices}
                            multipliers={multipliers}
                        />
                    </div>
                </>
            )}

            {/* Detail View */}
            {isSelected && (
                <div className="flex flex-col h-full bg-black/20">
                    <div className="flex items-center justify-between p-8 border-b border-white/20 bg-white/5 backdrop-blur-xl relative z-20">
                        <div className="flex items-center gap-4">
                            <div className="p-3 bg-white/10 backdrop-blur-sm rounded-2xl border border-white/20">
                                <TrendingUp className="w-8 h-8 text-cyan-400" />
                            </div>
                            <div>
                                <motion.h2 layoutId={`title-${id}`} className="text-2xl font-bold text-white">
                                    Hasar Yol HaritasÄ±
                                </motion.h2>
                                <p className="text-white/60">GeliÅŸim hedefleri ve sonraki adÄ±mlar</p>
                            </div>
                        </div>

                        <div className="flex items-center gap-2">
                            {/* Filter Button */}
                            <div className="relative">
                                <button
                                    onClick={(e) => {
                                        e.stopPropagation();
                                        setShowFilter(!showFilter);
                                    }}
                                    className={`p-2 rounded-lg transition-colors border ${showFilter
                                        ? "bg-cyan-500/20 text-cyan-400 border-cyan-500/50"
                                        : "bg-white/5 text-white/70 hover:bg-white/10 border-white/10"
                                        }`}
                                >
                                    <Filter className="w-5 h-5" />
                                </button>

                                {/* Filter Panel */}
                                {showFilter && (
                                    <div
                                        className="absolute right-0 top-full mt-2 w-64 bg-black/90 backdrop-blur-xl border border-white/10 rounded-xl shadow-2xl p-4 z-50"
                                        onClick={(e) => e.stopPropagation()}
                                    >
                                        <div className="flex items-center justify-between mb-3">
                                            <h3 className="font-semibold text-white">Metin Filtresi</h3>
                                            <button
                                                onClick={showAllMetins}
                                                className="text-xs text-cyan-400 hover:text-cyan-300"
                                            >
                                                TÃ¼mÃ¼nÃ¼ GÃ¶ster
                                            </button>
                                        </div>
                                        <div className="max-h-60 overflow-y-auto space-y-1 pr-2 custom-scrollbar">
                                            {metinList.map(metin => {
                                                const isHidden = (data.hiddenMetinIds || []).includes(metin.id);
                                                return (
                                                    <label
                                                        key={metin.id}
                                                        className="flex items-center gap-2 p-2 rounded hover:bg-white/5 cursor-pointer group"
                                                    >
                                                        <div className={`w-4 h-4 rounded border flex items-center justify-center transition-colors ${!isHidden
                                                            ? "bg-cyan-500 border-cyan-500"
                                                            : "border-white/30 group-hover:border-white/50"
                                                            }`}>
                                                            {!isHidden && <CheckSquare className="w-3 h-3 text-black" />}
                                                        </div>
                                                        <input
                                                            type="checkbox"
                                                            checked={!isHidden}
                                                            onChange={() => toggleMetinVisibility(metin.id)}
                                                            className="hidden"
                                                        />
                                                        <span className={`text-sm ${isHidden ? "text-white/50" : "text-white/90"}`}>
                                                            {metin.name}
                                                        </span>
                                                    </label>
                                                );
                                            })}
                                        </div>
                                    </div>
                                )}
                            </div>

                            <button
                                onClick={(e) => {
                                    e.stopPropagation();
                                    onClick();
                                }}
                                className="p-2 hover:bg-white/10 rounded-full transition-colors backdrop-blur-sm border border-white/10 hover:border-white/20"
                            >
                                <X className="w-6 h-6 text-white/80" />
                            </button>
                        </div>
                    </div>
                    <div className="flex-1 p-8 overflow-y-auto">
                        <DamageProgressionDetailView
                            userStats={userStats}
                            metinList={filteredMetinList}
                            craftingItems={craftingItems}
                            prices={prices}
                            multipliers={multipliers}
                        />
                    </div>
                </div>
            )}
        </motion.div>
    );
}

==================================================
DOSYA YOLU: .\app\components\widgets\MarketSupplyWidget.js
==================================================
"use client";

import { useState, useMemo, useEffect } from "react";
import { Package, Users, ChevronDown, Clock, Plus, Trash2, PieChart, Activity, AlertCircle } from "lucide-react";
import { formatCompactCurrency, formatCurrency } from "../../lib/calculator";
import { useSharedWidgetData } from "../../hooks/useSharedWidgetData";
import SmartInput from "../ui/SmartInput";

// ============================================================================
// SUB-COMPONENT: TARGET STRATEGY (Metin SeÃ§imi ve AÄŸÄ±rlÄ±klar)
// ============================================================================
function TargetStrategyPanel({ metinList, targets, setTargets }) {
    const [selectedMetinId, setSelectedMetinId] = useState("");

    // Listeye yeni metin ekle
    const handleAddMetin = () => {
        if (!selectedMetinId) return;

        // Zaten listede var mÄ±?
        if (targets.some(t => t.id === selectedMetinId)) return;

        const metin = metinList.find(m => m.id === selectedMetinId);
        if (metin) {
            // Yeni metini ekle, varsayÄ±lan aÄŸÄ±rlÄ±k ver, sonra normalize edeceÄŸiz
            const newTargets = [...targets, { ...metin, weight: 0 }];
            distributeWeightsEvenly(newTargets);
        }
        setSelectedMetinId("");
    };

    // Listeden metin Ã§Ä±kar
    const handleRemoveMetin = (id) => {
        const newTargets = targets.filter(t => t.id !== id);
        distributeWeightsEvenly(newTargets);
    };

    // AÄŸÄ±rlÄ±ÄŸÄ± gÃ¼ncelle
    const handleWeightChange = (id, newWeight) => {
        const updated = targets.map(t => t.id === id ? { ...t, weight: newWeight } : t);
        setTargets(updated);
    };

    // Helper: EÅŸit daÄŸÄ±t (HÄ±zlÄ± baÅŸlangÄ±Ã§ iÃ§in)
    const distributeWeightsEvenly = (list) => {
        const count = list.length;
        if (count === 0) {
            setTargets([]);
            return;
        }
        const avg = Math.floor(100 / count);
        const remainder = 100 - (avg * count);

        const distributed = list.map((t, i) => ({
            ...t,
            weight: i === 0 ? avg + remainder : avg // KalanÄ± ilkine ekle
        }));
        setTargets(distributed);
    };

    const totalWeight = targets.reduce((sum, t) => sum + (t.weight || 0), 0);
    const isWeightValid = totalWeight === 100;

    return (
        <div className="space-y-4 bg-zinc-900/50 p-4 rounded-xl border border-zinc-800">
            <h3 className="text-zinc-300 font-semibold flex items-center gap-2">
                <PieChart size={18} className="text-violet-400" />
                Hedef Rotasyonu
            </h3>

            {/* Metin Ekleme */}
            <div className="flex gap-2">
                <div className="relative flex-1">
                    <select
                        value={selectedMetinId}
                        onChange={(e) => setSelectedMetinId(e.target.value)}
                        className="w-full bg-zinc-950 border border-zinc-800 text-zinc-200 px-3 py-2 rounded-lg outline-none focus:border-violet-500 appearance-none text-sm"
                    >
                        <option value="">Metin SeÃ§...</option>
                        {metinList.map(m => (
                            <option key={m.id} value={m.id}>{m.name} (HP: {formatCompactCurrency(m.hp)})</option>
                        ))}
                    </select>
                    <ChevronDown className="absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-zinc-600 pointer-events-none" />
                </div>
                <button
                    onClick={handleAddMetin}
                    disabled={!selectedMetinId}
                    className="bg-violet-600 hover:bg-violet-500 text-white p-2 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed"
                >
                    <Plus size={18} />
                </button>
            </div>

            {/* SeÃ§ili Liste */}
            <div className="space-y-2 max-h-[250px] overflow-y-auto custom-scrollbar pr-1">
                {targets.map(target => (
                    <div key={target.id} className="flex items-center gap-3 bg-zinc-950 p-2 rounded-lg border border-zinc-800">
                        <div className="flex-1 min-w-0">
                            <div className="text-sm text-zinc-200 truncate" title={target.name}>{target.name}</div>
                            <div className="text-xs text-zinc-600">HP: {formatCompactCurrency(target.hp)}</div>
                        </div>

                        <div className="flex items-center gap-2">
                            <div className="w-20 relative">
                                <SmartInput
                                    value={target.weight}
                                    onChange={(val) => handleWeightChange(target.id, val)}
                                    className="w-full bg-zinc-900 border border-zinc-700 text-right text-sm px-2 py-1 rounded text-white focus:border-violet-500 outline-none"
                                    min={0}
                                    max={100}
                                />
                                <span className="absolute right-6 top-1/2 -translate-y-1/2 text-zinc-500 text-xs">%</span>
                            </div>
                            <button onClick={() => handleRemoveMetin(target.id)} className="text-zinc-600 hover:text-red-400">
                                <Trash2 size={16} />
                            </button>
                        </div>
                    </div>
                ))}

                {targets.length === 0 && (
                    <div className="text-center text-zinc-600 text-xs py-4 border border-dashed border-zinc-800 rounded-lg">
                        HenÃ¼z metin seÃ§ilmedi.
                    </div>
                )}
            </div>

            {/* Validation Error */}
            {!isWeightValid && targets.length > 0 && (
                <div className="flex items-center gap-2 text-xs text-red-400 bg-red-900/10 p-2 rounded border border-red-900/30">
                    <AlertCircle size={14} />
                    <span>Toplam aÄŸÄ±rlÄ±k %100 olmalÄ± (Åu an: %{totalWeight})</span>
                </div>
            )}
        </div>
    );
}

// ============================================================================
// SUB-COMPONENT: COHORT SETTINGS (Oyuncu AyarlarÄ±)
// ============================================================================
function CohortSettingsPanel({ config, updateConfig }) {
    return (
        <div className="space-y-4 bg-zinc-900/50 p-4 rounded-xl border border-zinc-800">
            <h3 className="text-zinc-300 font-semibold flex items-center gap-2">
                <Users size={18} className="text-blue-400" />
                Ekip ve Performans
            </h3>

            <div className="grid grid-cols-2 gap-4">
                {/* KiÅŸi SayÄ±sÄ± */}
                <div className="col-span-2">
                    <label className="text-xs text-zinc-500 font-medium block mb-1">Oyuncu SayÄ±sÄ±</label>
                    <div className="flex items-center gap-3 bg-zinc-950 p-1 rounded-lg border border-zinc-800">
                        <input
                            type="range" min="1" max="100"
                            value={config.playerCount}
                            onChange={(e) => updateConfig('playerCount', Number(e.target.value))}
                            className="flex-1 h-2 bg-zinc-800 rounded-lg appearance-none cursor-pointer accent-blue-500 ml-2"
                        />
                        <SmartInput
                            value={config.playerCount}
                            onChange={(val) => updateConfig('playerCount', val)}
                            className="w-16 bg-zinc-900 text-center text-white text-sm font-bold border-l border-zinc-800 py-1 outline-none"
                        />
                    </div>
                </div>

                {/* Hasar AralÄ±ÄŸÄ± */}
                <div className="col-span-2">
                    <label className="text-xs text-zinc-500 font-medium block mb-1">Hasar AralÄ±ÄŸÄ± (Ortalama HesaplanÄ±r)</label>
                    <div className="flex items-center gap-2">
                        <SmartInput
                            value={config.minDmg}
                            onChange={(val) => updateConfig('minDmg', val)}
                            className="flex-1 bg-zinc-950 border border-zinc-800 px-3 py-2 rounded text-sm text-zinc-300 focus:border-blue-500 outline-none text-center"
                            placeholder="Min"
                        />
                        <span className="text-zinc-600">-</span>
                        <SmartInput
                            value={config.maxDmg}
                            onChange={(val) => updateConfig('maxDmg', val)}
                            className="flex-1 bg-zinc-950 border border-zinc-800 px-3 py-2 rounded text-sm text-zinc-300 focus:border-blue-500 outline-none text-center"
                            placeholder="Max"
                        />
                    </div>
                    <p className="text-[10px] text-zinc-600 mt-1 text-center">
                        Ort. Hasar: <span className="text-blue-400 font-mono">{formatCompactCurrency((config.minDmg + config.maxDmg) / 2)}</span>
                    </p>
                </div>

                {/* Verim & SÃ¼re */}
                <div>
                    <label className="text-xs text-zinc-500 font-medium block mb-1">Verimlilik (%)</label>
                    <div className="relative">
                        <SmartInput
                            value={config.efficiency}
                            onChange={(val) => updateConfig('efficiency', val)}
                            className="w-full bg-zinc-950 border border-zinc-800 px-3 py-2 rounded text-sm text-zinc-300 focus:border-amber-500 outline-none"
                            max={100}
                        />
                        <Activity className="absolute right-2 top-1/2 -translate-y-1/2 w-3 h-3 text-amber-500 pointer-events-none" />
                    </div>
                </div>

                <div>
                    <label className="text-xs text-zinc-500 font-medium block mb-1">SÃ¼re (Saat)</label>
                    <div className="relative">
                        <SmartInput
                            value={config.duration}
                            onChange={(val) => updateConfig('duration', val)}
                            className="w-full bg-zinc-950 border border-zinc-800 px-3 py-2 rounded text-sm text-zinc-300 focus:border-green-500 outline-none"
                        />
                        <Clock className="absolute right-2 top-1/2 -translate-y-1/2 w-3 h-3 text-green-500 pointer-events-none" />
                    </div>
                </div>
            </div>
        </div>
    );
}

// ============================================================================
// MAIN WIDGET: MARKET SUPPLY SIMULATOR (REVISED)
// ============================================================================
export default function MarketSupplyWidget() {
    const { metinList, marketItems } = useSharedWidgetData();

    // --- STATE CONFIG ---
    const [config, setConfig] = useState({
        playerCount: 10,
        minDmg: 5000,
        maxDmg: 10000,
        efficiency: 90, // %
        duration: 4, // Saat
    });

    // SeÃ§ili Metinler ve AÄŸÄ±rlÄ±klarÄ±
    const [targets, setTargets] = useState([]);

    // Config Update Helper
    const updateConfig = (key, val) => setConfig(prev => ({ ...prev, [key]: val }));

    // --- THE CALCULATION ENGINE ---
    const simulationResults = useMemo(() => {
        if (targets.length === 0) return { supplyList: [], stats: null };

        // 1. Calculate Effective Group DPS
        const avgDmg = (config.minDmg + config.maxDmg) / 2;
        const totalRawDps = avgDmg * config.playerCount; // Basit DPS (Saniye BaÅŸÄ±na VuruÅŸ standart 1 kabul edelim ÅŸimdilik veya kullanÄ±cÄ±dan alabiliriz)
        // Not: Hasar formÃ¼lÃ¼nde 'HitsPerSecond' genellikle oyuncu bazlÄ±dÄ±r. Ortalama 2.5 vuruÅŸ/sn varsayalÄ±m.
        const HITS_PER_SEC = 2.5;
        const groupTotalDps = totalRawDps * HITS_PER_SEC;

        // 2. Apply Efficiency (Time Loss)
        const efficiencyFactor = config.efficiency / 100;
        const totalSeconds = config.duration * 3600;
        const effectiveSeconds = totalSeconds * efficiencyFactor;

        // 3. Total Damage Pool (Bu sÃ¼rede bu ekip toplam ne kadar vurabilir?)
        const damagePool = groupTotalDps * effectiveSeconds;

        // 4. Distribute Damage to Targets based on Weight
        const supplyMap = {}; // { itemId: count }
        let totalMetinsKilled = 0;

        targets.forEach(target => {
            const weightFactor = (target.weight || 0) / 100;
            const allocatedDamage = damagePool * weightFactor;

            // KaÃ§ tane kesilir?
            const killCount = Math.floor(allocatedDamage / target.hp);
            totalMetinsKilled += killCount;

            // DroplarÄ± Hesapla
            if (target.drops) {
                target.drops.forEach(drop => {
                    const dropChance = drop.chance / 100;
                    const totalDrops = killCount * drop.count * dropChance;

                    supplyMap[drop.itemId] = (supplyMap[drop.itemId] || 0) + totalDrops;
                });
            }
        });

        // 5. Convert Supply Map to List
        const supplyList = Object.entries(supplyMap).map(([itemId, count]) => {
            const item = marketItems.find(i => i.id === itemId || i.originalId === itemId);
            const price = item ? item.price : 0;
            return {
                itemId,
                name: item ? item.name : itemId,
                count: Math.floor(count), // Tam sayÄ±ya yuvarla
                totalValue: Math.floor(count) * price
            };
        }).sort((a, b) => b.totalValue - a.totalValue);

        const totalRevenue = supplyList.reduce((acc, curr) => acc + curr.totalValue, 0);

        return {
            supplyList,
            stats: {
                totalMetinsKilled,
                totalRevenue,
                groupDps: groupTotalDps,
                effectiveHours: effectiveSeconds / 3600
            }
        };

    }, [config, targets, marketItems]);

    return (
        <div className="w-full h-full flex flex-col p-6 space-y-6 bg-zinc-950 overflow-hidden">
            {/* Header */}
            <div className="flex justify-between items-center shrink-0">
                <div className="flex items-center gap-4">
                    <div className="p-3 bg-indigo-900/20 rounded-xl border border-indigo-800/50">
                        <Package className="w-8 h-8 text-indigo-400" />
                    </div>
                    <div>
                        <h1 className="text-2xl font-bold text-zinc-100">Arz SimÃ¼latÃ¶rÃ¼</h1>
                        <p className="text-zinc-500 text-sm">GeliÅŸmiÅŸ senaryo ve ekip planlamasÄ±</p>
                    </div>
                </div>
            </div>

            {/* Content Grid */}
            <div className="flex-1 grid grid-cols-1 lg:grid-cols-12 gap-6 overflow-hidden">

                {/* LEFT: CONTROLS (4 Columns) */}
                <div className="lg:col-span-4 flex flex-col gap-6 overflow-y-auto custom-scrollbar pr-2">
                    <CohortSettingsPanel config={config} updateConfig={updateConfig} />
                    <TargetStrategyPanel metinList={metinList} targets={targets} setTargets={setTargets} />

                    {/* Mini Stats Summary */}
                    {simulationResults.stats && (
                        <div className="bg-indigo-900/10 border border-indigo-900/30 p-4 rounded-xl">
                            <h4 className="text-indigo-300 font-semibold mb-2 text-sm">SimÃ¼lasyon Ã–zeti</h4>
                            <div className="grid grid-cols-2 gap-y-2 text-xs text-zinc-400">
                                <span>Toplam Kesim:</span>
                                <span className="text-white font-mono text-right">{formatCompactCurrency(simulationResults.stats.totalMetinsKilled)}</span>

                                <span>Efektif SÃ¼re:</span>
                                <span className="text-white font-mono text-right">{simulationResults.stats.effectiveHours.toFixed(1)} sa.</span>

                                <span>Toplam Ciro:</span>
                                <span className="text-green-400 font-bold font-mono text-right">{formatCompactCurrency(simulationResults.stats.totalRevenue)}</span>
                            </div>
                        </div>
                    )}
                </div>

                {/* RIGHT: RESULTS TABLE (8 Columns) */}
                <div className="lg:col-span-8 bg-zinc-900/30 rounded-xl border border-zinc-800 flex flex-col overflow-hidden">
                    <div className="p-4 border-b border-zinc-800 bg-zinc-900/80 flex justify-between items-center sticky top-0">
                        <h4 className="font-semibold text-zinc-200 flex items-center gap-2">
                            <Package size={18} /> Tahmini Arz Listesi
                        </h4>
                        <span className="text-xs text-zinc-500">
                            {simulationResults.supplyList.length} Kalem
                        </span>
                    </div>

                    <div className="flex-1 overflow-y-auto">
                        {simulationResults.supplyList.length > 0 ? (
                            <table className="w-full text-left text-sm">
                                <thead className="bg-zinc-950 text-zinc-500 text-xs uppercase font-medium sticky top-0 z-10 shadow-sm">
                                    <tr>
                                        <th className="p-3 font-semibold">EÅŸya AdÄ±</th>
                                        <th className="p-3 text-right font-semibold">Miktar</th>
                                        <th className="p-3 text-right font-semibold">Piyasa DeÄŸeri</th>
                                    </tr>
                                </thead>
                                <tbody className="divide-y divide-zinc-800/50">
                                    {simulationResults.supplyList.map((item, idx) => (
                                        <tr key={idx} className="hover:bg-zinc-800/30 transition-colors group">
                                            <td className="p-3 text-zinc-300 font-medium">{item.name}</td>
                                            <td className="p-3 text-right text-zinc-400 font-mono group-hover:text-white transition-colors">
                                                {formatCompactCurrency(item.count)}
                                            </td>
                                            <td className="p-3 text-right text-indigo-400 font-mono font-bold">
                                                {formatCompactCurrency(item.totalValue)}
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        ) : (
                            <div className="h-full flex flex-col items-center justify-center text-zinc-600 gap-2">
                                <PieChart size={48} className="opacity-20" />
                                <p>SonuÃ§larÄ± gÃ¶rmek iÃ§in sol taraftan metin ekleyin.</p>
                            </div>
                        )}
                    </div>
                </div>

            </div>
        </div>
    );
}

==================================================
DOSYA YOLU: .\app\components\widgets\MarketWidget.js
==================================================
"use client";

import { useState, useMemo } from "react";
import { motion, AnimatePresence } from "framer-motion";
import { CheckCircle, Coins, Package, X, EyeOff } from "lucide-react";
import useWidgetStore from "../../store/useWidgetStore";
import { exportToFile, parseImportFile } from "../../lib/excelUtils";
import { syncLocalMarketItems } from "../../lib/marketUtils";
import { formatCurrency, formatCompactCurrency } from "../../lib/calculator";

// Sub-components
import MarketStatCard from "./market/MarketStatCard";
import MarketFilters from "./market/MarketFilters";
import MarketTable from "./market/MarketTable";
import MarketModals from "./market/MarketModals";

// Helper for classes
const clsx = (...classes) => classes.filter(Boolean).join(" ");

// ============================================================================
// MAIN WIDGET VIEW (SaaS Dashboard Styled)
// ============================================================================
export default function MarketWidget() {
    // Global Store Data
    const masterRegistry = useWidgetStore((state) => state.masterRegistry);
    const activeServerId = useWidgetStore((state) => state.activeServerId);
    const serverProfiles = useWidgetStore((state) => state.serverProfiles);

    // Actions
    const updatePrice = useWidgetStore((state) => state.updatePrice);
    const registerItem = useWidgetStore((state) => state.registerItem);
    const setActiveServer = useWidgetStore((state) => state.setActiveServer);
    const addServerProfile = useWidgetStore((state) => state.addServerProfile);
    const resetMarketData = useWidgetStore((state) => state.resetMarketData);
    const nukeStore = useWidgetStore((state) => state.nukeStore);

    // Derived State
    const activeProfile = useMemo(() =>
        serverProfiles.find(p => p.id === activeServerId),
        [serverProfiles, activeServerId]
    );
    const prices = activeProfile?.prices || {};

    // Local State
    const [selectedCategory, setSelectedCategory] = useState("TÃ¼mÃ¼");
    const [searchQuery, setSearchQuery] = useState("");
    const [showAddForm, setShowAddForm] = useState(false);
    const [showDataModal, setShowDataModal] = useState(false);
    const [showProfileModal, setShowProfileModal] = useState(false);
    const [showResetModal, setShowResetModal] = useState(false);
    const [dataModalTab, setDataModalTab] = useState("export");
    const [successMessage, setSuccessMessage] = useState("");
    const [isDragging, setIsDragging] = useState(false);
    const [profileName, setProfileName] = useState("");
    const [newItem, setNewItem] = useState({
        name: "",
        category: "genel",
        icon: "Circle"
    });

    // Merge registry with local prices to create display items
    const displayItems = useMemo(() => {
        return masterRegistry.map(item => ({
            ...item,
            price: prices[item.id] || 0
        }));
    }, [masterRegistry, prices]);

    // Get unique categories
    const categories = useMemo(() => {
        const cats = ["TÃ¼mÃ¼", ...new Set(masterRegistry.map(item => item.category))];
        return cats;
    }, [masterRegistry]);

    // Filter items
    const filteredItems = useMemo(() => {
        return displayItems.filter(item => {
            const matchesCategory = selectedCategory === "TÃ¼mÃ¼" || item.category === selectedCategory;
            const matchesSearch = item.name.toLowerCase().includes(searchQuery.toLowerCase());
            return matchesCategory && matchesSearch;
        });
    }, [displayItems, selectedCategory, searchQuery]);

    // Calculate total value (All displayed items)
    const totalValue = useMemo(() => {
        return filteredItems.reduce((sum, item) => sum + item.price, 0);
    }, [filteredItems]);

    // ========================================================================
    // HANDLERS
    // ========================================================================

    const handlePriceChange = (itemId, newPrice) => {
        const price = parseFloat(newPrice);
        if (!isNaN(price) && price >= 0) {
            updatePrice(itemId, price);
        }
    };

    const handleAddItem = (e) => {
        e.preventDefault();
        if (newItem.name) {
            registerItem({
                name: newItem.name,
                category: newItem.category,
                icon: newItem.icon
            });

            setNewItem({ name: "", category: "genel", icon: "Circle" });
            setShowAddForm(false);
            setSuccessMessage("âœ… Yeni eÅŸya kataloÄŸa eklendi!");
            setTimeout(() => setSuccessMessage(""), 3000);
        }
    };

    const handleSwitchServer = (serverId) => {
        setActiveServer(serverId);
        const server = serverProfiles.find(p => p.id === serverId);
        setSuccessMessage(`âœ… Sunucu deÄŸiÅŸtirildi: ${server?.name}`);
        setTimeout(() => setSuccessMessage(""), 3000);
    };

    const handleAddServer = () => {
        if (profileName.trim()) {
            addServerProfile(profileName);
            setProfileName("");
            setShowProfileModal(false);
            setSuccessMessage(`âœ… Yeni sunucu eklendi: ${profileName}`);
            setTimeout(() => setSuccessMessage(""), 3000);
        }
    };

    const handleExport = async (format) => {
        const result = await exportToFile(displayItems, `piyasa-${activeProfile?.name}-${Date.now()}`, format);
        if (result.success) {
            setSuccessMessage(`âœ… ${format.toUpperCase()} dosyasÄ± indirildi!`);
            setTimeout(() => setSuccessMessage(""), 3000);
        }
    };

    const handleImport = async (file) => {
        try {
            const result = await parseImportFile(file);
            if (!result.success) {
                alert(result.message);
                return;
            }

            const importedData = result.data;
            const { newRegistryItems, idMap } = syncLocalMarketItems(importedData, masterRegistry);

            if (newRegistryItems.length > 0) {
                newRegistryItems.forEach(item => registerItem(item));
            }

            let updatedCount = 0;
            importedData.forEach(item => {
                const itemId = idMap[item.name] || item.id;
                if (itemId) {
                    const price = parseFloat(item.price) || 0;
                    updatePrice(itemId, price);
                    updatedCount++;
                }
            });

            setSuccessMessage(
                `âœ… ${updatedCount} fiyat gÃ¼ncellendi${newRegistryItems.length > 0 ? `, ${newRegistryItems.length} yeni eÅŸya eklendi` : ''}.`
            );
            setTimeout(() => setSuccessMessage(""), 4000);
            setShowDataModal(false);
        } catch (error) {
            console.error("Import hatasÄ±:", error);
            alert("Dosya yÃ¼klenirken bir hata oluÅŸtu. LÃ¼tfen dosya formatÄ±nÄ± kontrol edin.");
        }
    };

    const handleResetData = (scope) => {
        resetMarketData(scope);
        setShowResetModal(false);
        setSuccessMessage(scope === 'full' ? "âš ï¸ TÃ¼m veriler sÄ±fÄ±rlandÄ±!" : "âš ï¸ Fiyatlar sÄ±fÄ±rlandÄ±!");
        setTimeout(() => setSuccessMessage(""), 3000);
    };

    const handleFileChange = (e) => {
        const file = e.target.files?.[0];
        if (file) handleImport(file);
    };

    const handleDragOver = (e) => {
        e.preventDefault();
        setIsDragging(true);
    };

    const handleDragLeave = () => {
        setIsDragging(false);
    };

    const handleDrop = (e) => {
        e.preventDefault();
        setIsDragging(false);
        const file = e.dataTransfer.files?.[0];
        if (file) handleImport(file);
    };

    // ========================================================================
    // RENDER: FLAT DASHBOARD LAYOUT
    // ========================================================================

    return (
        <div className="w-full h-full flex flex-col p-8 space-y-6">
            <div className="flex justify-between items-center">
                <h1 className="text-3xl font-bold text-zinc-100">Piyasa YÃ¶netimi</h1>
                {/* Global Actions */}
                <div className="flex gap-2">
                    {/* Removed Close/Minimize buttons */}
                </div>
            </div>

            {/* Success Message */}
            <AnimatePresence>
                {successMessage && (
                    <motion.div
                        initial={{ opacity: 0, y: -20 }}
                        animate={{ opacity: 1, y: 0 }}
                        exit={{ opacity: 0, y: -20 }}
                        className="bg-green-600/90 backdrop-blur-sm text-white px-4 py-3 rounded-lg flex items-center gap-2 border border-green-500/30"
                    >
                        <CheckCircle className="w-5 h-5" />
                        <span className="font-medium">{successMessage}</span>
                    </motion.div>
                )}
            </AnimatePresence>

            {/* Top Stats & Actions */}
            <MarketStatCard
                totalValue={totalValue}
                activeProfile={activeProfile}
                filteredCount={filteredItems.length}
                totalCount={displayItems.length}
                activeServerId={activeServerId}
                serverProfiles={serverProfiles}
                onSwitchServer={handleSwitchServer}
                onShowProfileModal={() => setShowProfileModal(true)}
                onShowResetModal={() => setShowResetModal(true)}
                onShowDataModal={() => setShowDataModal(true)}
            />

            {/* Search & Filters */}
            <MarketFilters
                searchQuery={searchQuery}
                setSearchQuery={setSearchQuery}
                selectedCategory={selectedCategory}
                setSelectedCategory={setSelectedCategory}
                categories={categories}
                showAddForm={showAddForm}
                setShowAddForm={setShowAddForm}
                newItem={newItem}
                setNewItem={setNewItem}
                onAddItem={handleAddItem}
            />

            {/* Data Table - Flexible Height */}
            <div className="flex-1 overflow-hidden min-h-[400px]">
                <MarketTable
                    filteredItems={filteredItems}
                    searchQuery={searchQuery}
                    onPriceChange={handlePriceChange}
                    onShowAddForm={() => setShowAddForm(true)}
                    activeProfile={activeProfile}
                />
            </div>

            {/* Footer */}
            <div className="bg-zinc-900 border border-zinc-800 p-4 rounded-xl flex items-center justify-between text-sm shrink-0">
                <span className="text-zinc-500">
                    Toplam <strong className="text-zinc-300">{filteredItems.length}</strong> kalem listeleniyor
                </span>
                <span className="text-zinc-500">
                    PortfÃ¶y DeÄŸeri: <strong className="text-blue-400">{formatCurrency(totalValue)}</strong> {activeProfile?.currency}
                </span>
            </div>

            {/* Modals Layer */}
            <MarketModals
                showProfileModal={showProfileModal}
                setShowProfileModal={setShowProfileModal}
                profileName={profileName}
                setProfileName={setProfileName}
                onAddServer={handleAddServer}

                showResetModal={showResetModal}
                setShowResetModal={setShowResetModal}
                onResetData={handleResetData}
                onNukeStore={nukeStore}

                showDataModal={showDataModal}
                setShowDataModal={setShowDataModal}
                dataModalTab={dataModalTab}
                setDataModalTab={setDataModalTab}
                onExport={handleExport}
                onFileChange={handleFileChange}

                isDragging={isDragging}
                handleDragOver={handleDragOver}
                handleDragLeave={handleDragLeave}
                handleDrop={handleDrop}
            />
        </div>
    );
}

==================================================
DOSYA YOLU: .\app\components\widgets\MetinSettingsWidget.js
==================================================
"use client";

import { useState } from "react";
import { motion } from "framer-motion";
import { Settings, CheckCircle } from "lucide-react";
import useWidgetStore from "../../store/useWidgetStore";
import { MASTER_REGISTRY } from "../../data/initialData";
import { exportMetinsToExcel, parseMetinImport } from "../../lib/excelUtils";
import { syncLocalMarketItems } from "../../lib/marketUtils";

// Import modular components
import MetinSummary from "./metin-settings/MetinSummary";
import MetinHeader from "./metin-settings/MetinHeader";
import ImportExportModal from "./metin-settings/ImportExportModal";
import MetinList from "./metin-settings/MetinList";

// ============================================================================
// DETAIL VIEW CONTAINER
// ============================================================================
function MetinSettingsDetailView({ widgetId, metins, marketItems, craftingItems }) {
    const updateWidgetData = useWidgetStore((state) => state.updateWidgetData);
    const itemRegistry = useWidgetStore((state) => state.masterRegistry);
    const registerItems = useWidgetStore((state) => state.registerItems);

    const [showDataModal, setShowDataModal] = useState(false);
    const [successMessage, setSuccessMessage] = useState("");

    // Export handler
    const handleExport = async (format) => {
        if (format === 'excel') {
            const result = await exportMetinsToExcel(metins, marketItems, `metin-listesi-${Date.now()}`);
            if (result.success) {
                setSuccessMessage('Excel dosyasÄ± baÅŸarÄ±yla indirildi!');
                setTimeout(() => setSuccessMessage(""), 3000);
            }
        } else if (format === 'json') {
            // JSON export
            const jsonString = JSON.stringify(metins, null, 2);
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `metin-listesi-${Date.now()}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            setSuccessMessage('JSON dosyasÄ± baÅŸarÄ±yla indirildi!');
            setTimeout(() => setSuccessMessage(""), 3000);
        }
    };

    // Import handler
    const handleImport = async (file) => {
        try {
            // Step 1: Parse file
            const result = await parseMetinImport(file);

            if (!result.success) {
                alert(result.message);
                return;
            }

            const { metinList, detectedItems } = result;

            // Step 2: Sync imported items with registry using marketUtils
            const { newRegistryItems, profilePrices } = syncLocalMarketItems(detectedItems, itemRegistry);

            // Step 3: Create ID mapping (tempId -> realId)
            const idMap = {};
            detectedItems.forEach(item => {
                // Normalize name for matching
                const cleanName = item.originalName.trim().toLowerCase();

                // Find in existing registry
                const existing = itemRegistry.find(r => r.name.trim().toLowerCase() === cleanName);

                // Find in new items
                const newItem = newRegistryItems.find(n => n.name.trim().toLowerCase() === cleanName);

                if (existing) {
                    idMap[item.tempId] = existing.id;
                } else if (newItem) {
                    idMap[item.tempId] = newItem.id;
                }
            });

            // Step 4: Add new items to registry
            if (newRegistryItems.length > 0) {
                registerItems(newRegistryItems);
            }

            // Step 5: Replace temp IDs with real market IDs
            const updatedMetinList = metinList.map(metin => ({
                ...metin,
                drops: metin.drops.map(drop => ({
                    ...drop,
                    itemId: idMap[drop.itemId] || drop.itemId
                }))
            }));

            // Step 6: Save to widget data
            updateWidgetData(widgetId, { metins: updatedMetinList });

            // Step 7: Show success message
            setSuccessMessage(
                `âœ… ${metinList.length} metin yÃ¼klendi. ${newRegistryItems.length} yeni eÅŸya kataloÄŸa eklendi.`
            );
            setTimeout(() => setSuccessMessage(""), 5000);
            setShowDataModal(false);

        } catch (error) {
            console.error('Import error:', error);
            alert('Ä°Ã§e aktarma sÄ±rasÄ±nda hata oluÅŸtu: ' + error.message);
        }
    };

    return (
        <div className="space-y-6 h-full flex flex-col">
            {/* Success Message */}
            {successMessage && (
                <motion.div
                    initial={{ opacity: 0, y: -20 }}
                    animate={{ opacity: 1, y: 0 }}
                    exit={{ opacity: 0, y: -20 }}
                    className="bg-green-600/90 backdrop-blur-sm text-white px-4 py-3 rounded-lg flex items-center gap-2 border border-green-500/30"
                >
                    <CheckCircle className="w-5 h-5" />
                    <span className="font-medium">{successMessage}</span>
                </motion.div>
            )}

            {/* Header with Import/Export Button */}
            <MetinHeader
                onImportExportClick={() => setShowDataModal(true)}
            />

            {/* Metins List */}
            <MetinList
                metins={metins}
                marketItems={marketItems}
                craftingItems={craftingItems}
                updateWidgetData={updateWidgetData}
                widgetId={widgetId}
            />

            {/* Import/Export Modal */}
            <ImportExportModal
                isOpen={showDataModal}
                onClose={() => setShowDataModal(false)}
                onImport={handleImport}
                onExport={handleExport}
            />
        </div>
    );
}

// ============================================================================
// MAIN WIDGET (Full-Page Dashboard View)
// ============================================================================
export default function MetinSettingsWidget() {
    // Get data from store
    const marketItems = useWidgetStore((state) => state.masterRegistry) || [];
    const craftingItems = useWidgetStore((state) => state.craftingItems) || [];

    // Get metins from store or use defaults
    const storedMetins = useWidgetStore((state) => {
        const workspace = state.workspaces.find(ws => ws.id === state.activeWorkspaceId);
        return workspace?.data?.metinSettings?.metins;
    });
    const metins = storedMetins?.length > 0 ? storedMetins : MASTER_REGISTRY.metinTemplates;

    // We use activeWorkspaceId as the widgetId for data updates
    const activeWorkspaceId = useWidgetStore((state) => state.activeWorkspaceId);

    return (
        <div className="h-full flex flex-col">
            {/* Page Header */}
            <div className="flex items-center gap-4 mb-6">
                <div className="p-3 bg-cyan-500/10 rounded-2xl border border-cyan-500/20">
                    <Settings className="w-8 h-8 text-cyan-400" />
                </div>
                <div>
                    <h1 className="text-2xl font-bold text-white">Metin AyarlarÄ±</h1>
                    <p className="text-zinc-400">HP ve drop ayarlarÄ±nÄ± dÃ¼zenleyin</p>
                </div>
            </div>

            {/* Content */}
            <div className="flex-1 overflow-hidden">
                <MetinSettingsDetailView
                    widgetId={activeWorkspaceId}
                    metins={metins}
                    marketItems={marketItems}
                    craftingItems={craftingItems}
                />
            </div>
        </div>
    );
}


==================================================
DOSYA YOLU: .\app\components\widgets\analysis\AnalysisChart.js
==================================================
"use client";

import { BarChart3, ChevronDown, AlertCircle } from "lucide-react";
import {
    BarChart, Bar, LineChart, Line,
    XAxis, YAxis, CartesianGrid, Tooltip, Legend,
    ResponsiveContainer, Cell, ReferenceLine
} from "recharts";
import { formatCurrency, formatCompactCurrency } from "../../../lib/calculator";

// Chart Colors
const CHART_COLORS = ['#06b6d4', '#8b5cf6', '#d946ef', '#f43f5e', '#eab308'];

export default function AnalysisChart({ chartType, setChartType, comparisonData, efficiencyData, userStats, topMetins }) {
    // Data Guard - Veri yoksa mesaj gÃ¶ster
    const hasComparisonData = comparisonData && comparisonData.length > 0;
    const hasEfficiencyData = efficiencyData && efficiencyData.length > 0;
    const hasData = chartType === "comparison" ? hasComparisonData : hasEfficiencyData;

    return (
        <div className="bg-black/40 backdrop-blur-xl p-6 rounded-2xl border border-white/5 hover:border-cyan-500/30 transition-colors shadow-sm flex flex-col">
            <div className="flex items-center justify-between mb-6">
                <h3 className="text-lg font-semibold text-white flex items-center gap-2">
                    <BarChart3 className="w-5 h-5 text-white/70" />
                    Analiz GrafiÄŸi
                </h3>

                {/* Chart Type Selector */}
                <div className="relative">
                    <select
                        value={chartType}
                        onChange={(e) => setChartType(e.target.value)}
                        className="appearance-none bg-black/50 border border-white/10 text-white px-4 py-2 pr-10 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500/50 cursor-pointer font-medium"
                    >
                        <option value="comparison">Metin KarÅŸÄ±laÅŸtÄ±rmasÄ±</option>
                        <option value="efficiency">Hasar VerimliliÄŸi (Top 5)</option>
                    </select>
                    <ChevronDown className="absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-white/50 pointer-events-none" />
                </div>
            </div>

            {/* Chart Container with Fixed Height */}
            <div className="w-full h-[400px]">
                {!hasData ? (
                    // Empty State
                    <div className="w-full h-full flex flex-col items-center justify-center text-white/50">
                        <AlertCircle className="w-12 h-12 mb-3 opacity-50" />
                        <p className="text-lg font-medium">Veri Yok</p>
                        <p className="text-sm">Grafik oluÅŸturmak iÃ§in metin verileri gerekli</p>
                    </div>
                ) : (
                    <ResponsiveContainer width="100%" height="100%">
                        {chartType === "comparison" ? (
                            <BarChart data={comparisonData}>
                                <CartesianGrid strokeDasharray="3 3" stroke="#ffffff20" vertical={false} />
                                <XAxis
                                    dataKey="name"
                                    tick={{ fontSize: 12, fill: '#ffffff80' }}
                                    axisLine={false}
                                    tickLine={false}
                                    interval={0}
                                    height={50}
                                    angle={-15}
                                    textAnchor="end"
                                />
                                <YAxis
                                    tick={{ fontSize: 12, fill: '#ffffff80' }}
                                    tickFormatter={(value) => formatCompactCurrency(value)}
                                    axisLine={false}
                                    tickLine={false}
                                />
                                <Tooltip
                                    cursor={{ fill: '#ffffff10' }}
                                    formatter={(value) => [`${formatCurrency(value)} Yang`, 'Saatlik KazanÃ§']}
                                    contentStyle={{
                                        backgroundColor: '#000000',
                                        border: '1px solid rgba(6, 182, 212, 0.3)',
                                        borderRadius: '8px',
                                        color: '#fff'
                                    }}
                                />
                                <Bar dataKey="profit" radius={[4, 4, 0, 0]}>
                                    {comparisonData.map((entry, index) => (
                                        <Cell
                                            key={`cell-${index}`}
                                            fill={entry.isBest ? "#06b6d4" : "#4b5563"}
                                        />
                                    ))}
                                </Bar>
                            </BarChart>
                        ) : (
                            <LineChart data={efficiencyData}>
                                <CartesianGrid strokeDasharray="3 3" stroke="#ffffff20" />
                                <XAxis
                                    dataKey="damage"
                                    tick={{ fontSize: 12, fill: '#ffffff80' }}
                                    tickFormatter={(value) => formatCompactCurrency(value)}
                                    label={{ value: 'Hasar', position: 'insideBottom', offset: -5, fill: '#ffffff60', fontSize: 12 }}
                                />
                                <YAxis
                                    tick={{ fontSize: 12, fill: '#ffffff80' }}
                                    tickFormatter={(value) => formatCompactCurrency(value)}
                                />
                                <Tooltip
                                    formatter={(value, name) => [`${formatCurrency(value)} Yang`, name]}
                                    labelFormatter={(label) => `Hasar: ${formatCurrency(label)}`}
                                    contentStyle={{
                                        backgroundColor: '#000000',
                                        border: '1px solid rgba(6, 182, 212, 0.3)',
                                        borderRadius: '8px',
                                        color: '#fff'
                                    }}
                                    itemSorter={(item) => -item.value}
                                />
                                <Legend wrapperStyle={{ paddingTop: '10px' }} />
                                <ReferenceLine
                                    x={userStats.damage}
                                    stroke="#ffffff"
                                    strokeDasharray="3 3"
                                    label={{ value: 'Siz', position: 'top', fill: '#ffffff', fontSize: 12 }}
                                />
                                {topMetins.map((metin, index) => (
                                    <Line
                                        key={metin.metinId}
                                        type="monotone"
                                        dataKey={metin.metinName}
                                        stroke={CHART_COLORS[index % CHART_COLORS.length]}
                                        strokeWidth={index === 0 ? 3 : 2}
                                        dot={false}
                                        activeDot={{ r: 6 }}
                                    />
                                ))}
                            </LineChart>
                        )}
                    </ResponsiveContainer>
                )}
            </div>
        </div>
    );
}


==================================================
DOSYA YOLU: .\app\components\widgets\analysis\AnalysisKPIs.js
==================================================
"use client";

import { Award, TrendingUp } from "lucide-react";
import { formatCompactCurrency } from "../../../lib/calculator";
import SmartInput from "@/app/components/ui/SmartInput";

export default function AnalysisKPIs({ bestMetin, netHourlyProfit, hourlyCost, setHourlyCost }) {
    return (
        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
            {/* Best Metin Card */}
            <div className="bg-black/40 backdrop-blur-xl p-6 rounded-2xl border border-white/5 hover:border-cyan-500/30 transition-colors shadow-sm flex items-center justify-between relative overflow-hidden">
                <div className="absolute -right-6 -bottom-6 opacity-10">
                    <Award className="w-32 h-32 text-cyan-400" />
                </div>
                <div>
                    <p className="text-sm text-white/70 mb-1 flex items-center gap-2">
                        <Award className="w-4 h-4 text-cyan-400" />
                        En KarlÄ± SeÃ§im
                    </p>
                    <h3 className="text-3xl font-bold text-white">
                        {bestMetin.metinName}
                    </h3>
                </div>
                <div className="text-right z-10">
                    <p className="text-sm text-white/60">Metin BaÅŸÄ±</p>
                    <p className="text-xl font-bold text-cyan-400">
                        {formatCompactCurrency(bestMetin.dropValuePerMetin)}
                    </p>
                </div>
            </div>

            {/* Profit Card */}
            <div className="bg-black/40 backdrop-blur-xl p-6 rounded-2xl border border-white/5 hover:border-cyan-500/30 transition-colors shadow-sm flex items-center justify-between relative overflow-hidden">
                <div className="absolute -right-6 -bottom-6 opacity-10">
                    <TrendingUp className="w-32 h-32 text-violet-400" />
                </div>
                <div>
                    <p className="text-sm text-white/70 mb-1 flex items-center gap-2">
                        <TrendingUp className="w-4 h-4 text-violet-400" />
                        Tahmini Net KazanÃ§
                    </p>
                    <h3 className="text-3xl font-bold text-white">
                        {formatCompactCurrency(netHourlyProfit)}
                    </h3>
                    <p className="text-xs text-white/50">Yang / Saat</p>
                </div>
                <div className="z-10 bg-black/20 p-2 rounded-lg border border-white/10">
                    <label className="block text-xs text-white/60 mb-1">Saatlik Masraf</label>
                    <SmartInput
                        min={0}
                        value={hourlyCost}
                        onChange={(val) => setHourlyCost(val)}
                        className="w-24 bg-transparent text-right text-white font-bold focus:outline-none border-b border-white/20 focus:border-violet-400 transition-colors"
                        placeholder="0"
                    />
                </div>
            </div>
        </div>
    );
}

==================================================
DOSYA YOLU: .\app\components\widgets\analysis\AnalysisSummaryView.js
==================================================
"use client";

import { useMemo } from "react";
import { Award, TrendingUp, PlusCircle } from "lucide-react";
import { BarChart, Bar, ResponsiveContainer } from "recharts";
import { formatCompactCurrency } from "../../../lib/calculator";

export default function AnalysisSummaryView({ bestMetin }) {
    // Prepare mini chart data (top 5)
    const miniChartData = useMemo(() => {
        if (!bestMetin) return [];
        // Since we only have bestMetin, create a simple single-bar chart
        return [{
            name: bestMetin.metinName.substring(0, 6),
            profit: bestMetin.hourlyProfit,
        }];
    }, [bestMetin]);

    // BOÅ DURUM YÃ–NETÄ°MÄ°
    if (!bestMetin) {
        return (
            <div className="flex flex-col items-center justify-center h-full text-white/40 text-center px-6">
                <div className="w-16 h-16 bg-white/5 rounded-full flex items-center justify-center mb-4 border border-white/10 border-dashed">
                    <PlusCircle className="w-8 h-8 opacity-50" />
                </div>
                <h3 className="text-lg font-semibold text-white/80 mb-2">Veri Bekleniyor</h3>
                <p className="text-sm">
                    Analiz yapmak iÃ§in Ã¶nce <strong>Metin AyarlarÄ±</strong>'ndan bir metin ekleyin.
                </p>
            </div>
        );
    }

    return (
        <div className="flex flex-col items-center justify-center h-full w-full overflow-hidden px-4 relative">
            {/* Mini Background Chart */}
            <div className="absolute inset-0 opacity-[0.05] pointer-events-none">
                <ResponsiveContainer width="100%" height="100%">
                    <BarChart data={miniChartData}>
                        <Bar dataKey="profit" fill="#06b6d4" />
                    </BarChart>
                </ResponsiveContainer>
            </div>

            {/* Best Metin Badge */}
            <div className="flex items-center gap-2 mb-3 relative z-10">
                <Award className="w-6 h-6 text-cyan-400" />
                <span className="text-xs font-bold text-cyan-400 uppercase tracking-wide drop-shadow-[0_0_8px_rgba(34,211,238,0.5)]">
                    En KarlÄ± Metin
                </span>
            </div>

            {/* Metin Name */}
            <h3 className="text-2xl font-bold text-white mb-4 text-center relative z-10 drop-shadow-[0_0_10px_rgba(6,182,212,0.5)]">
                {bestMetin.metinName}
            </h3>

            {/* Split Stats */}
            <div className="grid grid-cols-2 gap-6 w-full max-w-xs relative z-10">
                <div className="flex flex-col items-center border-r border-white/10 pr-4">
                    <span className="text-xs text-white/60 mb-1">Metin BaÅŸÄ±</span>
                    <span className="text-xl font-bold text-white font-mono">
                        {formatCompactCurrency(bestMetin.dropValuePerMetin)}
                    </span>
                    <span className="text-xs text-white/50">Yang</span>
                </div>
                <div className="flex flex-col items-center pl-4">
                    <span className="text-xs text-white/60 mb-1 flex items-center gap-1">
                        <TrendingUp className="w-3 h-3 text-violet-400" />
                        Saatte
                    </span>
                    <span className="text-xl font-bold text-white font-mono">
                        {bestMetin.metinsPerHour.toFixed(1)}
                    </span>
                    <span className="text-xs text-white/50">Adet</span>
                </div>
            </div>
        </div>
    );
}

==================================================
DOSYA YOLU: .\app\components\widgets\analysis\AnalysisTable.js
==================================================
"use client";

import { AlertCircle, Target } from "lucide-react";
import { formatTime, formatCompactCurrency } from "../../../lib/calculator";

export default function AnalysisTable({ calculations, softcapWarning }) {
    return (
        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
            {/* Softcap Status */}
            <div className="lg:col-span-1">
                {softcapWarning?.active ? (
                    <div className="bg-red-500/10 backdrop-blur-xl p-6 rounded-2xl border border-red-500/30 h-full">
                        <div className="flex items-center gap-3 mb-3">
                            <AlertCircle className="w-6 h-6 text-red-400" />
                            <h4 className="font-bold text-white">Softcap UyarÄ±sÄ±</h4>
                        </div>
                        <p className="text-sm text-white/80 leading-relaxed">
                            {softcapWarning.message}
                        </p>
                        <div className="mt-4 p-3 bg-black/20 rounded-lg border border-red-500/20">
                            <p className="text-xs text-red-300">
                                Ã–neri: Hasar artÄ±rmak yerine metin bulma sÃ¼renizi (hareket hÄ±zÄ±) iyileÅŸtirmeye odaklanÄ±n.
                            </p>
                        </div>
                    </div>
                ) : (
                    <div className="bg-cyan-500/10 backdrop-blur-xl p-6 rounded-2xl border border-cyan-500/30 h-full flex flex-col justify-center items-center text-center">
                        <div className="p-3 bg-cyan-500/20 rounded-full mb-3">
                            <Target className="w-6 h-6 text-cyan-400" />
                        </div>
                        <h4 className="font-bold text-white mb-1">Verimlilik Ä°yi</h4>
                        <p className="text-sm text-white/70">
                            Mevcut hasarÄ±nÄ±zla henÃ¼z softcap sÄ±nÄ±rÄ±na ulaÅŸmadÄ±nÄ±z. Hasar artÄ±ÅŸÄ± kÃ¢rÄ±nÄ±zÄ± artÄ±rmaya devam edecektir.
                        </p>
                    </div>
                )}
            </div>

            {/* Detailed Table */}
            <div className="lg:col-span-2 bg-black/40 backdrop-blur-xl p-6 rounded-2xl border border-white/5 hover:border-cyan-500/30 transition-colors shadow-sm overflow-hidden flex flex-col">
                <h3 className="text-lg font-semibold text-white mb-4">DetaylÄ± SÄ±ralama</h3>
                <div className="overflow-auto max-h-[300px] -mr-2 pr-2">
                    <table className="w-full">
                        <thead className="bg-black/60 sticky top-0 backdrop-blur-md z-10">
                            <tr>
                                <th className="px-3 py-2 text-left text-xs font-semibold text-white/60">SÄ±ra</th>
                                <th className="px-3 py-2 text-left text-xs font-semibold text-white/60">Metin</th>
                                <th className="px-3 py-2 text-right text-xs font-semibold text-white/60">Kesim SÃ¼resi</th>
                                <th className="px-3 py-2 text-right text-xs font-semibold text-white/60">Adet/Saat</th>
                                <th className="px-3 py-2 text-right text-xs font-semibold text-white/60">KazanÃ§</th>
                            </tr>
                        </thead>
                        <tbody className="divide-y divide-white/5">
                            {calculations.map((calc, index) => (
                                <tr
                                    key={calc.metinId}
                                    className={`hover:bg-cyan-500/5 transition-colors ${index === 0 ? "bg-cyan-500/10" : ""}`}
                                >
                                    <td className="px-3 py-3 text-sm text-white/50">#{index + 1}</td>
                                    <td className="px-3 py-3">
                                        <span className={`text-sm font-medium ${index === 0 ? "text-cyan-400" : "text-white"}`}>
                                            {calc.metinName}
                                        </span>
                                    </td>
                                    <td className="px-3 py-3 text-sm text-white/70 text-right font-mono">
                                        {formatTime(calc.killTime)}
                                    </td>
                                    <td className="px-3 py-3 text-sm text-violet-300 text-right font-mono">
                                        {calc.metinsPerHour.toFixed(1)}
                                    </td>
                                    <td className="px-3 py-3 text-right">
                                        <span className={`text-sm font-bold font-mono ${index === 0 ? "text-cyan-400" : "text-white/90"}`}>
                                            {formatCompactCurrency(calc.hourlyProfit)}
                                        </span>
                                    </td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    );
}

==================================================
DOSYA YOLU: .\app\components\widgets\analysis\BossRotationView.js
==================================================
"use client";

import { useMemo } from "react";
import { formatCurrency, formatTime, calculateAllBosses, formatCompactCurrency } from "../../../lib/calculator";
import { Clock, TrendingUp, AlertTriangle, CheckCircle, Shield, Briefcase } from "lucide-react";

// Helper for classes
const clsx = (...classes) => classes.filter(Boolean).join(" ");

export default function BossRotationView({ userStats, bosses, prices, marketItems, dailyPlayHours }) {

    // 1. Calculate Metrics
    // FIX: Destructure result to get both array and total duration
    const { results: calculations, totalDurationMinutes } = useMemo(() => {
        return calculateAllBosses(bosses, userStats, dailyPlayHours, marketItems);
    }, [bosses, userStats, dailyPlayHours, marketItems]);

    // 2. Summary Metrics
    // FIX: Use totalDurationMinutes from simulation for accurate total time (includes cooling/idle)
    const totalTimeRequired = totalDurationMinutes / 60;
    const totalPotentialProfit = calculations.reduce((acc, curr) => acc + curr.dailyProfit, 0);
    const isOverCapacity = totalTimeRequired > dailyPlayHours;

    // Formatting Logic (X Sa. Y Dk.)
    const totalHours = Math.floor(totalDurationMinutes / 60);
    const totalMinutes = Math.floor(totalDurationMinutes % 60);
    const formattedDuration = `${totalHours} Sa. ${totalMinutes} Dk.`;

    if (bosses.length === 0) {
        return (
            <div className="flex flex-col items-center justify-center h-full text-white/50 space-y-4">
                <Shield className="w-16 h-16 opacity-20" />
                <p>HenÃ¼z Boss / Zindan eklenmemiÅŸ.</p>
                <p className="text-xs">"Boss AyarlarÄ±" widget'Ä±ndan ekleme yapabilirsiniz.</p>
            </div>
        );
    }

    return (
        <div className="space-y-6">
            {/* Header / Summary Card */}
            <div className={clsx(
                "p-4 rounded-2xl border flex items-center justify-between",
                isOverCapacity
                    ? "bg-red-500/10 border-red-500/20"
                    : "bg-green-500/10 border-green-500/20"
            )}>
                <div className="flex items-center gap-4">
                    <div className={clsx(
                        "p-3 rounded-xl",
                        isOverCapacity ? "bg-red-500/20 text-red-400" : "bg-green-500/20 text-green-400"
                    )}>
                        {isOverCapacity ? <AlertTriangle className="w-6 h-6" /> : <CheckCircle className="w-6 h-6" />}
                    </div>
                    <div>
                        <h3 className="text-lg font-bold text-white">
                            {isOverCapacity ? "Zaman Yetersiz!" : "Rotasyon Uygun"}
                        </h3>
                        <p className="text-sm text-white/60">
                            {isOverCapacity
                                ? `TÃ¼m zindanlarÄ± bitirmek ${formattedDuration} sÃ¼rÃ¼yor. (${(totalTimeRequired - dailyPlayHours).toFixed(1)} sa. eksik)`
                                : `Top. SÃ¼re: ${formattedDuration} / ${dailyPlayHours} Saat`}
                        </p>
                    </div>
                </div>
                <div className="text-right">
                    <div className="text-xs text-white/50">Tahmini GÃ¼nlÃ¼k KazanÃ§</div>
                    <div className="text-2xl font-bold text-cyan-400 text-shadow-neon">
                        {formatCompactCurrency(totalPotentialProfit)}
                    </div>
                </div>
            </div>

            {/* Boss Table */}
            <div className="bg-black/20 rounded-2xl border border-white/5 overflow-hidden">
                <table className="w-full text-left">
                    <thead className="bg-white/5 text-xs text-white/40 uppercase font-medium">
                        <tr>
                            <th className="p-4">Boss AdÄ±</th>
                            <th className="p-4 text-center">Tur SÃ¼resi</th>
                            <th className="p-4 text-center">Limit</th>
                            <th className="p-4 text-center">GerÃ§ek Kesim</th>
                            <th className="p-4 text-right">GÃ¼nlÃ¼k KazanÃ§</th>
                            <th className="p-4 text-center">Gereken SÃ¼re</th>
                        </tr>
                    </thead>
                    <tbody className="divide-y divide-white/5">
                        {calculations.map((calc, idx) => (
                            <tr key={calc.bossId} className="hover:bg-white/5 transition-colors">
                                <td className="p-4">
                                    <div className="font-medium text-white/90">{calc.bossName}</div>
                                    <div className="text-xs text-white/40 mt-0.5">
                                        Drop DeÄŸeri: {formatCompactCurrency(calc.profitPerCycle)}
                                    </div>
                                </td>
                                <td className="p-4 text-center text-sm text-white/70">
                                    {calc.cycleTimeMinutes.toFixed(0)} dk
                                </td>
                                <td className="p-4 text-center">
                                    {calc.dailyLimit > 0 ? (
                                        <span className="px-2 py-0.5 rounded bg-white/10 text-xs">{calc.dailyLimit}</span>
                                    ) : (
                                        <span className="text-xl text-white/20">âˆ</span>
                                    )}
                                </td>
                                <td className="p-4 text-center text-cyan-300 font-medium">
                                    {calc.realDailyKills}
                                </td>
                                <td className="p-4 text-right font-bold text-green-400">
                                    {formatCompactCurrency(calc.dailyProfit)}
                                </td>
                                <td className="p-4 text-center text-sm text-white/60">
                                    {calc.timeRequiredHours.toFixed(1)} sa.
                                </td>
                            </tr>
                        ))}
                    </tbody>
                </table>
            </div>

            <div className="text-xs text-white/30 text-center italic">
                * Tur sÃ¼resine Metin Bulma / Zindan GiriÅŸ-Ã‡Ä±kÄ±ÅŸ sÃ¼releri dahil edilmiÅŸtir.
            </div>
        </div>
    );
}

==================================================
DOSYA YOLU: .\app\components\widgets\market\MarketFilters.js
==================================================
import React from "react";
import { Search, Filter, Plus } from "lucide-react";
import { motion, AnimatePresence } from "framer-motion";

export default function MarketFilters({
    searchQuery,
    setSearchQuery,
    selectedCategory,
    setSelectedCategory,
    categories,
    showAddForm,
    setShowAddForm,
    newItem,
    setNewItem,
    onAddItem
}) {
    const iconOptions = [
        "Circle", "Star", "Diamond", "Gem", "Crown", "Shield", "Sword",
        "Zap", "Heart", "Sparkles", "Award", "Package", "Gift"
    ];

    return (
        <div className="space-y-3">
            <div className="relative">
                <Search className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-white/50" />
                <input
                    type="text"
                    value={searchQuery}
                    onChange={(e) => setSearchQuery(e.target.value)}
                    placeholder="EÅŸya ara..."
                    className="w-full pl-10 pr-4 py-2 font-medium text-white bg-black/50 border border-white/10 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500/20 focus:border-cyan-500/50 placeholder:text-white/20 backdrop-blur-sm transition-all"
                />
            </div>

            <div className="flex items-center gap-2 flex-wrap">
                <Filter className="w-4 h-4 text-white/60" />
                {categories.map((cat) => (
                    <button
                        key={cat}
                        onClick={() => setSelectedCategory(cat)}
                        className={`px-3 py-1 rounded-lg text-sm font-medium transition-all backdrop-blur-sm ${selectedCategory === cat
                                ? "bg-cyan-600/20 text-cyan-400 border border-cyan-500/30 shadow-md"
                                : "bg-white/5 text-white/70 hover:bg-white/10 border border-white/10"
                            }`}
                    >
                        {cat.charAt(0).toUpperCase() + cat.slice(1)}
                    </button>
                ))}
            </div>

            <button
                onClick={() => setShowAddForm(!showAddForm)}
                className="w-full flex items-center justify-center gap-2 px-4 py-2 bg-cyan-600/20 backdrop-blur-sm text-cyan-400 rounded-lg hover:bg-cyan-600/40 transition-colors font-medium border border-cyan-500/30"
            >
                <Plus className="w-5 h-5" />
                Yeni EÅŸya Ekle
            </button>

            {/* Add Form */}
            <AnimatePresence>
                {showAddForm && (
                    <motion.form
                        initial={{ opacity: 0, height: 0 }}
                        animate={{ opacity: 1, height: "auto" }}
                        exit={{ opacity: 0, height: 0 }}
                        onSubmit={onAddItem}
                        className="bg-white/5 backdrop-blur-xl p-4 rounded-xl border border-white/10 space-y-3"
                    >
                        <h3 className="font-semibold text-white mb-2">Yeni EÅŸya Bilgileri</h3>
                        <div className="grid grid-cols-2 gap-3">
                            <input
                                type="text"
                                value={newItem.name}
                                onChange={(e) => setNewItem({ ...newItem, name: e.target.value })}
                                className="px-3 py-2 font-medium text-white bg-black/50 border border-white/10 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500/20 focus:border-cyan-500/50 placeholder:text-white/20"
                                placeholder="EÅŸya adÄ±"
                                required
                            />
                            <input
                                type="text"
                                value={newItem.category}
                                onChange={(e) => setNewItem({ ...newItem, category: e.target.value })}
                                className="px-3 py-2 font-medium text-white bg-black/50 border border-white/10 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500/20 focus:border-cyan-500/50 placeholder:text-white/20"
                                placeholder="Kategori"
                            />
                            <select
                                value={newItem.icon}
                                onChange={(e) => setNewItem({ ...newItem, icon: e.target.value })}
                                className="col-span-2 px-3 py-2 font-medium text-white bg-black/50 border border-white/10 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500/20 focus:border-cyan-500/50"
                            >
                                {iconOptions.map((icon) => (
                                    <option key={icon} value={icon} className="bg-zinc-900">{icon}</option>
                                ))}
                            </select>
                        </div>
                        <div className="flex gap-2">
                            <button
                                type="submit"
                                className="flex-1 px-4 py-2 bg-cyan-600/20 text-cyan-400 rounded-lg hover:bg-cyan-600/40 transition-colors text-sm font-medium border border-cyan-500/30"
                            >
                                Ekle
                            </button>
                            <button
                                type="button"
                                onClick={() => setShowAddForm(false)}
                                className="px-4 py-2 bg-white/5 text-white/80 rounded-lg hover:bg-white/10 transition-colors text-sm font-medium border border-white/10"
                            >
                                Ä°ptal
                            </button>
                        </div>
                    </motion.form>
                )}
            </AnimatePresence>
        </div>
    );
}

==================================================
DOSYA YOLU: .\app\components\widgets\market\MarketModals.js
==================================================
import React from "react";
import { motion } from "framer-motion";
import { X, Trash2, Download, Upload, FileSpreadsheet, FileJson, Coins } from "lucide-react";
import * as LucideIcons from "lucide-react";

export default function MarketModals({
    showProfileModal,
    setShowProfileModal,
    profileName,
    setProfileName,
    onAddServer,

    showResetModal,
    setShowResetModal,
    onResetData,
    onNukeStore,

    showDataModal,
    setShowDataModal,
    dataModalTab,
    setDataModalTab,
    onExport,
    onFileChange,

    isDragging,
    handleDragOver,
    handleDragLeave,
    handleDrop
}) {
    return (
        <>
            {/* Server Add Modal */}
            {showProfileModal && (
                <div className="fixed inset-0 z-[110] flex items-center justify-center p-4">
                    <div
                        className="absolute inset-0 bg-black/60 backdrop-blur-sm"
                        onClick={() => setShowProfileModal(false)}
                    />
                    <motion.div
                        initial={{ opacity: 0, scale: 0.9 }}
                        animate={{ opacity: 1, scale: 1 }}
                        className="relative bg-black/80 backdrop-blur-xl border border-white/10 rounded-2xl p-6 max-w-md w-full shadow-2xl"
                    >
                        <div className="flex items-center justify-between mb-4">
                            <h3 className="text-xl font-bold text-white">Yeni Sunucu Ekle</h3>
                            <button
                                onClick={() => setShowProfileModal(false)}
                                className="p-1 hover:bg-white/10 rounded-lg transition-colors"
                            >
                                <X className="w-5 h-5 text-white/70" />
                            </button>
                        </div>
                        <p className="text-sm text-white/70 mb-4">
                            Yeni bir sunucu profili oluÅŸturun.
                        </p>
                        <input
                            type="text"
                            value={profileName}
                            onChange={(e) => setProfileName(e.target.value)}
                            placeholder="Sunucu adÄ±..."
                            className="w-full px-3 py-2 font-medium text-white bg-black/50 border border-white/10 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500/20 focus:border-cyan-500/50 placeholder:text-white/20 mb-4"
                        />
                        <div className="flex gap-2">
                            <button
                                onClick={onAddServer}
                                disabled={!profileName.trim()}
                                className="flex-1 px-4 py-2 bg-cyan-600/20 text-cyan-400 rounded-lg hover:bg-cyan-600/40 transition-colors font-medium border border-cyan-500/30 disabled:opacity-50 disabled:cursor-not-allowed"
                            >
                                Ekle
                            </button>
                            <button
                                onClick={() => setShowProfileModal(false)}
                                className="px-4 py-2 bg-white/5 text-white/80 rounded-lg hover:bg-white/10 transition-colors font-medium border border-white/10"
                            >
                                Ä°ptal
                            </button>
                        </div>
                    </motion.div>
                </div>
            )}

            {/* Reset Confirmation Modal */}
            {showResetModal && (
                <div className="fixed inset-0 z-[110] flex items-center justify-center p-4">
                    <div
                        className="absolute inset-0 bg-red-950/80 backdrop-blur-md"
                        onClick={() => setShowResetModal(false)}
                    />
                    <motion.div
                        initial={{ opacity: 0, scale: 0.9 }}
                        animate={{ opacity: 1, scale: 1 }}
                        className="relative bg-black/90 backdrop-blur-xl border-2 border-red-600 rounded-2xl p-6 max-w-md w-full shadow-[0_0_50px_rgba(220,38,38,0.3)]"
                    >
                        <div className="flex items-center justify-between mb-6">
                            <h3 className="text-2xl font-bold text-white flex items-center gap-3">
                                <div className="p-2 bg-red-600 rounded-lg">
                                    <Trash2 className="w-6 h-6 text-white" />
                                </div>
                                KRÄ°TÄ°K Ä°ÅLEM
                            </h3>
                            <button
                                onClick={() => setShowResetModal(false)}
                                className="p-2 hover:bg-white/10 rounded-lg transition-colors"
                            >
                                <X className="w-5 h-5 text-white/70" />
                            </button>
                        </div>

                        <div className="bg-red-500/10 border border-red-500/20 rounded-xl p-4 mb-6">
                            <p className="text-red-200 font-medium mb-2 flex items-center gap-2">
                                <LucideIcons.AlertTriangle className="w-5 h-5 text-red-500" />
                                Bu iÅŸlem geri alÄ±namaz!
                            </p>
                            <ul className="text-sm text-red-300/80 list-disc list-inside space-y-1 ml-1">
                                <li>TÃ¼m market fiyatlarÄ± silinir.</li>
                                <li>Metin ve karakter ayarlarÄ± silinir.</li>
                                <li>Sayfa otomatik yenilenir.</li>
                                <li>Uygulama <strong>fabrika ayarlarÄ±na</strong> dÃ¶ner.</li>
                            </ul>
                        </div>

                        <div className="space-y-3">
                            <button
                                onClick={() => {
                                    if (window.confirm("SON UYARI: BÃ¼tÃ¼n verileriniz kalÄ±cÄ± olarak silinecek.\n\nOnaylÄ±yor musunuz?")) {
                                        onNukeStore();
                                    }
                                }}
                                className="w-full px-4 py-4 bg-gradient-to-r from-red-600 to-red-700 text-white rounded-xl hover:from-red-500 hover:to-red-600 transition-all font-bold shadow-lg shadow-red-900/40 flex items-center justify-center gap-3 group"
                            >
                                <Trash2 className="w-5 h-5 group-hover:scale-110 transition-transform" />
                                TÃœM VERÄ°LERÄ° SÄ°L (FABRÄ°KA AYARLARI)
                            </button>

                            <div className="relative py-2">
                                <div className="absolute inset-0 flex items-center">
                                    <div className="w-full border-t border-white/10"></div>
                                </div>
                                <div className="relative flex justify-center text-xs uppercase">
                                    <span className="bg-black/90 px-2 text-white/40">veya</span>
                                </div>
                            </div>

                            <button
                                onClick={() => onResetData('prices')}
                                className="w-full px-4 py-3 bg-white/5 text-amber-500 rounded-xl hover:bg-amber-500/10 transition-colors font-medium border border-amber-500/20 flex items-center justify-center gap-2"
                            >
                                <Coins className="w-5 h-5" />
                                Sadece FiyatlarÄ± Temizle
                            </button>

                            <button
                                onClick={() => setShowResetModal(false)}
                                className="w-full px-4 py-3 bg-transparent text-white/60 rounded-xl hover:text-white hover:bg-white/5 transition-colors font-medium"
                            >
                                Ä°ptal
                            </button>
                        </div>
                    </motion.div>
                </div>
            )}

            {/* Data Import/Export Modal */}
            {showDataModal && (
                <div className="fixed inset-0 z-[110] flex items-center justify-center p-4">
                    <div
                        className="absolute inset-0 bg-black/60 backdrop-blur-sm"
                        onClick={() => setShowDataModal(false)}
                    />
                    <motion.div
                        initial={{ opacity: 0, scale: 0.9 }}
                        animate={{ opacity: 1, scale: 1 }}
                        className="relative bg-black/80 backdrop-blur-xl border border-white/10 rounded-2xl p-6 max-w-md w-full shadow-2xl"
                    >
                        <div className="flex items-center justify-between mb-4">
                            <h3 className="text-xl font-bold text-white">Veri Ä°ÅŸlemleri</h3>
                            <button
                                onClick={() => setShowDataModal(false)}
                                className="p-1 hover:bg-white/10 rounded-lg transition-colors"
                            >
                                <X className="w-5 h-5 text-white/70" />
                            </button>
                        </div>

                        {/* Tabs */}
                        <div className="flex gap-2 mb-4">
                            <button
                                onClick={() => setDataModalTab("export")}
                                className={`flex-1 px-4 py-2 rounded-lg font-medium transition-all ${dataModalTab === "export"
                                    ? "bg-violet-600/20 text-violet-400 border border-violet-500/30"
                                    : "bg-white/5 text-white/70 hover:bg-white/10 border border-white/10"
                                    }`}
                            >
                                <Download className="w-4 h-4 inline mr-2" />
                                Ä°ndir
                            </button>
                            <button
                                onClick={() => setDataModalTab("import")}
                                className={`flex-1 px-4 py-2 rounded-lg font-medium transition-all ${dataModalTab === "import"
                                    ? "bg-violet-600/20 text-violet-400 border border-violet-500/30"
                                    : "bg-white/5 text-white/70 hover:bg-white/10 border border-white/10"
                                    }`}
                            >
                                <Upload className="w-4 h-4 inline mr-2" />
                                YÃ¼kle
                            </button>
                        </div>

                        {/* Export Tab */}
                        {dataModalTab === "export" && (
                            <div className="space-y-3">
                                <p className="text-sm text-white/70 mb-3">
                                    Piyasa fiyatlarÄ±nÄ±zÄ± Excel veya JSON formatÄ±nda indirin.
                                </p>
                                <button
                                    onClick={() => onExport("excel")}
                                    className="w-full flex items-center justify-center gap-3 px-4 py-3 bg-green-600/20 backdrop-blur-sm text-green-400 rounded-lg hover:bg-green-600/40 transition-colors font-medium border border-green-500/30"
                                >
                                    <FileSpreadsheet className="w-5 h-5" />
                                    Excel (.xlsx) Ä°ndir
                                </button>
                                <button
                                    onClick={() => onExport("json")}
                                    className="w-full flex items-center justify-center gap-3 px-4 py-3 bg-purple-600/20 backdrop-blur-sm text-purple-400 rounded-lg hover:bg-purple-600/40 transition-colors font-medium border border-purple-500/30"
                                >
                                    <FileJson className="w-5 h-5" />
                                    JSON Ä°ndir
                                </button>
                            </div>
                        )}

                        {/* Import Tab */}
                        {dataModalTab === "import" && (
                            <div className="space-y-3">
                                <p className="text-sm text-white/70 mb-3">
                                    Excel (.xlsx) veya JSON dosyasÄ± yÃ¼kleyin.
                                </p>
                                <div
                                    onDragOver={handleDragOver}
                                    onDragLeave={handleDragLeave}
                                    onDrop={handleDrop}
                                    className={`border-2 border-dashed rounded-lg p-8 text-center transition-all ${isDragging
                                        ? "border-violet-500 bg-violet-500/10"
                                        : "border-white/10 bg-white/5 hover:bg-white/10"
                                        }`}
                                >
                                    <Upload className="w-12 h-12 text-white/50 mx-auto mb-3" />
                                    <p className="text-white/70 mb-2">DosyayÄ± buraya sÃ¼rÃ¼kleyin</p>
                                    <p className="text-white/50 text-sm mb-4">veya</p>
                                    <label className="inline-block px-4 py-2 bg-violet-600/20 backdrop-blur-sm text-violet-400 rounded-lg hover:bg-violet-600/40 transition-colors cursor-pointer font-medium border border-violet-500/30">
                                        Dosya SeÃ§
                                        <input
                                            type="file"
                                            accept=".xlsx,.xls,.json,.csv"
                                            onChange={onFileChange}
                                            className="hidden"
                                        />
                                    </label>
                                    <p className="text-white/40 text-xs mt-3">
                                        Desteklenen formatlar: .xlsx, .xls, .json, .csv
                                    </p>
                                </div>
                            </div>
                        )}
                    </motion.div>
                </div>
            )}
        </>
    );
}

==================================================
DOSYA YOLU: .\app\components\widgets\market\MarketStatCard.js
==================================================
import React from "react";
import { Trash2, Download, FolderOpen, Plus } from "lucide-react";
import KNumber from "../../ui/KNumber";

export default function MarketStatCard({
    totalValue,
    activeProfile,
    filteredCount,
    totalCount,
    activeServerId,
    serverProfiles,
    onSwitchServer,
    onShowProfileModal,
    onShowResetModal,
    onShowDataModal
}) {
    return (
        <div className="bg-white/5 backdrop-blur-xl p-4 rounded-xl border border-white/10">
            <div className="flex items-center justify-between mb-3">
                <div>
                    <p className="text-sm text-white/70">Toplam Piyasa DeÄŸeri ({activeProfile?.name})</p>
                    <p className="text-2xl font-bold text-cyan-400">
                        <KNumber value={totalValue} /> {activeProfile?.currency}
                    </p>
                </div>
                <div className="flex items-center gap-3">
                    <button
                        onClick={onShowResetModal}
                        className="p-2 bg-red-600/20 backdrop-blur-sm text-red-400 rounded-lg hover:bg-red-600/40 transition-colors border border-red-500/30"
                        title="Verileri SÄ±fÄ±rla"
                    >
                        <Trash2 className="w-5 h-5" />
                    </button>
                    <button
                        onClick={onShowDataModal}
                        className="p-2 bg-violet-600/20 backdrop-blur-sm text-violet-400 rounded-lg hover:bg-violet-600/40 transition-colors border border-violet-500/30"
                        title="Veri Ä°ÅŸlemleri"
                    >
                        <Download className="w-5 h-5" />
                    </button>
                    <div className="text-right">
                        <p className="text-sm text-white/70">GÃ¶sterilen</p>
                        <p className="text-2xl font-bold text-white">
                            {filteredCount} / {totalCount}
                        </p>
                    </div>
                </div>
            </div>

            {/* Server Selection */}
            <div className="flex items-center gap-2 pt-3 border-t border-white/10">
                <FolderOpen className="w-4 h-4 text-white/60" />
                <select
                    value={activeServerId}
                    onChange={(e) => onSwitchServer(e.target.value)}
                    className="flex-1 px-3 py-2 text-sm font-medium text-white bg-black/50 border border-white/10 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500/20 focus:border-cyan-500/50"
                >
                    {serverProfiles.map(profile => (
                        <option key={profile.id} value={profile.id} className="bg-zinc-900">
                            {profile.name}
                        </option>
                    ))}
                </select>
                <button
                    onClick={onShowProfileModal}
                    className="px-4 py-2 bg-cyan-600/20 backdrop-blur-sm text-cyan-400 rounded-lg hover:bg-cyan-600/40 transition-colors text-sm font-medium border border-cyan-500/30 flex items-center gap-2"
                >
                    <Plus className="w-4 h-4" />
                    Yeni Sunucu
                </button>
            </div>
        </div>
    );
}

==================================================
DOSYA YOLU: .\app\components\widgets\market\MarketTable.js
==================================================
import React from "react";
import { Search, Plus } from "lucide-react";
import * as LucideIcons from "lucide-react";
import SmartInput from "@/app/components/ui/SmartInput"; // SmartInput Importu

export default function MarketTable({
    filteredItems,
    searchQuery,
    onPriceChange,
    onShowAddForm,
    activeProfile
}) {
    return (
        <div className="flex-1 overflow-auto rounded-xl border border-white/10 backdrop-blur-sm">
            <table className="w-full">
                <thead className="bg-black/80 sticky top-0 backdrop-blur-xl z-10">
                    <tr>
                        <th className="px-4 py-3 text-left text-xs font-semibold text-cyan-400 uppercase">Ä°kon</th>
                        <th className="px-4 py-3 text-left text-xs font-semibold text-cyan-400 uppercase">EÅŸya AdÄ±</th>
                        <th className="px-4 py-3 text-left text-xs font-semibold text-cyan-400 uppercase">Kategori</th>
                        <th className="px-4 py-3 text-left text-xs font-semibold text-cyan-400 uppercase">Fiyat ({activeProfile?.currency})</th>
                    </tr>
                </thead>
                <tbody className="bg-transparent divide-y divide-white/5">
                    {filteredItems.length === 0 ? (
                        <tr>
                            <td colSpan="4" className="px-4 py-12 text-center text-white/40">
                                <div className="flex flex-col items-center justify-center">
                                    <Search className="w-12 h-12 mb-3 opacity-20" />
                                    <p className="font-medium text-lg">Liste BoÅŸ</p>
                                    <p className="text-sm mt-1 max-w-xs mx-auto">
                                        "{searchQuery}" aramasÄ±na uygun eÅŸya yok veya henÃ¼z hiÃ§ eÅŸya eklemediniz.
                                    </p>
                                    <button
                                        onClick={onShowAddForm}
                                        className="mt-4 text-cyan-400 hover:text-cyan-300 text-sm font-medium flex items-center gap-2 transition-colors"
                                    >
                                        <Plus className="w-4 h-4" />
                                        Ä°lk EÅŸyayÄ± Ekle
                                    </button>
                                </div>
                            </td>
                        </tr>
                    ) : (
                        filteredItems.map((item) => {
                            const ItemIcon = LucideIcons[item.icon] || LucideIcons.Circle;
                            return (
                                <tr key={item.id} className="hover:bg-cyan-500/10 transition-colors group">
                                    <td className="px-4 py-3">
                                        <div className="p-2 bg-white/5 rounded-lg w-fit group-hover:bg-cyan-500/20 transition-colors border border-white/10">
                                            <ItemIcon className="w-5 h-5 text-white/70 group-hover:text-cyan-400" />
                                        </div>
                                    </td>
                                    <td className="px-4 py-3">
                                        <p className="text-sm font-medium text-white">{item.name}</p>
                                    </td>
                                    <td className="px-4 py-3">
                                        <span className="px-2 py-1 bg-white/5 text-white/80 rounded text-xs font-medium border border-white/10">
                                            {item.category}
                                        </span>
                                    </td>
                                    <td className="px-4 py-3">
                                        {/* BURASI GÃœNCELLENDÄ°: SmartInput KullanÄ±mÄ± */}
                                        <SmartInput
                                            value={item.price}
                                            onChange={(val) => onPriceChange(item.id, val)}
                                            className="w-32 px-2 py-1 text-sm font-semibold text-white bg-black/50 border border-white/10 rounded focus:outline-none focus:ring-2 focus:ring-cyan-500/20 focus:border-cyan-500/50 placeholder:text-white/20 transition-all"
                                            min={0}
                                            placeholder="0"
                                        />
                                    </td>
                                </tr>
                            );
                        })
                    )}
                </tbody>
            </table>
        </div>
    );
}

==================================================
DOSYA YOLU: .\app\components\widgets\metin-settings\ImportExportModal.js
==================================================
"use client";

import { useState } from "react";
import { motion } from "framer-motion";
import { X, Download, Upload, FileSpreadsheet, FileJson } from "lucide-react";
import useWidgetStore from "../../../store/useWidgetStore";
import { syncLocalMarketItems } from "../../../lib/marketUtils";
import { parseMetinImport } from "../../../lib/excelUtils";

export default function ImportExportModal({ isOpen, onClose, onImport, onExport }) {
    const [dataModalTab, setDataModalTab] = useState("export");
    const [isDragging, setIsDragging] = useState(false);

    // Enhanced file input handler with global registry and market sync
    const handleFileChange = async (e) => {
        const file = e.target.files?.[0];
        if (!file) return;

        try {
            // 1. Get store data
            const itemRegistry = useWidgetStore.getState().masterRegistry;
            const registerItems = useWidgetStore.getState().registerItems;

            // 2. Parse the file
            const result = await parseMetinImport(file);

            if (!result.success) {
                alert(result.message);
                return;
            }

            const { metinList, detectedItems } = result;

            // 3. Sync with global registry
            const { newRegistryItems, idMap } = syncLocalMarketItems(detectedItems, itemRegistry);

            // 4. Register new items to global catalog (CRITICAL STEP)
            if (newRegistryItems.length > 0) {
                registerItems(newRegistryItems);
                console.log(`âœ… ${newRegistryItems.length} yeni eÅŸya kataloÄŸa eklendi.`);
            }

            // 5. Update Market Prices (Batch Operation)
            // Eski "widget bulma" mantÄ±ÄŸÄ±nÄ± Ã§Ã¶pe atÄ±yoruz. DoÄŸrudan Store'a yazÄ±yoruz.
            const batchUpdatePrices = useWidgetStore.getState().batchUpdatePrices;

            if (newRegistryItems.length > 0) {
                const newPrices = {};
                newRegistryItems.forEach(item => {
                    // Yeni eklenen itemlara varsayÄ±lan 0 fiyat ver
                    newPrices[item.id] = 0;
                });

                // Tek seferde store'u gÃ¼ncelle (Performans + DoÄŸruluk)
                if (batchUpdatePrices) {
                    batchUpdatePrices(newPrices);
                    console.log(`âœ… ${newRegistryItems.length} yeni eÅŸya fiyat listesine eklendi.`);
                }
            }

            // 6. Update metin list with real IDs
            const updatedMetinList = metinList.map(metin => ({
                ...metin,
                drops: metin.drops.map(drop => ({
                    ...drop,
                    itemId: idMap[drop.itemId] || drop.itemId
                }))
            }));

            // 7. Call parent's onImport with updated data
            // Pass the file object to maintain compatibility with parent handler
            // The parent will handle the actual widget data update
            onImport(file);

            // Close modal
            onClose();

        } catch (error) {
            console.error('Import error:', error);
            alert('Ä°Ã§e aktarma sÄ±rasÄ±nda hata oluÅŸtu: ' + error.message);
        }
    };

    // Drag and drop handlers
    const handleDragOver = (e) => {
        e.preventDefault();
        setIsDragging(true);
    };

    const handleDragLeave = () => {
        setIsDragging(false);
    };

    const handleDrop = (e) => {
        e.preventDefault();
        setIsDragging(false);
        const file = e.dataTransfer.files?.[0];
        if (file) {
            // Create a fake event object to reuse handleFileChange
            handleFileChange({ target: { files: [file] } });
        }
    };

    if (!isOpen) return null;

    return (
        <div className="fixed inset-0 z-[110] flex items-center justify-center p-4">
            {/* Backdrop */}
            <div
                className="absolute inset-0 bg-black/60 backdrop-blur-sm"
                onClick={onClose}
            />

            {/* Modal */}
            <motion.div
                initial={{ opacity: 0, scale: 0.9 }}
                animate={{ opacity: 1, scale: 1 }}
                className="relative bg-black/80 backdrop-blur-xl border border-white/10 rounded-2xl p-6 max-w-md w-full shadow-2xl"
            >
                <div className="flex items-center justify-between mb-4">
                    <h3 className="text-xl font-bold text-white">Metin Preset YÃ¶netimi</h3>
                    <button
                        onClick={onClose}
                        className="p-1 hover:bg-white/10 rounded-lg transition-colors"
                    >
                        <X className="w-5 h-5 text-white/70" />
                    </button>
                </div>

                {/* Tabs */}
                <div className="flex gap-2 mb-4">
                    <button
                        onClick={() => setDataModalTab("export")}
                        className={`flex-1 px-4 py-2 rounded-lg font-medium transition-all ${dataModalTab === "export"
                            ? "bg-violet-600/20 text-violet-400 border border-violet-500/30"
                            : "bg-white/5 text-white/70 hover:bg-white/10 border border-white/10"
                            }`}
                    >
                        <Download className="w-4 h-4 inline mr-2" />
                        Kaydet
                    </button>
                    <button
                        onClick={() => setDataModalTab("import")}
                        className={`flex-1 px-4 py-2 rounded-lg font-medium transition-all ${dataModalTab === "import"
                            ? "bg-violet-600/20 text-violet-400 border border-violet-500/30"
                            : "bg-white/5 text-white/70 hover:bg-white/10 border border-white/10"
                            }`}
                    >
                        <Upload className="w-4 h-4 inline mr-2" />
                        YÃ¼kle
                    </button>
                </div>

                {/* Export Tab */}
                {dataModalTab === "export" && (
                    <div className="space-y-3">
                        <p className="text-sm text-white/70 mb-3">
                            Metin ayarlarÄ±nÄ±zÄ± Excel veya JSON formatÄ±nda kaydedin.
                        </p>
                        <button
                            onClick={() => onExport("excel")}
                            className="w-full flex items-center justify-center gap-3 px-4 py-3 bg-green-600/20 backdrop-blur-sm text-green-400 rounded-lg hover:bg-green-600/40 transition-colors font-medium border border-green-500/30"
                        >
                            <FileSpreadsheet className="w-5 h-5" />
                            Excel (.xlsx) Ä°ndir
                        </button>
                        <button
                            onClick={() => onExport("json")}
                            className="w-full flex items-center justify-center gap-3 px-4 py-3 bg-purple-600/20 backdrop-blur-sm text-purple-400 rounded-lg hover:bg-purple-600/40 transition-colors font-medium border border-purple-500/30"
                        >
                            <FileJson className="w-5 h-5" />
                            JSON Ä°ndir
                        </button>
                    </div>
                )}

                {/* Import Tab */}
                {dataModalTab === "import" && (
                    <div className="space-y-3">
                        <p className="text-sm text-white/70 mb-3">
                            Excel (.xlsx) veya JSON dosyasÄ± yÃ¼kleyin. Yeni eÅŸyalar otomatik olarak kataloÄŸa ve markete eklenecek.
                        </p>
                        <div
                            onDragOver={handleDragOver}
                            onDragLeave={handleDragLeave}
                            onDrop={handleDrop}
                            className={`border-2 border-dashed rounded-lg p-8 text-center transition-all ${isDragging
                                ? "border-violet-500 bg-violet-500/10"
                                : "border-white/10 bg-white/5 hover:bg-white/10"
                                }`}
                        >
                            <Upload className="w-12 h-12 text-white/50 mx-auto mb-3" />
                            <p className="text-white/70 mb-2">DosyayÄ± buraya sÃ¼rÃ¼kleyin</p>
                            <p className="text-white/50 text-sm mb-4">veya</p>
                            <label className="inline-block px-4 py-2 bg-violet-600/20 backdrop-blur-sm text-violet-400 rounded-lg hover:bg-violet-600/40 transition-colors cursor-pointer font-medium border border-violet-500/30">
                                Dosya SeÃ§
                                <input
                                    type="file"
                                    accept=".xlsx,.xls,.json,.csv"
                                    onChange={handleFileChange}
                                    className="hidden"
                                />
                            </label>
                            <p className="text-white/40 text-xs mt-3">
                                Desteklenen formatlar: .xlsx, .xls, .json, .csv
                            </p>
                        </div>
                    </div>
                )}
            </motion.div>
        </div>
    );
}

==================================================
DOSYA YOLU: .\app\components\widgets\metin-settings\MetinAccordionItem.js
==================================================
"use client";

import { useState } from "react";
import { motion, AnimatePresence } from "framer-motion";
import { ChevronDown, Plus, Trash2 } from "lucide-react";
import SmartInput from "@/app/components/ui/SmartInput";

const formatNumber = (num) => {
    return new Intl.NumberFormat('tr-TR').format(num);
};

export default function MetinAccordionItem({
    metin,
    isOpen,
    onToggle,
    onUpdateHP,
    onAddDrop,
    onRemoveDrop,
    onUpdateDrop,
    marketItems,
    craftingItems
}) {
    const [selectedItemId, setSelectedItemId] = useState("");
    const [selectedSourceType, setSelectedSourceType] = useState("market");
    const [error, setError] = useState(null);

    // Combine market and crafting items for dropdown
    // Combine market and crafting items for dropdown
    const safeMarketItems = marketItems || [];
    const safeCraftingItems = craftingItems || [];

    const allAvailableItems = [
        ...safeMarketItems.map(item => ({
            id: item.originalId || item.id,
            name: item.name,
            sourceType: 'market',
            displayName: item.name
        })),
        ...safeCraftingItems.map(item => ({
            id: item.id,
            name: item.name,
            sourceType: 'crafting',
            displayName: `ğŸ“¦ ${item.name}` // Add box icon for crafting items
        }))
    ];

    const getItemByIdAndType = (itemId, sourceType) => {
        if (sourceType === 'market') {
            return (marketItems || []).find((item) => (item.originalId || item.id) === itemId);
        } else {
            return (craftingItems || []).find((item) => item.id === itemId);
        }
    };

    const handleHpChange = (newHp) => {
        if (newHp > 0) {
            onUpdateHP(metin.id, newHp);
        }
    };

    const handleDropChange = (dropId, field, value) => {
        onUpdateDrop(metin.id, dropId, field, value);
    };

    const handleAddDrop = () => {
        if (selectedItemId) {
            const exists = metin.drops.some((d) => d.itemId === selectedItemId);
            if (exists) {
                setError("Bu eÅŸya zaten bu metinde ekli!");
                return;
            }
            onAddDrop(metin.id, selectedItemId, selectedSourceType);
        }
    };

    const handleRemoveDrop = (dropId) => {
        if (confirm("Bu drop'u silmek istediÄŸinizden emin misiniz?")) {
            onRemoveDrop(metin.id, dropId);
        }
    };

    return (
        <div className={`backdrop-blur-xl rounded-xl border overflow-hidden transition-all ${isOpen
            ? "bg-violet-900/20 border-violet-500/20 shadow-[0_0_20px_rgba(139,92,246,0.1)]"
            : "bg-black/20 border-white/5 hover:bg-white/5"
            }`}>
            <button
                onClick={onToggle}
                className="w-full flex items-center justify-between p-4 hover:bg-white/5 transition-colors"
            >
                <div className="flex items-center gap-3">
                    <motion.div
                        animate={{ rotate: isOpen ? 180 : 0 }}
                        transition={{ duration: 0.2 }}
                    >
                        <ChevronDown className="w-5 h-5 text-white/60" />
                    </motion.div>
                    <h3 className="text-lg font-semibold text-white">{metin.name}</h3>
                </div>
                <div className="flex items-center gap-3">
                    <span className="text-sm text-white/60">
                        HP: <span className="text-cyan-300 font-bold font-mono">{formatNumber(metin.hp)}</span>
                    </span>
                    <span className="text-sm text-white/60">
                        {metin.drops.length} Drop
                    </span>
                </div>
            </button>

            <AnimatePresence>
                {isOpen && (
                    <motion.div
                        initial={{ height: 0, opacity: 0 }}
                        animate={{ height: "auto", opacity: 1 }}
                        exit={{ height: 0, opacity: 0 }}
                        className="bg-black/30 border-t border-white/5"
                    >
                        <div className="p-4 space-y-4">
                            {/* HP Input */}
                            <div>
                                <label className="block text-sm font-semibold text-white/80 mb-2">
                                    Metin HP
                                </label>
                                <SmartInput
                                    value={metin.hp}
                                    onChange={(val) => handleHpChange(val)}
                                    className="w-full px-3 py-2 font-mono font-semibold text-white bg-black/60 border border-white/10 rounded-lg focus:outline-none focus:ring-2 focus:ring-violet-500/20 focus:border-violet-500/50 placeholder:text-white/40 transition-all"
                                    min={1}
                                    step={1000}
                                />
                            </div>

                            {/* Drops List */}
                            <div>
                                <h4 className="text-sm font-semibold text-white/80 mb-2">
                                    Drop Listesi
                                </h4>
                                <div className="space-y-2">
                                    {metin.drops.map((drop) => {
                                        const item = getItemByIdAndType(drop.itemId, drop.sourceType || 'market');
                                        return (
                                            <div
                                                key={drop.id}
                                                className="bg-black/40 backdrop-blur-sm p-3 rounded-lg border border-white/5 hover:border-white/10 transition-colors"
                                            >
                                                <div className="flex items-center justify-between mb-2">
                                                    <span className="text-white font-medium">
                                                        {drop.sourceType === 'crafting' && 'ğŸ“¦ '}
                                                        {item?.name || drop.itemId}
                                                    </span>
                                                    <button
                                                        onClick={() => handleRemoveDrop(drop.id)}
                                                        className="p-1 hover:bg-red-500/20 rounded transition-colors"
                                                    >
                                                        <Trash2 className="w-4 h-4 text-red-400" />
                                                    </button>
                                                </div>
                                                <div className="grid grid-cols-2 gap-2">
                                                    <div>
                                                        <label className="block text-xs text-white/60 mb-1">
                                                            Adet
                                                        </label>
                                                        <SmartInput
                                                            value={drop.count}
                                                            onChange={(val) => handleDropChange(drop.id, "count", val)}
                                                            className="w-full px-2 py-1 text-sm font-mono font-medium text-white bg-black/60 border border-white/10 rounded focus:outline-none focus:ring-1 focus:ring-violet-500/50 focus:border-violet-500/50"
                                                            min={1}
                                                        />
                                                    </div>
                                                    <div>
                                                        <label className="block text-xs text-white/60 mb-1">
                                                            Åans (%)
                                                        </label>
                                                        <SmartInput
                                                            value={drop.chance}
                                                            onChange={(val) => handleDropChange(drop.id, "chance", val)}
                                                            className="w-full px-2 py-1 text-sm font-mono font-medium text-white bg-black/60 border border-white/10 rounded focus:outline-none focus:ring-1 focus:ring-violet-500/50 focus:border-violet-500/50"
                                                            min={0}
                                                            max={100}
                                                        />
                                                    </div>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>

                            {/* Add Drop */}
                            <div className="pt-2 border-t border-white/10">
                                <h4 className="text-sm font-semibold text-white/80 mb-2">
                                    Yeni Drop Ekle
                                </h4>
                                <div className="flex gap-2">
                                    <select
                                        value={selectedItemId}
                                        onChange={(e) => {
                                            const selected = allAvailableItems.find(item => item.id === e.target.value);
                                            setSelectedItemId(e.target.value);
                                            setSelectedSourceType(selected?.sourceType || 'market');
                                        }}
                                        className="flex-1 px-3 py-2 font-medium text-white bg-black/60 border border-white/10 rounded-lg focus:outline-none focus:ring-2 focus:ring-violet-500/20 focus:border-violet-500/50"
                                    >
                                        <option value="" className="bg-zinc-900">SeÃ§iniz...</option>
                                        {allAvailableItems.map((item) => (
                                            <option
                                                key={`${item.sourceType}-${item.id}`}
                                                value={item.id}
                                                className="bg-zinc-900"
                                            >
                                                {item.displayName}
                                            </option>
                                        ))}
                                    </select>
                                    <button
                                        onClick={handleAddDrop}
                                        className="px-4 py-2 bg-cyan-600/20 backdrop-blur-sm text-cyan-400 rounded-lg hover:bg-cyan-600/40 transition-colors font-medium border border-cyan-500/30 flex items-center gap-2"
                                    >
                                        <Plus className="w-4 h-4" />
                                        Ekle
                                    </button>
                                </div>
                            </div>
                        </div>
                    </motion.div>
                )}
            </AnimatePresence>

            {/* Error Popup */}
            {error && (
                <div
                    className="fixed inset-0 z-[150] flex items-center justify-center bg-black/50 backdrop-blur-sm"
                    onClick={() => setError(null)}
                >
                    <motion.div
                        initial={{ opacity: 0, scale: 0.9 }}
                        animate={{ opacity: 1, scale: 1 }}
                        className="bg-red-900/90 border border-red-500/50 text-white p-6 rounded-xl shadow-2xl"
                        onClick={() => setError(null)}
                    >
                        {error}
                    </motion.div>
                </div>
            )}
        </div>
    );
}

==================================================
DOSYA YOLU: .\app\components\widgets\metin-settings\MetinHeader.js
==================================================
"use client";

import { Settings, Download } from "lucide-react";

export default function MetinHeader({ onImportExportClick, onClose }) {
    return (
        <div className="bg-black/20 backdrop-blur-xl p-4 rounded-xl border border-white/5">
            <div className="flex items-start justify-between">
                <div className="flex items-start gap-3">
                    <div className="p-2 bg-cyan-500/10 backdrop-blur-sm rounded-lg border border-cyan-500/20">
                        <Settings className="w-5 h-5 text-cyan-400" />
                    </div>
                    <div>
                        <h3 className="font-semibold text-white mb-1">Metin AyarlarÄ±</h3>
                        <p className="text-sm text-white/70">
                            Her metinin HP deÄŸerini ve drop listesini dÃ¼zenleyin.
                            DeÄŸiÅŸiklikler anlÄ±k olarak kaydedilir.
                        </p>
                    </div>
                </div>
                <button
                    onClick={onImportExportClick}
                    className="p-2 bg-violet-600/20 backdrop-blur-sm text-violet-400 rounded-lg hover:bg-violet-600/40 transition-colors border border-violet-500/30"
                    title="Ä°Ã§e/DÄ±ÅŸa Aktar"
                >
                    <Download className="w-5 h-5" />
                </button>
            </div>
        </div>
    );
}

==================================================
DOSYA YOLU: .\app\components\widgets\metin-settings\MetinList.js
==================================================
"use client";

import { useState } from "react";
import MetinAccordionItem from "./MetinAccordionItem";

export default function MetinList({ metins, marketItems, craftingItems, updateWidgetData, widgetId }) {
    const [openMetinId, setOpenMetinId] = useState(null);

    const handleUpdateHP = (metinId, newHP) => {
        const updated = metins.map((m) =>
            m.id === metinId ? { ...m, hp: newHP } : m
        );
        updateWidgetData(widgetId, { metins: updated });
    };

    const handleAddDrop = (metinId, itemId, sourceType) => {
        const updated = metins.map((m) => {
            if (m.id === metinId) {
                return {
                    ...m,
                    drops: [
                        ...m.drops,
                        {
                            id: crypto.randomUUID(),
                            itemId,
                            sourceType: sourceType || 'market', // Track source type
                            count: 1,
                            chance: 10,
                        },
                    ],
                };
            }
            return m;
        });
        updateWidgetData(widgetId, { metins: updated });
    };

    const handleRemoveDrop = (metinId, dropId) => {
        const updated = metins.map((m) => {
            if (m.id === metinId) {
                return {
                    ...m,
                    drops: m.drops.filter((d) => d.id !== dropId),
                };
            }
            return m;
        });
        updateWidgetData(widgetId, { metins: updated });
    };

    const handleUpdateDrop = (metinId, dropId, field, value) => {
        const updated = metins.map((m) => {
            if (m.id === metinId) {
                return {
                    ...m,
                    drops: m.drops.map((d) =>
                        d.id === dropId ? { ...d, [field]: value } : d
                    ),
                };
            }
            return m;
        });
        updateWidgetData(widgetId, { metins: updated });
    };

    return (
        <div className="flex-1 overflow-y-auto pr-2 space-y-3">
            {metins.map((metin) => (
                <MetinAccordionItem
                    key={metin.id}
                    metin={metin}
                    isOpen={openMetinId === metin.id}
                    onToggle={() =>
                        setOpenMetinId(openMetinId === metin.id ? null : metin.id)
                    }
                    onUpdateHP={handleUpdateHP}
                    onAddDrop={handleAddDrop}
                    onRemoveDrop={handleRemoveDrop}
                    onUpdateDrop={handleUpdateDrop}
                    marketItems={marketItems}
                    craftingItems={craftingItems}
                />
            ))}
        </div>
    );
}

==================================================
DOSYA YOLU: .\app\components\widgets\metin-settings\MetinSummary.js
==================================================
"use client";

import { Settings } from "lucide-react";

export default function MetinSummary({ metins }) {
    return (
        <div className="flex flex-col items-center justify-center h-full w-full overflow-hidden px-4">
            <div className="flex items-center gap-3 mb-3">
                <div className="p-2 bg-white/10 backdrop-blur-sm rounded-lg border border-white/10">
                    <Settings className="w-8 h-8 text-cyan-400" />
                </div>
            </div>
            <span className="text-3xl font-bold text-white whitespace-nowrap">
                Metin AyarlarÄ±
            </span>
            <span className="text-sm text-white/60 mt-2 font-mono">
                {metins.length} Metin TanÄ±mlÄ±
            </span>
        </div>
    );
}

==================================================
DOSYA YOLU: .\app\components\widgets\simulators\AlchemyPanel.js
==================================================
"use client";

import { useState, useCallback } from "react";
import { Gem } from "lucide-react";
import { usePersistentState } from "../../../hooks/usePersistentState";
import { useWorker } from "../../../hooks/useWorker";

// Import Sub-Components
import AlchemyConfig from "./alchemy/AlchemyConfig";
import AlchemyResults from "./alchemy/AlchemyResults";

// Import Constants
import {
    DEFAULT_CONFIG,
    DEFAULT_INPUT,
    DEFAULT_INPUT_CONFIG,
    DEFAULT_TARGET_CONFIG
} from "./alchemy/constants";

// ============================================================================
// MAIN CONTROLLER COMPONENT
// ============================================================================

export default function AlchemyPanel() {
    // Persistent state
    const [config, setConfig] = usePersistentState("alchemy-config-v2", DEFAULT_CONFIG);
    const [input, setInput] = usePersistentState("alchemy-input-v2", DEFAULT_INPUT);
    const [inputConfig, setInputConfig] = usePersistentState("alchemy-input-config-v2", DEFAULT_INPUT_CONFIG);
    const [mode, setMode] = useState('inventory'); // 'inventory' | 'target'
    const [targetConfig, setTargetConfig] = usePersistentState("alchemy-target-config-v1", DEFAULT_TARGET_CONFIG);

    // Worker
    const { run, result, progress, isRunning } = useWorker("/workers/alchemy.worker.js");

    // UI state
    const [showAdvanced, setShowAdvanced] = useState(false);

    // ========================================================================
    // HANDLERS
    // ========================================================================

    const handleSimulate = useCallback(() => {
        if (mode === 'inventory') {
            run({
                action: "run_simulation",
                inputConfig: inputConfig,
                corCount: input.corCount,
                corPrice: input.corPrice,
                simCount: input.simCount,
                config: config
            });
        } else {
            run({
                action: "calculate_target_cost",
                targetConfig: targetConfig,
                corPrice: input.corPrice,
                simCount: Math.min(input.simCount, 50), // Cap at 50 for performance
                config: config
            });
        }
    }, [run, input, config, mode, targetConfig, inputConfig]);

    // ========================================================================
    // RENDER
    // ========================================================================

    return (
        <div className="h-full flex flex-col overflow-hidden">
            {/* Header */}
            <header className="flex-shrink-0 p-6 border-b border-zinc-800 bg-zinc-950/80">
                <div className="flex items-center justify-between">
                    <div className="flex items-center gap-3">
                        <div className="p-2 bg-purple-900/30 rounded-xl border border-purple-500/30">
                            <Gem className="w-6 h-6 text-purple-400" />
                        </div>
                        <div>
                            <h2 className="text-xl font-bold text-white">Ejderha SimyasÄ±</h2>
                            <p className="text-xs text-zinc-500">Dragon Soul Alchemy SimÃ¼lasyonu</p>
                        </div>
                    </div>
                </div>
            </header>

            {/* Main Content - 2 Column Layout */}
            <div className="flex-1 overflow-auto p-6">
                <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">

                    {/* Left Column - Config & Settings */}
                    <div>
                        <AlchemyConfig
                            // State
                            config={config}
                            input={input}
                            inputConfig={inputConfig}
                            targetConfig={targetConfig}
                            mode={mode}
                            showAdvanced={showAdvanced}
                            // Setters
                            setConfig={setConfig}
                            setInput={setInput}
                            setInputConfig={setInputConfig}
                            setTargetConfig={setTargetConfig}
                            setMode={setMode}
                            setShowAdvanced={setShowAdvanced}
                            // Actions
                            onSimulate={handleSimulate}
                            isRunning={isRunning}
                            progress={progress}
                        />
                    </div>

                    {/* Right Column - Results */}
                    <div className="lg:col-span-2">
                        <AlchemyResults
                            result={result}
                            mode={mode}
                            inputConfig={inputConfig}
                        />
                    </div>
                </div>
            </div>
        </div>
    );
}

==================================================
DOSYA YOLU: .\app\components\widgets\simulators\BlacksmithPanel.js
==================================================
"use client";

import { useState, useCallback, useMemo } from "react";
import { Hammer, Search, Trash2 } from "lucide-react";
import { usePersistentState } from "../../../hooks/usePersistentState";
import { useWorker } from "../../../hooks/useWorker";
import { useSharedWidgetData } from "../../../hooks/useSharedWidgetData";
import SmartInput from "@/app/components/ui/SmartInput";

// Import Sub-Components
import ConfigPanel, { MATERIALS, DEFAULT_BONUSES } from "./blacksmith/ConfigPanel";
import StrategyTable, { DEFAULT_STRATEGY } from "./blacksmith/StrategyTable";
import ResultsPanel, { formatCurrency } from "./blacksmith/ResultsPanel";

// ============================================================================
// CONSTANTS
// ============================================================================

const DEFAULT_CONFIG = {
    calcMode: 'additive',      // 'additive' or 'multiplicative'
    pitySystem: 'none',        // 'none', 'incremental', 'hard'
    fallbackToRaw: false       // If no materials, use raw (destroy on fail)
};

const DEFAULT_INVENTORY = {
    blessing_scroll: 50,
    magic_stone: 10,
    ritual_stone: 5,
    blacksmith_book: 2
};

const DEFAULT_PRICES = {
    blessing_scroll: 1000000,
    magic_stone: 5000000,
    ritual_stone: 15000000,
    blacksmith_book: 50000000
};

const DEFAULT_INPUT = {
    startLevel: 0,
    targetLevel: 9,
    simCount: 1000
};

// ============================================================================
// MAIN COMPONENT (Controller)
// ============================================================================

export default function BlacksmithPanel() {
    // State for modal
    const [activeModalLevel, setActiveModalLevel] = useState(null);

    // Persistent state
    const [config, setConfig] = usePersistentState("blacksmith-config-v1", DEFAULT_CONFIG);
    const [inventory, setInventory] = usePersistentState("blacksmith-inventory-v1", DEFAULT_INVENTORY);
    const [materialBonuses, setMaterialBonuses] = usePersistentState("blacksmith-bonuses-v1", DEFAULT_BONUSES);
    const [prices, setPrices] = usePersistentState("blacksmith-prices-v1", DEFAULT_PRICES);
    const [strategy, setStrategy] = usePersistentState("blacksmith-strategy-v1", DEFAULT_STRATEGY);
    const [input, setInput] = usePersistentState("blacksmith-input-v1", DEFAULT_INPUT);

    // Get live market data
    const { marketItems } = useSharedWidgetData();

    // Compute market prices map for worker (itemId -> price)
    const marketPrices = useMemo(() => {
        return marketItems.reduce((acc, item) => ({
            ...acc,
            [item.id]: item.price || 0
        }), {});
    }, [marketItems]);

    // Worker
    const { run, result, progress, isRunning } = useWorker("/workers/blacksmith.worker.js");

    // ========================================================================
    // HANDLERS
    // ========================================================================

    const handleInputChange = useCallback((field, value) => {
        setInput(prev => ({ ...prev, [field]: value }));
    }, [setInput]);

    const handleConfigChange = useCallback((field, value) => {
        setConfig(prev => ({ ...prev, [field]: value }));
    }, [setConfig]);

    const handleInventoryChange = useCallback((material, value) => {
        setInventory(prev => ({ ...prev, [material]: value }));
    }, [setInventory]);

    const handlePriceChange = useCallback((material, value) => {
        setPrices(prev => ({ ...prev, [material]: value }));
    }, [setPrices]);

    const handleBonusChange = useCallback((material, value) => {
        setMaterialBonuses(prev => ({ ...prev, [material]: value }));
    }, [setMaterialBonuses]);

    const handleStrategyChange = useCallback((level, field, value) => {
        setStrategy(prev => ({
            ...prev,
            [level]: { ...prev[level], [field]: value }
        }));
    }, [setStrategy]);

    const handleSimulate = useCallback(() => {
        run({
            action: "run_simulation",
            startLevel: input.startLevel,
            targetLevel: input.targetLevel,
            inventory: inventory,
            prices: prices,
            marketPrices: marketPrices,
            config: config,
            strategy: strategy,
            materialBonuses: materialBonuses,
            simCount: input.simCount
        });
    }, [run, input, inventory, config, strategy, prices, materialBonuses, marketPrices]);

    // Generate level range for strategy table
    const levelRange = useMemo(() => {
        const range = [];
        for (let i = input.startLevel; i < input.targetLevel; i++) {
            range.push(i);
        }
        return range;
    }, [input.startLevel, input.targetLevel]);

    // ========================================================================
    // RENDER
    // ========================================================================

    return (
        <div className="h-full flex flex-col overflow-hidden">
            {/* Header */}
            <header className="flex-shrink-0 p-4 border-b border-zinc-800 bg-zinc-950/80">
                <div className="flex items-center justify-between">
                    <div className="flex items-center gap-3">
                        <div className="p-2 bg-orange-900/30 rounded-xl border border-orange-500/30">
                            <Hammer className="w-5 h-5 text-orange-400" />
                        </div>
                        <div>
                            <h2 className="text-lg font-bold text-white">Demirci SimÃ¼lasyonu</h2>
                            <p className="text-xs text-zinc-500">Strateji bazlÄ± yÃ¼kseltme analizi</p>
                        </div>
                    </div>
                </div>
            </header>

            {/* Main Content - 3 Column Layout */}
            <div className="flex-1 overflow-auto">
                <div className="grid grid-cols-1 lg:grid-cols-4 gap-4 p-4">

                    {/* LEFT PANEL - Config & Inventory */}
                    <div>
                        <ConfigPanel
                            config={config}
                            inventory={inventory}
                            materialBonuses={materialBonuses}
                            prices={prices}
                            input={input}
                            isRunning={isRunning}
                            progress={progress}
                            onConfigChange={handleConfigChange}
                            onInventoryChange={handleInventoryChange}
                            onPriceChange={handlePriceChange}
                            onBonusChange={handleBonusChange}
                            onInputChange={handleInputChange}
                            onSimulate={handleSimulate}
                        />
                    </div>

                    {/* CENTER PANEL - Strategy Table */}
                    <div className="lg:col-span-2">
                        <StrategyTable
                            levelRange={levelRange}
                            strategy={strategy}
                            config={config}
                            onStrategyChange={handleStrategyChange}
                            onOpenMaterials={setActiveModalLevel}
                        />
                    </div>

                    {/* RIGHT PANEL - Results */}
                    <div>
                        <ResultsPanel
                            result={result}
                            targetLevel={input.targetLevel}
                        />
                    </div>
                </div>
            </div>

            {/* Materials Modal */}
            {activeModalLevel !== null && (
                <MaterialsModal
                    level={activeModalLevel}
                    strategy={strategy[activeModalLevel]}
                    marketItems={marketItems}
                    onClose={() => setActiveModalLevel(null)}
                    onUpdate={(newMaterials) => handleStrategyChange(activeModalLevel, 'requiredMaterials', newMaterials)}
                />
            )}
        </div>
    );
}

// ============================================================================
// MATERIALS MODAL (Kept inline for simplicity)
// ============================================================================

function MaterialsModal({ level, strategy, marketItems, onClose, onUpdate }) {
    const [searchTerm, setSearchTerm] = useState("");
    const currentMaterials = strategy?.requiredMaterials || [];

    // Filter items
    const searchResults = useMemo(() => {
        if (!searchTerm || searchTerm.length < 2) return [];
        return marketItems.filter(item =>
            item.name.toLowerCase().includes(searchTerm.toLowerCase())
        ).slice(0, 5);
    }, [searchTerm, marketItems]);

    const handleAdd = (item) => {
        const exists = currentMaterials.find(m => m.itemId === item.id);
        if (exists) return;
        onUpdate([...currentMaterials, { itemId: item.id, count: 1 }]);
        setSearchTerm("");
    };

    const handleRemove = (itemId) => {
        onUpdate(currentMaterials.filter(m => m.itemId !== itemId));
    };

    const handleCountChange = (itemId, count) => {
        onUpdate(currentMaterials.map(m =>
            m.itemId === itemId ? { ...m, count } : m
        ));
    };

    const totalCost = currentMaterials.reduce((acc, m) => {
        const item = marketItems.find(i => i.id === m.itemId);
        return acc + ((item?.price || 0) * m.count);
    }, 0);

    return (
        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4">
            <div className="bg-zinc-900 border border-zinc-700 rounded-xl w-full max-w-md shadow-2xl flex flex-col max-h-[80vh]">
                <div className="p-4 border-b border-zinc-800 flex justify-between items-center bg-zinc-900/50">
                    <div>
                        <h3 className="text-sm font-bold text-white">Ekstra Materyaller</h3>
                        <p className="text-xs text-zinc-500">+{level} âœ +{level + 1} iÃ§in gerekli malzemeler</p>
                    </div>
                    <button onClick={onClose} className="p-1 hover:bg-zinc-800 rounded-lg text-zinc-400">
                        <Trash2 className="w-4 h-4" />
                    </button>
                </div>

                <div className="p-4 flex-1 overflow-y-auto space-y-4">
                    {/* Search */}
                    <div className="relative">
                        <Search className="absolute left-3 top-2.5 w-4 h-4 text-zinc-500" />
                        <input
                            type="text"
                            value={searchTerm}
                            onChange={e => setSearchTerm(e.target.value)}
                            placeholder="Materyal Ara..."
                            className="w-full pl-9 pr-4 py-2 bg-zinc-950 border border-zinc-700 rounded-lg text-sm text-white focus:outline-none focus:border-blue-500 transition-colors"
                        />

                        {/* Results Dropdown */}
                        {searchResults.length > 0 && (
                            <div className="absolute top-full left-0 right-0 mt-1 bg-zinc-900 border border-zinc-700 rounded-lg shadow-xl z-20 overflow-hidden">
                                {searchResults.map(item => (
                                    <button
                                        key={item.id}
                                        onClick={() => handleAdd(item)}
                                        className="w-full flex items-center justify-between p-2 hover:bg-zinc-800 border-b border-zinc-800/50 last:border-0 text-left"
                                    >
                                        <div className="flex items-center gap-2">
                                            <span className="text-xs text-zinc-300">{item.name}</span>
                                        </div>
                                        <span className="text-xs font-mono text-yellow-500">{formatCurrency(item.price)}</span>
                                    </button>
                                ))}
                            </div>
                        )}
                    </div>

                    {/* Active Materials List */}
                    <div className="space-y-2">
                        {currentMaterials.length === 0 ? (
                            <div className="text-center py-8 text-zinc-500 text-xs border border-dashed border-zinc-800 rounded-lg">
                                HenÃ¼z materyal eklenmedi.
                            </div>
                        ) : (
                            currentMaterials.map(mat => {
                                const item = marketItems.find(i => i.id === mat.itemId);
                                return (
                                    <div key={mat.itemId} className="flex items-center gap-2 p-2 bg-zinc-950/50 border border-zinc-800 rounded-lg">
                                        <div className="flex-1 min-w-0">
                                            <div className="text-xs font-medium text-zinc-300 truncate">
                                                {item?.name || "Bilinmeyen ÃœrÃ¼n"}
                                            </div>
                                            <div className="text-[10px] text-yellow-500 font-mono">
                                                {formatCurrency(item?.price)}
                                            </div>
                                        </div>

                                        <div className="flex items-center gap-2">
                                            <div className="w-16">
                                                <SmartInput
                                                    value={mat.count}
                                                    onChange={(val) => handleCountChange(mat.itemId, val)}
                                                    min={1}
                                                    className="w-full px-2 py-1 text-right text-xs bg-zinc-900 border border-zinc-700 rounded text-white"
                                                />
                                            </div>
                                            <button
                                                onClick={() => handleRemove(mat.itemId)}
                                                className="p-1.5 hover:bg-red-500/20 text-zinc-500 hover:text-red-400 rounded transition-colors"
                                            >
                                                <Trash2 className="w-3.5 h-3.5" />
                                            </button>
                                        </div>
                                    </div>
                                );
                            })
                        )}
                    </div>
                </div>

                {/* Footer */}
                <div className="p-4 border-t border-zinc-800 bg-zinc-900/50">
                    <div className="flex justify-between items-center mb-3">
                        <span className="text-xs text-zinc-400">Toplam Ek Maliyet</span>
                        <span className="text-sm font-bold text-yellow-400 font-mono">{formatCurrency(totalCost)}</span>
                    </div>
                    <button
                        onClick={onClose}
                        className="w-full py-2 bg-white text-black font-semibold rounded-lg hover:bg-zinc-200 transition-colors text-sm"
                    >
                        Tamam
                    </button>
                </div>
            </div>
        </div>
    );
}

==================================================
DOSYA YOLU: .\app\components\widgets\simulators\SashCraftingPanel.js
==================================================
"use client";

import { useState, useCallback, useEffect, useRef } from "react";
import { Sparkles, History } from "lucide-react";
import { usePersistentState } from "../../../hooks/usePersistentState";
import { useWorker } from "../../../hooks/useWorker";

// Import Sub-Components
import SashConfig from "./sash/SashConfig";
import SashResults from "./sash/SashResults";

// Import Constants
import { DEFAULT_CONFIG } from "./sash/constants";

// ============================================================================
// MAIN CONTROLLER COMPONENT
// ============================================================================

export default function SashCraftingPanel() {
    // Persistent State
    const [config, setConfig] = usePersistentState("sash-simulator-config", DEFAULT_CONFIG);
    const [history, setHistory] = usePersistentState("sash-simulator-history", []);

    // Worker Hook
    const { run, status, result, progress, isRunning } = useWorker("/workers/sash.worker.js");

    // Local State
    const [showHistory, setShowHistory] = useState(true);

    // Ref to track last processed result (prevents duplicate entries in StrictMode)
    const lastResultRef = useRef(null);

    // ========================================================================
    // HANDLERS
    // ========================================================================

    const handleConfigChange = useCallback((field, value) => {
        setConfig(prev => ({ ...prev, [field]: value }));
    }, [setConfig]);

    const handleRateChange = useCallback((rateKey, value) => {
        setConfig(prev => ({
            ...prev,
            rates: {
                ...prev.rates,
                [rateKey]: value
            }
        }));
    }, [setConfig]);

    const handleSimulate = useCallback(() => {
        if (config.mode === 'budget') {
            run({
                action: "run_simulation",
                mode: 'budget',
                clothPrice: config.clothPrice,
                clothCount: config.clothCount,
                clothBudget: config.clothBudget,
                absorptionCap: config.absorptionCap,
                simCount: config.simCount,
                rates: config.rates
            });
        } else {
            run({
                action: "run_simulation",
                mode: 'target',
                clothPrice: config.clothPrice,
                clothCount: config.clothCount,
                targetGrade: config.targetGrade,
                simCount: config.simCount,
                rates: config.rates
            });
        }
    }, [run, config]);

    // Effect: Add result to history when complete (with deduplication)
    useEffect(() => {
        if (status === "complete" && result && result.duration) {
            // Use duration as a unique identifier for this result
            const resultKey = `${result.avgCost}-${result.duration}`;

            if (lastResultRef.current !== resultKey) {
                lastResultRef.current = resultKey;

                const newEntry = {
                    id: Date.now(),
                    date: Date.now(),
                    config: { ...config },
                    result: { ...result }
                };
                setHistory(prev => [newEntry, ...prev].slice(0, 50)); // Max 50 records
            }
        }
    }, [status, result, config, setHistory]);

    const handleRestore = useCallback((item) => {
        setConfig(item.config);
    }, [setConfig]);

    const handleDeleteHistory = useCallback((id) => {
        setHistory(prev => prev.filter(item => item.id !== id));
    }, [setHistory]);

    const handleClearHistory = useCallback(() => {
        setHistory([]);
    }, [setHistory]);

    // ========================================================================
    // RENDER
    // ========================================================================

    return (
        <div className="h-full flex flex-col overflow-hidden">
            {/* Header */}
            <header className="px-6 py-4 border-b border-zinc-800 bg-zinc-900/30 shrink-0">
                <div className="flex items-center justify-between">
                    <div className="flex items-center gap-3">
                        <div className="p-2 bg-violet-500/10 rounded-lg border border-violet-500/20">
                            <Sparkles className="w-5 h-5 text-violet-400" />
                        </div>
                        <div>
                            <h1 className="text-lg font-semibold text-white">
                                KuÅŸak Maliyet SimÃ¼lasyonu
                            </h1>
                            <p className="text-xs text-zinc-500">
                                Monte Carlo yÃ¶ntemiyle ortalama maliyet hesaplama
                            </p>
                        </div>
                    </div>
                    <button
                        onClick={() => setShowHistory(!showHistory)}
                        className={`
                            flex items-center gap-2 px-3 py-1.5 rounded-lg text-sm transition-colors
                            ${showHistory
                                ? "bg-violet-500/20 text-violet-400 border border-violet-500/30"
                                : "bg-zinc-800 text-zinc-400 border border-zinc-700 hover:bg-zinc-700"
                            }
                        `}
                    >
                        <History className="w-4 h-4" />
                        GeÃ§miÅŸ
                    </button>
                </div>
            </header>

            {/* Main Content - 3 Column Layout */}
            <div className="flex-1 overflow-auto p-6">
                <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">

                    {/* Left Column - Config */}
                    <div>
                        <SashConfig
                            config={config}
                            onConfigChange={handleConfigChange}
                            onRateChange={handleRateChange}
                            onSimulate={handleSimulate}
                            isRunning={isRunning}
                            progress={progress}
                        />
                    </div>

                    {/* Right Column - Results (2 spans) */}
                    <div className="lg:col-span-2">
                        <SashResults
                            result={result}
                            history={history}
                            showHistory={showHistory}
                            onRestore={handleRestore}
                            onDeleteHistory={handleDeleteHistory}
                            onClearHistory={handleClearHistory}
                        />
                    </div>
                </div>
            </div>
        </div>
    );
}

==================================================
DOSYA YOLU: .\app\components\widgets\simulators\alchemy\AlchemyConfig.js
==================================================
"use client";

import {
    Calculator,
    Loader2,
    Settings,
    ChevronDown,
    Gem,
    Sparkles,
    Percent,
    Package,
    Layers,
    Target,
    ToggleLeft,
    ToggleRight,
    Coins
} from "lucide-react";
import SmartInput from "@/app/components/ui/SmartInput";
import {
    ELEMENTS,
    CLASS_LEVELS,
    CLARITY_LEVELS,
    TARGET_CLASS_OPTIONS,
    COR_OUTPUT_OPTIONS,
    formatCurrency
} from "./constants";

// ============================================================================
// ALCHEMY CONFIG PANEL
// ============================================================================

export default function AlchemyConfig({
    // State
    config,
    input,
    inputConfig,
    targetConfig,
    mode,
    showAdvanced,
    // Setters
    setConfig,
    setInput,
    setInputConfig,
    setTargetConfig,
    setMode,
    setShowAdvanced,
    // Actions
    onSimulate,
    isRunning,
    progress
}) {
    // ========================================================================
    // HANDLERS
    // ========================================================================

    const handleInputChange = (field, value) => {
        setInput(prev => ({ ...prev, [field]: value }));
    };

    const handleConfigChange = (field, value) => {
        setConfig(prev => ({ ...prev, [field]: value }));
    };

    const handleRequirementChange = (field, value) => {
        setConfig(prev => ({
            ...prev,
            requirements: { ...prev.requirements, [field]: value }
        }));
    };

    const handleRateChange = (field, value) => {
        setConfig(prev => ({
            ...prev,
            rates: { ...prev.rates, [field]: value }
        }));
    };

    const toggleElement = (element) => {
        setConfig(prev => {
            const current = prev.activeElements || [];
            if (current.includes(element)) {
                return { ...prev, activeElements: current.filter(e => e !== element) };
            } else {
                return { ...prev, activeElements: [...current, element] };
            }
        });
    };

    const toggleClarity = () => {
        setConfig(prev => ({ ...prev, upgradeClarity: !prev.upgradeClarity }));
    };

    // ========================================================================
    // RENDER
    // ========================================================================

    return (
        <div className="space-y-4">
            {/* Mode Switcher */}
            <div className="flex bg-zinc-900/50 p-1 rounded-xl border border-zinc-800 mb-4">
                <button
                    onClick={() => setMode('inventory')}
                    className={`flex-1 py-2 text-xs font-medium rounded-lg transition-all ${mode === 'inventory' ? 'bg-zinc-800 text-white shadow-sm' : 'text-zinc-500 hover:text-zinc-300'}`}
                >
                    Elimdekilerle Ne Ã‡Ä±kar?
                </button>
                <button
                    onClick={() => setMode('target')}
                    className={`flex-1 py-2 text-xs font-medium rounded-lg transition-all ${mode === 'target' ? 'bg-zinc-800 text-white shadow-sm' : 'text-zinc-500 hover:text-zinc-300'}`}
                >
                    Hedef Ä°Ã§in Ne LazÄ±m?
                </button>
            </div>

            <h3 className="text-sm font-semibold text-zinc-400 flex items-center gap-2">
                <Package className="w-4 h-4" />
                {mode === 'inventory' ? 'SimÃ¼lasyon AyarlarÄ±' : 'Hedef AyarlarÄ±'}
            </h3>

            {/* Inventory Mode Inputs */}
            {mode === 'inventory' && (
                <div className="bg-zinc-900/50 p-4 rounded-xl border border-zinc-800 space-y-4">
                    {/* Source Selector */}
                    <div className="flex bg-zinc-950 p-1 rounded-lg border border-zinc-800">
                        <button
                            onClick={() => setInputConfig(prev => ({ ...prev, mode: 'cor' }))}
                            className={`flex-1 py-1.5 text-xs font-medium rounded transition-all ${inputConfig.mode === 'cor' ? 'bg-zinc-800 text-white' : 'text-zinc-500 hover:text-zinc-400'}`}
                        >
                            Cor Draconis
                        </button>
                        <button
                            onClick={() => setInputConfig(prev => ({ ...prev, mode: 'material' }))}
                            className={`flex-1 py-1.5 text-xs font-medium rounded transition-all ${inputConfig.mode === 'material' ? 'bg-zinc-800 text-white' : 'text-zinc-500 hover:text-zinc-400'}`}
                        >
                            Direkt TaÅŸ
                        </button>
                    </div>

                    {inputConfig.mode === 'cor' ? (
                        /* Cor Count Input */
                        <div>
                            <label className="block text-xs font-medium text-zinc-400 mb-2">
                                Cor Draconis SayÄ±sÄ±
                            </label>
                            <div className="flex items-center gap-2">
                                <Gem className="w-4 h-4 text-purple-500" />
                                <SmartInput
                                    value={input.corCount}
                                    onChange={(val) => handleInputChange("corCount", val)}
                                    min={1}
                                    className="flex-1 px-3 py-2 text-lg font-mono font-semibold text-white bg-zinc-950 border border-zinc-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500/30 focus:border-purple-500/50"
                                    placeholder="1000"
                                />
                            </div>
                        </div>
                    ) : (
                        /* Direct Material Input */
                        <div className="space-y-3">
                            <div className="grid grid-cols-2 gap-2">
                                <div>
                                    <label className="block text-xs text-zinc-500 mb-1">BaÅŸlangÄ±Ã§ SÄ±nÄ±fÄ±</label>
                                    <select
                                        value={inputConfig.itemClass}
                                        onChange={(e) => setInputConfig(prev => ({ ...prev, itemClass: e.target.value }))}
                                        className="w-full px-2 py-1.5 text-xs text-white bg-zinc-950 border border-zinc-700 rounded-lg focus:outline-none focus:ring-1 focus:ring-purple-500/30"
                                    >
                                        {Object.entries(CLASS_LEVELS).map(([key, info]) => (
                                            <option key={key} value={key}>{info.name}</option>
                                        ))}
                                    </select>
                                </div>
                                <div>
                                    <label className="block text-xs text-zinc-500 mb-1">SaflÄ±k</label>
                                    <select
                                        value={inputConfig.itemClarity}
                                        onChange={(e) => setInputConfig(prev => ({ ...prev, itemClarity: e.target.value }))}
                                        className="w-full px-2 py-1.5 text-xs text-white bg-zinc-950 border border-zinc-700 rounded-lg focus:outline-none focus:ring-1 focus:ring-purple-500/30"
                                    >
                                        {Object.entries(CLARITY_LEVELS).map(([key, info]) => (
                                            <option key={key} value={key}>{info.name}</option>
                                        ))}
                                    </select>
                                </div>
                            </div>

                            <div>
                                <label className="block text-xs font-medium text-zinc-400 mb-2">
                                    Adet (Miktar)
                                </label>
                                <div className="flex items-center gap-2">
                                    <Layers className="w-4 h-4 text-orange-500" />
                                    <SmartInput
                                        value={input.corCount}
                                        onChange={(val) => handleInputChange("corCount", val)}
                                        min={1}
                                        className="flex-1 px-3 py-2 text-lg font-mono font-semibold text-white bg-zinc-950 border border-zinc-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500/30 focus:border-orange-500/50"
                                        placeholder="10"
                                    />
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            )}

            {/* Target Mode Inputs */}
            {mode === 'target' && (
                <div className="bg-zinc-900/50 p-4 rounded-xl border border-zinc-800 space-y-4">
                    {/* Base Element Selection */}
                    <div>
                        <label className="block text-xs text-zinc-500 mb-1.5">TaÅŸ TÃ¼rÃ¼</label>
                        <select
                            value={targetConfig.baseElement}
                            onChange={(e) => setTargetConfig(prev => ({ ...prev, baseElement: e.target.value }))}
                            className="w-full px-3 py-2 text-sm text-white bg-zinc-950 border border-zinc-700 rounded-lg"
                        >
                            {Object.entries(ELEMENTS).map(([key, info]) => (
                                <option key={key} value={key}>{info.name}</option>
                            ))}
                        </select>
                    </div>

                    {/* Target Grade */}
                    <div>
                        <label className="block text-xs text-zinc-500 mb-1.5">Hedef SÄ±nÄ±f</label>
                        <select
                            value={targetConfig.targetGrade}
                            onChange={(e) => setTargetConfig(prev => ({ ...prev, targetGrade: e.target.value }))}
                            className="w-full px-3 py-2 text-sm text-white bg-zinc-950 border border-zinc-700 rounded-lg"
                        >
                            {Object.entries(CLASS_LEVELS).map(([key, info]) => (
                                <option key={key} value={key}>{info.name}</option>
                            ))}
                        </select>
                    </div>

                    {/* Target Clarity */}
                    <div>
                        <label className="block text-xs text-zinc-500 mb-1.5">Hedef SaflÄ±k</label>
                        <select
                            value={targetConfig.targetClarity}
                            onChange={(e) => setTargetConfig(prev => ({ ...prev, targetClarity: e.target.value }))}
                            className="w-full px-3 py-2 text-sm text-white bg-zinc-950 border border-zinc-700 rounded-lg"
                        >
                            {Object.entries(CLARITY_LEVELS).map(([key, info]) => (
                                <option key={key} value={key}>{info.name}</option>
                            ))}
                        </select>
                    </div>
                </div>
            )}

            {/* Cor Price Input */}
            <div className="bg-zinc-900/50 p-4 rounded-xl border border-zinc-800">
                <label className="block text-xs font-medium text-zinc-400 mb-2">
                    Cor Draconis FiyatÄ± (Yang)
                </label>
                <div className="flex items-center gap-2">
                    <Coins className="w-4 h-4 text-yellow-500" />
                    <SmartInput
                        value={input.corPrice}
                        onChange={(val) => handleInputChange("corPrice", val)}
                        min={0}
                        className="flex-1 px-3 py-2 text-lg font-mono font-semibold text-white bg-zinc-950 border border-zinc-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500/30 focus:border-yellow-500/50"
                        placeholder="0"
                    />
                </div>
                <p className="text-xs text-zinc-600 mt-2">
                    Maliyet hesabÄ± iÃ§in (opsiyonel): {formatCurrency(input.corPrice)} Yang
                </p>
            </div>

            {/* Production Strategy */}
            <div className="bg-zinc-900/50 p-4 rounded-xl border border-zinc-800 space-y-4">
                <h4 className="text-xs font-semibold text-zinc-300 flex items-center gap-2">
                    <Target className="w-4 h-4 text-violet-400" />
                    Ãœretim Stratejisi
                </h4>

                {/* Target Class */}
                <div>
                    <label className="block text-xs text-zinc-500 mb-1.5">
                        Hedef SÄ±nÄ±f (Hangi seviyeye kadar?)
                    </label>
                    <select
                        value={config.targetClass}
                        onChange={(e) => handleConfigChange("targetClass", e.target.value)}
                        className="w-full px-3 py-2 text-sm text-white bg-zinc-950 border border-zinc-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-violet-500/30"
                    >
                        {TARGET_CLASS_OPTIONS.map(opt => (
                            <option key={opt.value} value={opt.value}>{opt.label}</option>
                        ))}
                    </select>
                </div>

                {/* Clarity Toggle */}
                <div
                    onClick={toggleClarity}
                    className={`
                        flex items-center justify-between p-3 rounded-lg border cursor-pointer transition-all
                        ${config.upgradeClarity
                            ? 'bg-violet-500/20 border-violet-500/40'
                            : 'bg-zinc-900 border-zinc-700 hover:border-zinc-600'
                        }
                    `}
                >
                    <div className="flex items-center gap-2">
                        <Sparkles className={`w-4 h-4 ${config.upgradeClarity ? 'text-violet-400' : 'text-zinc-500'}`} />
                        <span className={`text-sm ${config.upgradeClarity ? 'text-white' : 'text-zinc-400'}`}>
                            SaflÄ±k YÃ¼kselt
                        </span>
                    </div>
                    {config.upgradeClarity ? (
                        <ToggleRight className="w-6 h-6 text-violet-400" />
                    ) : (
                        <ToggleLeft className="w-6 h-6 text-zinc-600" />
                    )}
                </div>
                {config.upgradeClarity && (
                    <p className="text-xs text-violet-300/70 -mt-2 pl-1">
                        Hedef sÄ±nÄ±ftaki taÅŸlarÄ±n saflÄ±ÄŸÄ± yÃ¼kseltilecek
                    </p>
                )}
            </div>

            {/* Simulation Count */}
            <div className="bg-zinc-900/50 p-4 rounded-xl border border-zinc-800">
                <label className="block text-xs font-medium text-zinc-400 mb-2">
                    SimÃ¼lasyon SayÄ±sÄ±: <span className="text-white font-mono">{input.simCount}</span>
                </label>
                <input
                    type="range"
                    min={10}
                    max={500}
                    step={10}
                    value={input.simCount}
                    onChange={(e) => handleInputChange("simCount", parseInt(e.target.value))}
                    className="w-full h-2 bg-zinc-800 rounded-lg appearance-none cursor-pointer accent-purple-500"
                />
            </div>

            {/* Advanced Settings Accordion */}
            <details
                className="bg-zinc-900/50 rounded-xl border border-zinc-800 group"
                open={showAdvanced}
                onToggle={(e) => setShowAdvanced(e.target.open)}
            >
                <summary className="p-4 cursor-pointer list-none flex items-center justify-between hover:bg-zinc-800/30 transition-colors rounded-xl">
                    <div className="flex items-center gap-2">
                        <Settings className="w-4 h-4 text-zinc-500" />
                        <span className="text-xs font-medium text-zinc-400">GeliÅŸmiÅŸ Sunucu AyarlarÄ±</span>
                    </div>
                    <ChevronDown className="w-4 h-4 text-zinc-500 transition-transform group-open:rotate-180" />
                </summary>
                <div className="p-4 pt-0 space-y-4">

                    {/* Active Elements */}
                    <div>
                        <label className="block text-xs text-zinc-500 mb-2">Aktif Elementler</label>
                        <div className="flex flex-wrap gap-2">
                            {Object.entries(ELEMENTS).map(([key, info]) => (
                                <button
                                    key={key}
                                    onClick={() => toggleElement(key)}
                                    className={`
                                        px-3 py-1.5 text-xs rounded-lg border transition-all
                                        ${config.activeElements?.includes(key)
                                            ? `${info.bgColor} ${info.borderColor} text-white`
                                            : 'bg-zinc-900 border-zinc-700 text-zinc-500 hover:text-zinc-300'
                                        }
                                    `}
                                >
                                    {info.name}
                                </button>
                            ))}
                        </div>
                    </div>

                    {/* Cor Output */}
                    <div>
                        <label className="block text-xs text-zinc-500 mb-2">Cor Ä°Ã§eriÄŸi (Ne atÄ±yor?)</label>
                        <select
                            value={config.corOutput}
                            onChange={(e) => handleConfigChange("corOutput", e.target.value)}
                            className="w-full px-3 py-2 text-sm text-white bg-zinc-950 border border-zinc-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500/30"
                        >
                            {COR_OUTPUT_OPTIONS.map(opt => (
                                <option key={opt.value} value={opt.value}>{opt.label}</option>
                            ))}
                        </select>
                    </div>

                    {/* Requirements */}
                    <div className="grid grid-cols-2 gap-3">
                        <div>
                            <label className="block text-xs text-zinc-500 mb-1">SÄ±nÄ±f BirleÅŸtirme</label>
                            <SmartInput
                                value={config.requirements?.classUpgrade ?? 2}
                                onChange={(val) => handleRequirementChange("classUpgrade", val)}
                                min={2}
                                max={10}
                                className="w-full px-2 py-1.5 text-sm font-mono text-white bg-zinc-950 border border-zinc-700 rounded-lg"
                            />
                        </div>
                        <div>
                            <label className="block text-xs text-zinc-500 mb-1">SaflÄ±k BirleÅŸtirme</label>
                            <SmartInput
                                value={config.requirements?.clarityUpgrade ?? 2}
                                onChange={(val) => handleRequirementChange("clarityUpgrade", val)}
                                min={2}
                                max={10}
                                className="w-full px-2 py-1.5 text-sm font-mono text-white bg-zinc-950 border border-zinc-700 rounded-lg"
                            />
                        </div>
                    </div>

                    {/* Rates */}
                    <div className="grid grid-cols-2 gap-3">
                        <div>
                            <label className="block text-xs text-zinc-500 mb-1">SÄ±nÄ±f ÅansÄ± %</label>
                            <div className="flex items-center gap-2">
                                <SmartInput
                                    value={config.rates?.class ?? 50}
                                    onChange={(val) => handleRateChange("class", val)}
                                    min={1}
                                    max={100}
                                    className="flex-1 px-2 py-1.5 text-sm font-mono text-white bg-zinc-950 border border-zinc-700 rounded-lg"
                                />
                                <Percent className="w-4 h-4 text-zinc-600" />
                            </div>
                        </div>
                        <div>
                            <label className="block text-xs text-zinc-500 mb-1">SaflÄ±k ÅansÄ± %</label>
                            <div className="flex items-center gap-2">
                                <SmartInput
                                    value={config.rates?.clarity ?? 70}
                                    onChange={(val) => handleRateChange("clarity", val)}
                                    min={1}
                                    max={100}
                                    className="flex-1 px-2 py-1.5 text-sm font-mono text-white bg-zinc-950 border border-zinc-700 rounded-lg"
                                />
                                <Percent className="w-4 h-4 text-zinc-600" />
                            </div>
                        </div>
                    </div>
                </div>
            </details>

            {/* Simulate Button */}
            <button
                onClick={onSimulate}
                disabled={isRunning}
                className={`
                    w-full flex items-center justify-center gap-2 py-3 rounded-xl font-semibold transition-all duration-200
                    ${isRunning
                        ? "bg-zinc-800 text-zinc-500 cursor-not-allowed"
                        : "bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-500 hover:to-pink-500 text-white shadow-lg shadow-purple-900/30"
                    }
                `}
            >
                {isRunning ? (
                    <>
                        <Loader2 className="w-5 h-5 animate-spin" />
                        SimÃ¼le Ediliyor... {progress}%
                    </>
                ) : (
                    <>
                        <Calculator className="w-5 h-5" />
                        {mode === 'inventory' ? 'SimÃ¼lasyonu BaÅŸlat' : 'Maliyeti Hesapla'}
                    </>
                )}
            </button>

            {/* Progress Bar */}
            {isRunning && (
                <div className="w-full h-2 bg-zinc-800 rounded-full overflow-hidden">
                    <div
                        className="h-full bg-gradient-to-r from-purple-500 to-pink-500 transition-all duration-300"
                        style={{ width: `${progress}%` }}
                    />
                </div>
            )}
        </div>
    );
}

==================================================
DOSYA YOLU: .\app\components\widgets\simulators\alchemy\AlchemyResults.js
==================================================
"use client";

import {
    Gem,
    Layers,
    Trash2,
    TrendingUp
} from "lucide-react";
import {
    ELEMENTS,
    CLASS_LEVELS,
    CLARITY_LEVELS,
    formatNumber,
    formatCurrency
} from "./constants";

// ============================================================================
// ELEMENT RESULT CARD SUB-COMPONENT
// ============================================================================

function ElementResultCard({ element, summary, config }) {
    const elementInfo = ELEMENTS[element];
    if (!elementInfo) return null;

    const targetClassInfo = CLASS_LEVELS[config.targetClass];
    const targetTotal = summary?.targetClassTotal?.[element] || 0;
    const clarityBreakdown = summary?.targetClassByClarity?.[element] || {};
    const leftovers = summary?.leftoversByClass?.[element] || {};

    // Skip if no stones at all
    if (targetTotal < 0.001 && Object.keys(leftovers).length === 0) return null;

    return (
        <div className={`p-4 rounded-xl border ${elementInfo.borderColor} ${elementInfo.bgColor}`}>
            {/* Header */}
            <div className="flex items-center justify-between mb-3">
                <div className="flex items-center gap-2">
                    <Gem className={`w-5 h-5 ${elementInfo.textColor}`} />
                    <h4 className={`font-semibold ${elementInfo.textColor}`}>
                        {targetClassInfo?.name} {elementInfo.name}
                    </h4>
                </div>
                <span className="text-lg font-bold text-white font-mono">
                    {formatNumber(targetTotal)}
                </span>
            </div>

            {/* Clarity Breakdown (only if upgradeClarity is enabled) */}
            {config.upgradeClarity && Object.keys(clarityBreakdown).length > 0 && (
                <div className="space-y-1 mb-3 pl-2 border-l-2 border-white/10">
                    {Object.entries(clarityBreakdown).map(([clarity, count]) => (
                        <div key={clarity} className="flex justify-between items-center text-xs">
                            <span className="text-zinc-400">{CLARITY_LEVELS[clarity]?.name}</span>
                            <span className="text-white font-mono">{formatNumber(count)}</span>
                        </div>
                    ))}
                </div>
            )}

            {/* Leftovers */}
            {Object.keys(leftovers).length > 0 && (
                <div className="pt-2 border-t border-white/10">
                    <div className="flex items-center gap-1 text-xs text-zinc-500 mb-1">
                        <Trash2 className="w-3 h-3" />
                        <span>ArtÄ±klar</span>
                    </div>
                    <div className="flex flex-wrap gap-2">
                        {Object.entries(leftovers).map(([classLevel, count]) => (
                            <span key={classLevel} className="text-xs text-zinc-500">
                                {formatNumber(count)} {CLASS_LEVELS[classLevel]?.shortName}
                            </span>
                        ))}
                    </div>
                </div>
            )}
        </div>
    );
}

// ============================================================================
// MAIN RESULTS PANEL
// ============================================================================

export default function AlchemyResults({ result, mode, inputConfig }) {
    return (
        <div>
            <h3 className="text-sm font-semibold text-zinc-400 flex items-center gap-2 mb-4">
                <Layers className="w-4 h-4" />
                Hazine (SonuÃ§lar)
            </h3>

            {result ? (
                <div className="space-y-4">
                    {mode === 'target' && result.targetCost ? (
                        // TARGET MODE RESULTS
                        <div className="bg-gradient-to-br from-violet-900/30 to-fuchsia-900/30 p-4 rounded-xl border border-violet-500/30">
                            <div className="flex items-center gap-3 mb-6">
                                <div className={`p-3 rounded-lg ${ELEMENTS[result.targetCost.targetConfig.baseElement]?.bgColor || 'bg-zinc-800'}`}>
                                    <Gem className={`w-8 h-8 ${ELEMENTS[result.targetCost.targetConfig.baseElement]?.textColor || 'text-zinc-400'}`} />
                                </div>
                                <div>
                                    <h3 className="text-xl font-bold text-white">
                                        {CLASS_LEVELS[result.targetCost.targetConfig.targetGrade]?.name} {CLARITY_LEVELS[result.targetCost.targetConfig.targetClarity]?.name} {ELEMENTS[result.targetCost.targetConfig.baseElement]?.name}
                                    </h3>
                                    <p className="text-sm text-zinc-400">Hedeflenen Kimya TaÅŸÄ±</p>
                                </div>
                            </div>

                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div className="bg-zinc-900/60 p-4 rounded-xl border border-zinc-700">
                                    <p className="text-xs text-zinc-500 mb-1">Gereken Ortalama Cor</p>
                                    <p className="text-2xl font-bold text-purple-400 font-mono">
                                        {formatNumber(result.targetCost.avgCors)}
                                    </p>
                                    <div className="flex gap-3 mt-2 text-xs text-zinc-500 font-mono">
                                        <span className="text-green-500/70">Min: {formatNumber(result.targetCost.minCors)}</span>
                                        <span className="text-red-500/70">Max: {formatNumber(result.targetCost.maxCors)}</span>
                                    </div>
                                </div>

                                <div className="bg-zinc-900/60 p-4 rounded-xl border border-zinc-700">
                                    <p className="text-xs text-zinc-500 mb-1">Tahmini Maliyet</p>
                                    <p className="text-2xl font-bold text-yellow-500 font-mono">
                                        {formatCurrency(result.targetCost.avgCors * (result.corPrice || 0))}
                                    </p>
                                    <p className="text-xs text-zinc-600 mt-1">Yang</p>
                                </div>
                            </div>
                        </div>
                    ) : (
                        // INVENTORY MODE RESULTS
                        <>
                            {/* Summary Card */}
                            <div className="bg-gradient-to-br from-purple-900/30 to-pink-900/30 p-4 rounded-xl border border-purple-500/30">
                                <div className="flex items-center justify-between flex-wrap gap-4">
                                    <div>
                                        <p className="text-xs text-purple-300">SimÃ¼lasyon Ã–zeti</p>
                                        <p className="text-lg font-bold text-white">
                                            {inputConfig?.mode === 'cor' ? (
                                                `${result.corCount?.toLocaleString()} Cor`
                                            ) : (
                                                `${result.corCount?.toLocaleString()}x ${CLASS_LEVELS[inputConfig?.itemClass]?.name} ${CLARITY_LEVELS[inputConfig?.itemClarity]?.name}`
                                            )}
                                            {' '} â†’ {CLASS_LEVELS[result.config?.targetClass]?.name || 'Mitsi'}
                                        </p>
                                    </div>
                                    <div className="flex gap-4 text-right">
                                        <div>
                                            <p className="text-xs text-zinc-400">Deneme</p>
                                            <p className="text-sm font-mono text-purple-300">{result.simCount}x</p>
                                        </div>
                                        <div>
                                            <p className="text-xs text-zinc-400">SaflÄ±k</p>
                                            <p className="text-sm font-mono text-purple-300">
                                                {result.config?.upgradeClarity ? 'AÃ§Ä±k' : 'KapalÄ±'}
                                            </p>
                                        </div>
                                        <div>
                                            <p className="text-xs text-zinc-400">SÃ¼re</p>
                                            <p className="text-sm font-mono text-purple-300">{result.duration}ms</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* Element Result Cards */}
                            <div className="grid grid-cols-2 md:grid-cols-3 gap-4">
                                {result.config?.activeElements?.map(element => (
                                    <ElementResultCard
                                        key={element}
                                        element={element}
                                        summary={result.summary}
                                        config={result.config}
                                    />
                                ))}
                            </div>

                            {/* Financial Analysis */}
                            {result.financials && result.financials.totalCost > 0 && (
                                <div className="bg-zinc-900/50 p-4 rounded-xl border border-zinc-800">
                                    <h4 className="text-sm font-semibold text-zinc-400 mb-3 flex items-center gap-2">
                                        <TrendingUp className="w-4 h-4 text-yellow-500" />
                                        Maliyet Analizi
                                    </h4>
                                    <div className="grid grid-cols-2 md:grid-cols-4 gap-3">
                                        <div className="bg-zinc-800/50 p-3 rounded-lg">
                                            <p className="text-xs text-zinc-500">Toplam Harcanan</p>
                                            <p className="text-lg font-bold text-yellow-400 font-mono">
                                                {formatCurrency(result.financials.totalCost)}
                                            </p>
                                            <p className="text-xs text-zinc-600">Yang</p>
                                        </div>
                                        <div className="bg-zinc-800/50 p-3 rounded-lg">
                                            <p className="text-xs text-zinc-500">{CLASS_LEVELS[result.config?.targetClass]?.name} BaÅŸÄ±na</p>
                                            <p className="text-lg font-bold text-purple-400 font-mono">
                                                {formatCurrency(result.financials.costPerTargetStone)}
                                            </p>
                                            <p className="text-xs text-zinc-600">Yang / Adet</p>
                                        </div>
                                        {result.config?.upgradeClarity && result.financials.costPerFlawless > 0 && (
                                            <div className="bg-zinc-800/50 p-3 rounded-lg">
                                                <p className="text-xs text-zinc-500">Kusursuz BaÅŸÄ±na</p>
                                                <p className="text-lg font-bold text-pink-400 font-mono">
                                                    {formatCurrency(result.financials.costPerFlawless)}
                                                </p>
                                                <p className="text-xs text-zinc-600">Yang / Adet</p>
                                            </div>
                                        )}
                                        <div className="bg-zinc-800/50 p-3 rounded-lg">
                                            <p className="text-xs text-zinc-500">Toplam Hedef TaÅŸ</p>
                                            <p className="text-lg font-bold text-white font-mono">
                                                {formatNumber(result.financials.totalTargetStones)}
                                            </p>
                                            <p className="text-xs text-zinc-600">Adet (Ortalama)</p>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </>
                    )}
                </div>
            ) : (
                /* Empty State */
                <div className="flex flex-col items-center justify-center h-64 text-zinc-600 bg-zinc-900/30 rounded-xl border border-zinc-800">
                    <Gem className="w-12 h-12 mb-3 opacity-20" />
                    <p className="text-sm">SimÃ¼lasyon sonuÃ§larÄ± burada gÃ¶rÃ¼necek</p>
                    <p className="text-xs text-zinc-700 mt-1">
                        Parametreleri ayarlayÄ±n ve "BaÅŸlat" butonuna tÄ±klayÄ±n
                    </p>
                </div>
            )}
        </div>
    );
}

// Export sub-component for external use if needed
export { ElementResultCard };

==================================================
DOSYA YOLU: .\app\components\widgets\simulators\alchemy\constants.js
==================================================
// ============================================================================
// ALCHEMY PANEL CONSTANTS
// ============================================================================

export const ELEMENTS = {
    diamond: { name: 'Elmas', color: 'cyan-200', bgColor: 'bg-cyan-500/20', borderColor: 'border-cyan-500/30', textColor: 'text-cyan-300' },
    ruby: { name: 'Yakut', color: 'rose-500', bgColor: 'bg-rose-500/20', borderColor: 'border-rose-500/30', textColor: 'text-rose-300' },
    jade: { name: 'YeÅŸim', color: 'emerald-500', bgColor: 'bg-emerald-500/20', borderColor: 'border-emerald-500/30', textColor: 'text-emerald-300' },
    sapphire: { name: 'Safir', color: 'blue-500', bgColor: 'bg-blue-500/20', borderColor: 'border-blue-500/30', textColor: 'text-blue-300' },
    garnet: { name: 'Garnet', color: 'orange-500', bgColor: 'bg-orange-500/20', borderColor: 'border-orange-500/30', textColor: 'text-orange-300' },
    onyx: { name: 'Oniks', color: 'zinc-400', bgColor: 'bg-zinc-700/50', borderColor: 'border-zinc-500/30', textColor: 'text-zinc-300' },
    amethyst: { name: 'Ametist', color: 'purple-500', bgColor: 'bg-purple-500/20', borderColor: 'border-purple-500/30', textColor: 'text-purple-300' }
};

export const CLASS_LEVELS = {
    rough: { name: 'Ä°ÅŸlenmemiÅŸ', shortName: 'Rough' },
    cut: { name: 'YontulmuÅŸ', shortName: 'Cut' },
    rare: { name: 'Nadir', shortName: 'Rare' },
    antique: { name: 'Antika', shortName: 'Antique' },
    legendary: { name: 'Efsanevi', shortName: 'Legend' },
    mythic: { name: 'Mitsi', shortName: 'Mythic' }
};

export const CLARITY_LEVELS = {
    matte: { name: 'Mat', shortName: 'Mat' },
    clear: { name: 'Berrak', shortName: 'Clear' },
    brilliant: { name: 'Parlak', shortName: 'Brill' },
    excellent: { name: 'MÃ¼kemmel', shortName: 'Exc' },
    flawless: { name: 'Kusursuz', shortName: 'Flaw' }
};

export const TARGET_CLASS_OPTIONS = [
    { value: 'antique', label: 'Antika' },
    { value: 'legendary', label: 'Efsanevi' },
    { value: 'mythic', label: 'Mitsi' }
];

export const COR_OUTPUT_OPTIONS = [
    { value: 'rough', label: 'Ä°ÅŸlenmemiÅŸ (Rough)' },
    { value: 'cut', label: 'YontulmuÅŸ (Cut)' },
    { value: 'rare', label: 'Nadir (Rare)' },
    { value: 'antique', label: 'Antika (Antique)' },
    { value: 'legendary', label: 'Efsanevi (Legendary)' },
    { value: 'mythic', label: 'Mitsi (Mythic)' }
];

export const DEFAULT_CONFIG = {
    activeElements: ['diamond', 'ruby', 'jade', 'sapphire', 'garnet', 'onyx'],
    corOutput: 'rough',
    targetClass: 'mythic',
    upgradeClarity: false,
    requirements: {
        classUpgrade: 2,
        clarityUpgrade: 2
    },
    rates: {
        class: 50,
        clarity: 70
    }
};

export const DEFAULT_INPUT = {
    corCount: 1000,
    corPrice: 0,
    simCount: 100
};

export const DEFAULT_INPUT_CONFIG = {
    mode: 'cor', // 'cor' | 'material'
    itemClass: 'mythic',
    itemClarity: 'matte'
};

export const DEFAULT_TARGET_CONFIG = {
    baseElement: 'ruby',
    targetGrade: 'mythic',
    targetClarity: 'excellent'
};

// ============================================================================
// HELPER FUNCTIONS
// ============================================================================

export const formatNumber = (num) => {
    if (num === undefined || num === null || isNaN(num)) return "0";
    if (num >= 1) return num.toFixed(1);
    if (num >= 0.01) return num.toFixed(2);
    if (num > 0) return num.toFixed(3);
    return "0";
};

export const formatCurrency = (value) => {
    if (value === undefined || value === null || isNaN(value)) return "0";
    if (value >= 1000000000) return `${(value / 1000000000).toFixed(2)}B`;
    if (value >= 1000000) return `${(value / 1000000).toFixed(2)}M`;
    if (value >= 1000) return `${(value / 1000).toFixed(1)}K`;
    return Math.round(value).toLocaleString("tr-TR");
};

==================================================
DOSYA YOLU: .\app\components\widgets\simulators\blacksmith\ConfigPanel.js
==================================================
"use client";

import {
    Settings,
    Package,
    Calculator,
    Loader2
} from "lucide-react";
import SmartInput from "@/app/components/ui/SmartInput";

// ============================================================================
// CONSTANTS
// ============================================================================

const MATERIALS = {
    blessing_scroll: { name: 'Kutsama KaÄŸÄ±dÄ±', color: 'text-yellow-400' },
    magic_stone: { name: 'BÃ¼yÃ¼lÃ¼ Metal', color: 'text-blue-400' },
    ritual_stone: { name: 'RitÃ¼el TaÅŸÄ±', color: 'text-purple-400' },
    blacksmith_book: { name: 'Demirci El KitabÄ±', color: 'text-orange-400' }
};

const DEFAULT_BONUSES = {
    blessing_scroll: 0,
    magic_stone: 5,
    ritual_stone: 10,
    blacksmith_book: 15
};

// ============================================================================
// MAIN COMPONENT
// ============================================================================

export default function ConfigPanel({
    config,
    inventory,
    materialBonuses,
    prices,
    input,
    isRunning,
    progress,
    onConfigChange,
    onInventoryChange,
    onPriceChange,
    onBonusChange,
    onInputChange,
    onSimulate
}) {
    return (
        <div className="space-y-4">
            {/* Server Config Section */}
            <h3 className="text-sm font-semibold text-zinc-400 flex items-center gap-2">
                <Settings className="w-4 h-4" />
                Sunucu AyarlarÄ±
            </h3>

            {/* Calc Mode */}
            <div className="bg-zinc-900/50 p-3 rounded-xl border border-zinc-800">
                <label className="block text-xs font-medium text-zinc-400 mb-2">
                    Bonus Hesaplama
                </label>
                <div className="grid grid-cols-2 gap-2">
                    <button
                        onClick={() => onConfigChange("calcMode", "additive")}
                        className={`p-2 text-xs rounded-lg border transition-all ${config.calcMode === 'additive'
                            ? 'bg-orange-500/20 border-orange-500/50 text-orange-300'
                            : 'bg-zinc-900 border-zinc-700 text-zinc-400'
                            }`}
                    >
                        DÃ¼z (+%10)
                    </button>
                    <button
                        onClick={() => onConfigChange("calcMode", "multiplicative")}
                        className={`p-2 text-xs rounded-lg border transition-all ${config.calcMode === 'multiplicative'
                            ? 'bg-orange-500/20 border-orange-500/50 text-orange-300'
                            : 'bg-zinc-900 border-zinc-700 text-zinc-400'
                            }`}
                    >
                        Oransal (x1.1)
                    </button>
                </div>
            </div>

            {/* Pity System */}
            <div className="bg-zinc-900/50 p-3 rounded-xl border border-zinc-800">
                <label className="block text-xs font-medium text-zinc-400 mb-2">
                    Pity Sistemi
                </label>
                <select
                    value={config.pitySystem}
                    onChange={(e) => onConfigChange("pitySystem", e.target.value)}
                    className="w-full px-3 py-2 text-sm text-white bg-zinc-950 border border-zinc-700 rounded-lg"
                >
                    <option value="none">Yok</option>
                    <option value="incremental">Artan (Her yanÄ±ÅŸta +%5)</option>
                    <option value="hard">Garanti (X yanÄ±ÅŸta %100)</option>
                </select>
            </div>

            {/* Inventory & Bonuses Grid */}
            <h3 className="text-sm font-semibold text-zinc-400 flex items-center gap-2 mt-4">
                <Package className="w-4 h-4" />
                Envanter & Bonuslar
            </h3>

            <div className="space-y-3">
                {Object.entries(MATERIALS).map(([id, mat]) => (
                    <div key={id} className="bg-zinc-900/50 p-3 rounded-xl border border-zinc-800">
                        <div className="flex items-center justify-between mb-2">
                            <span className={`text-xs font-semibold ${mat.color}`}>{mat.name}</span>
                        </div>
                        <div className="grid grid-cols-3 gap-2">
                            {/* Stock Input */}
                            <div>
                                <label className="block text-[10px] text-zinc-500 mb-1">Adet</label>
                                <SmartInput
                                    value={inventory[id] || 0}
                                    onChange={(val) => onInventoryChange(id, val)}
                                    min={0}
                                    className="w-full px-2 py-1 text-xs font-mono text-white bg-zinc-950 border border-zinc-700 rounded"
                                />
                            </div>
                            {/* Bonus Input */}
                            <div>
                                <label className="block text-[10px] text-zinc-500 mb-1">Åans %</label>
                                <SmartInput
                                    value={materialBonuses[id] !== undefined ? materialBonuses[id] : (DEFAULT_BONUSES[id] || 0)}
                                    onChange={(val) => onBonusChange(id, val)}
                                    min={0}
                                    max={100}
                                    className="w-full px-2 py-1 text-xs font-mono text-green-400 bg-zinc-950 border border-zinc-700 rounded border-green-500/20"
                                />
                            </div>
                            {/* Price Input */}
                            <div>
                                <label className="block text-[10px] text-zinc-500 mb-1">Birim Fiyat</label>
                                <SmartInput
                                    value={prices[id] || 0}
                                    onChange={(val) => onPriceChange(id, val)}
                                    min={0}
                                    className="w-full px-2 py-1 text-xs font-mono text-yellow-400 bg-zinc-950 border border-zinc-700 rounded border-yellow-500/20"
                                />
                            </div>
                        </div>
                    </div>
                ))}
            </div>

            {/* Simulation Range */}
            <div className="bg-zinc-900/50 p-3 rounded-xl border border-zinc-800">
                <div className="grid grid-cols-2 gap-2">
                    <div>
                        <label className="block text-xs text-zinc-500 mb-1">BaÅŸlangÄ±Ã§</label>
                        <SmartInput
                            value={input.startLevel}
                            onChange={(val) => onInputChange("startLevel", val)}
                            min={0}
                            max={8}
                            className="w-full px-2 py-1.5 text-sm font-mono text-white bg-zinc-950 border border-zinc-700 rounded-lg"
                        />
                    </div>
                    <div>
                        <label className="block text-xs text-zinc-500 mb-1">Hedef</label>
                        <SmartInput
                            value={input.targetLevel}
                            onChange={(val) => onInputChange("targetLevel", val)}
                            min={1}
                            max={9}
                            className="w-full px-2 py-1.5 text-sm font-mono text-white bg-zinc-950 border border-zinc-700 rounded-lg"
                        />
                    </div>
                </div>
            </div>

            {/* Sim Count */}
            <div className="bg-zinc-900/50 p-3 rounded-xl border border-zinc-800">
                <label className="block text-xs font-medium text-zinc-400 mb-2">
                    SimÃ¼lasyon: {input.simCount?.toLocaleString() || 1000}
                </label>
                <input
                    type="range"
                    min={100}
                    max={10000}
                    step={100}
                    value={input.simCount || 1000}
                    onChange={(e) => onInputChange("simCount", parseInt(e.target.value))}
                    className="w-full h-2 bg-zinc-800 rounded-lg accent-orange-500"
                />
            </div>

            {/* Simulate Button */}
            <button
                onClick={onSimulate}
                disabled={isRunning}
                className={`
                    w-full flex items-center justify-center gap-2 py-3 rounded-xl font-semibold transition-all
                    ${isRunning
                        ? "bg-zinc-800 text-zinc-500 cursor-not-allowed"
                        : "bg-gradient-to-r from-orange-600 to-red-600 hover:from-orange-500 hover:to-red-500 text-white shadow-lg"
                    }
                `}
            >
                {isRunning ? (
                    <>
                        <Loader2 className="w-5 h-5 animate-spin" />
                        SimÃ¼le Ediliyor... {progress}%
                    </>
                ) : (
                    <>
                        <Calculator className="w-5 h-5" />
                        SimÃ¼lasyonu BaÅŸlat
                    </>
                )}
            </button>
        </div>
    );
}

// Export MATERIALS for use in other components
export { MATERIALS, DEFAULT_BONUSES };

==================================================
DOSYA YOLU: .\app\components\widgets\simulators\blacksmith\ResultsPanel.js
==================================================
"use client";

import {
    BarChart3,
    Hammer,
    CheckCircle2,
    XCircle,
    Coins,
    AlertTriangle
} from "lucide-react";
import {
    BarChart,
    Bar,
    XAxis,
    YAxis,
    CartesianGrid,
    Tooltip,
    ResponsiveContainer,
    Cell
} from "recharts";

// ============================================================================
// CONSTANTS
// ============================================================================

const MATERIALS = {
    blessing_scroll: { name: 'Kutsama KaÄŸÄ±dÄ±', color: 'text-yellow-400' },
    magic_stone: { name: 'BÃ¼yÃ¼lÃ¼ Metal', color: 'text-blue-400' },
    ritual_stone: { name: 'RitÃ¼el TaÅŸÄ±', color: 'text-purple-400' },
    blacksmith_book: { name: 'Demirci El KitabÄ±', color: 'text-orange-400' }
};

// ============================================================================
// HELPER FUNCTIONS
// ============================================================================

const formatCurrency = (value) => {
    if (value === undefined || value === null || isNaN(value)) return "0";
    if (value >= 1000000000) return `${(value / 1000000000).toFixed(2)}B`;
    if (value >= 1000000) return `${(value / 1000000).toFixed(2)}M`;
    if (value >= 1000) return `${(value / 1000).toFixed(1)}K`;
    return Math.round(value).toLocaleString("tr-TR");
};

// ============================================================================
// SUB-COMPONENT: ResultCard
// ============================================================================

function ResultCard({ title, value, subtitle, icon: Icon, color = "zinc" }) {
    const colorClasses = {
        zinc: "from-zinc-800/50 to-zinc-900/50 border-zinc-700/50",
        green: "from-green-500/20 to-green-500/5 border-green-500/30",
        red: "from-red-500/20 to-red-500/5 border-red-500/30",
        yellow: "from-yellow-500/20 to-yellow-500/5 border-yellow-500/30",
        violet: "from-violet-500/20 to-violet-500/5 border-violet-500/30"
    };

    const iconColors = {
        zinc: "text-zinc-400",
        green: "text-green-400",
        red: "text-red-400",
        yellow: "text-yellow-400",
        violet: "text-violet-400"
    };

    return (
        <div className={`bg-gradient-to-br ${colorClasses[color]} rounded-xl border p-4`}>
            <div className="flex items-center gap-2 mb-2">
                {Icon && <Icon className={`w-4 h-4 ${iconColors[color]}`} />}
                <span className="text-xs font-medium text-zinc-400">{title}</span>
            </div>
            <p className="text-xl font-bold text-white font-mono">{value}</p>
            {subtitle && <p className="text-xs text-zinc-500 mt-1">{subtitle}</p>}
        </div>
    );
}

// ============================================================================
// MAIN COMPONENT: ResultsPanel
// ============================================================================

export default function ResultsPanel({ result, targetLevel }) {
    return (
        <div className="space-y-4">
            <h3 className="text-sm font-semibold text-zinc-400 flex items-center gap-2">
                <BarChart3 className="w-4 h-4" />
                SonuÃ§lar
            </h3>

            {result ? (
                <div className="space-y-3">
                    {/* Success Rate */}
                    <ResultCard
                        title="BaÅŸarÄ± OranÄ±"
                        value={`%${result.successRate}`}
                        subtitle={`${result.simCount} deneme`}
                        icon={result.successRate >= 50 ? CheckCircle2 : XCircle}
                        color={result.successRate >= 50 ? "green" : "red"}
                    />

                    {/* Average Cost (Total: Material + Yang) */}
                    <ResultCard
                        title="Toplam Maliyet"
                        value={`${formatCurrency(result.avgCost)} Yang`}
                        subtitle={`${result.avgAttempts} deneme`}
                        icon={Coins}
                        color="yellow"
                    />

                    {/* Cost Breakdown */}
                    {(result.avgMaterialCost > 0 || result.avgYangCost > 0) && (
                        <div className="bg-zinc-900/50 p-3 rounded-xl border border-zinc-800">
                            <h4 className="text-xs font-semibold text-zinc-400 mb-2">Maliyet DaÄŸÄ±lÄ±mÄ±</h4>
                            <div className="space-y-1">
                                <div className="flex justify-between text-xs">
                                    <span className="text-blue-400">Materyal</span>
                                    <span className="text-white font-mono">{formatCurrency(result.avgMaterialCost)}</span>
                                </div>
                                <div className="flex justify-between text-xs">
                                    <span className="text-yellow-400">YÃ¼kseltme Ãœcreti</span>
                                    <span className="text-white font-mono">{formatCurrency(result.avgYangCost)}</span>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Material Usage */}
                    <div className="bg-zinc-900/50 p-3 rounded-xl border border-zinc-800">
                        <h4 className="text-xs font-semibold text-zinc-400 mb-2">Materyal KullanÄ±mÄ±</h4>
                        <div className="space-y-1">
                            {Object.entries(result.avgMaterials || {}).filter(([_, v]) => v > 0).map(([mat, avg]) => (
                                <div key={mat} className="flex justify-between text-xs">
                                    <span className={MATERIALS[mat]?.color || 'text-zinc-400'}>
                                        {MATERIALS[mat]?.name || mat}
                                    </span>
                                    <span className="text-white font-mono">{avg}</span>
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* Stock Analysis */}
                    {result.stockAnalysis && (
                        <div className="bg-zinc-900/50 p-3 rounded-xl border border-zinc-800">
                            <h4 className="text-xs font-semibold text-zinc-400 mb-2">Envanter Durumu</h4>
                            <div className="space-y-1">
                                {Object.entries(result.stockAnalysis)
                                    .filter(([_, data]) => data.required > 0)
                                    .map(([mat, data]) => (
                                        <div key={mat} className="flex items-center justify-between text-xs">
                                            <span className={data.sufficient ? 'text-green-400' : 'text-red-400'}>
                                                {MATERIALS[mat]?.name || mat}
                                            </span>
                                            <span className="font-mono">
                                                {data.available}/{data.required.toFixed(1)}
                                                {data.deficit > 0 && (
                                                    <span className="text-red-400 ml-1">(-{data.deficit})</span>
                                                )}
                                            </span>
                                        </div>
                                    ))}
                            </div>
                        </div>
                    )}

                    {/* Warnings */}
                    {result.stockOutSummary?.length > 0 && (
                        <div className="bg-yellow-900/20 p-3 rounded-xl border border-yellow-500/30">
                            <h4 className="text-xs font-semibold text-yellow-400 mb-2 flex items-center gap-1">
                                <AlertTriangle className="w-3 h-3" />
                                UyarÄ±lar
                            </h4>
                            <div className="space-y-1 text-xs text-yellow-300/80">
                                {result.stockOutSummary.slice(0, 3).map((warning, i) => (
                                    <p key={i}>
                                        +{warning.level}'de {warning.materialName} %{warning.frequency} simÃ¼lasyonda bitti
                                    </p>
                                ))}
                            </div>
                        </div>
                    )}

                    {/* Level Distribution Chart */}
                    {result.levelDistribution && (
                        <div className="bg-zinc-900/50 p-3 rounded-xl border border-zinc-800">
                            <h4 className="text-xs font-semibold text-zinc-400 mb-2">BitiÅŸ Seviyesi DaÄŸÄ±lÄ±mÄ±</h4>
                            <div className="h-32">
                                <ResponsiveContainer width="100%" height="100%">
                                    <BarChart data={result.levelDistribution}>
                                        <CartesianGrid strokeDasharray="3 3" stroke="#333" />
                                        <XAxis
                                            dataKey="level"
                                            tick={{ fill: '#888', fontSize: 10 }}
                                            tickFormatter={(v) => `+${v}`}
                                        />
                                        <YAxis
                                            tick={{ fill: '#888', fontSize: 10 }}
                                            tickFormatter={(v) => `${v}%`}
                                        />
                                        <Tooltip
                                            contentStyle={{ background: '#18181b', border: '1px solid #333' }}
                                            labelFormatter={(v) => `+${v}`}
                                            formatter={(v) => [`${v}%`, 'Oran']}
                                        />
                                        <Bar dataKey="percentage">
                                            {result.levelDistribution.map((entry, index) => (
                                                <Cell
                                                    key={`cell-${index}`}
                                                    fill={entry.level >= targetLevel ? '#22c55e' : '#f97316'}
                                                />
                                            ))}
                                        </Bar>
                                    </BarChart>
                                </ResponsiveContainer>
                            </div>
                        </div>
                    )}
                </div>
            ) : (
                /* Empty State */
                <div className="flex flex-col items-center justify-center h-48 text-zinc-600 bg-zinc-900/30 rounded-xl border border-zinc-800">
                    <Hammer className="w-10 h-10 mb-2 opacity-20" />
                    <p className="text-sm">SonuÃ§lar burada gÃ¶rÃ¼necek</p>
                </div>
            )}
        </div>
    );
}

// Export helper and sub-components
export { ResultCard, formatCurrency };

==================================================
DOSYA YOLU: .\app\components\widgets\simulators\blacksmith\StrategyTable.js
==================================================
"use client";

import { useState, useCallback } from "react";
import { motion, AnimatePresence } from "framer-motion";
import {
    Target,
    ChevronDown,
    Shield,
    Skull,
    Lock,
    RotateCcw,
    ArrowRight,
    Copy,
    Coins,
    Package,
    AlertTriangle,
    Plus,
    X,
    Sparkles
} from "lucide-react";
import SmartInput from "@/app/components/ui/SmartInput";

// ============================================================================
// CONSTANTS
// ============================================================================

const MATERIAL_OPTIONS = [
    { value: 'ritual_stone', label: 'RitÃ¼el TaÅŸÄ±', icon: 'ğŸ’', color: 'purple' },
    { value: 'magic_stone', label: 'BÃ¼yÃ¼lÃ¼ Metal', icon: 'ğŸ”®', color: 'blue' },
    { value: 'blessing_scroll', label: 'Kutsama KaÄŸÄ±dÄ±', icon: 'ğŸ“œ', color: 'yellow' },
    { value: 'blacksmith_book', label: 'El KitabÄ±', icon: 'ğŸ“•', color: 'orange' }
];

const FAIL_OPTIONS = [
    { value: 'downgrade', label: 'Seviye DÃ¼ÅŸ (-1)', icon: ArrowRight, color: 'text-orange-400' },
    { value: 'destroy', label: 'Yok Ol (Destroy)', icon: Skull, color: 'text-red-400' },
    { value: 'keep_level', label: 'Seviye Koru (Safe)', icon: Shield, color: 'text-green-400' },
    { value: 'reset', label: 'BaÅŸa DÃ¶n (Reset)', icon: RotateCcw, color: 'text-violet-400' }
];

const DEFAULT_STRATEGY = {
    0: { baseChance: 90, pityLimit: 5, priorityList: ['blessing_scroll'], upgradeCost: 0, onFail: 'downgrade', requiredMaterials: [] },
    1: { baseChance: 85, pityLimit: 5, priorityList: ['blessing_scroll'], upgradeCost: 0, onFail: 'downgrade', requiredMaterials: [] },
    2: { baseChance: 80, pityLimit: 6, priorityList: ['blessing_scroll'], upgradeCost: 0, onFail: 'downgrade', requiredMaterials: [] },
    3: { baseChance: 75, pityLimit: 6, priorityList: ['blessing_scroll'], upgradeCost: 0, onFail: 'downgrade', requiredMaterials: [] },
    4: { baseChance: 70, pityLimit: 7, priorityList: ['blessing_scroll'], upgradeCost: 100000, onFail: 'downgrade', requiredMaterials: [] },
    5: { baseChance: 60, pityLimit: 8, priorityList: ['blessing_scroll', 'magic_stone'], upgradeCost: 200000, onFail: 'downgrade', requiredMaterials: [] },
    6: { baseChance: 50, pityLimit: 10, priorityList: ['magic_stone', 'blessing_scroll'], upgradeCost: 300000, onFail: 'downgrade', requiredMaterials: [] },
    7: { baseChance: 40, pityLimit: 12, priorityList: ['ritual_stone', 'magic_stone'], upgradeCost: 400000, onFail: 'downgrade', requiredMaterials: [] },
    8: { baseChance: 30, pityLimit: 15, priorityList: ['ritual_stone', 'magic_stone', 'blessing_scroll'], upgradeCost: 500000, onFail: 'keep_level', requiredMaterials: [] }
};

// ============================================================================
// HELPER FUNCTIONS
// ============================================================================

const getChanceColor = (chance) => {
    if (chance >= 70) return { border: 'border-l-green-500', text: 'text-green-400', bg: 'bg-green-500/10' };
    if (chance >= 40) return { border: 'border-l-yellow-500', text: 'text-yellow-400', bg: 'bg-yellow-500/10' };
    return { border: 'border-l-red-500', text: 'text-red-400', bg: 'bg-red-500/10' };
};

const formatCurrency = (value) => {
    if (value === undefined || value === null || isNaN(value)) return "0";
    if (value >= 1000000000) return `${(value / 1000000000).toFixed(1)}B`;
    if (value >= 1000000) return `${(value / 1000000).toFixed(1)}M`;
    if (value >= 1000) return `${(value / 1000).toFixed(0)}K`;
    return Math.round(value).toLocaleString("tr-TR");
};

// ============================================================================
// SUB-COMPONENT: StageCard
// ============================================================================

function StageCard({
    level,
    strategy,
    config,
    onChange,
    onOpenMaterials,
    onApplyToHigher,
    isExpanded,
    onToggle
}) {
    const chanceColors = getChanceColor(strategy.baseChance);
    const showPityLimit = config.pitySystem === 'hard';
    const totalCost = (strategy.upgradeCost || 0);
    const materialCount = strategy.requiredMaterials?.length || 0;

    // Get active protection icons
    const getProtectionIcons = () => {
        const icons = [];
        if (strategy.priorityList?.includes('ritual_stone')) icons.push({ icon: 'ğŸ’', label: 'RitÃ¼el' });
        if (strategy.priorityList?.includes('magic_stone')) icons.push({ icon: 'ğŸ”®', label: 'BÃ¼yÃ¼lÃ¼' });
        if (strategy.onFail === 'keep_level') icons.push({ icon: 'ğŸ›¡ï¸', label: 'Safe' });
        if (materialCount > 0) icons.push({ icon: 'ğŸ“¦', label: `+${materialCount}` });
        return icons;
    };

    const protectionIcons = getProtectionIcons();

    return (
        <div className={`
            rounded-xl border border-l-4 overflow-hidden transition-all duration-200
            ${chanceColors.border}
            ${isExpanded ? 'bg-zinc-900/80 border-zinc-700' : 'bg-zinc-900/40 border-zinc-800 hover:bg-zinc-900/60'}
        `}>
            {/* HEADER - Always Visible (Collapsed Dashboard View) */}
            <button
                onClick={onToggle}
                className="w-full px-4 py-3 flex items-center gap-4 text-left"
            >
                {/* Level Badge */}
                <div className="flex items-center gap-2 min-w-[90px]">
                    <span className="text-lg font-bold text-white">+{level}</span>
                    <ArrowRight className="w-4 h-4 text-zinc-600" />
                    <span className="text-lg font-bold text-white">+{level + 1}</span>
                </div>

                {/* Chance Display */}
                <div className={`
                    px-3 py-1 rounded-lg font-mono font-bold text-lg min-w-[70px] text-center
                    ${chanceColors.bg} ${chanceColors.text}
                `}>
                    %{strategy.baseChance}
                </div>

                {/* Cost Preview */}
                <div className="flex items-center gap-1.5 px-3 py-1 bg-yellow-500/10 rounded-lg">
                    <Coins className="w-4 h-4 text-yellow-500" />
                    <span className="text-sm font-mono font-semibold text-yellow-400">
                        {formatCurrency(totalCost)}
                    </span>
                </div>

                {/* Protection Summary Badges */}
                <div className="flex items-center gap-1 flex-1">
                    {protectionIcons.map((item, idx) => (
                        <span
                            key={idx}
                            className="px-2 py-0.5 bg-zinc-800 rounded text-xs"
                            title={item.label}
                        >
                            {item.icon}
                        </span>
                    ))}
                </div>

                {/* Expand Icon */}
                <ChevronDown className={`
                    w-5 h-5 text-zinc-500 transition-transform duration-200
                    ${isExpanded ? 'rotate-180' : ''}
                `} />
            </button>

            {/* BODY - Expanded Control Center */}
            <AnimatePresence>
                {isExpanded && (
                    <motion.div
                        initial={{ height: 0, opacity: 0 }}
                        animate={{ height: 'auto', opacity: 1 }}
                        exit={{ height: 0, opacity: 0 }}
                        transition={{ duration: 0.2 }}
                        className="overflow-hidden"
                    >
                        <div className="px-4 pb-4 space-y-4 border-t border-zinc-800">

                            {/* ZONE 1: Core Stats */}
                            <div className="grid grid-cols-2 md:grid-cols-4 gap-3 pt-4">
                                {/* Base Chance */}
                                <div>
                                    <label className="block text-xs text-zinc-500 mb-1">BaÅŸarÄ± ÅansÄ± %</label>
                                    <SmartInput
                                        value={strategy.baseChance}
                                        onChange={(val) => onChange(level, 'baseChance', val)}
                                        min={1}
                                        max={100}
                                        className={`w-full px-3 py-2 text-lg font-mono font-bold bg-zinc-950 border border-zinc-700 rounded-lg ${chanceColors.text}`}
                                    />
                                </div>

                                {/* Pity Limit */}
                                {showPityLimit && (
                                    <div>
                                        <label className="block text-xs text-zinc-500 mb-1">Pity Limit</label>
                                        <SmartInput
                                            value={strategy.pityLimit ?? 10}
                                            onChange={(val) => onChange(level, 'pityLimit', val)}
                                            min={0}
                                            max={100}
                                            className="w-full px-3 py-2 text-lg font-mono font-bold text-orange-400 bg-zinc-950 border border-orange-500/30 rounded-lg"
                                        />
                                    </div>
                                )}

                                {/* Upgrade Cost */}
                                <div>
                                    <label className="block text-xs text-zinc-500 mb-1">YÃ¼kseltme Ãœcreti</label>
                                    <SmartInput
                                        value={strategy.upgradeCost ?? 0}
                                        onChange={(val) => onChange(level, 'upgradeCost', val)}
                                        min={0}
                                        className="w-full px-3 py-2 text-lg font-mono font-bold text-yellow-400 bg-zinc-950 border border-yellow-500/30 rounded-lg"
                                    />
                                </div>

                                {/* Extra Materials Button */}
                                <div>
                                    <label className="block text-xs text-zinc-500 mb-1">Ekstra Malzeme</label>
                                    <button
                                        onClick={() => onOpenMaterials(level)}
                                        className={`
                                            w-full px-3 py-2 rounded-lg border flex items-center justify-center gap-2 transition-all
                                            ${materialCount > 0
                                                ? 'bg-blue-500/20 border-blue-500/50 text-blue-400 hover:bg-blue-500/30'
                                                : 'bg-zinc-950 border-zinc-700 text-zinc-400 hover:text-white hover:border-zinc-600'
                                            }
                                        `}
                                    >
                                        <Package className="w-4 h-4" />
                                        {materialCount > 0 ? `${materialCount} Malzeme` : 'Ekle'}
                                    </button>
                                </div>
                            </div>

                            {/* ZONE 2: Protection Strategy */}
                            <div className="bg-zinc-950/50 p-3 rounded-lg border border-zinc-800">
                                <h4 className="text-xs font-semibold text-zinc-400 mb-3 flex items-center gap-2">
                                    <Shield className="w-3.5 h-3.5 text-green-400" />
                                    Koruma Ã–nceliÄŸi
                                </h4>
                                <div className="grid grid-cols-3 gap-2">
                                    {[0, 1, 2].map((idx) => (
                                        <div key={idx}>
                                            <label className="block text-[10px] text-zinc-600 mb-1">
                                                {idx + 1}. Ã–ncelik
                                            </label>
                                            <select
                                                value={strategy.priorityList?.[idx] || ''}
                                                onChange={(e) => {
                                                    const newList = [...(strategy.priorityList || [])];
                                                    if (e.target.value) {
                                                        newList[idx] = e.target.value;
                                                    } else {
                                                        newList.splice(idx, 1);
                                                    }
                                                    onChange(level, 'priorityList', newList.filter(Boolean));
                                                }}
                                                className="w-full px-2 py-1.5 text-xs text-white bg-zinc-900 border border-zinc-700 rounded-lg focus:border-green-500/50 focus:outline-none"
                                            >
                                                {idx > 0 && <option value="">- Yok -</option>}
                                                {MATERIAL_OPTIONS.map(opt => (
                                                    <option key={opt.value} value={opt.value}>
                                                        {opt.icon} {opt.label}
                                                    </option>
                                                ))}
                                            </select>
                                        </div>
                                    ))}
                                </div>
                            </div>

                            {/* ZONE 3: Risk Management */}
                            <div className="bg-zinc-950/50 p-3 rounded-lg border border-zinc-800">
                                <h4 className="text-xs font-semibold text-zinc-400 mb-3 flex items-center gap-2">
                                    <AlertTriangle className="w-3.5 h-3.5 text-red-400" />
                                    BaÅŸarÄ±sÄ±z Olursa
                                </h4>
                                <div className="grid grid-cols-2 md:grid-cols-4 gap-2">
                                    {FAIL_OPTIONS.map((opt) => {
                                        const IconComponent = opt.icon;
                                        const isSelected = strategy.onFail === opt.value;
                                        return (
                                            <button
                                                key={opt.value}
                                                onClick={() => onChange(level, 'onFail', opt.value)}
                                                className={`
                                                    p-2 rounded-lg border text-xs font-medium transition-all flex flex-col items-center gap-1
                                                    ${isSelected
                                                        ? `bg-zinc-800 border-zinc-600 ${opt.color}`
                                                        : 'bg-zinc-900 border-zinc-800 text-zinc-500 hover:border-zinc-700'
                                                    }
                                                `}
                                            >
                                                <IconComponent className={`w-4 h-4 ${isSelected ? opt.color : ''}`} />
                                                <span className="text-[10px] text-center leading-tight">{opt.label}</span>
                                            </button>
                                        );
                                    })}
                                </div>
                            </div>

                            {/* Action Footer */}
                            <div className="flex items-center justify-end gap-2 pt-2">
                                <button
                                    onClick={() => onApplyToHigher(level)}
                                    className="flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium text-violet-400 bg-violet-500/10 hover:bg-violet-500/20 border border-violet-500/30 rounded-lg transition-colors"
                                >
                                    <Copy className="w-3.5 h-3.5" />
                                    Ãœst Seviyelere Uygula
                                </button>
                            </div>
                        </div>
                    </motion.div>
                )}
            </AnimatePresence>
        </div>
    );
}

// ============================================================================
// MAIN COMPONENT: StrategyTable
// ============================================================================

export default function StrategyTable({
    levelRange,
    strategy,
    config,
    onStrategyChange,
    onOpenMaterials
}) {
    const [expandedLevel, setExpandedLevel] = useState(null);
    const [globalProtection, setGlobalProtection] = useState('blessing_scroll');
    const [globalFailMode, setGlobalFailMode] = useState('downgrade');

    // Toggle card expansion
    const handleToggle = useCallback((level) => {
        setExpandedLevel(prev => prev === level ? null : level);
    }, []);

    // Apply settings to all higher levels
    const handleApplyToHigher = useCallback((fromLevel) => {
        const sourceStrategy = strategy[fromLevel] || DEFAULT_STRATEGY[fromLevel];
        levelRange.forEach(lvl => {
            if (lvl > fromLevel) {
                onStrategyChange(lvl, 'priorityList', [...(sourceStrategy.priorityList || [])]);
                onStrategyChange(lvl, 'onFail', sourceStrategy.onFail);
            }
        });
    }, [levelRange, strategy, onStrategyChange]);

    // Apply global settings to all levels
    const handleApplyGlobal = useCallback(() => {
        levelRange.forEach(lvl => {
            onStrategyChange(lvl, 'priorityList', [globalProtection]);
            onStrategyChange(lvl, 'onFail', globalFailMode);
        });
    }, [levelRange, globalProtection, globalFailMode, onStrategyChange]);

    return (
        <div className="space-y-4">
            {/* Header */}
            <div className="flex items-center justify-between">
                <h3 className="text-sm font-semibold text-zinc-400 flex items-center gap-2">
                    <Target className="w-4 h-4" />
                    Seviye Stratejileri
                </h3>
                <span className="text-xs text-zinc-600">
                    {levelRange.length} seviye
                </span>
            </div>

            {/* Global Action Bar */}
            <div className="flex items-center gap-2 p-3 bg-zinc-900/50 rounded-xl border border-zinc-800">
                <Sparkles className="w-4 h-4 text-violet-400 flex-shrink-0" />
                <span className="text-xs text-zinc-400 flex-shrink-0">Hepsine Uygula:</span>

                <select
                    value={globalProtection}
                    onChange={(e) => setGlobalProtection(e.target.value)}
                    className="px-2 py-1 text-xs text-white bg-zinc-950 border border-zinc-700 rounded-lg flex-1 max-w-[150px]"
                >
                    {MATERIAL_OPTIONS.map(opt => (
                        <option key={opt.value} value={opt.value}>{opt.icon} {opt.label}</option>
                    ))}
                </select>

                <select
                    value={globalFailMode}
                    onChange={(e) => setGlobalFailMode(e.target.value)}
                    className="px-2 py-1 text-xs text-white bg-zinc-950 border border-zinc-700 rounded-lg flex-1 max-w-[140px]"
                >
                    {FAIL_OPTIONS.map(opt => (
                        <option key={opt.value} value={opt.value}>{opt.label}</option>
                    ))}
                </select>

                <button
                    onClick={handleApplyGlobal}
                    className="px-3 py-1 text-xs font-semibold text-white bg-violet-600 hover:bg-violet-500 rounded-lg transition-colors flex-shrink-0"
                >
                    Uygula
                </button>
            </div>

            {/* Stage Cards List */}
            <div className="space-y-2">
                {levelRange.map(level => (
                    <StageCard
                        key={level}
                        level={level}
                        strategy={strategy[level] || DEFAULT_STRATEGY[level] || {
                            baseChance: 30,
                            pityLimit: 10,
                            priorityList: ['blessing_scroll'],
                            upgradeCost: 0,
                            onFail: 'downgrade',
                            requiredMaterials: []
                        }}
                        config={config}
                        onChange={onStrategyChange}
                        onOpenMaterials={onOpenMaterials}
                        onApplyToHigher={handleApplyToHigher}
                        isExpanded={expandedLevel === level}
                        onToggle={() => handleToggle(level)}
                    />
                ))}
            </div>

            {/* Footer Tips */}
            <div className="flex items-start gap-2 p-3 bg-zinc-800/30 rounded-lg border border-zinc-700/50">
                <AlertTriangle className="w-4 h-4 text-yellow-500 flex-shrink-0 mt-0.5" />
                <div className="text-xs text-zinc-500">
                    <p className="font-medium text-zinc-400 mb-1">Strateji Ä°puÃ§larÄ±:</p>
                    <ul className="space-y-0.5 list-disc list-inside">
                        <li>YÃ¼ksek seviyeler iÃ§in "Seviye Koru" modunu tercih edin</li>
                        <li>Koruma Ã¶ncelikleri envanter durumuna gÃ¶re otomatik seÃ§ilir</li>
                        <li>Kartlara tÄ±klayarak detaylÄ± ayarlarÄ± gÃ¶rÃ¼ntÃ¼leyin</li>
                    </ul>
                </div>
            </div>
        </div>
    );
}

// Export constants for use in other components
export { MATERIAL_OPTIONS, DEFAULT_STRATEGY, FAIL_OPTIONS };

==================================================
DOSYA YOLU: .\app\components\widgets\simulators\sash\constants.js
==================================================
// ============================================================================
// SASH CRAFTING PANEL CONSTANTS
// ============================================================================

export const TARGET_GRADES = [
    { value: 18, label: "%18 EmiÅŸ" },
    { value: 20, label: "%20 EmiÅŸ" },
    { value: 25, label: "%25 EmiÅŸ" },
    { value: 30, label: "%30 EmiÅŸ" }
];

export const DEFAULT_CONFIG = {
    clothPrice: 1000000,
    clothCount: 40,
    clothBudget: 1000,      // BÃ¼tÃ§e modu iÃ§in kumaÅŸ
    targetGrade: 25,
    simCount: 5000,
    mode: 'target',          // 'target' veya 'budget'
    absorptionCap: 25,       // Sunucu emiÅŸ sÄ±nÄ±rÄ± (hardcap)
    rates: {
        grade1: 90,
        grade2: 80,
        grade3: 70,
        upgrade: 50
    }
};

// ============================================================================
// HELPER FUNCTIONS
// ============================================================================

export const formatCurrency = (value) => {
    if (value === undefined || value === null || isNaN(value)) return "0";
    if (value >= 1000000000) return `${(value / 1000000000).toFixed(2)}B`;
    if (value >= 1000000) return `${(value / 1000000).toFixed(2)}M`;
    if (value >= 1000) return `${(value / 1000).toFixed(1)}K`;
    return Math.round(value).toLocaleString("tr-TR");
};

export const formatDate = (timestamp) => {
    const date = new Date(timestamp);
    return date.toLocaleString("tr-TR", {
        day: "2-digit",
        month: "2-digit",
        hour: "2-digit",
        minute: "2-digit"
    });
};

==================================================
DOSYA YOLU: .\app\components\widgets\simulators\sash\SashConfig.js
==================================================
"use client";

import {
    Calculator,
    Loader2,
    ChevronDown,
    Coins,
    Target,
    Layers,
    Settings,
    Percent
} from "lucide-react";
import SmartInput from "@/app/components/ui/SmartInput";
import { TARGET_GRADES, formatCurrency } from "./constants";

// ============================================================================
// SASH CONFIG PANEL
// ============================================================================

export default function SashConfig({
    // State
    config,
    // Handlers
    onConfigChange,
    onRateChange,
    // Actions
    onSimulate,
    isRunning,
    progress
}) {
    return (
        <div className="space-y-4">
            <h3 className="text-sm font-semibold text-zinc-400 flex items-center gap-2">
                <Target className="w-4 h-4" />
                Parametreler
            </h3>

            {/* KumaÅŸ FiyatÄ± */}
            <div className="bg-zinc-900/50 p-4 rounded-xl border border-zinc-800">
                <label className="block text-xs font-medium text-zinc-400 mb-2">
                    KumaÅŸ FiyatÄ± (Yang)
                </label>
                <div className="flex items-center gap-2">
                    <Coins className="w-4 h-4 text-yellow-500" />
                    <SmartInput
                        value={config.clothPrice}
                        onChange={(val) => onConfigChange("clothPrice", val)}
                        min={0}
                        step={100000}
                        className="flex-1 px-3 py-2 text-lg font-mono font-semibold text-white bg-zinc-950 border border-zinc-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-violet-500/30 focus:border-violet-500/50"
                        placeholder="1000000"
                    />
                </div>
                <p className="text-xs text-zinc-600 mt-2">
                    FormatlÄ±: {formatCurrency(config.clothPrice)} Yang
                </p>
            </div>

            {/* Gereken KumaÅŸ Adedi */}
            <div className="bg-zinc-900/50 p-4 rounded-xl border border-zinc-800">
                <label className="block text-xs font-medium text-zinc-400 mb-2">
                    Gereken KumaÅŸ (Adet)
                </label>
                <div className="flex items-center gap-2">
                    <Layers className="w-4 h-4 text-orange-500" />
                    <SmartInput
                        value={config.clothCount}
                        onChange={(val) => onConfigChange("clothCount", val)}
                        min={1}
                        max={100}
                        step={1}
                        className="flex-1 px-3 py-2 text-lg font-mono font-semibold text-white bg-zinc-950 border border-zinc-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500/30 focus:border-orange-500/50"
                        placeholder="40"
                    />
                </div>
                <p className="text-xs text-zinc-600 mt-2">
                    1 adet %1 kuÅŸak iÃ§in kaÃ§ kumaÅŸ lazÄ±m? (PvP: 1, Normal: 40)
                </p>
            </div>

            {/* Mode Selection */}
            <div className="bg-zinc-900/50 p-4 rounded-xl border border-zinc-800">
                <label className="block text-xs font-medium text-zinc-400 mb-3">
                    SimÃ¼lasyon Modu
                </label>
                <div className="grid grid-cols-2 gap-2">
                    <button
                        onClick={() => onConfigChange("mode", "target")}
                        className={`
                            p-3 rounded-lg border text-sm font-medium transition-all
                            ${config.mode === 'target'
                                ? 'bg-violet-500/20 border-violet-500/50 text-violet-300'
                                : 'bg-zinc-900 border-zinc-700 text-zinc-400 hover:border-zinc-600'
                            }
                        `}
                    >
                        <Target className="w-4 h-4 mx-auto mb-1" />
                        Hedefe UlaÅŸ
                    </button>
                    <button
                        onClick={() => onConfigChange("mode", "budget")}
                        className={`
                            p-3 rounded-lg border text-sm font-medium transition-all
                            ${config.mode === 'budget'
                                ? 'bg-orange-500/20 border-orange-500/50 text-orange-300'
                                : 'bg-zinc-900 border-zinc-700 text-zinc-400 hover:border-zinc-600'
                            }
                        `}
                    >
                        <Layers className="w-4 h-4 mx-auto mb-1" />
                        BÃ¼tÃ§e ile Dene
                    </button>
                </div>
                <p className="text-xs text-zinc-600 mt-2">
                    {config.mode === 'target'
                        ? 'Hedef emiÅŸe ulaÅŸmak iÃ§in gereken maliyet'
                        : 'Mevcut kumaÅŸla elde edilebilecek emiÅŸ'
                    }
                </p>
            </div>

            {/* Budget Mode Inputs */}
            {config.mode === 'budget' && (
                <div className="space-y-3">
                    {/* KumaÅŸ BÃ¼tÃ§esi */}
                    <div className="bg-orange-900/20 p-4 rounded-xl border border-orange-500/30">
                        <label className="block text-xs font-medium text-orange-300 mb-2">
                            Mevcut KumaÅŸ BÃ¼tÃ§esi (Adet)
                        </label>
                        <div className="flex items-center gap-2">
                            <Layers className="w-4 h-4 text-orange-400" />
                            <SmartInput
                                value={config.clothBudget}
                                onChange={(val) => onConfigChange("clothBudget", val)}
                                min={1}
                                className="flex-1 px-3 py-2 text-lg font-mono font-semibold text-white bg-zinc-950 border border-orange-500/50 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500/30"
                                placeholder="1000"
                            />
                        </div>
                        <p className="text-xs text-orange-400/70 mt-2">
                            Bu kadar kumaÅŸla kaÃ§ emiÅŸ yapabilirsin?
                        </p>
                    </div>
                    {/* EmiÅŸ SÄ±nÄ±rÄ± (Hardcap) */}
                    <div className="bg-red-900/20 p-4 rounded-xl border border-red-500/30">
                        <label className="block text-xs font-medium text-red-300 mb-2">
                            Maks. EmiÅŸ SÄ±nÄ±rÄ± (Sunucu Cap)
                        </label>
                        <div className="flex items-center gap-2">
                            <Target className="w-4 h-4 text-red-400" />
                            <SmartInput
                                value={config.absorptionCap}
                                onChange={(val) => onConfigChange("absorptionCap", val)}
                                min={1}
                                max={100}
                                className="flex-1 px-3 py-2 text-lg font-mono font-semibold text-white bg-zinc-950 border border-red-500/50 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500/30"
                                placeholder="25"
                            />
                            <span className="text-red-400 font-bold">%</span>
                        </div>
                        <p className="text-xs text-red-400/70 mt-2">
                            Sunucunun izin verdiÄŸi maksimum emiÅŸ (Ã¶rn: %25 veya %30)
                        </p>
                    </div>
                </div>
            )}

            {/* Target Mode - Target Grade Selection */}
            {config.mode === 'target' && (
                <div className="bg-zinc-900/50 p-4 rounded-xl border border-zinc-800">
                    <label className="block text-xs font-medium text-zinc-400 mb-2">
                        Hedef EmiÅŸ OranÄ±
                    </label>
                    <div className="relative">
                        <select
                            value={config.targetGrade}
                            onChange={(e) => onConfigChange("targetGrade", parseInt(e.target.value))}
                            className="w-full px-3 py-2.5 text-white bg-zinc-950 border border-zinc-700 rounded-lg appearance-none focus:outline-none focus:ring-2 focus:ring-violet-500/30 focus:border-violet-500/50 cursor-pointer"
                        >
                            {TARGET_GRADES.map(grade => (
                                <option key={grade.value} value={grade.value}>
                                    {grade.label}
                                </option>
                            ))}
                        </select>
                        <ChevronDown className="absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-zinc-500 pointer-events-none" />
                    </div>
                </div>
            )}

            {/* Simulation Count */}
            <div className="bg-zinc-900/50 p-4 rounded-xl border border-zinc-800">
                <label className="block text-xs font-medium text-zinc-400 mb-2">
                    SimÃ¼lasyon SayÄ±sÄ±: <span className="text-white font-mono">{config.simCount?.toLocaleString() || 5000}</span>
                </label>
                <input
                    type="range"
                    min={1000}
                    max={50000}
                    step={1000}
                    value={config.simCount}
                    onChange={(e) => onConfigChange("simCount", parseInt(e.target.value))}
                    className="w-full h-2 bg-zinc-800 rounded-lg appearance-none cursor-pointer accent-violet-500"
                />
                <div className="flex justify-between text-xs text-zinc-600 mt-1">
                    <span>1K</span>
                    <span>25K</span>
                    <span>50K</span>
                </div>
            </div>

            {/* Advanced Settings - Accordion */}
            <details className="bg-zinc-900/50 rounded-xl border border-zinc-800 group">
                <summary className="p-4 cursor-pointer list-none flex items-center justify-between hover:bg-zinc-800/30 transition-colors rounded-xl">
                    <div className="flex items-center gap-2">
                        <Settings className="w-4 h-4 text-zinc-500" />
                        <span className="text-xs font-medium text-zinc-400">Åans OranlarÄ± (%)</span>
                    </div>
                    <ChevronDown className="w-4 h-4 text-zinc-500 transition-transform group-open:rotate-180" />
                </summary>
                <div className="p-4 pt-0 space-y-3">
                    {/* 1 -> 5 Rate */}
                    <div className="flex items-center gap-3">
                        <div className="flex-1">
                            <label className="block text-xs text-zinc-500 mb-1">1 â 5</label>
                            <SmartInput
                                value={config.rates?.grade1 ?? 90}
                                onChange={(val) => onRateChange("grade1", val)}
                                min={1}
                                max={100}
                                step={1}
                                className="w-full px-2 py-1.5 text-sm font-mono text-white bg-zinc-950 border border-zinc-700 rounded-lg focus:outline-none focus:ring-1 focus:ring-violet-500/30"
                            />
                        </div>
                        <Percent className="w-4 h-4 text-zinc-600" />
                    </div>
                    {/* 5 -> 10 Rate */}
                    <div className="flex items-center gap-3">
                        <div className="flex-1">
                            <label className="block text-xs text-zinc-500 mb-1">5 â 10</label>
                            <SmartInput
                                value={config.rates?.grade2 ?? 80}
                                onChange={(val) => onRateChange("grade2", val)}
                                min={1}
                                max={100}
                                step={1}
                                className="w-full px-2 py-1.5 text-sm font-mono text-white bg-zinc-950 border border-zinc-700 rounded-lg focus:outline-none focus:ring-1 focus:ring-violet-500/30"
                            />
                        </div>
                        <Percent className="w-4 h-4 text-zinc-600" />
                    </div>
                    {/* 10 -> Hakim Rate */}
                    <div className="flex items-center gap-3">
                        <div className="flex-1">
                            <label className="block text-xs text-zinc-500 mb-1">10 â Hakim</label>
                            <SmartInput
                                value={config.rates?.grade3 ?? 70}
                                onChange={(val) => onRateChange("grade3", val)}
                                min={1}
                                max={100}
                                step={1}
                                className="w-full px-2 py-1.5 text-sm font-mono text-white bg-zinc-950 border border-zinc-700 rounded-lg focus:outline-none focus:ring-1 focus:ring-violet-500/30"
                            />
                        </div>
                        <Percent className="w-4 h-4 text-zinc-600" />
                    </div>
                    {/* Upgrade Rate */}
                    <div className="flex items-center gap-3">
                        <div className="flex-1">
                            <label className="block text-xs text-zinc-500 mb-1">EmiÅŸ Upgrade</label>
                            <SmartInput
                                value={config.rates?.upgrade ?? 50}
                                onChange={(val) => onRateChange("upgrade", val)}
                                min={1}
                                max={100}
                                step={1}
                                className="w-full px-2 py-1.5 text-sm font-mono text-white bg-zinc-950 border border-zinc-700 rounded-lg focus:outline-none focus:ring-1 focus:ring-violet-500/30"
                            />
                        </div>
                        <Percent className="w-4 h-4 text-zinc-600" />
                    </div>
                </div>
            </details>

            {/* Simulate Button */}
            <button
                onClick={onSimulate}
                disabled={isRunning}
                className={`
                    w-full flex items-center justify-center gap-2 py-3 rounded-xl font-semibold transition-all duration-200
                    ${isRunning
                        ? "bg-zinc-800 text-zinc-500 cursor-not-allowed"
                        : "bg-gradient-to-r from-violet-600 to-purple-600 hover:from-violet-500 hover:to-purple-500 text-white shadow-lg shadow-violet-900/30"
                    }
                `}
            >
                {isRunning ? (
                    <>
                        <Loader2 className="w-5 h-5 animate-spin" />
                        HesaplanÄ±yor... {progress}%
                    </>
                ) : (
                    <>
                        <Calculator className="w-5 h-5" />
                        SimÃ¼lasyonu BaÅŸlat
                    </>
                )}
            </button>

            {/* Progress Bar */}
            {isRunning && (
                <div className="w-full h-2 bg-zinc-800 rounded-full overflow-hidden">
                    <div
                        className="h-full bg-gradient-to-r from-violet-500 to-purple-500 transition-all duration-300"
                        style={{ width: `${progress}%` }}
                    />
                </div>
            )}
        </div>
    );
}

==================================================
DOSYA YOLU: .\app\components\widgets\simulators\sash\SashResults.js
==================================================
"use client";

import { useMemo } from "react";
import {
    Calculator,
    TrendingUp,
    History,
    RotateCcw,
    Trash2,
    Sparkles,
    Target,
    BarChart3
} from "lucide-react";
import {
    XAxis,
    YAxis,
    CartesianGrid,
    Tooltip,
    ResponsiveContainer,
    Area,
    AreaChart
} from "recharts";
import { formatCurrency, formatDate } from "./constants";

// ============================================================================
// SUB-COMPONENTS
// ============================================================================

function ResultCard({ title, value, subtitle, icon: Icon, color = "violet" }) {
    const colorClasses = {
        violet: "from-violet-500/20 to-violet-500/5 border-violet-500/30 text-violet-400",
        green: "from-green-500/20 to-green-500/5 border-green-500/30 text-green-400",
        red: "from-red-500/20 to-red-500/5 border-red-500/30 text-red-400",
        blue: "from-blue-500/20 to-blue-500/5 border-blue-500/30 text-blue-400"
    };

    return (
        <div className={`
            bg-gradient-to-br ${colorClasses[color]}
            rounded-xl border p-4
        `}>
            <div className="flex items-center gap-2 mb-2">
                {Icon && <Icon className="w-4 h-4" />}
                <span className="text-xs font-medium text-zinc-400">{title}</span>
            </div>
            <p className="text-2xl font-bold text-white font-mono">{value}</p>
            {subtitle && (
                <p className="text-xs text-zinc-500 mt-1">{subtitle}</p>
            )}
        </div>
    );
}

function HistoryItem({ item, onRestore, onDelete }) {
    return (
        <div className="flex items-center gap-3 p-3 bg-zinc-900/50 rounded-lg border border-zinc-800 hover:border-zinc-700 transition-colors group">
            <div className="flex-1 min-w-0">
                <div className="flex items-center gap-2">
                    <span className="text-sm font-mono font-semibold text-white">
                        {formatCurrency(item.result.avgCost || item.result.avgGrade)}
                    </span>
                    <span className="text-xs text-zinc-500">{item.config.mode === 'budget' ? '% EmiÅŸ' : 'Yang'}</span>
                </div>
                <div className="flex items-center gap-2 mt-1">
                    <span className="text-xs text-zinc-500">{formatDate(item.date)}</span>
                    <span className="text-xs text-zinc-600">â€¢</span>
                    <span className="text-xs text-zinc-500">%{item.config.targetGrade}</span>
                </div>
            </div>
            <div className="flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                <button
                    onClick={() => onRestore(item)}
                    className="p-1.5 rounded-md bg-violet-500/10 text-violet-400 hover:bg-violet-500/20 transition-colors"
                    title="Geri YÃ¼kle"
                >
                    <RotateCcw className="w-3.5 h-3.5" />
                </button>
                <button
                    onClick={() => onDelete(item.id)}
                    className="p-1.5 rounded-md bg-red-500/10 text-red-400 hover:bg-red-500/20 transition-colors"
                    title="Sil"
                >
                    <Trash2 className="w-3.5 h-3.5" />
                </button>
            </div>
        </div>
    );
}

// ============================================================================
// MAIN RESULTS PANEL
// ============================================================================

export default function SashResults({
    result,
    history,
    showHistory,
    onRestore,
    onDeleteHistory,
    onClearHistory
}) {
    // Calculate chart data from history
    const chartData = useMemo(() => {
        return history.map((item, index) => ({
            name: `#${index + 1}`,
            cost: item.result.avgCost,
            min: item.result.minCost,
            max: item.result.maxCost
        })).slice(-20); // Last 20 records
    }, [history]);

    return (
        <div className="space-y-4">
            <h3 className="text-sm font-semibold text-zinc-400 flex items-center gap-2">
                <BarChart3 className="w-4 h-4" />
                SonuÃ§lar
            </h3>

            {/* Result Cards */}
            {result ? (
                <>
                    {/* TARGET MODE RESULTS */}
                    {result.mode !== 'budget' && (
                        <div className="grid grid-cols-2 md:grid-cols-4 gap-3">
                            <ResultCard
                                title="Ortalama Maliyet"
                                value={formatCurrency(result.avgCost)}
                                subtitle="Yang"
                                icon={TrendingUp}
                                color="violet"
                            />
                            <ResultCard
                                title="Minimum"
                                value={formatCurrency(result.minCost)}
                                subtitle="En iyi senaryo"
                                icon={TrendingUp}
                                color="green"
                            />
                            <ResultCard
                                title="Maksimum"
                                value={formatCurrency(result.maxCost)}
                                subtitle="En kÃ¶tÃ¼ senaryo"
                                icon={TrendingUp}
                                color="red"
                            />
                            <ResultCard
                                title="Ort. KumaÅŸ"
                                value={result.totalClothUsed?.toLocaleString() || "0"}
                                subtitle="Adet kullanÄ±m"
                                icon={Sparkles}
                                color="blue"
                            />
                        </div>
                    )}

                    {/* BUDGET MODE RESULTS */}
                    {result.mode === 'budget' && (
                        <div className="space-y-4">
                            <div className="grid grid-cols-2 md:grid-cols-3 gap-3">
                                <ResultCard
                                    title="Ortalama EmiÅŸ"
                                    value={`%${result.avgGrade}`}
                                    subtitle="Beklenen sonuÃ§"
                                    icon={Target}
                                    color="violet"
                                />
                                <ResultCard
                                    title="Maksimum EmiÅŸ"
                                    value={`%${result.maxGrade}`}
                                    subtitle="En iyi senaryo"
                                    icon={TrendingUp}
                                    color="green"
                                />
                                <ResultCard
                                    title="Minimum EmiÅŸ"
                                    value={`%${result.minGrade}`}
                                    subtitle="En kÃ¶tÃ¼ senaryo"
                                    icon={TrendingUp}
                                    color="red"
                                />
                            </div>

                            {/* Grade Distribution */}
                            {result.gradeDistribution && Object.keys(result.gradeDistribution).length > 0 && (
                                <div className="bg-zinc-900/50 p-4 rounded-xl border border-zinc-800">
                                    <h4 className="text-sm font-semibold text-zinc-400 mb-3">EmiÅŸ DaÄŸÄ±lÄ±mÄ±</h4>
                                    <div className="grid grid-cols-3 md:grid-cols-5 gap-2">
                                        {Object.entries(result.gradeDistribution)
                                            .sort((a, b) => parseInt(b[0]) - parseInt(a[0]))
                                            .filter(([, data]) => parseFloat(data.percentage) > 0)
                                            .map(([grade, data]) => (
                                                <div key={grade} className="text-center p-2 bg-zinc-800/50 rounded-lg">
                                                    <div className="text-lg font-bold text-white">%{grade}</div>
                                                    <div className="text-xs text-zinc-500">{data.percentage}%</div>
                                                </div>
                                            ))
                                        }
                                    </div>
                                </div>
                            )}
                        </div>
                    )}
                </>
            ) : (
                /* Empty State */
                <div className="bg-zinc-900/30 rounded-xl border border-zinc-800 p-8 text-center">
                    <Calculator className="w-12 h-12 text-zinc-700 mx-auto mb-3" />
                    <p className="text-zinc-500">
                        SimÃ¼lasyonu baÅŸlatmak iÃ§in parametreleri ayarlayÄ±n ve
                        <br />
                        <span className="text-violet-400">"SimÃ¼lasyonu BaÅŸlat"</span> butonuna tÄ±klayÄ±n.
                    </p>
                </div>
            )}

            {/* Chart + History Section */}
            {showHistory && history.length > 0 && (
                <div className="grid grid-cols-1 lg:grid-cols-2 gap-4 mt-6">
                    {/* Chart */}
                    <div className="bg-zinc-900/50 rounded-xl border border-zinc-800 p-4">
                        <h4 className="text-sm font-semibold text-zinc-400 mb-4">
                            Maliyet Trendi
                        </h4>
                        <div className="h-48">
                            <ResponsiveContainer width="100%" height="100%">
                                <AreaChart data={chartData}>
                                    <defs>
                                        <linearGradient id="colorCost" x1="0" y1="0" x2="0" y2="1">
                                            <stop offset="5%" stopColor="#8b5cf6" stopOpacity={0.3} />
                                            <stop offset="95%" stopColor="#8b5cf6" stopOpacity={0} />
                                        </linearGradient>
                                    </defs>
                                    <CartesianGrid strokeDasharray="3 3" stroke="#27272a" />
                                    <XAxis
                                        dataKey="name"
                                        tick={{ fill: '#71717a', fontSize: 10 }}
                                        axisLine={{ stroke: '#3f3f46' }}
                                    />
                                    <YAxis
                                        tick={{ fill: '#71717a', fontSize: 10 }}
                                        axisLine={{ stroke: '#3f3f46' }}
                                        tickFormatter={formatCurrency}
                                    />
                                    <Tooltip
                                        contentStyle={{
                                            backgroundColor: '#18181b',
                                            border: '1px solid #3f3f46',
                                            borderRadius: '8px',
                                            fontSize: '12px'
                                        }}
                                        formatter={(value) => [formatCurrency(value) + " Yang", "Maliyet"]}
                                    />
                                    <Area
                                        type="monotone"
                                        dataKey="cost"
                                        stroke="#8b5cf6"
                                        strokeWidth={2}
                                        fillOpacity={1}
                                        fill="url(#colorCost)"
                                    />
                                </AreaChart>
                            </ResponsiveContainer>
                        </div>
                    </div>

                    {/* History List */}
                    <div className="bg-zinc-900/50 rounded-xl border border-zinc-800 p-4 flex flex-col">
                        <div className="flex items-center justify-between mb-3">
                            <h4 className="text-sm font-semibold text-zinc-400">
                                GeÃ§miÅŸ ({history.length})
                            </h4>
                            {history.length > 0 && (
                                <button
                                    onClick={onClearHistory}
                                    className="text-xs text-red-400 hover:text-red-300 transition-colors"
                                >
                                    TÃ¼mÃ¼nÃ¼ Sil
                                </button>
                            )}
                        </div>
                        <div className="flex-1 overflow-y-auto space-y-2 max-h-48 custom-scrollbar">
                            {history.slice(0, 10).map(item => (
                                <HistoryItem
                                    key={item.id}
                                    item={item}
                                    onRestore={onRestore}
                                    onDelete={onDeleteHistory}
                                />
                            ))}
                        </div>
                    </div>
                </div>
            )}

            {/* Empty History State */}
            {showHistory && history.length === 0 && (
                <div className="bg-zinc-900/30 rounded-xl border border-zinc-800 p-6 text-center mt-4">
                    <History className="w-10 h-10 text-zinc-700 mx-auto mb-2" />
                    <p className="text-sm text-zinc-500">
                        HenÃ¼z simÃ¼lasyon geÃ§miÅŸi yok.
                    </p>
                </div>
            )}
        </div>
    );
}

// Export sub-components for external use if needed
export { ResultCard, HistoryItem };

==================================================
DOSYA YOLU: .\app\data\initialData.js
==================================================
/**
 * ============================================================================
 * INITIAL DATA - ZERO STATE
 * ============================================================================
 * KullanÄ±cÄ± kendi verisini gireceÄŸi iÃ§in tÃ¼m hazÄ±r listeler temizlendi.
 */

// 1. MASTER REGISTRY (Global Sabit Katalog - BOÅ)
export const MASTER_REGISTRY = {
  items: [],          // Market bomboÅŸ
  metinTemplates: []  // Metin listesi bomboÅŸ
};

// 2. SERVER CONFIGURATIONS (BaÅŸlangÄ±Ã§ Profili - BOÅ)
export const INITIAL_SERVERS = [
  {
    id: "default_server",
    name: "Sunucum",
    currency: "Won",
    prices: {},       // Fiyatlar boÅŸ
    multipliers: { drop: 1.0, yang: 1.0 }
  }
];

==================================================
DOSYA YOLU: .\app\hooks\useCraftingSync.js
==================================================
import { useEffect } from 'react';
import useWidgetStore from '../store/useWidgetStore';
import { useSharedWidgetData } from './useSharedWidgetData';

/**
 * Helper: Circular Dependency Check (DFS)
 * Checks if adding candidateId as a dependency to targetId would create a cycle.
 */
export const hasCircularDependency = (candidateId, targetId, allItems, visited = new Set()) => {
    if (candidateId === targetId) return true;
    if (visited.has(candidateId)) return false;

    visited.add(candidateId);
    const candidateItem = allItems.find(i => i.id === candidateId);
    if (!candidateItem || !candidateItem.contents) return false;

    return candidateItem.contents.some(content => {
        if (content.sourceType === 'crafting') {
            return hasCircularDependency(content.itemId, targetId, allItems, visited);
        }
        return false;
    });
};

/**
 * Hook to sync crafting item costs with market prices.
 * Calculates the cost of crafted items based on their recipe/contents and updates the market store.
 *
 * FEATURES:
 * - Supports Recipes, Containers, and Fragments.
 * - Prevents Infinite Loops: Only updates the store if pricing actually changes.
 */
export const useCraftingSync = () => {
    // Shared Data Hooks
    const { metinList, marketItems } = useSharedWidgetData();
    const craftingItems = useWidgetStore((state) => state.craftingItems);
    const syncCraftedItems = useWidgetStore((state) => state.syncCraftedItems);

    useEffect(() => {
        if (!craftingItems.length) return;

        const updates = [];

        craftingItems.forEach(item => {
            let calculatedCost = 0;

            if (item.type === 'recipe' && item.contents) {
                // ReÃ§ete: Ä°Ã§eriklerin toplamÄ±
                calculatedCost = item.contents.reduce((total, content) => {
                    const ingredient = marketItems.find(i => i.id === content.itemId || i.originalId === content.itemId);
                    const price = ingredient ? ingredient.price : 0;
                    return total + (price * content.count);
                }, 0);
            }
            else if (item.type === 'fragment' && item.targetId) {
                // ParÃ§a: Hedef item / Adet
                if (item.targetType === 'metin') {
                    const metin = metinList.find(m => m.id === item.targetId);
                    if (metin) {
                        const totalDropValue = metin.drops.reduce((acc, drop) => {
                            const dropItem = marketItems.find(i => i.id === drop.itemId || i.originalId === drop.itemId);
                            const price = dropItem ? dropItem.price : 0;
                            const count = drop.minCount ? (drop.minCount + drop.maxCount) / 2 : drop.count;
                            return acc + (price * count * (drop.chance / 100));
                        }, 0);
                        calculatedCost = totalDropValue / (item.amount || 1);
                    }
                } else {
                    const target = marketItems.find(i => i.id === item.targetId || i.originalId === item.targetId);
                    const targetPrice = target ? target.price : 0;
                    const amount = item.amount || 1;
                    calculatedCost = targetPrice / amount;
                }
            }
            else if (item.type === 'container' && item.contents) {
                // SandÄ±k: Beklenen DeÄŸer (Expected Value)
                calculatedCost = item.contents.reduce((total, content) => {
                    const dropItem = marketItems.find(i => i.id === content.itemId || i.originalId === content.itemId);
                    const price = dropItem ? dropItem.price : 0;
                    const chance = (content.chance || 0) / 100;
                    return total + (price * content.count * chance);
                }, 0);
            }

            // Check if price is significantly different from current market price
            // to avoid infinite loops and unnecessary updates.
            const currentPluginItem = marketItems.find(i => i.id === item.id);
            const currentPrice = currentPluginItem ? currentPluginItem.price : 0;

            // Use a small epsilon for float comparison if needed, or strict equality since we calculate direct sums
            if (Math.abs(calculatedCost - currentPrice) > 0.01) {
                updates.push({
                    id: item.id,
                    name: item.name,
                    price: calculatedCost
                });
            }
        });

        // Only dispatch if there are actual changes
        if (updates.length > 0) {
            // console.log("Syncing Crafting Prices:", updates.length, "items updated.");
            syncCraftedItems(updates);
        }

    }, [craftingItems, marketItems, metinList, syncCraftedItems]);
};

==================================================
DOSYA YOLU: .\app\hooks\usePersistentState.js
==================================================
"use client";

import { useState, useEffect, useCallback } from "react";

/**
 * usePersistentState - SSR-uyumlu localStorage hook
 *
 * Ã–zellikler:
 * - Server-side rendering'de hata vermez (window check)
 * - Ä°lk mount'ta localStorage'dan okur
 * - Her deÄŸiÅŸiklikte otomatik kaydeder
 * - JSON serialize/deserialize desteÄŸi
 *
 * @param {string} key - localStorage key
 * @param {any} defaultValue - VarsayÄ±lan deÄŸer
 * @returns {[any, Function]} - [state, setState]
 */
export function usePersistentState(key, defaultValue) {
    // Ä°lk deÄŸer olarak defaultValue kullan (SSR iÃ§in gÃ¼venli)
    const [state, setState] = useState(defaultValue);
    const [isHydrated, setIsHydrated] = useState(false);

    // Client tarafÄ±nda localStorage'dan oku (hydration sonrasÄ±)
    useEffect(() => {
        if (typeof window === "undefined") return;

        try {
            const stored = localStorage.getItem(key);
            if (stored !== null) {
                const parsed = JSON.parse(stored);
                setState(parsed);
            }
        } catch (error) {
            console.warn(`[usePersistentState] Error reading key "${key}":`, error);
        }

        setIsHydrated(true);
    }, [key]);

    // DeÄŸer deÄŸiÅŸince localStorage'a yaz
    useEffect(() => {
        if (!isHydrated) return;
        if (typeof window === "undefined") return;

        try {
            localStorage.setItem(key, JSON.stringify(state));
        } catch (error) {
            console.warn(`[usePersistentState] Error saving key "${key}":`, error);
        }
    }, [key, state, isHydrated]);

    // Setter wrapper - fonksiyon veya deÄŸer kabul eder
    const setPersistentState = useCallback((valueOrUpdater) => {
        setState((prev) => {
            if (typeof valueOrUpdater === "function") {
                return valueOrUpdater(prev);
            }
            return valueOrUpdater;
        });
    }, []);

    return [state, setPersistentState];
}

export default usePersistentState;

==================================================
DOSYA YOLU: .\app\hooks\useSharedWidgetData.js
==================================================
import { useMemo } from "react";
import useWidgetStore from "../store/useWidgetStore";
import { MASTER_REGISTRY } from "../data/initialData";
import { mergeMarketData } from "../lib/marketUtils";

/**
 * Merkezi veri paylaÅŸÄ±m hook'u
 * TÃ¼m widget'lara ortak veri saÄŸlar
 *
 * YENÄ° MÄ°MARÄ°: Veriler workspace.data objesinden okunur
 */
export function useSharedWidgetData() {
    // 1. Global Store Verileri
    const activeWorkspaceId = useWidgetStore((state) => state.activeWorkspaceId);
    const workspaces = useWidgetStore((state) => state.workspaces);
    const activeServerId = useWidgetStore((state) => state.activeServerId);
    const serverProfiles = useWidgetStore((state) => state.serverProfiles);
    const itemRegistry = useWidgetStore((state) => state.masterRegistry);
    const craftingItems = useWidgetStore((state) => state.craftingItems) || [];
    const bosses = useWidgetStore((state) => state.bosses) || [];

    // 2. Aktif Sunucu FiyatlarÄ±nÄ± Bul
    const activeProfile = serverProfiles.find(p => p.id === activeServerId);
    const prices = activeProfile?.prices || {};
    const multipliers = activeProfile?.multipliers || { drop: 1.0 };

    // 3. Aktif Workspace'i Bul
    const activeWorkspace = workspaces.find((ws) => ws.id === activeWorkspaceId);
    const workspaceData = activeWorkspace?.data || {};

    // 4. Karakter Verilerini Al (Yeni workspace.data yapÄ±sÄ±ndan)
    // Birden fazla olasÄ± key'i kontrol et (eski ve yeni)
    const characterData =
        workspaceData.characterStats ||      // Yeni key (DashboardContent'ten)
        workspaceData['character-settings'] || // Alternatif key
        workspaceData['character-stats'] ||    // Alternatif key
        null;

    const userStats = characterData || {
        damage: 3000,
        hitsPerSecond: 2.5,
        findTime: 10
    };

    // 5. Metin Listesini Al (Yeni workspace.data yapÄ±sÄ±ndan)
    // Ä°mport iÅŸlemi metinSettings.metins'e kaydediyor
    const metinData = workspaceData.metinSettings?.metins;
    const metinList = (metinData && metinData.length > 0)
        ? metinData
        : MASTER_REGISTRY.metinTemplates;

    // 6. Market BirleÅŸtirme
    const marketItems = useMemo(() => {
        return mergeMarketData(itemRegistry, prices);
    }, [itemRegistry, prices]);

    // 7. Hepsini Paketle
    return {
        userStats,
        metinList,
        marketItems,
        craftingItems,
        prices,
        multipliers,
        bosses,
        // Debug iÃ§in workspace data'ya eriÅŸim
        workspaceData
    };
}


==================================================
DOSYA YOLU: .\app\hooks\useWorker.js
==================================================
"use client";

import { useState, useEffect, useRef, useCallback } from "react";

/**
 * useWorker - Web Worker yÃ¶netim hook'u
 *
 * Ã–zellikler:
 * - Worker instance yaÅŸam dÃ¶ngÃ¼sÃ¼ yÃ¶netimi
 * - postMessage ile veri gÃ¶nderme
 * - onmessage ile sonuÃ§ dinleme
 * - Progress tracking desteÄŸi
 * - Component unmount'ta otomatik terminate (memory leak Ã¶nlemi)
 *
 * @param {string} workerPath - Worker dosyasÄ±nÄ±n public path'i (Ã¶rn: "/workers/sash.worker.js")
 * @returns {{ run: Function, status: string, result: any, progress: number, error: string|null }}
 */
export function useWorker(workerPath) {
    const workerRef = useRef(null);
    const [status, setStatus] = useState("idle"); // idle | running | complete | error
    const [result, setResult] = useState(null);
    const [progress, setProgress] = useState(0);
    const [error, setError] = useState(null);

    // Worker'Ä± baÅŸlat ve cleanup yap
    useEffect(() => {
        // SSR kontrolÃ¼
        if (typeof window === "undefined") return;

        try {
            workerRef.current = new Worker(workerPath);

            // Message handler
            workerRef.current.onmessage = (e) => {
                const { type, ...data } = e.data;

                switch (type) {
                    case "progress":
                        setProgress(data.progress || 0);
                        break;
                    case "complete":
                        setResult(data);
                        setStatus("complete");
                        setProgress(100);
                        break;
                    case "error":
                        setError(data.message || "Unknown error");
                        setStatus("error");
                        break;
                    default:
                        // Bilinmeyen mesaj tipi, result olarak kaydet
                        setResult(data);
                }
            };

            // Error handler
            workerRef.current.onerror = (e) => {
                console.error("[useWorker] Worker error:", e);
                setError(e.message || "Worker error occurred");
                setStatus("error");
            };
        } catch (err) {
            console.error("[useWorker] Failed to create worker:", err);
            setError("Failed to initialize worker");
            setStatus("error");
        }

        // Cleanup: Component unmount olunca worker'Ä± kapat
        return () => {
            if (workerRef.current) {
                workerRef.current.terminate();
                workerRef.current = null;
            }
        };
    }, [workerPath]);

    // Worker'a mesaj gÃ¶nder ve simÃ¼lasyonu baÅŸlat
    const run = useCallback((payload) => {
        if (!workerRef.current) {
            setError("Worker not initialized");
            setStatus("error");
            return;
        }

        // State'leri sÄ±fÄ±rla
        setStatus("running");
        setProgress(0);
        setResult(null);
        setError(null);

        // Worker'a veri gÃ¶nder
        workerRef.current.postMessage(payload);
    }, []);

    // State'leri sÄ±fÄ±rla
    const reset = useCallback(() => {
        setStatus("idle");
        setProgress(0);
        setResult(null);
        setError(null);
    }, []);

    return {
        run,
        reset,
        status,
        result,
        progress,
        error,
        isRunning: status === "running",
        isComplete: status === "complete",
        isError: status === "error"
    };
}

export default useWorker;

==================================================
DOSYA YOLU: .\app\lib\calculator.js
==================================================
/**
 * METIN2 CALCULATOR LIBRARY (BARREL FILE)
 * ---------------------------------------
 * Bu dosya artÄ±k bir "YÃ¶nlendirici"dir.
 * AsÄ±l mantÄ±k 'app/lib/math/' klasÃ¶rÃ¼ndeki alt modÃ¼llerde tutulur.
 */

export * from './math/formatters';
export * from './math/core';
export * from './math/progression';
export * from './math/simulation';

==================================================
DOSYA YOLU: .\app\lib\excelUtils.js
==================================================
/**
 * Excel and JSON Import/Export Utilities
 * Handles file operations for market data and other spreadsheet-based data
 */

import * as XLSX from 'xlsx';
import { generateStableId } from './marketUtils';

/**
 * Column name mappings for Excel export/import
 */
const COLUMN_MAPPINGS = {
    // English to Turkish (for export)
    toTurkish: {
        name: 'EÅŸya AdÄ±',
        price: 'Fiyat',
        originalId: 'ID'
    },
    // Turkish to English (for import)
    toEnglish: {
        'EÅŸya AdÄ±': 'name',
        'Fiyat': 'price',
        'ID': 'originalId'
    }
};

/**
 * Export data to Excel or JSON file
 * @param {Array} data - Array of objects to export
 * @param {string} filename - Name of the file (without extension)
 * @param {string} format - 'excel' or 'json'
 */
export async function exportToFile(data, filename, format = 'excel') {
    try {
        if (!data || data.length === 0) {
            throw new Error('DÄ±ÅŸa aktarÄ±lacak veri bulunamadÄ±.');
        }

        if (format === 'excel') {
            // Convert data to Turkish column names
            const translatedData = data.map(item => {
                const translated = {};
                Object.keys(item).forEach(key => {
                    const turkishKey = COLUMN_MAPPINGS.toTurkish[key] || key;
                    translated[turkishKey] = item[key];
                });
                return translated;
            });

            // Create worksheet
            const worksheet = XLSX.utils.json_to_sheet(translatedData);

            // Auto-size columns
            const maxWidth = 30;
            const colWidths = Object.keys(translatedData[0] || {}).map(key => ({
                wch: Math.min(
                    Math.max(
                        key.length,
                        ...translatedData.map(row => String(row[key] || '').length)
                    ),
                    maxWidth
                )
            }));
            worksheet['!cols'] = colWidths;

            // Create workbook and add worksheet
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, 'Veriler');

            // Generate Excel file and trigger download
            XLSX.writeFile(workbook, `${filename}.xlsx`);

        } else if (format === 'json') {
            // Create JSON blob
            const jsonString = JSON.stringify(data, null, 2);
            const blob = new Blob([jsonString], { type: 'application/json' });

            // Create download link and trigger
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `${filename}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);

        } else {
            throw new Error(`Desteklenmeyen format: ${format}`);
        }

        return { success: true, message: 'Dosya baÅŸarÄ±yla indirildi.' };

    } catch (error) {
        console.error('Export error:', error);
        return { success: false, message: error.message || 'DÄ±ÅŸa aktarma sÄ±rasÄ±nda hata oluÅŸtu.' };
    }
}

/**
 * Parse and import data from Excel or JSON file
 * @param {File} file - File object from input
 * @returns {Promise<Object>} - { success: boolean, data: Array, message: string }
 */
export async function parseImportFile(file) {
    try {
        if (!file) {
            throw new Error('Dosya seÃ§ilmedi.');
        }

        const fileName = file.name.toLowerCase();
        const fileExtension = fileName.split('.').pop();

        if (fileExtension === 'json') {
            // Parse JSON file
            return new Promise((resolve, reject) => {
                const reader = new FileReader();

                reader.onload = (e) => {
                    try {
                        const jsonData = JSON.parse(e.target.result);

                        if (!Array.isArray(jsonData)) {
                            throw new Error('JSON dosyasÄ± bir dizi iÃ§ermelidir.');
                        }

                        resolve({
                            success: true,
                            data: jsonData,
                            message: `${jsonData.length} kayÄ±t baÅŸarÄ±yla yÃ¼klendi.`
                        });
                    } catch (parseError) {
                        reject(new Error('JSON dosyasÄ± okunamadÄ±: ' + parseError.message));
                    }
                };

                reader.onerror = () => {
                    reject(new Error('Dosya okuma hatasÄ±.'));
                };

                reader.readAsText(file);
            });

        } else if (fileExtension === 'xlsx' || fileExtension === 'xls' || fileExtension === 'csv') {
            // Parse Excel/CSV file
            return new Promise((resolve, reject) => {
                const reader = new FileReader();

                reader.onload = (e) => {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });

                        // Get first sheet
                        const firstSheetName = workbook.SheetNames[0];
                        const worksheet = workbook.Sheets[firstSheetName];

                        // Convert to JSON
                        const jsonData = XLSX.utils.sheet_to_json(worksheet);

                        if (jsonData.length === 0) {
                            throw new Error('Excel dosyasÄ± boÅŸ.');
                        }

                        // Map Turkish column names back to English
                        const translatedData = jsonData.map(item => {
                            const translated = {};
                            Object.keys(item).forEach(key => {
                                const englishKey = COLUMN_MAPPINGS.toEnglish[key] || key;
                                translated[englishKey] = item[key];
                            });
                            return translated;
                        });

                        resolve({
                            success: true,
                            data: translatedData,
                            message: `${translatedData.length} kayÄ±t baÅŸarÄ±yla yÃ¼klendi.`
                        });
                    } catch (parseError) {
                        reject(new Error('Excel dosyasÄ± okunamadÄ±: ' + parseError.message));
                    }
                };

                reader.onerror = () => {
                    reject(new Error('Dosya okuma hatasÄ±.'));
                };

                reader.readAsArrayBuffer(file);
            });

        } else {
            throw new Error(`Desteklenmeyen dosya formatÄ±: .${fileExtension}\nSadece .json, .xlsx, .xls veya .csv dosyalarÄ± desteklenir.`);
        }

    } catch (error) {
        console.error('Import error:', error);
        return { success: false, data: [], message: error.message || 'Ä°Ã§e aktarma sÄ±rasÄ±nda hata oluÅŸtu.' };
    }
}

// ============================================================================
// METIN LIST IMPORT/EXPORT
// ============================================================================

/**
 * Export metin list to Excel with flattened drop data
 * @param {Array} metinList - Array of metin objects with drops
 * @param {Array} marketItems - Market items for name lookup
 * @param {string} filename - Name of the file (without extension)
 */
export async function exportMetinsToExcel(metinList, marketItems, filename = 'metin-listesi') {
    try {
        if (!metinList || metinList.length === 0) {
            throw new Error('DÄ±ÅŸa aktarÄ±lacak metin bulunamadÄ±.');
        }

        // Flatten data: one row per drop
        const flattenedData = [];

        metinList.forEach(metin => {
            if (metin.drops && metin.drops.length > 0) {
                metin.drops.forEach(drop => {
                    // Find item name from market items
                    const item = marketItems.find(i => i.originalId === drop.itemId);
                    const itemName = item ? item.name : drop.itemId;

                    flattenedData.push({
                        'Metin AdÄ±': metin.name,
                        'HP': metin.hp,
                        'EÅŸya AdÄ±': itemName,
                        'Adet': drop.count,
                        'Åans': drop.chance
                    });
                });
            } else {
                // Metin with no drops - add one row with empty drop data
                flattenedData.push({
                    'Metin AdÄ±': metin.name,
                    'HP': metin.hp,
                    'EÅŸya AdÄ±': '',
                    'Adet': 0,
                    'Åans': 0
                });
            }
        });

        // Create worksheet
        const worksheet = XLSX.utils.json_to_sheet(flattenedData);

        // Auto-size columns
        const colWidths = [
            { wch: 20 }, // Metin AdÄ±
            { wch: 12 }, // HP
            { wch: 25 }, // EÅŸya AdÄ±
            { wch: 8 },  // Adet
            { wch: 8 }   // Åans
        ];
        worksheet['!cols'] = colWidths;

        // Create workbook and add worksheet
        const workbook = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(workbook, worksheet, 'Metin Listesi');

        // Generate Excel file and trigger download
        XLSX.writeFile(workbook, `${filename}.xlsx`);

        return { success: true, message: 'Metin listesi baÅŸarÄ±yla indirildi.' };

    } catch (error) {
        console.error('Metin export error:', error);
        return { success: false, message: error.message || 'Metin dÄ±ÅŸa aktarma sÄ±rasÄ±nda hata oluÅŸtu.' };
    }
}

// HELPER: Metinleri Sterilize Eden Fonksiyon ğŸ§¼
const sanitizeText = (text) => {
    if (!text) return '';
    return String(text)
        .normalize('NFC')
        .replace(/[\u200B-\u200D\uFEFF]/g, '') // GÃ¶rÃ¼nmez karakterleri sil
        .replace(/\u00A0/g, ' ') // Non-breaking space -> normal space
        .replace(/\s+/g, ' ') // Ã‡ift boÅŸluklarÄ± tek yap
        .trim();
};

// HELPER: Ä°simden Sabit ID Ãœretici (Slugify) - Imported from marketUtils
// function generateStableId(name) { ... }

/**
 * Parse and import metin list from Excel or JSON file
 * Groups rows by metin name and detects new items
 * @param {File} file - File object from input
 * @returns {Promise<Object>} - { success: boolean, metinList: Array, detectedItems: Array, message: string }
 */
export async function parseMetinImport(file) {
    try {
        if (!file) {
            throw new Error('Dosya seÃ§ilmedi.');
        }

        const fileName = file.name.toLowerCase();
        const fileExtension = fileName.split('.').pop();

        let rawData = [];

        // Read file based on extension
        if (fileExtension === 'json') {
            // Parse JSON file
            const result = await new Promise((resolve, reject) => {
                const reader = new FileReader();

                reader.onload = (e) => {
                    try {
                        const jsonData = JSON.parse(e.target.result);
                        if (!Array.isArray(jsonData)) {
                            throw new Error('JSON dosyasÄ± bir dizi iÃ§ermelidir.');
                        }
                        resolve(jsonData);
                    } catch (parseError) {
                        reject(new Error('JSON dosyasÄ± okunamadÄ±: ' + parseError.message));
                    }
                };

                reader.onerror = () => reject(new Error('Dosya okuma hatasÄ±.'));
                reader.readAsText(file);
            });

            rawData = result;

        } else if (fileExtension === 'xlsx' || fileExtension === 'xls' || fileExtension === 'csv') {
            // Parse Excel/CSV file
            const result = await new Promise((resolve, reject) => {
                const reader = new FileReader();

                reader.onload = (e) => {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });

                        // Get first sheet
                        const firstSheetName = workbook.SheetNames[0];
                        const worksheet = workbook.Sheets[firstSheetName];

                        // Convert to JSON
                        const jsonData = XLSX.utils.sheet_to_json(worksheet);

                        if (jsonData.length === 0) {
                            throw new Error('Excel dosyasÄ± boÅŸ.');
                        }

                        resolve(jsonData);
                    } catch (parseError) {
                        reject(new Error('Excel dosyasÄ± okunamadÄ±: ' + parseError.message));
                    }
                };

                reader.onerror = () => reject(new Error('Dosya okuma hatasÄ±.'));
                reader.readAsArrayBuffer(file);
            });

            rawData = result;

        } else {
            throw new Error(`Desteklenmeyen dosya formatÄ±: .${fileExtension}\nSadece .json, .xlsx, .xls veya .csv dosyalarÄ± desteklenir.`);
        }

        // Group rows by metin name and detect items
        const metinMap = new Map();
        const detectedItemsMap = new Map();

        rawData.forEach(row => {
            const rawName = row['Metin AdÄ±'] || row.metinName || row.name;
            const metinName = sanitizeText(rawName);
            const hp = parseInt(row['HP'] || row.hp) || 100000;

            const rawItemName = row['EÅŸya AdÄ±'] || row.itemName || row.item;
            const itemName = sanitizeText(rawItemName); // TemizlenmiÅŸ isim

            const count = parseInt(row['Adet'] || row.count) || 1;
            const chance = parseFloat(row['Åans'] || row.chance) || 100;

            if (!metinName) {
                console.warn('SatÄ±rda metin adÄ± bulunamadÄ±, atlanÄ±yor:', row);
                return;
            }

            // Get or create metin entry
            if (!metinMap.has(metinName)) {
                // âœ… ARTIK Ä°SÄ°M TABANLI SABÄ°T ID KULLANIYORUZ
                const stableId = generateStableId(metinName);

                metinMap.set(metinName, {
                    id: stableId,
                    name: metinName,
                    hp: hp,
                    drops: []
                });
            }

            const metin = metinMap.get(metinName);

            // Add drop if item name exists
            if (itemName && itemName.trim() !== '') {
                // Detect and register item
                if (!detectedItemsMap.has(itemName)) {
                    detectedItemsMap.set(itemName, {
                        originalName: itemName,
                        tempId: generateStableId(itemName),
                        icon: 'Circle'
                    });
                }

                const detectedItem = detectedItemsMap.get(itemName);

                // Add drop to metin
                metin.drops.push({
                    id: `drop-${crypto.randomUUID()}`,
                    itemId: detectedItem.tempId,
                    count: count,
                    chance: chance
                });
            }
        });

        // Convert maps to arrays
        const metinList = Array.from(metinMap.values());
        const detectedItems = Array.from(detectedItemsMap.values());

        return {
            success: true,
            metinList: metinList,
            detectedItems: detectedItems,
            message: `${metinList.length} metin ve ${detectedItems.length} benzersiz eÅŸya yÃ¼klendi.`
        };

    } catch (error) {
        console.error('Metin import error:', error);
        return {
            success: false,
            metinList: [],
            detectedItems: [],
            message: error.message || 'Metin iÃ§e aktarma sÄ±rasÄ±nda hata oluÅŸtu.'
        };
    }
}

==================================================
DOSYA YOLU: .\app\lib\marketUtils.js
==================================================
/**
 * ============================================================================
 * MARKET UTILITIES - Global Catalog + Profile Price Architecture
 * ============================================================================
 *
 * Bu modÃ¼l, "Global Katalog + Profil FiyatÄ±" mimarisine tam uyumlu
 * yardÄ±mcÄ± fonksiyonlar saÄŸlar.
 */

/**
 * Global item kataloÄŸu ile seÃ§ili profildeki fiyatlarÄ± birleÅŸtirir.
 *
 * @param {Array} registry - Global item kataloÄŸu (tÃ¼m item tanÄ±mlarÄ±)
 * @param {Object} priceMap - SeÃ§ili profildeki fiyat objesi { itemId: price }
 * @returns {Array} BirleÅŸtirilmiÅŸ market verileri
 *
 * @example
 * const registry = [
 *   { id: '1', name: 'KÄ±lÄ±Ã§', category: 'silah' },
 *   { id: '2', name: 'Kalkan', category: 'zÄ±rh' }
 * ];
 * const priceMap = { '1': 5000, '2': 3000 };
 * const merged = mergeMarketData(registry, priceMap);
 * // Result: [
 * //   { id: '1', name: 'KÄ±lÄ±Ã§', category: 'silah', price: 5000, originalId: '1' },
 * //   { id: '2', name: 'Kalkan', category: 'zÄ±rh', price: 3000, originalId: '2' }
 * // ]
 */
export function mergeMarketData(registry, priceMap) {
    // GÃ¼venlik: BoÅŸ registry gelirse boÅŸ dizi dÃ¶ndÃ¼r
    if (!registry || !Array.isArray(registry)) {
        console.warn('mergeMarketData: registry is empty or invalid');
        return [];
    }

    // GÃ¼venlik: priceMap yoksa boÅŸ obje olarak kullan
    const safePriceMap = priceMap || {};

    // Registry'deki her item iÃ§in fiyat bilgisini ekle
    return registry.map(item => ({
        ...item,
        price: safePriceMap[item.id] ?? 0, // Fiyat yoksa 0
        originalId: item.id // Calculator uyumluluÄŸu iÃ§in
    }));
}

/**
 * Excel'den gelen ham veriyi iÅŸler, katalogla eÅŸleÅŸtirir ve sonuÃ§ Ã¼retir.
 *
 * @param {Array} importedData - Excel'den gelen item listesi
 *   Market Import: [{name, price, category}]
 *   Metin Import: [{tempId, originalName}]
 * @param {Array} registry - Global item kataloÄŸu
 * @returns {Object} { newRegistryItems, idMap }
 *
 * @example
 * // Market Import
 * const importedData = [
 *   { name: 'KÄ±lÄ±Ã§', price: 5000, category: 'silah' },
 *   { name: 'Yeni Item', price: 2000, category: 'genel' }
 * ];
 * const result = syncLocalMarketItems(importedData, registry);
 * // Result: {
 * //   newRegistryItems: [{ id: 'uuid', name: 'Yeni Item', ... }],
 * //   idMap: { 'KÄ±lÄ±Ã§': 'existing-id', 'Yeni Item': 'uuid' }
 * // }
 *
 * @example
 * // Metin Import
 * const importedData = [
 *   { tempId: 'temp-1', originalName: 'Efsun Nesnesi' }
 * ];
 * const result = syncLocalMarketItems(importedData, registry);
 * // Result: {
 * //   newRegistryItems: [],
 * //   idMap: { 'temp-1': 'existing-id' }
 * // }
 */
// Helper for robust string matching
const normalizeForMatch = (str) => {
    if (!str) return '';
    return String(str)
        .normalize('NFC')
        .replace(/['".,\/#!$%\^&\*;:{}=\-_`~()]/g, "") // Noktalama iÅŸaretlerini at
        .replace(/\s/g, "") // TÃœM BOÅLUKLARI sil (Zehir KÄ±lÄ±cÄ± -> zehirkÄ±lÄ±cÄ±)
        .toLocaleLowerCase('tr');
};

// Helper for item id generation
export function generateStableId(name) {
    const trMap = { 'Ã§': 'c', 'Ã‡': 'c', 'ÄŸ': 'g', 'Ä': 'g', 'ÅŸ': 's', 'Å': 's', 'Ã¼': 'u', 'Ãœ': 'u', 'Ä±': 'i', 'I': 'i', 'Ä°': 'i', 'Ã¶': 'o', 'Ã–': 'o' };
    return 'item_' + String(name).trim().split('').map(char => trMap[char] || char).join('').toLowerCase().replace(/[^a-z0-9]+/g, '_').replace(/^_+|_+$/g, '');
}

export function syncLocalMarketItems(importedData, registry) {
    const newRegistryItems = [];
    const idMap = {}; // TempID/Name -> RealID

    // GÃ¼venlik: BoÅŸ veri gelirse iÅŸlem yapma
    if (!importedData || !Array.isArray(importedData)) {
        console.warn('syncLocalMarketItems: importedData is empty or invalid');
        return { newRegistryItems: [], idMap: {} };
    }

    // GÃ¼venlik: Registry yoksa boÅŸ dizi olarak kullan
    const safeRegistry = registry || [];

    // Her import edilen item'Ä± iÅŸle
    importedData.forEach((importedItem) => {
        // Determine the name field (supports both 'name' and 'originalName')
        const itemName = importedItem.originalName || importedItem.name;

        // GÃ¼venlik: Ä°sim yoksa atla
        if (!itemName) {
            return;
        }

        // 1. Ä°sim Normalizasyonu
        const importNameNorm = normalizeForMatch(itemName);

        // 2. Ã–nce Mevcut Katalogda Ara (ID'yi kurtarmak iÃ§in)
        // EÄŸer katalogda bu isimde bir eÅŸya zaten varsa, ONUN ID'sini kullan
        let match = safeRegistry.find(
            (regItem) => normalizeForMatch(regItem.name) === importNameNorm
        );

        // 3. EÄŸer katalogda yoksa, ÅŸu an oluÅŸturduÄŸumuz "yeni eklenecekler" listesinde var mÄ±?
        // (AynÄ± Excel iÃ§inde mÃ¼kerrer kayÄ±t varsa engellemek iÃ§in)
        if (!match) {
            match = newRegistryItems.find(
                (newItem) => normalizeForMatch(newItem.name) === importNameNorm
            );
        }

        const mapKey = importedItem.tempId || itemName; // Use tempId if available, otherwise use name

        if (match) {
            // âœ… KRÄ°TÄ°K: EÅŸleÅŸme varsa ESKÄ° ID'yi kullan!
            // BÃ¶ylece fiyat gÃ¼ncellemesi doÄŸru itema gider. (Yeni ID Ã¼retme!)
            idMap[mapKey] = match.id;
        } else {
            // EÅŸleÅŸme yoksa yeni oluÅŸtur -> ARTIK STABLE ID KULLAN
            const newId = generateStableId(itemName);
            newRegistryItems.push({
                id: newId,
                originalId: null,
                name: itemName.trim(), // Orijinal yazÄ±mÄ± koru
                category: importedItem.category || 'ithal',
                icon: 'Circle', // VarsayÄ±lan ikon
                origin: 'market',
                isSystemItem: false
            });
            idMap[mapKey] = newId;
        }
    });

    return { newRegistryItems, idMap };
}

/**
 * Validate merged market data
 *
 * @param {Array} marketItems - Merged market items
 * @returns {boolean} True if valid
 */
export function validateMarketData(marketItems) {
    if (!marketItems || !Array.isArray(marketItems)) {
        console.error('validateMarketData: marketItems is not an array');
        return false;
    }

    const hasInvalidItems = marketItems.some(item => {
        if (!item.id || !item.name) {
            console.error('validateMarketData: Item missing id or name', item);
            return true;
        }
        if (typeof item.price !== 'number' || item.price < 0) {
            console.error('validateMarketData: Item has invalid price', item);
            return true;
        }
        return false;
    });

    return !hasInvalidItems;
}

/**
 * Get items by category from merged market data
 *
 * @param {Array} marketItems - Merged market items
 * @param {string} category - Category to filter by
 * @returns {Array} Filtered items
 */
export function getItemsByCategory(marketItems, category) {
    if (!marketItems || !Array.isArray(marketItems)) {
        return [];
    }

    if (!category) {
        return marketItems;
    }

    return marketItems.filter(item => item.category === category);
}

/**
 * Search items by name
 *
 * @param {Array} marketItems - Merged market items
 * @param {string} query - Search query
 * @returns {Array} Matching items
 */
export function searchItems(marketItems, query) {
    if (!marketItems || !Array.isArray(marketItems)) {
        return [];
    }

    if (!query || query.trim() === '') {
        return marketItems;
    }

    const cleanQuery = query.trim().toLowerCase();

    return marketItems.filter(item =>
        item.name.toLowerCase().includes(cleanQuery)
    );
}

==================================================
DOSYA YOLU: .\app\lib\math\core.js
==================================================
/**
 * Metin2 Drop Simulator - Core Calculation Engine
 */

import { ITEM_SOURCES, COOLDOWN_TYPES } from '../../store/constants';

/**
 * @typedef {Object} UserStats
 * @property {number} damage
 * @property {number} hitsPerSecond
 * @property {number} findTime
 */

/**
 * @typedef {Object} Boss
 * @property {string} id
 * @property {string} name
 * @property {number} hp
 * @property {number} fixedRunTime
 * @property {Object} constraints
 * @property {number} constraints.cooldown
 * @property {string} constraints.cooldownType
 * @property {number} [constraints.dailyLimit]
 * @property {Array} drops
 */

/**
 * @typedef {Object} Metin
 * @property {string} id
 * @property {string} name
 * @property {number} hp
 * @property {Array} drops
 */

/**
 * Simple Price Resolver (Basit Fiyat Ã‡Ã¶zÃ¼cÃ¼)
 *
 * ArtÄ±k recursive deÄŸil! Sadece market listesinden fiyatÄ± bulur.
 * Crafting itemlarÄ±nÄ±n fiyatlarÄ± zaten market store'una pushlandÄ±ÄŸÄ± iÃ§in
 * burada ekstra bir hesaplama yapmaya gerek yoktur.
 *
 * @param {string} itemId - ID of the item to resolve
 * @param {string} sourceType - Source type of the item (unused but kept for compatibility)
 * @param {Array} marketItems - Array of market items with prices
 * @returns {number} Unit price of the item
 */
export function resolveItemPrice(itemId, sourceType, marketItems = []) {
    if (!itemId) return 0;
    const safeMarketItems = marketItems || [];

    // 1. Kesin EÅŸleÅŸme (ID veya OriginalID)
    let item = safeMarketItems.find(i => i.id === itemId || i.originalId === itemId);

    // 2. BulunamadÄ±ysa: Esnek EÅŸleÅŸme (ID string karÅŸÄ±laÅŸtÄ±rmasÄ±)
    if (!item) {
        const searchId = String(itemId).toLowerCase();
        item = safeMarketItems.find(i => String(i.id).toLowerCase() === searchId);
    }

    return item ? (item.price || 0) : 0;
}

/**
 * Calculate profit metrics for a single Metin
 *
 * @param {Metin} metin
 * @param {Object} prices
 * @param {Object} multipliers
 * @param {UserStats} userStats
 * @param {Array} marketItems
 * @returns {Object} Calculated metrics
 */
export function calculateMetinProfit(metin, prices, multipliers, userStats, marketItems = []) {
    // ARTIK STORE VERÄ°SÄ° AYIKLAMAK YOK. DOÄRUDAN VERÄ° Ä°LE Ã‡ALIÅIYORUZ.
    const safePrices = prices || {};
    const safeMultipliers = multipliers || { drop: 1.0 };

    let totalDropValue = 0;
    if (metin && metin.drops) {
        metin.drops.forEach(drop => {
            // âœ… DÃœZELTME: FiyatÄ± bulmak iÃ§in merkezi hesaplayÄ±cÄ±yÄ± kullanÄ±yoruz.
            // ArtÄ±k sadece marketItems yeterli, Ã§Ã¼nkÃ¼ crafting fiyatlarÄ± oraya pushlanÄ±yor.
            const price = resolveItemPrice(
                drop.itemId,
                drop.sourceType || ITEM_SOURCES.MARKET,
                marketItems
            );

            // Drop Ã§arpanÄ±nÄ± hesaba kat
            const count = drop.count * safeMultipliers.drop;

            totalDropValue += count * (drop.chance / 100) * price;
        });
    }

    const { damage, hitsPerSecond, findTime } = userStats;

    // GÃ¼venlik: 0'a bÃ¶lme hatasÄ± Ã¶nlemi
    const dps = (damage || 0) * (hitsPerSecond || 0);
    const killTime = dps > 0 ? metin.hp / dps : 0;
    const cycleTime = killTime + (findTime || 0);
    const metinsPerHour = cycleTime > 0 ? 3600 / cycleTime : 0;

    const hourlyProfit = metinsPerHour * totalDropValue;

    return {
        metinId: metin.id,
        metinName: metin.name,
        killTime,
        cycleTime,
        metinsPerHour,
        dropValuePerMetin: totalDropValue,
        hourlyProfit,
    };
}

/**
 * Calculate profit metrics for all Metins and sort by hourly profit
 */
export function calculateAllMetins(metinList = [], prices = {}, multipliers = {}, userStats = {}, marketItems = []) {
    if (!metinList || !Array.isArray(metinList) || metinList.length === 0) {
        return [];
    }

    const calculations = metinList.map((metin) =>
        calculateMetinProfit(metin, prices, multipliers, userStats, marketItems)
    );

    return calculations.sort((a, b) => b.hourlyProfit - a.hourlyProfit);
}

/**
 * Get the best (most profitable) Metin
 */
export function getBestMetin(calculations) {
    return calculations.length > 0 ? calculations[0] : null;
}

/**
 * Helper: Calculate a smart upper limit for damage simulation
 * EÄŸer veri yoksa varsayÄ±lan bir tavan deÄŸer belirler.
 */
export function calculateSmartLimit(metinList, hitsPerSecond) {
    // KORUMA: Liste boÅŸsa varsayÄ±lan 30k hasar sÄ±nÄ±rÄ± koy
    if (!metinList || metinList.length === 0) return 30000;

    const maxHp = Math.max(...metinList.map(m => m.hp));
    const hps = hitsPerSecond || 1;
    const limit = (maxHp / hps) * 1.2; // +20% buffer

    // Clamp between reasonable bounds
    return Math.max(5000, Math.min(200000, Math.ceil(limit / 500) * 500));
}

/**
 * Calculate profit metrics for a single Boss
 * Robust version with Type Safety
 *
 * @param {Boss} boss
 * @param {UserStats} userStats
 * @param {number} dailyPlayHours
 * @param {Array} marketItems
 * @returns {Object} Boss metrics
 */
export function calculateBossMetrics(boss, userStats, dailyPlayHours = 4, marketItems = []) {
    // 1. Force Number Types (Prevent String Concatenation bugs)
    const damage = Number(userStats.damage) || 0;
    const hitsPerSecond = Number(userStats.hitsPerSecond) || 0;
    // NOTE: userStats.findTime is intentionally ignored here.
    const bossHp = Number(boss.hp) || 1;

    // 2. Calculate DPS & Kill Time
    const dps = damage * hitsPerSecond;
    // If DPS is 0, time is Infinity. Using a safe large number for logic.
    const killTime = dps > 0 ? bossHp / dps : Infinity;

    // 3. Cycle & Active Time Calculations
    const fixedRunTimeMinutes = Number(boss.fixedRunTime) || 5;
    const fixedRunTimeSeconds = fixedRunTimeMinutes * 60;

    // FIX 1: Active Time (Zaman ÅiÅŸmesini Ã–nle)
    // Zindan sÃ¼resi (fixedRunTime), genellikle toplam sÃ¼reyi ifade eder.
    // Kesim sÃ¼resi (killTime) bunun iÃ§indedir. EÄŸer kesim Ã§ok uzun sÃ¼rerse, sÃ¼re uzar.
    const activeTimeSeconds = Math.max(killTime, fixedRunTimeSeconds);
    const activeTimeMinutes = activeTimeSeconds / 60;

    // FIX 2: Cycle Time (GiriÅŸ/Ã‡Ä±kÄ±ÅŸ AyrÄ±mÄ±)
    const cooldownMinutes = Number(boss.constraints?.cooldown) || 0;
    const cooldownSeconds = cooldownMinutes * 60;
    const cooldownType = boss.constraints?.cooldownType || COOLDOWN_TYPES.ENTRY;

    let cycleTimeSeconds;
    if (cooldownType === COOLDOWN_TYPES.ENTRY) {
        // GiriÅŸ: SoÄŸuma, iÃ§erideken de iÅŸler.
        // DÃ¶ngÃ¼ = Max(Aktif SÃ¼re, SoÄŸuma SÃ¼resi)
        cycleTimeSeconds = Math.max(activeTimeSeconds, cooldownSeconds);
    } else {
        // Ã‡Ä±kÄ±ÅŸ: SoÄŸuma, Ã§Ä±ktÄ±ktan sonra baÅŸlar.
        // DÃ¶ngÃ¼ = Aktif SÃ¼re + SoÄŸuma SÃ¼resi
        cycleTimeSeconds = activeTimeSeconds + cooldownSeconds;
    }

    // 4. Calculate Total Drop Value
    let totalDropValue = 0;
    if (boss.drops) {
        boss.drops.forEach(drop => {
            const price = resolveItemPrice(
                drop.itemId,
                drop.sourceType || ITEM_SOURCES.MARKET,
                marketItems
            );
            totalDropValue += (Number(drop.count) || 1) * (Number(drop.chance) / 100) * price;
        });
    }

    const dailyLimit = Number(boss.constraints?.dailyLimit) || 0;

    return {
        bossId: boss.id,
        bossName: boss.name,
        killTime,
        activeTimeMinutes, // Pure playtime per run
        cycleTimeMinutes: cycleTimeSeconds / 60, // Total rotation time per run
        dailyLimit,
        totalDropValue,
        profitPerCycle: totalDropValue,
        // Flags
        isUnkillable: dps <= 0, // Flag for UI
    };
}

/**
 * Calculate metrics for all bosses using a Timeline Simulation
 *
 * @param {Array<Boss>} bossList
 * @param {UserStats} userStats
 * @param {number} dailyPlayHours
 * @param {Array} marketItems
 * @returns {Array} Simulation results
 */
export function calculateAllBosses(bossList = [], userStats = {}, dailyPlayHours = 4, marketItems = []) {
    if (!bossList || !Array.isArray(bossList) || bossList.length === 0) {
        return { results: [], totalDurationMinutes: 0 };
    }

    const maxTimeMinutes = Number(dailyPlayHours) * 60;

    // 1. Initialize Simulation State
    let bossStates = bossList.map(boss => {
        const metrics = calculateBossMetrics(boss, userStats, dailyPlayHours, marketItems);

        // Calculate Efficiency (Profit per Minute of Active Play)
        // Prevent division by zero or infinity
        let efficiency = 0;
        if (!metrics.isUnkillable && metrics.activeTimeMinutes > 0) {
            efficiency = metrics.profitPerCycle / metrics.activeTimeMinutes;
        }

        return {
            ...boss,
            metrics,
            // Simulation State
            nextAvailableTime: 0,
            remainingDailyLimit: metrics.dailyLimit > 0 ? metrics.dailyLimit : Infinity,
            runCount: 0,
            totalProfit: 0
        };
    });

    // 2. Run Simulation Loop
    let currentTime = 0;

    // Safety break to prevent infinite loops
    let loopCount = 0;
    const MAX_LOOPS = 10000;

    while (currentTime < maxTimeMinutes && loopCount < MAX_LOOPS) {
        loopCount++;

        // Find available candidates
        const availableBosses = bossStates.filter(b =>
            !b.metrics.isUnkillable && // Hasar yetiyorsa
            b.nextAvailableTime <= currentTime && // SÃ¼resi geldiyse
            b.remainingDailyLimit > 0 && // Limiti dolmadÄ±ysa
            (currentTime + b.metrics.activeTimeMinutes) <= maxTimeMinutes // Vakit yetiyorsa
        );

        if (availableBosses.length > 0) {
            // Pick best (Greedy)
            availableBosses.sort((a, b) => b.efficiency - a.efficiency); // Sort desc
            const selected = availableBosses[0];

            // Execute Run
            const startTime = currentTime;
            const runDuration = selected.metrics.activeTimeMinutes;
            const finishTime = startTime + runDuration;

            // Update State
            selected.runCount++;
            selected.remainingDailyLimit--;
            selected.totalProfit += selected.metrics.profitPerCycle;
            currentTime = finishTime;

            // Update Cooldown
            const cooldownMin = Number(selected.constraints?.cooldown) || 0;
            const type = selected.constraints?.cooldownType || COOLDOWN_TYPES.ENTRY;

            if (type === COOLDOWN_TYPES.ENTRY) {
                selected.nextAvailableTime = Math.max(finishTime, startTime + cooldownMin);
            } else {
                selected.nextAvailableTime = finishTime + cooldownMin;
            }

        } else {
            // No boss available right now. Fast forward.
            const pendingBosses = bossStates.filter(b =>
                !b.metrics.isUnkillable &&
                b.remainingDailyLimit > 0
            );

            if (pendingBosses.length === 0) {
                break; // Nothing left to kill today
            }

            const nextEventTime = Math.min(...pendingBosses.map(b => b.nextAvailableTime));

            if (nextEventTime > maxTimeMinutes) {
                break; // Next event is too late
            }

            // Jump time
            currentTime = Math.max(currentTime + 0.1, nextEventTime);
        }
    }

    // 3. Format Results
    const results = bossStates.map(b => ({
        bossId: b.id,
        bossName: b.name,

        // Stats
        cycleTimeMinutes: b.metrics.cycleTimeMinutes, // FIX: Display FULL cycle time (Run + Cooldown)
        realDailyKills: b.runCount,
        dailyProfit: b.totalProfit,
        profitPerCycle: b.metrics.profitPerCycle,

        // Total Time Spent (Active Only)
        timeRequiredHours: (b.runCount * b.metrics.activeTimeMinutes) / 60,

        dailyLimit: b.metrics.dailyLimit,
        isUnkillable: b.metrics.isUnkillable
    })).sort((a, b) => b.dailyProfit - a.dailyProfit);

    return {
        results,
        totalDurationMinutes: currentTime // Return total simulation time
    };
}

/**
 * Calculate expected item yields for a specific duration
 */
export function calculateItemYields(metin, userStats, durationHours) {
    const { damage, hitsPerSecond, findTime } = userStats;

    // Calculate Metins Per Hour (reusing logic for consistency)
    const dps = damage * hitsPerSecond;
    const killTime = dps > 0 ? metin.hp / dps : 0;
    const cycleTime = killTime + findTime;
    const metinsPerHour = cycleTime > 0 ? 3600 / cycleTime : 0;

    const totalMetins = metinsPerHour * durationHours;
    const yields = [];

    metin.drops.forEach(drop => {
        // Expected count = Total Metins * Count per drop * Chance
        const expectedCount = totalMetins * drop.count * (drop.chance / 100);

        yields.push({
            itemId: drop.itemId,
            count: expectedCount,
            // Note: We don't have item names here directly, caller should map them
            chance: drop.chance
        });
    });

    return {
        metinsCount: totalMetins,
        yields: yields
    };
}

==================================================
DOSYA YOLU: .\app\lib\math\formatters.js
==================================================
/**
 * RECURSIVE 'K' FORMATTER
 *
 * MantÄ±k:
 * 0-999 -> 999
 * 1,000 -> 1k
 * 1,000,000 -> 1kk (Milyon yerine)
 * 1,000,000,000 -> 1kkk (Milyar yerine)
 */

// 1. KISA FORMAT (Genel GÃ¶rÃ¼nÃ¼m iÃ§in: 1.5kk)
export function formatCompactK(number) {
    if (!number || isNaN(number)) return "0";
    if (number < 1000) return Math.floor(number).toString();

    // KaÃ§ tane 'k' grubu var? (log1000)
    const tier = Math.floor(Math.log10(number) / 3);

    // EÄŸer tier 0 ise (1000 altÄ±)
    if (tier === 0) return Math.floor(number).toString();

    // Suffix oluÅŸtur (tier kadar 'k' ekle)
    const suffix = 'k'.repeat(tier);

    // SayÄ±yÄ± kÃ¼Ã§Ã¼lt (Ã–rn: 1500 -> 1.5)
    const scale = Math.pow(1000, tier);
    const scaled = number / scale;

    // OndalÄ±k temizliÄŸi (Tam sayÄ±ysa .0 koyma, deÄŸilse max 2 basamak)
    const formattedNum = parseFloat(scaled.toFixed(2)); // 1.50 -> 1.5

    return `${formattedNum}${suffix}`;
}

// 2. DETAYLI FORMAT (Hover iÃ§in: 1kkk 350kk 240k 422)
export function formatDetailedK(number) {
    if (!number || isNaN(number)) return "0";
    if (number < 1000) return Math.floor(number).toString();

    let str = "";
    let temp = Math.floor(number);

    // SayÄ±yÄ± 1000'e bÃ¶lerek parÃ§ala
    const groups = [];
    while (temp > 0) {
        groups.push(temp % 1000);
        temp = Math.floor(temp / 1000);
    }

    // Tersten (En bÃ¼yÃ¼kten en kÃ¼Ã§Ã¼ÄŸe) birleÅŸtir
    // Ã–rn: groups = [422, 240, 350, 1] -> Tier 0, 1, 2, 3
    for (let i = groups.length - 1; i >= 0; i--) {
        const val = groups[i];
        if (val > 0) {
            const suffix = i > 0 ? 'k'.repeat(i) : '';
            str += ` ${val}${suffix}`;
        }
    }

    return str.trim();
}

/**
 * 3. SUFFIX PARSER (Input iÃ§in: "40k" -> 40000)
 *
 * Desteklenen formatlar:
 * - "1.5k" -> 1500
 * - "1kk" veya "1m" -> 1000000
 * - "1kkk" veya "1b" -> 1000000000
 * - "40k" -> 40000
 * - "2.5kk" -> 2500000
 */
export function parseSuffixValue(input) {
    if (input === null || input === undefined) return 0;

    // String'e Ã§evir ve temizle
    let str = String(input).trim().toLowerCase();

    // BoÅŸ string kontrolÃ¼
    if (!str || str === "") return 0;

    // VirgÃ¼lÃ¼ noktaya Ã§evir (TÃ¼rkÃ§e format desteÄŸi)
    str = str.replace(",", ".");

    // Sadece sayÄ± ise direkt parse et
    if (/^-?[\d.]+$/.test(str)) {
        return parseFloat(str) || 0;
    }

    let multiplier = 1;

    // "kk" veya "kkk" gibi tekrarlayan k'larÄ± say
    const kMatch = str.match(/k+$/i);
    if (kMatch) {
        const kCount = kMatch[0].length;
        multiplier = Math.pow(1000, kCount);
        str = str.replace(/k+$/i, "");
    }
    // "m" suffix (milyon)
    else if (/m$/i.test(str)) {
        multiplier = 1_000_000;
        str = str.replace(/m$/i, "");
    }
    // "b" suffix (milyar)
    else if (/b$/i.test(str)) {
        multiplier = 1_000_000_000;
        str = str.replace(/b$/i, "");
    }

    // Kalan sayÄ±yÄ± parse et
    const baseNumber = parseFloat(str) || 0;

    return Math.round(baseNumber * multiplier);
}

// Eskilerle uyumluluk iÃ§in (Yenilere yÃ¶nlendir)
export const formatCurrency = formatCompactK;
export const formatCompactCurrency = formatCompactK;

/**
 * Format time in seconds to readable format
 */
export function formatTime(seconds) {
    if (seconds >= 60) {
        const minutes = Math.floor(seconds / 60);
        const secs = Math.round(seconds % 60);
        return `${minutes}m ${secs}s`;
    }
    return `${seconds.toFixed(1)}s`;
}


==================================================
DOSYA YOLU: .\app\lib\math\progression.js
==================================================
/**
 * Metin2 Drop Simulator - Damage Progression Logic
 */

import { calculateAllMetins, getBestMetin, calculateSmartLimit } from './core';

// Helper colors
const colors = ["#ef4444", "#f97316", "#eab308", "#22c55e", "#06b6d4", "#3b82f6", "#a855f7", "#ec4899"];
export const getColor = (name) => {
    let hash = 0;
    for (let i = 0; i < name.length; i++) hash = name.charCodeAt(i) + ((hash << 5) - hash);
    return colors[Math.abs(hash) % colors.length];
};

/**
 * Calculate damage progression zones
 * DÃœZELTÄ°LMÄ°Å VERSÄ°YON
 */
export function calculateDamageZones(metinList, prices, multipliers, userStats, marketItems = []) {
    const zones = [];
    let currentZone = null;

    // calculateSmartLimit fonksiyonunun dosyada tanÄ±mlÄ± olduÄŸundan emin olun, deÄŸilse 30000 varsayalÄ±m
    // EÄŸer calculateSmartLimit yoksa: const maxDamage = 30000; yapabilirsiniz.
    const maxDamage = typeof calculateSmartLimit === 'function'
        ? calculateSmartLimit(metinList, userStats.hitsPerSecond)
        : 30000;

    let step = 100;

    // --- DÃ–NGÃœ BAÅLANGICI ---
    // continue sadece bu parantezler { } iÃ§inde Ã§alÄ±ÅŸÄ±r
    for (let damage = 1000; damage <= maxDamage; damage += step) {

        // AkÄ±llÄ± AdÄ±m AralÄ±ÄŸÄ± (Performans iÃ§in)
        if (damage > 50000) step = 500;
        if (damage > 200000) step = 1000;

        const tempStats = { ...userStats, damage };

        // Hesaplama
        const calculations = calculateAllMetins(metinList, prices, multipliers, tempStats, marketItems);
        const bestMetin = getBestMetin(calculations);

        // KORUMA: EÄŸer uygun metin yoksa bu adÄ±mÄ± atla (continue burada Ã§alÄ±ÅŸÄ±r)
        if (!bestMetin) continue;

        const isSoftcap = bestMetin.killTime < (userStats.findTime * 0.1);

        // Zone MantÄ±ÄŸÄ±
        if (!currentZone || currentZone.bestMetinName !== bestMetin.metinName) {
            // Yeni Zone BaÅŸlat
            currentZone = {
                minDamage: damage,
                maxDamage: damage,
                bestMetinName: bestMetin.metinName,
                minProfit: bestMetin.hourlyProfit,
                maxProfit: bestMetin.hourlyProfit,
                color: getColor(bestMetin.metinName),
                isSoftcap: isSoftcap,
                rankings: calculations.slice(0, 3).map(c => ({
                    name: c.metinName,
                    profit: c.hourlyProfit,
                    efficiency: (c.hourlyProfit / bestMetin.hourlyProfit) * 100
                }))
            };
            zones.push(currentZone);
        } else {
            // Mevcut Zone'u GeniÅŸlet
            currentZone.maxDamage = damage;
            currentZone.maxProfit = bestMetin.hourlyProfit;
            if (isSoftcap) currentZone.isSoftcap = true;
        }
    }
    // --- DÃ–NGÃœ BÄ°TÄ°ÅÄ° ---

    return zones;
}

/**
 * Analyze next tier requirements and potential gains
 */
export function analyzeNextTier(currentDamage, zones) {
    if (!zones || zones.length === 0) return null;

    // Find current zone
    const currentZoneIndex = zones.findIndex(
        z => currentDamage >= z.minDamage && currentDamage <= z.maxDamage
    );

    // If damage is beyond max calculated range or in the last zone
    if (currentZoneIndex === -1 || currentZoneIndex === zones.length - 1) {
        // Check if damage is higher than the last zone's max
        const lastZone = zones[zones.length - 1];
        if (currentDamage > lastZone.maxDamage) {
            return { isMaxLevel: true, message: "Zirvedesiniz! Daha verimli bir metin yok." };
        }
        // If inside the last zone
        return { isMaxLevel: true, message: "En verimli metin bÃ¶lgesindesiniz." };
    }

    const currentZone = zones[currentZoneIndex];
    const nextZone = zones[currentZoneIndex + 1];

    // Calculate requirements
    const requiredDamage = nextZone.minDamage - currentDamage;

    // Calculate profit potential (using averages for smoother comparison)
    const currentAvgProfit = (currentZone.minProfit + currentZone.maxProfit) / 2;
    const nextAvgProfit = (nextZone.minProfit + nextZone.maxProfit) / 2;

    const profitIncrease = nextAvgProfit - currentAvgProfit;
    const percentGain = currentAvgProfit > 0
        ? (profitIncrease / currentAvgProfit) * 100
        : 0;

    return {
        isMaxLevel: false,
        nextMetin: nextZone.bestMetinName,
        requiredDamage: requiredDamage,
        profitIncrease: profitIncrease,
        percentGain: percentGain
    };
}

==================================================
DOSYA YOLU: .\app\lib\math\simulation.js
==================================================
/**
 * Metin2 Drop Simulator - Simulation Logic
 */

/**
 * Generate simulated player distribution across damage ranges
 */
export function generatePlayerDistribution(minDmg, maxDmg, playerCount, type, timeStrategy, baseHours = 4) {
    const segments = [];
    const segmentCount = 20; // Number of buckets
    const range = maxDmg - minDmg;
    const step = range / segmentCount;

    let totalWeight = 0;
    const weights = [];

    // 1. Calculate weights based on distribution type
    for (let i = 0; i < segmentCount; i++) {
        const normalizedPos = i / (segmentCount - 1); // 0 to 1
        let weight = 0;

        switch (type) {
            case "normal": // Bell curve
                // Gaussian function centered at 0.5
                weight = Math.exp(-Math.pow(normalizedPos - 0.5, 2) / 0.1);
                break;
            case "left-skewed": // Majority low damage (Gamma-like)
                weight = Math.pow(1 - normalizedPos, 2);
                break;
            case "right-skewed": // Majority high damage
                weight = Math.pow(normalizedPos, 2);
                break;
            case "uniform":
            default:
                weight = 1;
                break;
        }
        weights.push(weight);
        totalWeight += weight;
    }

    // 2. Distribute players and calculate play time
    for (let i = 0; i < segmentCount; i++) {
        const segmentMid = minDmg + (step * i) + (step / 2);
        const normalizedPos = i / (segmentCount - 1);

        // Player Count for this segment
        const count = Math.round(playerCount * (weights[i] / totalWeight));

        // Average Play Time (Hours) based on strategy
        let avgPlayTime = baseHours;

        switch (timeStrategy) {
            case "linear": // Stronger players play more
                // Weak: 50%, Strong: 150%
                avgPlayTime = baseHours * (0.5 + normalizedPos);
                break;
            case "linear-inverse": // Weaker players play more
                // Weak: 150%, Strong: 50%
                avgPlayTime = baseHours * (1.5 - normalizedPos);
                break;
            case "exponential": // Elites play significantly more
                // Quadratic increase
                avgPlayTime = baseHours * (0.2 + 1.8 * Math.pow(normalizedPos, 2));
                break;
            case "exponential-inverse": // Beginners play significantly more
                // Quadratic increase for low damage
                avgPlayTime = baseHours * (0.2 + 1.8 * Math.pow(1 - normalizedPos, 2));
                break;
            case "constant":
            default:
                avgPlayTime = baseHours;
                break;
        }

        if (count > 0) {
            segments.push({
                minDamage: minDmg + (step * i),
                maxDamage: minDmg + (step * (i + 1)),
                avgDamage: segmentMid,
                playerCount: count,
                avgPlayTime: avgPlayTime,
                totalHours: count * avgPlayTime
            });
        }
    }

    return segments;
}

==================================================
DOSYA YOLU: .\app\store\constants.js
==================================================
import { MASTER_REGISTRY } from "../data/initialData";

// ============================================================================
// 1. OYUN MEKANÄ°KLERÄ° (ENUMS)
// ============================================================================

// EÅŸya KaynaklarÄ±
export const ITEM_SOURCES = {
    MARKET: 'market',
    CRAFTING: 'crafting',
    SYSTEM: 'system' // Oyunun kendi itemlarÄ±
};

// Crafting Tipleri
export const CRAFTING_TYPES = {
    RECIPE: 'recipe',       // X + Y = Z
    CONTAINER: 'container', // SandÄ±k / Boss
    FRAGMENT: 'fragment'    // ParÃ§a
};

// Boss SoÄŸuma Tipleri
export const COOLDOWN_TYPES = {
    ENTRY: 'entry', // GiriÅŸten itibaren
    EXIT: 'exit'    // Ã‡Ä±kÄ±ÅŸtan itibaren
};

// ============================================================================
// 2. WIDGET TÄ°PLERÄ° (ENUM) - Tek GerÃ§eklik KaynaÄŸÄ±
// ============================================================================
export const WIDGET_TYPES = {
    MARKET: "market-prices",
    CHARACTER: "character-stats",
    METIN_SETTINGS: "metin-settings",
    ANALYSIS: "analysis-tool",
    DAMAGE_PROGRESSION: "damage-progression",
    MARKET_SUPPLY: "market-supply",
    CRAFTING: "crafting-manager",
    BOSS_SETTINGS: "boss-settings"
};

// ============================================================================
// 3. WIDGET KAYDI
// ============================================================================
export const WIDGET_REGISTRY = {
    [WIDGET_TYPES.MARKET]: {
        title: "Piyasa FiyatlarÄ±",
        icon: "Coins",
        defaultData: { prices: {} },
        description: "EÅŸya fiyatlarÄ±nÄ± gÃ¶rÃ¼ntÃ¼le ve dÃ¼zenle"
    },
    [WIDGET_TYPES.CHARACTER]: {
        title: "Karakterim",
        icon: "Sword",
        defaultData: {
            damage: 5000,
            hitsPerSecond: 2.5,
            findTime: 10
        },
        description: "Karakter istatistiklerini yÃ¶net"
    },
    [WIDGET_TYPES.METIN_SETTINGS]: {
        title: "Metin AyarlarÄ±",
        icon: "Settings",
        defaultData: {
            metins: MASTER_REGISTRY.metinTemplates
        },
        description: "Metin HP ve drop ayarlarÄ±nÄ± dÃ¼zenle"
    },
    [WIDGET_TYPES.ANALYSIS]: {
        title: "Analiz & SimÃ¼lasyon",
        icon: "Calculator",
        defaultData: {},
        description: "KarlÄ±lÄ±k analizi ve farming stratejisi"
    },
    [WIDGET_TYPES.DAMAGE_PROGRESSION]: {
        title: "Hasar Yol HaritasÄ±",
        icon: "Map",
        defaultData: {},
        description: "HasarÄ±nÄ±za gÃ¶re en verimli metin bÃ¶lgelerini gÃ¶sterir."
    },
    [WIDGET_TYPES.MARKET_SUPPLY]: {
        title: "Piyasa ArzÄ±",
        icon: "Package",
        defaultData: {},
        description: "KiÅŸisel ve sunucu geneli eÅŸya birikim simÃ¼lasyonu"
    },
    [WIDGET_TYPES.CRAFTING]: {
        title: "Ãœretim & Boss",
        icon: "Hammer",
        defaultData: { items: [] },
        description: "DÃ¶nÃ¼ÅŸÃ¼m reÃ§eteleri ve boss sandÄ±k iÃ§eriklerini yÃ¶netin."
    },
    [WIDGET_TYPES.BOSS_SETTINGS]: {
        title: "Boss AyarlarÄ±",
        icon: "Shield",
        defaultData: {},
        description: "Boss rotasyonlarÄ±nÄ±, soÄŸuma sÃ¼relerini ve droplarÄ± yÃ¶netin."
    },
};

==================================================
DOSYA YOLU: .\app\store\useWidgetStore.js
==================================================
"use client";

import { create } from "zustand";
import { persist } from "zustand/middleware";
import { immer } from "zustand/middleware/immer";

// Slice'larÄ± iÃ§e aktar
import { createUISlice } from "./slices/createUISlice";
import { createMarketSlice } from "./slices/createMarketSlice";
import { createCraftingSlice } from "./slices/createCraftingSlice";

// Sabitleri iÃ§e aktar (EÄŸer app/store/constants.js oluÅŸturmadÄ±ysan, WIDGET_REGISTRY'yi app/data/constants.js yolundan alabilirsin)
// Not: EÄŸer constants dosyan yoksa bu satÄ±rÄ± kontrol et.
import { createBossSlice } from "./slices/createBossSlice";

// Sabitleri iÃ§e aktar (EÄŸer app/store/constants.js oluÅŸturmadÄ±ysan, WIDGET_REGISTRY'yi app/data/constants.js yolundan alabilirsin)
// Not: EÄŸer constants dosyan yoksa bu satÄ±rÄ± kontrol et.
import { WIDGET_REGISTRY } from "../store/constants";

// ============================================================================
// STORE OLUÅTURMA (Slice Pattern)
// ============================================================================
const useWidgetStore = create(
  persist(
    immer((...a) => ({
      ...createUISlice(...a),
      ...createMarketSlice(...a),
      ...createCraftingSlice(...a),
      ...createBossSlice(...a),
    })),
    {
      name: "financial-dashboard-storage", // LocalStorage Key
      version: 6, // Ã–NEMLÄ°: Versiyon 6'ya geÃ§tik, Boss slice eklendi.

      // Migration: Versiyon deÄŸiÅŸirse state'i temizle
      migrate: (persistedState, version) => {
        if (version < 6) {
          return {
            ...persistedState,
            bosses: [] // Yeni boss state'ini baÅŸlat
          };
        }
        return persistedState;
      },
    }
  )
);

// ============================================================================
// HELPER HOOKS
// ============================================================================

/**
 * Verilen widget tipine gÃ¶re Registry'den tanÄ±m dÃ¶ndÃ¼rÃ¼r
 */
export const useWidgetDefinition = (type) => {
  return WIDGET_REGISTRY[type] || null;
};

/**
 * Aktif workspace'i dÃ¶ndÃ¼rÃ¼r
 */
export const useActiveWorkspace = () => {
  return useWidgetStore((state) => {
    const activeId = state.activeWorkspaceId;
    return state.workspaces.find((ws) => ws.id === activeId);
  });
};

// ============================================================================
// EXPORTS
// ============================================================================
export { WIDGET_REGISTRY };
export default useWidgetStore;

==================================================
DOSYA YOLU: .\app\store\slices\createBossSlice.js
==================================================

import { ITEM_SOURCES, COOLDOWN_TYPES } from '../constants';

export const createBossSlice = (set, get) => ({
    // State
    bosses: [],

    // Actions
    addBoss: (boss) => set((state) => {
        const newBoss = {
            id: boss.id || crypto.randomUUID(),
            name: boss.name || "Yeni Boss",
            hp: boss.hp || 1000000,
            fixedRunTime: boss.fixedRunTime || 5, // Zindan/Tur sÃ¼resi (Dk) - Sabit koÅŸu sÃ¼resi
            constraints: {
                cooldown: boss.constraints?.cooldown || 60, // Dakika
                dailyLimit: boss.constraints?.dailyLimit || 0, // 0 = SÄ±nÄ±rsÄ±z
                minLevel: boss.constraints?.minLevel || 75,
                cooldownType: boss.constraints?.cooldownType || COOLDOWN_TYPES.ENTRY // 'entry' | 'exit'
            },
            drops: boss.drops || []
        };
        state.bosses.push(newBoss);
    }),

    updateBoss: (id, updates) => set((state) => {
        const boss = state.bosses.find(b => b.id === id);
        if (boss) {
            // Constraints mergesini manuel yap
            if (updates.constraints) {
                boss.constraints = { ...boss.constraints, ...updates.constraints };
                delete updates.constraints; // KalanlarÄ± normal merge yap
            }
            Object.assign(boss, updates);
        }
    }),

    removeBoss: (id) => set((state) => {
        state.bosses = state.bosses.filter(b => b.id !== id);
    }),

    addDropToBoss: (bossId, drop) => set((state) => {
        const boss = state.bosses.find(b => b.id === bossId);
        if (boss) {
            boss.drops.push({
                itemId: drop.itemId,
                chance: drop.chance || 10,
                count: drop.count || 1,
                sourceType: drop.sourceType || ITEM_SOURCES.MARKET
            });
        }
    }),

    removeDropFromBoss: (bossId, dropIndex) => set((state) => {
        const boss = state.bosses.find(b => b.id === bossId);
        if (boss) {
            boss.drops.splice(dropIndex, 1);
        }
    }),

    updateBossDrop: (bossId, dropIndex, updates) => set((state) => {
        const boss = state.bosses.find(b => b.id === bossId);
        if (boss && boss.drops[dropIndex]) {
            Object.assign(boss.drops[dropIndex], updates);
        }
    })
});

==================================================
DOSYA YOLU: .\app\store\slices\createCraftingSlice.js
==================================================

import { ITEM_SOURCES, CRAFTING_TYPES } from '../constants';

/**
 * Crafting Slice - Ãœretim, Boss SandÄ±klarÄ± ve DÃ¶nÃ¼ÅŸÃ¼m Zincirleri
 *
 * Bu slice, oyun iÃ§i crafting sistemini yÃ¶netir:
 * - 'recipe' tipi: ReÃ§ete (X + Y = Z)
 * - 'container' tipi: SandÄ±k/Boss (Ä°Ã§inden %X ÅŸansla Y Ã§Ä±kar)
 */
export const createCraftingSlice = (set) => ({
    craftingItems: [],

    /**
     * Yeni boÅŸ bir crafting Ã¶ÄŸesi oluÅŸturur
     * @param {string} name - Ã–ÄŸenin adÄ± (Ã–rn: "Azrail SandÄ±ÄŸÄ±")
     * @param {'recipe'|'container'|'fragment'} type - Ã–ÄŸe tipi
     */
    addCraftingItem: (name, type) =>
        set((state) => {
            const newItem = {
                id: crypto.randomUUID(),
                name: name || 'Yeni Ã–ÄŸe',
                type: type || CRAFTING_TYPES.RECIPE,
                contents: [],
            };
            state.craftingItems.push(newItem);
        }),

    /**
     * Crafting Ã¶ÄŸesini siler
     * @param {string} id - Silinecek Ã¶ÄŸenin ID'si
     */
    removeCraftingItem: (id) =>
        set((state) => {
            const index = state.craftingItems.findIndex((item) => item.id === id);
            if (index !== -1) {
                state.craftingItems.splice(index, 1);
            }
        }),

    /**
     * Crafting Ã¶ÄŸesini gÃ¼nceller (isim, tip vb.)
     * @param {string} id - GÃ¼ncellenecek Ã¶ÄŸenin ID'si
     * @param {object} updates - GÃ¼ncellenecek alanlar (name, type vb.)
     */
    updateCraftingItem: (id, updates) =>
        set((state) => {
            const item = state.craftingItems.find((item) => item.id === id);
            if (item) {
                Object.assign(item, updates);
            }
        }),

    /**
     * Bir crafting Ã¶ÄŸesinin iÃ§ine hammadde/iÃ§erik ekler
     * @param {string} parentId - Ana Ã¶ÄŸenin ID'si
     * @param {object} content - Eklenecek iÃ§erik
     * @param {string} content.itemId - BaÄŸlanan eÅŸyanÄ±n ID'si
     * @param {'market'|'crafting'} content.sourceType - Kaynak tipi (market veya crafting)
     * @param {number} content.count - Adet
     * @param {number} content.chance - Åans (0-100 arasÄ±, container iÃ§in)
     */
    addContentToItem: (parentId, content) =>
        set((state) => {
            const parentItem = state.craftingItems.find((item) => item.id === parentId);
            if (parentItem) {
                const newContent = {
                    id: crypto.randomUUID(),
                    itemId: content.itemId,
                    sourceType: content.sourceType || ITEM_SOURCES.MARKET, // 'market' veya 'crafting'
                    count: content.count || 1,
                    chance: content.chance || 100, // Container iÃ§in ÅŸans (%)
                };
                parentItem.contents.push(newContent);
            }
        }),

    /**
     * Bir crafting Ã¶ÄŸesinden hammadde/iÃ§erik siler
     * @param {string} parentId - Ana Ã¶ÄŸenin ID'si
     * @param {string} contentId - Silinecek iÃ§eriÄŸin ID'si
     */
    removeContentFromItem: (parentId, contentId) =>
        set((state) => {
            const parentItem = state.craftingItems.find((item) => item.id === parentId);
            if (parentItem) {
                const index = parentItem.contents.findIndex((c) => c.id === contentId);
                if (index !== -1) {
                    parentItem.contents.splice(index, 1);
                }
            }
        }),

    /**
     * Bir crafting Ã¶ÄŸesinin iÃ§eriÄŸini gÃ¼nceller (adet, ÅŸans vb.)
     * @param {string} parentId - Ana Ã¶ÄŸenin ID'si
     * @param {string} contentId - GÃ¼ncellenecek iÃ§eriÄŸin ID'si
     * @param {object} updates - GÃ¼ncellenecek alanlar (count, chance vb.)
     */
    updateContentInItem: (parentId, contentId, updates) =>
        set((state) => {
            const parentItem = state.craftingItems.find((item) => item.id === parentId);
            if (parentItem) {
                const content = parentItem.contents.find((c) => c.id === contentId);
                if (content) {
                    Object.assign(content, updates);
                }
            }
        }),
});

==================================================
DOSYA YOLU: .\app\store\slices\createMarketSlice.js
==================================================
import { MASTER_REGISTRY, INITIAL_SERVERS } from "../../data/initialData";
import { ITEM_SOURCES } from '../constants';

export const createMarketSlice = (set, get) => ({
    // --- STATE ---
    masterRegistry: MASTER_REGISTRY.items, // Global Katalog
    serverProfiles: INITIAL_SERVERS,       // Sunucu Listesi
    activeServerId: INITIAL_SERVERS[0]?.id || "server_marmara", // SeÃ§ili Sunucu

    // --- ACTIONS ---

    // 1. Sunucu YÃ¶netimi
    setActiveServer: (serverId) => set((state) => {
        const exists = state.serverProfiles.some(p => p.id === serverId);
        if (exists) state.activeServerId = serverId;
    }),

    addServerProfile: (name) => set((state) => {
        state.serverProfiles.push({
            id: `server_${Date.now()}`,
            name: name,
            currency: "Won",
            prices: {},
            multipliers: { drop: 1.0 }
        });
    }),

    // 2. Fiyat YÃ¶netimi (Sadece Aktif Sunucuya Yazar)
    updatePrice: (itemId, newPrice) => set((state) => {
        const activeProfile = state.serverProfiles.find(p => p.id === state.activeServerId);

        // ğŸ›¡ï¸ KORUMA: EÄŸer bu item "crafting" kÃ¶kenli ise elle deÄŸiÅŸtirmeyi engelle
        const itemRegistry = state.masterRegistry;
        const itemDef = itemRegistry.find(i => i.id === itemId);

        // EÄŸer item Ã¼retimden geliyorsa ve fiyatÄ± elle deÄŸiÅŸtirilmeye Ã§alÄ±ÅŸÄ±lÄ±yorsa engelle
        if (itemDef && itemDef.origin === ITEM_SOURCES.CRAFTING) {
            console.warn(`Item ${itemId} is a crafted item. Price cannot be updated manually.`);
            return;
        }

        if (activeProfile) {
            activeProfile.prices[itemId] = parseFloat(newPrice) || 0;
        }
    }),

    // âœ… YENÄ°: Crafting Widget'Ä±ndan gelen hesaplanmÄ±ÅŸ fiyatlarÄ± senkronize eder
    // Bu fonksiyon "BoÄŸucu Ä°ncir" taktiÄŸinin kalbidir.
    syncCraftedItems: (craftedItems) => set((state) => {
        const activeProfile = state.serverProfiles.find(p => p.id === state.activeServerId);
        if (!activeProfile) return;

        craftedItems.forEach(cItem => {
            // 1. Item Market KataloÄŸunda yoksa ekle (Origin: 'crafting' olarak iÅŸaretle)
            const exists = state.masterRegistry.some(i => i.id === cItem.id);
            if (!exists) {
                state.masterRegistry.push({
                    id: cItem.id,
                    name: cItem.name,
                    category: "Ã¼retim", // Otomatik kategori
                    icon: "Hammer",     // Ãœretim ikonu
                    origin: ITEM_SOURCES.CRAFTING, // ğŸ”’ KÄ°LÄ°T MEKANÄ°ZMASI
                    isSystemItem: false
                });
            } else {
                // Varsa ismini ve origin'i gÃ¼ncelle (belki kullanÄ±cÄ± Ã¼retimde ismini deÄŸiÅŸtirdi)
                const itemIndex = state.masterRegistry.findIndex(i => i.id === cItem.id);
                if (itemIndex !== -1) {
                    // Sadece ismi gÃ¼ncelle, mevcut kategoriyi bozma
                    state.masterRegistry[itemIndex].name = cItem.name;
                    // Emin olmak iÃ§in origin set et
                    if (!state.masterRegistry[itemIndex].origin) {
                        state.masterRegistry[itemIndex].origin = ITEM_SOURCES.CRAFTING;
                    }
                }
            }

            // 2. FiyatÄ± GÃ¼ncelle (Crafting'den gelen maliyeti yaz)
            if (cItem.price !== undefined) {
                activeProfile.prices[cItem.id] = cItem.price;
            }
        });
    }),

    // Toplu Fiyat GÃ¼ncelleme (Import iÅŸlemleri iÃ§in performans optimizasyonu)
    batchUpdatePrices: (priceMap) => set((state) => {
        const activeProfile = state.serverProfiles.find(p => p.id === state.activeServerId);
        if (activeProfile) {
            activeProfile.prices = {
                ...activeProfile.prices,
                ...priceMap
            };
        }
    }),

    // 3. Katalog YÃ¶netimi (Yeni Item Ekleme - Tekli)
    registerItem: (item) => set((state) => {
        const generatedId = item.id || item.name.toLowerCase().trim().replace(/\s+/g, '_');

        // Helper for normalization
        const normalize = (str) => String(str).trim().toLocaleLowerCase('tr');

        const idExists = state.masterRegistry.some(i => i.id === generatedId);
        const nameExists = state.masterRegistry.some(i => normalize(i.name) === normalize(item.name));

        if (!idExists && !nameExists) {
            state.masterRegistry.push({
                id: generatedId,
                name: item.name,
                category: item.category || "genel",
                icon: item.icon || "Circle",
                origin: ITEM_SOURCES.MARKET, // KullanÄ±cÄ± ekledi (Market KaynaklÄ±)
                isSystemItem: false
            });
        }
    }),

    // Toplu Item KaydÄ± (Import iÃ§in)
    registerItems: (items) => set((state) => {
        // YENÄ° NORMALÄ°ZASYON (marketUtils ile birebir aynÄ± olmalÄ±)
        const normalize = (str) => String(str)
            .normalize('NFC')
            .replace(/['".,\/#!$%\^&\*;:{}=\-_`~()]/g, "")
            .replace(/\s/g, "")
            .toLocaleLowerCase('tr');

        items.forEach(item => {
            // ID kontrolÃ¼
            const idExists = state.masterRegistry.some(i => i.id === item.id);

            // Ä°sim kontrolÃ¼ (Agresif)
            const nameExists = state.masterRegistry.some(i => normalize(i.name) === normalize(item.name));

            if (!idExists && !nameExists) {
                state.masterRegistry.push({
                    id: item.id, // Burada gelen ID'yi olduÄŸu gibi kullanÄ±yoruz
                    name: item.name,
                    category: item.category || "genel",
                    icon: item.icon || "Circle",
                    origin: ITEM_SOURCES.MARKET,
                    isSystemItem: false
                });
            }
        });
    }),

    // 4. Veri SÄ±fÄ±rlama
    resetMarketData: (scope) => set((state) => {
        const activeProfile = state.serverProfiles.find(p => p.id === state.activeServerId);

        if (scope === 'prices') {
            if (activeProfile) {
                activeProfile.prices = {};
            }
        } else if (scope === 'full') {
            if (activeProfile) {
                activeProfile.prices = {};
            }
            // Sadece sistem itemlarÄ±nÄ± ve crafting itemlarÄ±nÄ± tut
            // User tarafÄ±ndan eklenenleri sil
            state.masterRegistry = state.masterRegistry.filter(item => item.isSystemItem || item.origin === ITEM_SOURCES.CRAFTING);
        }
    }),
});

==================================================
DOSYA YOLU: .\app\store\slices\createUISlice.js
==================================================

export const createUISlice = (set, get) => ({
    // State
    activeWorkspaceId: "default-workspace",
    activeTab: "overview", // Default Tab: "overview", "market", "analysis", "boss", "settings"

    workspaces: [
        {
            id: "default-workspace",
            name: "Ana Panel",
            activeMarketProfileId: "default_server",
            // Data storage for components (no layout info needed anymore)
            data: {
                moneyInput: { amount: "" },
                noteTaker: { notes: "" }
            }
        },
    ],

    // Actions
    setActiveTab: (tabId) =>
        set((state) => {
            state.activeTab = tabId;
        }),

    addWorkspace: (name) =>
        set((state) => {
            const defaultProfileId = state.serverProfiles?.[0]?.id || "default_server";
            const newWorkspace = {
                id: crypto.randomUUID(),
                name: name || "Yeni Panel",
                activeMarketProfileId: defaultProfileId,
                data: {}
            };
            state.workspaces.push(newWorkspace);
            state.activeWorkspaceId = newWorkspace.id;
        }),

    switchWorkspace: (id) =>
        set((state) => {
            state.activeWorkspaceId = id;
        }),

    renameWorkspace: (workspaceId, newName) =>
        set((state) => {
            const workspace = state.workspaces.find((ws) => ws.id === workspaceId);
            if (workspace) {
                workspace.name = newName;
            }
        }),

    removeWorkspace: (workspaceId) =>
        set((state) => {
            if (state.workspaces.length <= 1) return;
            const workspaceIndex = state.workspaces.findIndex((ws) => ws.id === workspaceId);
            if (workspaceIndex === -1) return;

            if (state.activeWorkspaceId === workspaceId) {
                const newActiveIndex = workspaceIndex === state.workspaces.length - 1
                    ? workspaceIndex - 1
                    : workspaceIndex + 1;
                state.activeWorkspaceId = state.workspaces[newActiveIndex].id;
            }
            state.workspaces.splice(workspaceIndex, 1);
        }),

    // Data updater helper
    updateComponentData: (workspaceId, componentKey, data) =>
        set((state) => {
            const workspace = state.workspaces.find((ws) => ws.id === workspaceId);
            if (workspace) {
                if (!workspace.data) workspace.data = {};
                workspace.data[componentKey] = { ...workspace.data[componentKey], ...data };
            }
        }),

    // Widget data updater (backward compatibility)
    // widgetId genellikle workspaceId veya bir component key olarak kullanÄ±lÄ±r
    updateWidgetData: (widgetId, data) =>
        set((state) => {
            // widgetId aslÄ±nda workspaceId ise doÄŸrudan o workspace'e yaz
            let workspace = state.workspaces.find((ws) => ws.id === widgetId);

            // BulunamadÄ±ysa aktif workspace'i kullan
            if (!workspace) {
                workspace = state.workspaces.find((ws) => ws.id === state.activeWorkspaceId);
            }

            if (workspace) {
                if (!workspace.data) workspace.data = {};

                // EÄŸer data iÃ§inde 'metins' varsa, metinSettings altÄ±na kaydet
                if (data.metins) {
                    if (!workspace.data.metinSettings) workspace.data.metinSettings = {};
                    workspace.data.metinSettings.metins = data.metins;
                } else {
                    // DiÄŸer veriler iÃ§in generic merge
                    Object.keys(data).forEach(key => {
                        workspace.data[key] = data[key];
                    });
                }
            }
        }),

    setWorkspaceMarketProfile: (workspaceId, profileId) =>
        set((state) => {
            const workspace = state.workspaces.find((ws) => ws.id === workspaceId);
            if (workspace) {
                workspace.activeMarketProfileId = profileId;
            }
        }),

    nukeStore: () => {
        localStorage.removeItem("financial-dashboard-storage");
        window.location.reload();
    },
});

==================================================
DOSYA YOLU: .\app\v2\page.js
==================================================
import WorkstationLayout from "./components/WorkstationLayout";

export const metadata = {
    title: 'W2 Workstation',
    description: 'Advanced Simulation Workspace',
}

export default function V2Page() {
    return <WorkstationLayout />;
}

==================================================
DOSYA YOLU: .\app\v2\components\WorkstationLayout.js
==================================================
"use client";

import { useState, useEffect, useRef } from "react";
import { motion, AnimatePresence } from "framer-motion";
import { clsx } from "clsx";
import { twMerge } from "tailwind-merge";
import {
    LayoutGrid,
    Sword,
    Tractor, // For 'Farm'
    TrendingUp,
    Terminal,
    Play,
    Clock,
    Cpu,
    CheckCircle2,
    AlertCircle
} from "lucide-react";

// Utility for Tailwind class merging
function cn(...inputs) {
    return twMerge(clsx(inputs));
}

// ============================================================================
// COMPONENTS
// ============================================================================

// 1. TOOLBELT ITEM (Left Menu)
function ToolbeltItem({ id, icon: Icon, isActive, onClick, label }) {
    return (
        <button
            onClick={() => onClick(id)}
            className={cn(
                "relative group w-12 h-12 flex items-center justify-center rounded-xl transition-all duration-300",
                isActive
                    ? "bg-blue-600 shadow-[0_0_20px_rgba(37,99,235,0.5)] text-white"
                    : "bg-white/5 hover:bg-white/10 text-white/50 hover:text-white"
            )}
        >
            <Icon className="w-5 h-5" />

            {/* Tooltip */}
            <div className="absolute left-14 bg-black/90 border border-white/10 px-3 py-1.5 rounded-lg text-xs font-medium text-white opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap z-50">
                {label}
            </div>

            {/* Active Indicator */}
            {isActive && (
                <motion.div
                    layoutId="active-indicator"
                    className="absolute -left-1 w-1 h-6 bg-blue-500 rounded-r-full"
                />
            )}
        </button>
    );
}

// 2. STAGE PANEL (Main Content Area)
function StagePanel({ activeTool, onRunSimulation, progress, status }) {
    return (
        <motion.div
            layoutId="main-stage"
            className="w-full h-full bg-zinc-900/50 rounded-2xl border border-white/5 overflow-hidden flex flex-col relative"
        >
            {/* Background Grid Pattern */}
            <div className="absolute inset-0 opacity-[0.02] pointer-events-none"
                style={{ backgroundImage: 'radial-gradient(circle at 1px 1px, white 1px, transparent 0)', backgroundSize: '24px 24px' }}>
            </div>

            <AnimatePresence mode="wait">
                {activeTool === 'boss-sim' && (
                    <motion.div
                        key="boss-sim"
                        initial={{ opacity: 0, scale: 0.95 }}
                        animate={{ opacity: 1, scale: 1 }}
                        exit={{ opacity: 0, filter: 'blur(10px)' }}
                        className="flex-1 flex flex-col items-center justify-center p-12"
                    >
                        <div className="bg-black/40 p-8 rounded-3xl border border-white/5 backdrop-blur-xl shadow-2xl max-w-md w-full">
                            <div className="w-16 h-16 bg-blue-500/10 rounded-2xl flex items-center justify-center mb-6 mx-auto border border-blue-500/20">
                                <Sword className="w-8 h-8 text-blue-500" />
                            </div>

                            <h2 className="text-2xl font-bold text-white text-center mb-2">Boss SimÃ¼lasyonu</h2>
                            <p className="text-white/40 text-center text-sm mb-8">
                                Arka planda aÄŸÄ±r matematiksel iÅŸlem yapan Web Worker demosu.
                            </p>

                            <button
                                onClick={onRunSimulation}
                                disabled={status === 'running'}
                                className={cn(
                                    "w-full py-4 rounded-xl font-bold flex items-center justify-center gap-3 transition-all",
                                    status === 'running'
                                        ? "bg-white/5 text-white/20 cursor-not-allowed"
                                        : "bg-blue-600 hover:bg-blue-500 text-white shadow-lg hover:shadow-blue-500/25 active:scale-95"
                                )}
                            >
                                {status === 'running' ? (
                                    <>
                                        <div className="w-5 h-5 border-2 border-white/20 border-t-white rounded-full animate-spin" />
                                        HesaplanÄ±yor...
                                    </>
                                ) : (
                                    <>
                                        <Play className="w-5 h-5 fill-current" />
                                        SimÃ¼lasyonu BaÅŸlat
                                    </>
                                )}
                            </button>

                            {/* Progress Bar inside Card */}
                            <div className="mt-8 space-y-2">
                                <div className="flex justify-between text-xs font-medium">
                                    <span className={status === 'completed' ? "text-green-400" : "text-white/40"}>
                                        {status === 'idle' && "HazÄ±r"}
                                        {status === 'running' && "Ä°ÅŸleniyor..."}
                                        {status === 'completed' && "TamamlandÄ±"}
                                    </span>
                                    <span className="text-white/60">%{progress}</span>
                                </div>
                                <div className="h-2 bg-white/5 rounded-full overflow-hidden">
                                    <motion.div
                                        className={cn(
                                            "h-full rounded-full transition-all duration-300",
                                            status === 'completed' ? "bg-green-500" : "bg-blue-500"
                                        )}
                                        initial={{ width: 0 }}
                                        animate={{ width: `${progress}%` }}
                                    />
                                </div>
                            </div>
                        </div>
                    </motion.div>
                )}

                {activeTool === 'farm-plan' && (
                    <motion.div
                        key="farm-plan"
                        initial={{ opacity: 0, x: 20 }}
                        animate={{ opacity: 1, x: 0 }}
                        exit={{ opacity: 0, x: -20 }}
                        className="flex-1 flex items-center justify-center text-white/20 font-black text-6xl tracking-tighter"
                    >
                        FARM PLAN
                    </motion.div>
                )}

                {activeTool === 'market-analiz' && (
                    <motion.div
                        key="market-analiz"
                        initial={{ opacity: 0, y: 20 }}
                        animate={{ opacity: 1, y: 0 }}
                        exit={{ opacity: 0, y: -20 }}
                        className="flex-1 flex items-center justify-center text-white/20 font-black text-6xl tracking-tighter"
                    >
                        MARKET
                    </motion.div>
                )}
            </AnimatePresence>
        </motion.div>
    );
}

// ============================================================================
// MAIN LAYOUT
// ============================================================================

export default function WorkstationLayout() {
    const [activeTool, setActiveTool] = useState('boss-sim');
    const [progress, setProgress] = useState(0);
    const [status, setStatus] = useState('idle'); // idle | running | completed
    const [logs, setLogs] = useState([]);

    const workerRef = useRef(null);

    // Initialize Worker
    useEffect(() => {
        workerRef.current = new Worker(new URL('../workers/simulation.worker.js', import.meta.url));

        workerRef.current.onmessage = (event) => {
            const { type, progress, result, duration, message } = event.data;

            if (type === 'progress') {
                setProgress(progress);
            } else if (type === 'complete') {
                setProgress(100);
                setStatus('completed');
                addLog('success', `Ä°ÅŸlem TamamlandÄ±: ${result.toFixed(2)} (SÃ¼re: ${duration}ms)`);
            }
        };

        return () => {
            workerRef.current?.terminate();
        };
    }, []);

    const addLog = (type, message) => {
        setLogs(prev => [{ id: Date.now(), type, message }, ...prev].slice(0, 50));
    };

    const runSimulation = () => {
        if (status === 'running') return;

        setStatus('running');
        setProgress(0);
        addLog('info', 'SimÃ¼lasyon baÅŸlatÄ±lÄ±yor...');

        // Send message to worker
        workerRef.current.postMessage({
            action: 'start_simulation',
            loopCount: 50000000 // Heavy enough to notice
        });
    };

    return (
        <div className="h-screen w-full bg-black text-white p-4 grid gap-4 grid-cols-[80px_1fr] grid-rows-[1fr_200px] overflow-hidden font-sans selection:bg-blue-500/30">

            {/* 1. LEFT TOOLBELT */}
            <aside className="row-span-2 bg-zinc-900/50 rounded-2xl border border-white/5 flex flex-col items-center py-6 gap-4">
                <div className="mb-4">
                    <div className="w-10 h-10 bg-gradient-to-br from-blue-500 to-violet-600 rounded-lg flex items-center justify-center shadow-lg shadow-blue-500/20">
                        <LayoutGrid className="text-white w-6 h-6" />
                    </div>
                </div>

                <div className="w-8 h-[1px] bg-white/10 mb-2" />

                <ToolbeltItem
                    id="boss-sim"
                    icon={Sword}
                    isActive={activeTool === 'boss-sim'}
                    onClick={setActiveTool}
                    label="Boss SimÃ¼lasyonu"
                />
                <ToolbeltItem
                    id="farm-plan"
                    icon={Tractor}
                    isActive={activeTool === 'farm-plan'}
                    onClick={setActiveTool}
                    label="Ã‡iftlik PlanÄ±"
                />
                <ToolbeltItem
                    id="market-analiz"
                    icon={TrendingUp}
                    isActive={activeTool === 'market-analiz'}
                    onClick={setActiveTool}
                    label="Piyasa Analizi"
                />
            </aside>

            {/* 2. MAIN STAGE */}
            <main className="col-start-2 row-start-1 min-h-0">
                <StagePanel
                    activeTool={activeTool}
                    onRunSimulation={runSimulation}
                    progress={progress}
                    status={status}
                />
            </main>

            {/* 3. TIMELINE / LOGS */}
            <footer className="col-start-2 row-start-2 bg-zinc-900/50 rounded-2xl border border-white/5 overflow-hidden flex flex-col">
                {/* Header */}
                <div className="h-10 border-b border-white/5 flex items-center px-4 gap-2 bg-black/20">
                    <Terminal className="w-4 h-4 text-white/40" />
                    <span className="text-xs font-bold text-white/50 uppercase tracking-wider">System Logs</span>
                    <div className="ml-auto flex gap-2">
                        <div className="w-2 h-2 rounded-full bg-green-500 animate-pulse" />
                        <span className="text-[10px] text-green-500 font-mono">ONLINE</span>
                    </div>
                </div>

                {/* Log Content */}
                <div className="flex-1 overflow-y-auto p-4 font-mono text-sm space-y-1 custom-scrollbar">
                    <AnimatePresence initial={false}>
                        {logs.map((log) => (
                            <motion.div
                                key={log.id}
                                initial={{ opacity: 0, x: -20 }}
                                animate={{ opacity: 1, x: 0 }}
                                className={cn(
                                    "flex items-center gap-3",
                                    log.type === 'error' ? "text-red-400" :
                                        log.type === 'success' ? "text-green-400" : "text-white/60"
                                )}
                            >
                                <span className="text-white/20 text-[10px]">
                                    {new Date(log.id).toLocaleTimeString()}
                                </span>
                                {log.type === 'success' ? <CheckCircle2 className="w-3 h-3" /> :
                                    log.type === 'error' ? <AlertCircle className="w-3 h-3" /> :
                                        <Clock className="w-3 h-3 text-white/20" />}

                                <span>{log.message}</span>
                            </motion.div>
                        ))}
                        {logs.length === 0 && (
                            <div className="text-white/20 italic">Sistem hazÄ±r. Log kaydÄ± bekleniyor...</div>
                        )}
                    </AnimatePresence>
                </div>
            </footer>

        </div>
    );
}

==================================================
DOSYA YOLU: .\app\v2\workers\simulation.worker.js
==================================================
/**
 * Simulation Web Worker
 * Handles heavy calculations off the main thread to keep UI responsive.
 */

self.onmessage = (e) => {
    const { action, loopCount } = e.data;

    if (action === 'start_simulation') {
        runSimulation(loopCount || 10000000);
    }
};

function runSimulation(maxLoops) {
    console.log('Worker: Starting simulation with', maxLoops, 'loops');
    let sum = 0;
    const updateInterval = Math.floor(maxLoops / 20); // Update every 5%

    const startTime = performance.now();

    for (let i = 0; i <= maxLoops; i++) {
        // Heavy calculation simulation (Math.sqrt is relatively expensive)
        sum += Math.sqrt(i) * Math.sin(i);

        // Send progress updates
        if (i % updateInterval === 0 || i === maxLoops) {
            const progress = Math.round((i / maxLoops) * 100);

            // Artificial delay to make it visible to the human eye for demo purposes
            // In production code you wouldn't slow it down intentionaly like this
            if (i % (updateInterval * 2) === 0) {
                const now = Date.now();
                while (Date.now() - now < 50) { /* Busy wait 50ms */ }
            }

            self.postMessage({
                type: 'progress',
                progress: progress,
                currentStep: i,
                totalSteps: maxLoops
            });
        }
    }

    const endTime = performance.now();
    const duration = (endTime - startTime).toFixed(2);

    self.postMessage({
        type: 'complete',
        result: sum,
        duration: duration,
        message: `SimÃ¼lasyon tamamlandÄ±! (${duration}ms)`
    });
}

==================================================
DOSYA YOLU: .\public\workers\alchemy.worker.js
==================================================
/**
 * Dragon Soul Alchemy Simulation Worker - Revised
 *
 * Ejderha TaÅŸÄ± SimyasÄ± Monte Carlo SimÃ¼lasyonu
 */

// ============================================================================
// CONSTANTS
// ============================================================================

const SAFETY_LIMIT = 100_000;

// Element definitions
const ELEMENTS = {
    diamond: { name: 'Elmas', color: 'cyan' },
    ruby: { name: 'Yakut', color: 'rose' },
    jade: { name: 'YeÅŸim', color: 'emerald' },
    sapphire: { name: 'Safir', color: 'blue' },
    garnet: { name: 'Garnet', color: 'orange' },
    onyx: { name: 'Oniks', color: 'zinc' },
    amethyst: { name: 'Ametist', color: 'purple' }
};

// Stone class levels (ascending order)
const CLASS_LEVELS = ['rough', 'cut', 'rare', 'antique', 'legendary', 'mythic'];

// Stone clarity levels (ascending order)
const CLARITY_LEVELS = ['matte', 'clear', 'brilliant', 'excellent', 'flawless'];

// Default configuration
const DEFAULT_CONFIG = {
    activeElements: ['diamond', 'ruby', 'jade', 'sapphire', 'garnet', 'onyx'],
    corOutput: 'rough',
    targetClass: 'mythic',       // Hedef sÄ±nÄ±f (antique, legendary, mythic)
    upgradeClarity: false,       // SaflÄ±k yÃ¼kseltmesi yapÄ±lsÄ±n mÄ±?
    requirements: {
        classUpgrade: 2,
        clarityUpgrade: 2
    },
    rates: {
        class: 50,
        clarity: 70
    }
};

// ============================================================================
// HELPER FUNCTIONS
// ============================================================================

function getRandomElement(activeElements) {
    const idx = Math.floor(Math.random() * activeElements.length);
    return activeElements[idx];
}

function createEmptyInventory(activeElements) {
    const inventory = {};
    activeElements.forEach(element => {
        inventory[element] = {};
        CLASS_LEVELS.forEach(classLevel => {
            inventory[element][classLevel] = {};
            CLARITY_LEVELS.forEach(clarity => {
                inventory[element][classLevel][clarity] = 0;
            });
        });
    });
    return inventory;
}

function getClassIndex(classLevel) {
    return CLASS_LEVELS.indexOf(classLevel);
}

function simulateCorOpening(corCount, config) {
    const inventory = createEmptyInventory(config.activeElements);
    const outputLevel = config.corOutput || 'rough';
    const startClarity = 'matte';

    for (let i = 0; i < corCount; i++) {
        const element = getRandomElement(config.activeElements);
        inventory[element][outputLevel][startClarity]++;
    }

    return inventory;
}

function populateInventory(count, inputConfig, activeElements) {
    const inventory = createEmptyInventory(activeElements);
    const { itemClass, itemClarity } = inputConfig;

    // Distribute count across active elements randomly or evenly?
    // Let's assume the user has X count of EACH active element or TOTAL?
    // User says "16 Mythic Rubies". Usually implies specific element.
    // If multiple elements active, we should probably distribute?
    // Ideally, for "Direct Material", we might want to simulate ONE element type if the user meant "I have 16 Rubies".
    // But current UI selects "Active Elements" globally.
    // Let's assume the input count is TOTAL distributed randomly among active.

    for (let i = 0; i < count; i++) {
        const element = getRandomElement(activeElements);
        inventory[element][itemClass][itemClarity]++;
    }

    return inventory;
}

// ============================================================================
// UPGRADE FUNCTIONS
// ============================================================================

function upgradeClassOnly(inventory, config) {
    const { classUpgrade } = config.requirements;
    const classRate = config.rates.class / 100;
    const targetClassIndex = getClassIndex(config.targetClass);

    Object.keys(inventory).forEach(element => {
        for (let classIdx = 0; classIdx < targetClassIndex; classIdx++) {
            const currentClass = CLASS_LEVELS[classIdx];
            const nextClass = CLASS_LEVELS[classIdx + 1];

            CLARITY_LEVELS.forEach(clarity => {
                let safetyCounter = 0;
                while (inventory[element][currentClass][clarity] >= classUpgrade && safetyCounter < SAFETY_LIMIT) {
                    safetyCounter++;
                    inventory[element][currentClass][clarity] -= classUpgrade;

                    if (Math.random() < classRate) {
                        inventory[element][nextClass][clarity]++;
                    } else {
                        inventory[element][currentClass][clarity]++;
                    }
                }
            });
        }
    });
    return inventory;
}

function upgradeClarityOnly(inventory, config) {
    const { clarityUpgrade } = config.requirements;
    const clarityRate = config.rates.clarity / 100;
    const targetClass = config.targetClass;

    Object.keys(inventory).forEach(element => {
        for (let clarityIdx = 0; clarityIdx < CLARITY_LEVELS.length - 1; clarityIdx++) {
            const currentClarity = CLARITY_LEVELS[clarityIdx];
            const nextClarity = CLARITY_LEVELS[clarityIdx + 1];
            let safetyCounter = 0;

            while (inventory[element][targetClass][currentClarity] >= clarityUpgrade && safetyCounter < SAFETY_LIMIT) {
                safetyCounter++;
                inventory[element][targetClass][currentClarity] -= clarityUpgrade;

                if (Math.random() < clarityRate) {
                    inventory[element][targetClass][nextClarity]++;
                } else {
                    inventory[element][targetClass][currentClarity]++;
                }
            }
        }
    });

    return inventory;
}

// ============================================================================
// INVENTORY UTILITIES
// ============================================================================

function sumInventories(inv1, inv2, activeElements) {
    const result = createEmptyInventory(activeElements);
    activeElements.forEach(element => {
        CLASS_LEVELS.forEach(classLevel => {
            CLARITY_LEVELS.forEach(clarity => {
                result[element][classLevel][clarity] =
                    (inv1[element]?.[classLevel]?.[clarity] || 0) +
                    (inv2[element]?.[classLevel]?.[clarity] || 0);
            });
        });
    });
    return result;
}

function averageInventory(inventory, divisor, activeElements) {
    const result = createEmptyInventory(activeElements);
    activeElements.forEach(element => {
        CLASS_LEVELS.forEach(classLevel => {
            CLARITY_LEVELS.forEach(clarity => {
                result[element][classLevel][clarity] =
                    (inventory[element][classLevel][clarity] || 0) / divisor;
            });
        });
    });
    return result;
}

function calculateSummary(inventory, config) {
    const summary = {
        targetClassTotal: {},
        targetClassByClarity: {},
        leftoversByClass: {}
    };
    const targetClass = config.targetClass;
    const targetClassIndex = getClassIndex(targetClass);

    config.activeElements.forEach(element => {
        let targetTotal = 0;
        const clarityBreakdown = {};

        CLARITY_LEVELS.forEach(clarity => {
            const count = inventory[element][targetClass][clarity] || 0;
            targetTotal += count;
            if (count > 0.001) clarityBreakdown[clarity] = count;
        });

        summary.targetClassTotal[element] = targetTotal;
        summary.targetClassByClarity[element] = clarityBreakdown;

        const leftovers = {};
        for (let i = 0; i < targetClassIndex; i++) {
            const classLevel = CLASS_LEVELS[i];
            let classTotal = 0;
            CLARITY_LEVELS.forEach(clarity => {
                classTotal += inventory[element][classLevel][clarity] || 0;
            });
            if (classTotal > 0.001) leftovers[classLevel] = classTotal;
        }

        if (Object.keys(leftovers).length > 0) {
            summary.leftoversByClass[element] = leftovers;
        }
    });
    return summary;
}

function calculateFinancials(summary, corCount, corPrice, config) {
    const totalCost = corCount * corPrice;
    let totalTargetStones = 0;
    let totalFlawlessStones = 0;

    Object.values(summary.targetClassTotal).forEach(count => totalTargetStones += count);

    if (config.upgradeClarity) {
        Object.values(summary.targetClassByClarity).forEach(clarityBreakdown => {
            totalFlawlessStones += clarityBreakdown.flawless || 0;
        });
    }

    return {
        totalCost,
        costPerTargetStone: totalTargetStones > 0 ? Math.round(totalCost / totalTargetStones) : 0,
        costPerFlawless: totalFlawlessStones > 0 ? Math.round(totalCost / totalFlawlessStones) : 0,
        totalTargetStones: parseFloat(totalTargetStones.toFixed(2)),
        totalFlawlessStones: parseFloat(totalFlawlessStones.toFixed(2))
    };
}

// ============================================================================
// MAIN SIMULATION
// ============================================================================

function runSimulation(corCount, simCount, config, corPrice, inputConfig) {
    const updateInterval = Math.max(1, Math.floor(simCount / 20));
    let totalInventory = createEmptyInventory(config.activeElements);

    // Default to 'cor' mode if undefined
    const mode = inputConfig?.mode || 'cor';
    const startClass = mode === 'material' ? inputConfig.itemClass : (config.corOutput || 'rough');

    // Determine if we need to run Class Upgrade
    // If starting class index < target class index, we run it.
    const startClassIdx = getClassIndex(startClass);
    const targetClassIdx = getClassIndex(config.targetClass);
    const shouldUpgradeClass = startClassIdx < targetClassIdx;

    for (let sim = 0; sim < simCount; sim++) {
        let inventory;

        // Step 1: Initialize Inventory
        if (mode === 'material') {
            inventory = populateInventory(corCount, inputConfig, config.activeElements);
        } else {
            inventory = simulateCorOpening(corCount, config);
        }

        // Step 2: Upgrade Class (if needed)
        if (shouldUpgradeClass) {
            inventory = upgradeClassOnly(inventory, config);
        }

        // Step 3: Upgrade Clarity (if enabled)
        if (config.upgradeClarity) {
            inventory = upgradeClarityOnly(inventory, config);
        }

        totalInventory = sumInventories(totalInventory, inventory, config.activeElements);

        if ((sim + 1) % updateInterval === 0) {
            self.postMessage({ type: 'progress', progress: Math.round(((sim + 1) / simCount) * 100) });
        }
    }

    const averageResults = averageInventory(totalInventory, simCount, config.activeElements);
    const summary = calculateSummary(averageResults, config);
    // Adjust financials to treat "cor count" as "start material count" if in material mode?
    // Yes, essentially initial cost calculation might differ, but logic remains "Input Qty * Unit Price"
    const financials = calculateFinancials(summary, corCount, corPrice || 0, config);

    return {
        averageInventory: averageResults,
        summary,
        financials,
        corCount,
        corPrice: corPrice || 0,
        simCount,
        config: { ...config }
    };
}

// ============================================================================
// REVERSE CALCULATOR (TARGET COST)
// ============================================================================

function determineTargetCost(targetConfig, simCount, config, corPrice) {
    const { baseElement, targetGrade, targetClarity } = targetConfig;
    const updateInterval = Math.max(1, Math.floor(simCount / 10));

    let totalCorsUsed = 0;
    let minCors = Infinity;
    let maxCors = 0;

    // Optimization
    const outputLevel = config.corOutput || 'rough';
    const runConfig = {
        ...config,
        activeElements: [baseElement],
        targetClass: targetGrade,
        upgradeClarity: true
    };
    const checkClarity = config.upgradeClarity || targetClarity !== 'matte';
    if (checkClarity) runConfig.upgradeClarity = true;

    const BATCH_SIZE = 100; // Fast batch size
    const MAX_CORS = SAFETY_LIMIT * 5;

    for (let sim = 0; sim < simCount; sim++) {
        let corsUsed = 0;
        let found = false;
        let inventory = createEmptyInventory([baseElement]);

        while (corsUsed < MAX_CORS) {
            corsUsed += BATCH_SIZE;

            // 1. Add Cors
            inventory[baseElement][outputLevel]['matte'] += BATCH_SIZE;

            // 2. Upgrade Class
            inventory = upgradeClassOnly(inventory, runConfig);

            // 3. Upgrade Clarity
            if (checkClarity) {
                inventory = upgradeClarityOnly(inventory, runConfig);
            }

            // 4. Check for Target
            if (inventory[baseElement][targetGrade][targetClarity] >= 1) {
                found = true;
                break;
            }
        }

        if (found) {
            totalCorsUsed += corsUsed;
            minCors = Math.min(minCors, corsUsed);
            maxCors = Math.max(maxCors, corsUsed);
        } else {
            totalCorsUsed += MAX_CORS;
            maxCors = Math.max(maxCors, MAX_CORS);
        }

        if ((sim + 1) % updateInterval === 0) {
            self.postMessage({ type: 'progress', progress: Math.round(((sim + 1) / simCount) * 100) });
        }
    }

    const avgCors = totalCorsUsed / simCount;

    return {
        targetCost: {
            avgCors,
            minCors: minCors === Infinity ? 0 : minCors,
            maxCors,
            targetConfig
        },
        corPrice: corPrice || 0,
        simCount,
        config
    };
}

// ============================================================================
// MESSAGE HANDLER
// ============================================================================

self.onmessage = (e) => {
    const { action, corCount, corPrice, simCount, config, targetConfig, inputConfig } = e.data;

    try {
        const actualConfig = {
            ...DEFAULT_CONFIG,
            ...config,
            requirements: { ...DEFAULT_CONFIG.requirements, ...config?.requirements },
            rates: { ...DEFAULT_CONFIG.rates, ...config?.rates }
        };

        if (action === 'run_simulation') {
            console.log('[Alchemy Worker] Starting Inv Sim');
            const startTime = performance.now();
            const result = runSimulation(
                corCount || 100,
                simCount || 100,
                actualConfig,
                corPrice || 0,
                inputConfig // Pass input config
            );
            const endTime = performance.now();
            self.postMessage({ type: 'complete', ...result, duration: (endTime - startTime).toFixed(2) });

        } else if (action === 'calculate_target_cost') {
            console.log('[Alchemy Worker] Starting Target Cost');
            const startTime = performance.now();
            const result = determineTargetCost(targetConfig, simCount || 50, actualConfig, corPrice || 0);
            const endTime = performance.now();
            self.postMessage({ type: 'complete', ...result, duration: (endTime - startTime).toFixed(2) });
        }
    } catch (error) {
        self.postMessage({ type: 'error', message: error.message || 'Simulation failed' });
    }
};

==================================================
DOSYA YOLU: .\public\workers\blacksmith.worker.js
==================================================
/**
 * Blacksmith (Demirci) Monte Carlo Simulation Worker
 *
 * State Machine based simulation for weapon/armor upgrade system.
 * Supports:
 * - Additive vs Multiplicative chance calculation
 * - Pity systems (none, incremental, hard)
 * - Priority-based material usage
 * - Protection and degradation mechanics
 */

// ============================================================================
// CONSTANTS
// ============================================================================

const SAFETY_LIMIT = 1_000_000;

// Material definitions with their properties
const MATERIALS = {
    blessing_scroll: {
        name: 'Kutsama KaÄŸÄ±dÄ±',
        bonusChance: 0,          // Base bonus %
        protected: false,        // Item not destroyed on fail
        degradeOnFail: true,     // Level decreases on fail
        price: 1000000           // Default price
    },
    magic_stone: {
        name: 'BÃ¼yÃ¼lÃ¼ Metal',
        bonusChance: 5,          // +5% bonus
        protected: true,         // Item protected on fail
        degradeOnFail: false,
        price: 5000000
    },
    ritual_stone: {
        name: 'RitÃ¼el TaÅŸÄ±',
        bonusChance: 10,         // +10% bonus
        protected: true,
        degradeOnFail: false,
        price: 15000000
    },
    blacksmith_book: {
        name: 'Demirci El KitabÄ±',
        bonusChance: 15,         // +15% bonus (buff item)
        protected: true,
        degradeOnFail: false,
        price: 50000000
    },
    raw: {
        name: 'Demirci (KorumasÄ±z)',
        bonusChance: 0,
        protected: false,
        degradeOnFail: false,    // Item destroyed on fail
        price: 0
    }
};

// Default level-based upgrade chances
// Each level: { baseChance, pityLimit, upgradeCost }
const DEFAULT_LEVEL_CONFIG = {
    0: { baseChance: 90, pityLimit: 5, upgradeCost: 0 },
    1: { baseChance: 85, pityLimit: 5, upgradeCost: 0 },
    2: { baseChance: 80, pityLimit: 6, upgradeCost: 0 },
    3: { baseChance: 75, pityLimit: 6, upgradeCost: 0 },
    4: { baseChance: 70, pityLimit: 7, upgradeCost: 100000 },
    5: { baseChance: 60, pityLimit: 8, upgradeCost: 200000 },
    6: { baseChance: 50, pityLimit: 10, upgradeCost: 300000 },
    7: { baseChance: 40, pityLimit: 12, upgradeCost: 400000 },
    8: { baseChance: 30, pityLimit: 15, upgradeCost: 500000 },
    9: { baseChance: 20, pityLimit: 20, upgradeCost: 1000000 }
};

// ============================================================================
// HELPER FUNCTIONS
// ============================================================================

/**
 * Calculate final success chance based on config
 */
function calculateChance(baseChance, itemBonus, calcMode, pityBonus = 0) {
    let finalChance;

    if (calcMode === 'multiplicative') {
        // Multiplicative: Base * (1 + bonus/100)
        finalChance = baseChance * (1 + itemBonus / 100);
    } else {
        // Additive: Base + bonus
        finalChance = baseChance + itemBonus;
    }

    // Add pity bonus
    finalChance += pityBonus;

    // Cap at 100%
    return Math.min(finalChance, 100);
}

/**
 * Get pity bonus based on system type
 */
function getPityBonus(pitySystem, failCount, pityLimit) {
    if (pitySystem === 'none') {
        return 0;
    }

    if (pitySystem === 'hard') {
        // Hard pity: 100% at limit
        // If limit is 0, pity is disabled for this level (True RNG)
        if (pityLimit > 0 && failCount >= pityLimit) {
            return 100; // Force success
        }
        return 0;
    }

    if (pitySystem === 'incremental') {
        // Incremental: +5% per fail
        return failCount * 5;
    }

    return 0;
}

/**
 * Select material from priority list based on available stock
 */
function selectMaterial(priorityList, stock, fallbackToRaw = true) {
    for (const materialId of priorityList) {
        if (stock[materialId] && stock[materialId] > 0) {
            return materialId;
        }
    }

    // No materials available
    if (fallbackToRaw) {
        return 'raw'; // Blacksmith mode (no protection)
    }

    return null; // Stop simulation
}

/**
 * Deep clone object
 */
function cloneObject(obj) {
    return JSON.parse(JSON.stringify(obj));
}

// ============================================================================
// SINGLE SIMULATION
// ============================================================================

/**
 * Run a single upgrade attempt from startLevel to targetLevel
 * State-based approach: while (currentStage !== targetStage)
 * @returns {Object} { success, finalLevel, materialsUsed, attempts, stuckAt, isDestroyed, yangCost }
 */
function simulateSingleUpgrade(startLevel, targetLevel, inventory, config, strategy, materialBonuses, marketPrices) {
    let currentLevel = startLevel;
    let stock = cloneObject(inventory);
    let attempts = 0;
    let materialsUsed = {};
    let pityCounters = {}; // Per-level pity tracking
    let isDestroyed = false;
    let stuckAtLevel = null;
    let stockOutWarnings = [];
    let totalYangCost = 0; // Track upgrade (Yang) costs

    // Initialize materials used tracking
    Object.keys(MATERIALS).forEach(m => {
        materialsUsed[m] = 0;
    });

    let safetyCounter = 0;

    // State-based loop: continue until we reach target state
    while (currentLevel !== targetLevel && safetyCounter < SAFETY_LIMIT) {
        safetyCounter++;
        attempts++;

        // Get strategy for current level (Refine Table entry)
        const defaultConfig = DEFAULT_LEVEL_CONFIG[currentLevel] || { baseChance: 30, pityLimit: 10, upgradeCost: 0 };
        const levelStrategy = strategy[currentLevel] || {
            baseChance: defaultConfig.baseChance,
            pityLimit: defaultConfig.pityLimit,
            priorityList: ['blessing_scroll'],
            upgradeCost: defaultConfig.upgradeCost
        };

        // Add upgrade cost for this attempt (applied on every attempt, success or fail)
        const attemptYangCost = levelStrategy.upgradeCost || 0;

        // Calculate extra material costs (from Market DB)
        let extraMaterialCost = 0;
        if (levelStrategy.requiredMaterials) {
            levelStrategy.requiredMaterials.forEach(req => {
                const price = marketPrices[req.itemId] || 0;
                extraMaterialCost += price * req.count;
            });
        }

        // Add both to total Yang Cost (Money spent)
        totalYangCost += attemptYangCost + extraMaterialCost;

        // Initialize pity counter for this level if needed
        if (pityCounters[currentLevel] === undefined) {
            pityCounters[currentLevel] = 0;
        }

        // Step 1: Select material from priority list
        const selectedMaterialId = selectMaterial(
            levelStrategy.priorityList || ['blessing_scroll'],
            stock,
            config.fallbackToRaw !== false
        );

        if (selectedMaterialId === null) {
            // No materials and fallback disabled - stop
            stuckAtLevel = currentLevel;
            break;
        }

        // Consume material (except 'raw')
        if (selectedMaterialId !== 'raw') {
            if (stock[selectedMaterialId] > 0) {
                stock[selectedMaterialId]--;
                materialsUsed[selectedMaterialId]++;
            } else {
                // Track stock-out event
                stockOutWarnings.push({
                    level: currentLevel,
                    material: selectedMaterialId,
                    attempt: attempts
                });
            }
        }

        const material = MATERIALS[selectedMaterialId];

        // Step 2: Calculate success chance
        // Use user-defined bonus if available, otherwise 0 (or fallback to material default if needed, but logic says user defines it)
        // For 'raw', bonus is always 0.
        const bonusChance = selectedMaterialId === 'raw'
            ? 0
            : (materialBonuses[selectedMaterialId] ?? 0);

        const pityBonus = getPityBonus(
            config.pitySystem,
            pityCounters[currentLevel],
            levelStrategy.pityLimit
        );

        const finalChance = calculateChance(
            levelStrategy.baseChance,
            bonusChance,
            config.calcMode,
            pityBonus
        );

        // Step 3: Roll the dice
        const roll = Math.random() * 100;
        const success = roll < finalChance;

        if (success) {
            // SUCCESS: Level up
            currentLevel++;
            pityCounters[currentLevel - 1] = 0; // Reset pity for previous level
        } else {
            // FAIL: Apply consequences based on material
            pityCounters[currentLevel]++;

            if (material.protected) {
                // Protected: Nothing happens, item stays
            } else if (material.degradeOnFail) {
                // Degrade: Level decreases
                currentLevel = Math.max(0, currentLevel - 1);
            } else {
                // Unprotected (raw): Item destroyed
                isDestroyed = true;
                break;
            }
        }
    }

    return {
        success: currentLevel >= targetLevel,
        finalLevel: currentLevel,
        materialsUsed,
        attempts,
        stuckAtLevel,
        isDestroyed,
        stockOutWarnings,
        remainingStock: stock,
        yangCost: totalYangCost // Upgrade fees (separate from material cost)
    };
}

// ============================================================================
// MONTE CARLO SIMULATION
// ============================================================================

/**
 * Run Monte Carlo simulation
 */
function runSimulation(params) {
    const {
        startLevel,
        targetLevel,
        inventory,
        config,
        strategy,
        materialBonuses,
        prices, // Custom prices for fixed mats (Blessing Scroll etc)
        marketPrices, // Live market prices for dynamic mats
        simCount
    } = params;

    const updateInterval = Math.max(1, Math.floor(simCount / 20));

    // Results tracking
    let successCount = 0;
    let totalAttempts = 0;
    let totalMaterialCost = 0;  // Cost from materials
    let totalYangCost = 0;      // Cost from upgrade fees
    let destroyedCount = 0;

    // Material usage tracking
    const totalMaterialsUsed = {};
    Object.keys(MATERIALS).forEach(m => {
        totalMaterialsUsed[m] = 0;
    });

    // Level stuck tracking (for chart)
    const levelAttempts = {};
    for (let i = startLevel; i <= targetLevel; i++) {
        levelAttempts[i] = 0;
    }

    // Stock-out analysis
    const stockOutEvents = {};

    for (let sim = 0; sim < simCount; sim++) {
        const result = simulateSingleUpgrade(
            startLevel,
            targetLevel,
            inventory,
            config,
            strategy,
            materialBonuses,
            marketPrices // Pass market prices
        );

        if (result.success) {
            successCount++;
        }

        if (result.isDestroyed) {
            destroyedCount++;
        }

        totalAttempts += result.attempts;

        // Sum up materials and material costs
        Object.entries(result.materialsUsed).forEach(([mat, count]) => {
            totalMaterialsUsed[mat] += count;
            // Calculate material cost using custom price or default
            const unitPrice = prices?.[mat] ?? MATERIALS[mat]?.price ?? 0;
            totalMaterialCost += count * unitPrice;
        });

        // Sum up Yang (upgrade) costs
        totalYangCost += result.yangCost || 0;

        // Track where people got stuck (final level)
        if (levelAttempts[result.finalLevel] !== undefined) {
            levelAttempts[result.finalLevel]++;
        }

        // Track stock-out events
        result.stockOutWarnings.forEach(warning => {
            const key = `${warning.level}_${warning.material}`;
            if (!stockOutEvents[key]) {
                stockOutEvents[key] = { ...warning, count: 0, totalAttempt: 0 };
            }
            stockOutEvents[key].count++;
            stockOutEvents[key].totalAttempt += warning.attempt;
        });

        // Progress update
        if ((sim + 1) % updateInterval === 0 || sim === simCount - 1) {
            self.postMessage({
                type: 'progress',
                progress: Math.round(((sim + 1) / simCount) * 100),
                currentStep: sim + 1,
                totalSteps: simCount
            });
        }
    }

    // Calculate averages
    const avgAttempts = totalAttempts / simCount;
    const avgMaterialCost = totalMaterialCost / simCount;
    const avgYangCost = totalYangCost / simCount;
    const avgTotalCost = avgMaterialCost + avgYangCost;
    const successRate = (successCount / simCount) * 100;
    const destroyRate = (destroyedCount / simCount) * 100;

    // Average materials per simulation
    const avgMaterials = {};
    Object.entries(totalMaterialsUsed).forEach(([mat, total]) => {
        avgMaterials[mat] = parseFloat((total / simCount).toFixed(2));
    });

    // Stock analysis - calculate if user's inventory is sufficient
    const stockAnalysis = {};
    Object.entries(avgMaterials).forEach(([mat, avgUsed]) => {
        const userStock = inventory[mat] || 0;
        const deficit = avgUsed - userStock;
        stockAnalysis[mat] = {
            required: avgUsed,
            available: userStock,
            deficit: deficit > 0 ? parseFloat(deficit.toFixed(2)) : 0,
            sufficient: deficit <= 0
        };
    });

    // Stock-out warnings summary
    const stockOutSummary = Object.values(stockOutEvents)
        .filter(e => e.count > simCount * 0.1) // More than 10% of sims
        .map(e => ({
            level: e.level,
            material: e.material,
            materialName: MATERIALS[e.material]?.name || e.material,
            frequency: parseFloat(((e.count / simCount) * 100).toFixed(1)),
            avgAttempt: Math.round(e.totalAttempt / e.count)
        }))
        .sort((a, b) => b.frequency - a.frequency);

    // Level distribution for chart
    const levelDistribution = Object.entries(levelAttempts).map(([level, count]) => ({
        level: parseInt(level),
        count,
        percentage: parseFloat(((count / simCount) * 100).toFixed(1))
    }));

    return {
        successRate: parseFloat(successRate.toFixed(2)),
        destroyRate: parseFloat(destroyRate.toFixed(2)),
        avgAttempts: parseFloat(avgAttempts.toFixed(1)),
        avgCost: Math.round(avgTotalCost),           // Total (Material + Yang)
        avgMaterialCost: Math.round(avgMaterialCost), // Material cost breakdown
        avgYangCost: Math.round(avgYangCost),        // Upgrade fee breakdown
        avgMaterials,
        stockAnalysis,
        stockOutSummary,
        levelDistribution,
        simCount,
        startLevel,
        targetLevel
    };
}

// ============================================================================
// MESSAGE HANDLER
// ============================================================================

self.onmessage = (e) => {
    const { action, ...params } = e.data;

    if (action === 'run_simulation') {
        try {
            console.log('[Blacksmith Worker] Starting simulation:', params);

            const startTime = performance.now();

            const result = runSimulation({
                startLevel: params.startLevel ?? 0,
                targetLevel: params.targetLevel ?? 9,
                inventory: params.inventory ?? {},
                config: params.config ?? { calcMode: 'additive', pitySystem: 'none' },
                strategy: params.strategy ?? {},
                materialBonuses: params.materialBonuses ?? {},
                prices: params.prices ?? {},
                marketPrices: params.marketPrices ?? {}, // Pass market prices
                simCount: params.simCount ?? 1000
            });

            const endTime = performance.now();

            self.postMessage({
                type: 'complete',
                ...result,
                duration: (endTime - startTime).toFixed(2)
            });
        } catch (error) {
            console.error('[Blacksmith Worker] Error:', error);
            self.postMessage({
                type: 'error',
                message: error.message || 'Simulation failed'
            });
        }
    }

    if (action === 'get_materials') {
        // Return material definitions for UI
        self.postMessage({
            type: 'materials',
            materials: MATERIALS,
            defaultLevelConfig: DEFAULT_LEVEL_CONFIG
        });
    }
};

==================================================
DOSYA YOLU: .\public\workers\sash.worker.js
==================================================
/**
 * Sash (KuÅŸak) Monte Carlo Simulation Worker
 *
 * Bu worker, kuÅŸak birleÅŸtirme maliyetini simÃ¼le eder.
 *
 * Logic:
 * - 1 â†’ 5 (%90 baÅŸarÄ±)
 * - 5 â†’ 10 (%80 baÅŸarÄ±)
 * - 10 â†’ Hakim (%70 baÅŸarÄ±)
 * - Hakim (Acced): 10+10 birleÅŸince 11-20 arasÄ± emiÅŸ atar
 *   - Weighted Random: 11-15 yÃ¼ksek, 16-18 orta, 19-20 dÃ¼ÅŸÃ¼k ihtimal
 * - Upgrade: Hedef emiÅŸe ulaÅŸana kadar iki hakimi birleÅŸtir
 *   - %50 baÅŸarÄ±, artÄ±ÅŸ +1 ile +5 arasÄ±
 */

// ============================================================================
// CONSTANTS
// ============================================================================

// GÃ¼venlik limiti - sonsuz dÃ¶ngÃ¼den korunma (1 milyon deneme)
const SAFETY_LIMIT = 1_000_000;

// VarsayÄ±lan oranlar (kullanÄ±cÄ± gÃ¶ndermezse)
const DEFAULT_RATES = {
    grade1: 90,   // 1 -> 5 geÃ§me ÅŸansÄ± (%)
    grade2: 80,   // 5 -> 10 geÃ§me ÅŸansÄ± (%)
    grade3: 70,   // 10 -> Hakim geÃ§me ÅŸansÄ± (%)
    upgrade: 50   // Hakim emiÅŸ arttÄ±rma ÅŸansÄ± (%)
};

const UPGRADE_MIN_INCREASE = 1;
const UPGRADE_MAX_INCREASE = 5;

// Hakim emiÅŸ aÄŸÄ±rlÄ±klarÄ± (11-20 arasÄ±)
// 11-15: yÃ¼ksek ihtimal, 16-18: orta, 19-20: Ã§ok dÃ¼ÅŸÃ¼k
const HAKIM_WEIGHTS = {
    11: 25,
    12: 22,
    13: 18,
    14: 14,
    15: 10,
    16: 5,
    17: 3,
    18: 2,
    19: 0.7,
    20: 0.3
};

// ============================================================================
// HELPER FUNCTIONS
// ============================================================================

/**
 * Weighted random seÃ§im
 * @param {Object} weights - { value: weight } formatÄ±nda aÄŸÄ±rlÄ±klar
 * @returns {number} SeÃ§ilen deÄŸer
 */
function weightedRandom(weights) {
    const entries = Object.entries(weights);
    const totalWeight = entries.reduce((sum, [, w]) => sum + w, 0);
    let random = Math.random() * totalWeight;

    for (const [value, weight] of entries) {
        random -= weight;
        if (random <= 0) {
            return parseInt(value, 10);
        }
    }

    // Fallback (olmamalÄ± ama gÃ¼venlik iÃ§in)
    return 11;
}

/**
 * Random int between min and max (inclusive)
 */
function randomInt(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
}

/**
 * Bir adet Lv1 kuÅŸaÄŸÄ± Lv5'e yÃ¼kseltme maliyeti
 * @param {number} clothPrice - KumaÅŸ fiyatÄ±
 * @param {number} clothCount - 1 adet %1 kuÅŸak iÃ§in gereken kumaÅŸ sayÄ±sÄ±
 * @param {Object} rates - Dinamik baÅŸarÄ± oranlarÄ±
 * @returns {{ cost: number, clothUsed: number, success: boolean }}
 */
function combineTo5(clothPrice, clothCount, rates) {
    // Her deneme 2 kuÅŸak kullanÄ±r (2 adet Lv1 kuÅŸak)
    // Her kuÅŸak clothCount kadar kumaÅŸ gerektirir
    let totalCost = 0;
    let clothUsed = 0;
    let safetyCounter = 0;
    const successRate = rates.grade1 / 100; // YÃ¼zdeyi ondalÄ±ÄŸa Ã§evir

    while (true) {
        safetyCounter++;
        if (safetyCounter > SAFETY_LIMIT) {
            throw new Error("Ä°ÅŸlem limiti aÅŸÄ±ldÄ±! 1âœ™5 oranÄ± Ã§ok dÃ¼ÅŸÃ¼k olabilir.");
        }

        // 2 adet Lv1 kuÅŸak = 2 * clothCount kumaÅŸ
        const clothNeeded = clothCount * 2;
        totalCost += clothPrice * clothNeeded;
        clothUsed += clothNeeded;

        if (Math.random() < successRate) {
            return { cost: totalCost, clothUsed, success: true };
        }
    }
}

/**
 * Ä°ki adet Lv5 kuÅŸaÄŸÄ± Lv10'a yÃ¼kseltme maliyeti
 * @param {number} clothPrice - KumaÅŸ fiyatÄ±
 * @param {number} clothCount - 1 adet %1 kuÅŸak iÃ§in gereken kumaÅŸ sayÄ±sÄ±
 * @param {Object} rates - Dinamik baÅŸarÄ± oranlarÄ±
 * @returns {{ cost: number, clothUsed: number, success: boolean }}
 */
function combineTo10(clothPrice, clothCount, rates) {
    let totalCost = 0;
    let clothUsed = 0;
    let safetyCounter = 0;
    const successRate = rates.grade2 / 100;

    while (true) {
        safetyCounter++;
        if (safetyCounter > SAFETY_LIMIT) {
            throw new Error("Ä°ÅŸlem limiti aÅŸÄ±ldÄ±! 5â‘10 oranÄ± Ã§ok dÃ¼ÅŸÃ¼k olabilir.");
        }

        // 2 adet Lv5 kuÅŸak gerekli - her birinin maliyetini hesapla
        const lv5_1 = combineTo5(clothPrice, clothCount, rates);
        const lv5_2 = combineTo5(clothPrice, clothCount, rates);

        totalCost += lv5_1.cost + lv5_2.cost;
        clothUsed += lv5_1.clothUsed + lv5_2.clothUsed;

        if (Math.random() < successRate) {
            return { cost: totalCost, clothUsed, success: true };
        }
    }
}

/**
 * Ä°ki adet Lv10 kuÅŸaÄŸÄ± Hakim'e yÃ¼kseltme (11-20 arasÄ± emiÅŸ atar)
 * @param {number} clothPrice - KumaÅŸ fiyatÄ±
 * @param {number} clothCount - 1 adet %1 kuÅŸak iÃ§in gereken kumaÅŸ sayÄ±sÄ±
 * @param {Object} rates - Dinamik baÅŸarÄ± oranlarÄ±
 * @returns {{ cost: number, clothUsed: number, grade: number }}
 */
function combineToHakim(clothPrice, clothCount, rates) {
    let totalCost = 0;
    let clothUsed = 0;
    let safetyCounter = 0;
    const successRate = rates.grade3 / 100;

    while (true) {
        safetyCounter++;
        if (safetyCounter > SAFETY_LIMIT) {
            throw new Error("Ä°ÅŸlem limiti aÅŸÄ±ldÄ±! 10â‘Hakim oranÄ± Ã§ok dÃ¼ÅŸÃ¼k olabilir.");
        }

        // 2 adet Lv10 kuÅŸak gerekli
        const lv10_1 = combineTo10(clothPrice, clothCount, rates);
        const lv10_2 = combineTo10(clothPrice, clothCount, rates);

        totalCost += lv10_1.cost + lv10_2.cost;
        clothUsed += lv10_1.clothUsed + lv10_2.clothUsed;

        if (Math.random() < successRate) {
            const grade = weightedRandom(HAKIM_WEIGHTS);
            return { cost: totalCost, clothUsed, grade };
        }
    }
}

/**
 * Hakim kuÅŸaÄŸÄ± hedef emiÅŸe yÃ¼kseltme
 * @param {number} clothPrice - KumaÅŸ fiyatÄ±
 * @param {number} clothCount - 1 adet %1 kuÅŸak iÃ§in gereken kumaÅŸ sayÄ±sÄ±
 * @param {number} targetGrade - Hedef emiÅŸ (Ã¶rn: 25)
 * @param {Object} rates - Dinamik baÅŸarÄ± oranlarÄ±
 * @returns {{ cost: number, clothUsed: number, finalGrade: number }}
 */
function upgradeToTarget(clothPrice, clothCount, targetGrade, rates) {
    // Ä°lk hakim kuÅŸaÄŸÄ±nÄ± al
    let current = combineToHakim(clothPrice, clothCount, rates);
    let totalCost = current.cost;
    let clothUsed = current.clothUsed;
    let currentGrade = current.grade;
    let safetyCounter = 0;
    const upgradeRate = rates.upgrade / 100;

    // Hedef emiÅŸe ulaÅŸana kadar upgrade
    while (currentGrade < targetGrade) {
        safetyCounter++;
        if (safetyCounter > SAFETY_LIMIT) {
            throw new Error("Ä°ÅŸlem limiti aÅŸÄ±ldÄ±! Upgrade oranÄ± Ã§ok dÃ¼ÅŸÃ¼k olabilir.");
        }

        // Ä°kinci bir hakim kuÅŸak gerekli
        const second = combineToHakim(clothPrice, clothCount, rates);
        totalCost += second.cost;
        clothUsed += second.clothUsed;

        // Dinamik baÅŸarÄ± ÅŸansÄ±
        if (Math.random() < upgradeRate) {
            // BaÅŸarÄ±lÄ± - +1 ile +5 arasÄ± artÄ±ÅŸ
            const increase = randomInt(UPGRADE_MIN_INCREASE, UPGRADE_MAX_INCREASE);
            currentGrade = Math.min(currentGrade + increase, 100); // Max %100
        }
        // BaÅŸarÄ±sÄ±z - ikinci hakim kaybedilir, mevcut kuÅŸak kalÄ±r
    }

    return { cost: totalCost, clothUsed, finalGrade: currentGrade };
}

/**
 * Monte Carlo simÃ¼lasyonu Ã§alÄ±ÅŸtÄ±r
 * @param {number} clothPrice - KumaÅŸ fiyatÄ±
 * @param {number} clothCount - 1 adet %1 kuÅŸak iÃ§in gereken kumaÅŸ sayÄ±sÄ±
 * @param {number} targetGrade - Hedef emiÅŸ oranÄ±
 * @param {number} simCount - SimÃ¼lasyon sayÄ±sÄ±
 * @param {Object} rates - Dinamik baÅŸarÄ± oranlarÄ±
 */
function runSimulation(clothPrice, clothCount, targetGrade, simCount, rates) {
    const results = [];
    const updateInterval = Math.max(1, Math.floor(simCount / 20)); // Her %5'te gÃ¼ncelle

    let totalCost = 0;
    let totalCloth = 0;
    let minCost = Infinity;
    let maxCost = 0;

    for (let i = 0; i < simCount; i++) {
        const result = upgradeToTarget(clothPrice, clothCount, targetGrade, rates);

        results.push(result.cost);
        totalCost += result.cost;
        totalCloth += result.clothUsed;

        if (result.cost < minCost) minCost = result.cost;
        if (result.cost > maxCost) maxCost = result.cost;

        // Progress update
        if ((i + 1) % updateInterval === 0 || i === simCount - 1) {
            self.postMessage({
                type: "progress",
                progress: Math.round(((i + 1) / simCount) * 100),
                currentStep: i + 1,
                totalSteps: simCount
            });
        }
    }

    const avgCost = totalCost / simCount;
    const avgCloth = totalCloth / simCount;

    // Maliyet daÄŸÄ±lÄ±mÄ± iÃ§in histogram (10 bucket)
    const distribution = calculateDistribution(results, 10);

    return {
        avgCost: Math.round(avgCost),
        minCost: Math.round(minCost),
        maxCost: Math.round(maxCost),
        totalClothUsed: Math.round(avgCloth),
        simCount,
        targetGrade,
        distribution
    };
}

// ============================================================================
// BUDGET SIMULATION (GÃ–REV 3) - OPTIMIZED BATCH PROCESSING
// ============================================================================

/**
 * Fisher-Yates shuffle for array randomization
 */
function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
}

/**
 * Single budget simulation using iterative batch processing
 * @param {number} clothBudget - Total cloth available
 * @param {number} clothPerSash - Cloth needed for 1 sash (e.g., 40)
 * @param {Object} rates - Success rates { grade1, grade2, grade3, upgrade }
 * @param {number} absorptionCap - Maximum absorption limit (e.g., 25)
 * @returns {number} - Final best grade achieved
 */
function simulateBatchBudget(clothBudget, clothPerSash, rates, absorptionCap = 25) {
    // Convert rates to decimals
    const r1 = rates.grade1 / 100;  // 1 -> 5
    const r2 = rates.grade2 / 100;  // 5 -> 10
    const r3 = rates.grade3 / 100;  // 10 -> Hakim
    const rUp = rates.upgrade / 100; // Upgrade

    // Inventory pools
    let grade1 = 0;
    let grade5 = 0;
    let grade10 = 0;
    let acced = []; // Array of absorption values (11-20)

    // =============================================
    // STEP 1: Cloth -> Grade 1 sashes
    // =============================================
    // Each sash attempt uses 2 * clothPerSash cloth
    const sashAttempts = Math.floor(clothBudget / (clothPerSash * 2));

    for (let i = 0; i < sashAttempts; i++) {
        if (Math.random() < r1) {
            grade1++;
        }
    }

    // =============================================
    // STEP 2: Grade 1 -> Grade 5
    // =============================================
    // Combine 2 Grade 1 to attempt Grade 5
    const g5Attempts = Math.floor(grade1 / 2);
    grade1 = grade1 % 2; // Leftover

    for (let i = 0; i < g5Attempts; i++) {
        if (Math.random() < r1) { // Note: using grade1 rate for 1->5
            grade5++;
        }
    }

    // =============================================
    // STEP 3: Grade 5 -> Grade 10
    // =============================================
    const g10Attempts = Math.floor(grade5 / 2);
    grade5 = grade5 % 2; // Leftover

    for (let i = 0; i < g10Attempts; i++) {
        if (Math.random() < r2) {
            grade10++;
        }
    }

    // =============================================
    // STEP 4: Grade 10 -> Hakim (Acced)
    // =============================================
    const hakimAttempts = Math.floor(grade10 / 2);
    grade10 = grade10 % 2; // Leftover

    for (let i = 0; i < hakimAttempts; i++) {
        if (Math.random() < r3) {
            // Generate random absorption (11-20) using weighted distribution
            const absorption = weightedRandom(HAKIM_WEIGHTS);
            acced.push(absorption);
        }
    }

    // =============================================
    // STEP 5: Hakim Upgrade (combine acced sashes)
    // =============================================
    if (acced.length === 0) {
        // No Hakim sashes created - fallback to best leftover grade
        if (grade10 > 0) return 10;
        if (grade5 > 0) return 5;
        if (grade1 > 0) return 1;
        return 0; // Complete failure
    }

    // Shuffle for randomness
    shuffleArray(acced);

    // Track sashes that reached the cap
    let finishedSashes = [];

    // Keep upgrading while we have 2+ sashes in the active pool
    while (acced.length >= 2) {
        // Take base and fodder
        const baseSash = acced.shift();
        const fodderSash = acced.shift(); // Fodder is always consumed

        if (Math.random() < rUp) {
            // Success: increase absorption by 1-5
            const increase = randomInt(UPGRADE_MIN_INCREASE, UPGRADE_MAX_INCREASE);
            // Clamp to absorptionCap instead of 100
            const newGrade = Math.min(baseSash + increase, absorptionCap);

            // If sash reached the cap, move to finished pool
            if (newGrade >= absorptionCap) {
                finishedSashes.push(newGrade);
            } else {
                acced.push(newGrade);
            }
        } else {
            // Fail: base stays the same, fodder is lost
            // Check if base was already at cap (shouldn't happen but safety check)
            if (baseSash >= absorptionCap) {
                finishedSashes.push(baseSash);
            } else {
                acced.push(baseSash);
            }
        }
    }

    // Combine remaining active sashes with finished sashes
    const allSashes = [...finishedSashes, ...acced];

    // Return the best sash (highest grade)
    return allSashes.length > 0 ? Math.max(...allSashes) : 0;
}

/**
 * Run budget simulation monte carlo
 * @param {number} clothBudget - Mevcut kumaÅŸ adedi
 * @param {number} clothCount - 1 adet %1 kuÅŸak iÃ§in gereken kumaÅŸ
 * @param {number} clothPrice - KumaÅŸ fiyatÄ± (maliyet iÃ§in)
 * @param {number} simCount - SimÃ¼lasyon sayÄ±sÄ±
 * @param {Object} rates - BaÅŸarÄ± oranlarÄ±
 * @param {number} absorptionCap - Maksimum emiÅŸ sÄ±nÄ±rÄ± (sunucu limiti)
 */
function runBudgetSimulation(clothBudget, clothCount, clothPrice, simCount, rates, absorptionCap = 25) {
    const updateInterval = Math.max(1, Math.floor(simCount / 20));

    const gradeDistribution = {}; // Her emiÅŸ deÄŸerinin kaÃ§ kez elde edildiÄŸi
    let totalGrade = 0;
    let maxGrade = 0;
    let minGrade = Infinity;

    for (let i = 0; i < simCount; i++) {
        const finalGrade = simulateBatchBudget(clothBudget, clothCount, rates, absorptionCap);

        totalGrade += finalGrade;

        if (finalGrade > maxGrade) maxGrade = finalGrade;
        if (finalGrade < minGrade) minGrade = finalGrade;

        // Grade daÄŸÄ±lÄ±mÄ±nÄ± kaydet
        gradeDistribution[finalGrade] = (gradeDistribution[finalGrade] || 0) + 1;

        // Progress update
        if ((i + 1) % updateInterval === 0 || i === simCount - 1) {
            self.postMessage({
                type: "progress",
                progress: Math.round(((i + 1) / simCount) * 100),
                currentStep: i + 1,
                totalSteps: simCount
            });
        }
    }

    const avgGrade = totalGrade / simCount;

    // Handle edge case where no sashes were created
    if (minGrade === Infinity) minGrade = 0;

    // DaÄŸÄ±lÄ±mÄ± yÃ¼zde olarak hesapla
    const percentageDistribution = {};
    Object.entries(gradeDistribution).forEach(([grade, count]) => {
        percentageDistribution[grade] = {
            count,
            percentage: ((count / simCount) * 100).toFixed(1)
        };
    });

    return {
        avgGrade: parseFloat(avgGrade.toFixed(2)),
        minGrade,
        maxGrade,
        totalCost: clothBudget * clothPrice,
        clothUsed: clothBudget,
        simCount,
        gradeDistribution: percentageDistribution
    };
}

/**
 * SonuÃ§ daÄŸÄ±lÄ±mÄ±nÄ± hesapla (histogram iÃ§in)
 * @param {number[]} results - Maliyet listesi
 * @param {number} bucketCount - Bucket sayÄ±sÄ±
 */
function calculateDistribution(results, bucketCount) {
    if (results.length === 0) return [];

    const min = Math.min(...results);
    const max = Math.max(...results);
    const range = max - min || 1;
    const bucketSize = range / bucketCount;

    const buckets = Array(bucketCount).fill(0);

    for (const value of results) {
        const bucketIndex = Math.min(
            Math.floor((value - min) / bucketSize),
            bucketCount - 1
        );
        buckets[bucketIndex]++;
    }

    return buckets.map((count, i) => ({
        range: `${formatCurrency(min + i * bucketSize)} - ${formatCurrency(min + (i + 1) * bucketSize)}`,
        count,
        percentage: ((count / results.length) * 100).toFixed(1)
    }));
}

/**
 * Para formatla
 */
function formatCurrency(value) {
    if (value >= 1000000000) {
        return `${(value / 1000000000).toFixed(1)}B`;
    }
    if (value >= 1000000) {
        return `${(value / 1000000).toFixed(1)}M`;
    }
    if (value >= 1000) {
        return `${(value / 1000).toFixed(1)}K`;
    }
    return Math.round(value).toString();
}

// ============================================================================
// MESSAGE HANDLER
// ============================================================================

self.onmessage = (e) => {
    const { action, clothPrice, clothCount, clothBudget, targetGrade, simCount, rates, mode, absorptionCap } = e.data;

    if (action === "run_simulation") {
        try {
            const actualClothCount = clothCount || 40;
            const actualRates = rates || DEFAULT_RATES;
            const actualAbsorptionCap = absorptionCap || 25;

            console.log("[Sash Worker] Starting simulation:", {
                mode: mode || 'target',
                clothPrice,
                clothCount: actualClothCount,
                targetGrade,
                clothBudget,
                absorptionCap: actualAbsorptionCap,
                simCount,
                rates: actualRates
            });

            const startTime = performance.now();
            let result;

            // Mode kontrolÃ¼: budget veya target
            if (mode === 'budget') {
                result = runBudgetSimulation(
                    clothBudget || 1000,
                    actualClothCount,
                    clothPrice || 1000000,
                    simCount || 1000,
                    actualRates,
                    actualAbsorptionCap
                );
            } else {
                result = runSimulation(
                    clothPrice || 1000000,
                    actualClothCount,
                    targetGrade || 25,
                    simCount || 1000,
                    actualRates
                );
            }

            const endTime = performance.now();

            self.postMessage({
                type: "complete",
                mode: mode || 'target',
                ...result,
                clothCount: actualClothCount,
                rates: actualRates,
                duration: (endTime - startTime).toFixed(2)
            });
        } catch (error) {
            self.postMessage({
                type: "error",
                message: error.message || "Simulation failed"
            });
        }
    }
};

==================================================
DOSYA YOLU: .\src\experiments\RoadmapFilter\FilterContext.tsx
==================================================
import React, { createContext, useContext, useState, ReactNode, useCallback } from 'react';

interface FilterState {
    minLevel: number;
    maxLevel: number;
    excludedMaps: string[];
    selectedElement: string | null;
}

interface FilterContextType extends FilterState {
    setMinLevel: (level: number) => void;
    setMaxLevel: (level: number) => void;
    setExcludedMaps: (maps: string[]) => void;
    setSelectedElement: (element: string | null) => void;
    resetFilters: () => void;
}

const defaultState: FilterState = {
    minLevel: 1,
    maxLevel: 120,
    excludedMaps: [],
    selectedElement: null,
};

const FilterContext = createContext<FilterContextType | undefined>(undefined);

export const FilterProvider = ({ children }: { children: ReactNode }) => {
    const [state, setState] = useState<FilterState>(defaultState);

    const setMinLevel = useCallback((minLevel: number) => {
        setState(prev => ({ ...prev, minLevel }));
    }, []);

    const setMaxLevel = useCallback((maxLevel: number) => {
        setState(prev => ({ ...prev, maxLevel }));
    }, []);

    const setExcludedMaps = useCallback((excludedMaps: string[]) => {
        setState(prev => ({ ...prev, excludedMaps }));
    }, []);

    const setSelectedElement = useCallback((selectedElement: string | null) => {
        setState(prev => ({ ...prev, selectedElement }));
    }, []);

    const resetFilters = useCallback(() => {
        setState(defaultState);
    }, []);

    const value = {
        ...state,
        setMinLevel,
        setMaxLevel,
        setExcludedMaps,
        setSelectedElement,
        resetFilters,
    };

    return (
        <FilterContext.Provider value={value}>
            {children}
        </FilterContext.Provider>
    );
};

export const useFilterContext = () => {
    const context = useContext(FilterContext);
    if (context === undefined) {
        throw new Error('useFilterContext must be used within a FilterProvider');
    }
    return context;
};

==================================================
DOSYA YOLU: .\src\experiments\RoadmapFilter\FilterSidebar.tsx
==================================================
import React from 'react';
import { useFilterContext } from './FilterContext';

const COMMON_MAPS = [
    "Seungryong Valley",
    "Yongbi Desert",
    "Sohan Mountain",
    "Fireland",
    "Ghost Forest",
    "Red Wood",
    "Land of Giants",
    "Grotto of Exile"
];

export const FilterSidebar: React.FC = () => {
    const {
        minLevel,
        maxLevel,
        excludedMaps,
        setMinLevel,
        setMaxLevel,
        setExcludedMaps,
        resetFilters
    } = useFilterContext();

    const handleMapToggle = (mapName: string) => {
        if (excludedMaps.includes(mapName)) {
            setExcludedMaps(excludedMaps.filter(m => m !== mapName));
        } else {
            setExcludedMaps([...excludedMaps, mapName]);
        }
    };

    return (
        <div className="w-full md:w-80 bg-zinc-900 border-2 border-yellow-600/50 rounded-lg p-6 shadow-[0_0_15px_rgba(202,138,4,0.2)] text-yellow-100 font-serif">
            <h2 className="text-2xl font-bold text-yellow-500 mb-6 border-b border-yellow-600/30 pb-2 text-center uppercase tracking-widest">
                Filter Panel
            </h2>

            {/* Level Range Section */}
            <div className="mb-8">
                <h3 className="text-lg font-semibold text-yellow-200/80 mb-4 flex items-center gap-2">
                    <span className="w-2 h-2 bg-yellow-500 rotate-45"></span>
                    Level Range
                </h3>
                <div className="flex items-center gap-4">
                    <div className="flex-1">
                        <label className="block text-xs text-yellow-500/70 mb-1 uppercase">Min</label>
                        <input
                            type="number"
                            min={1}
                            max={120}
                            value={minLevel}
                            onChange={(e) => setMinLevel(Number(e.target.value))}
                            className="w-full bg-black/40 border border-yellow-700/50 rounded px-3 py-2 text-yellow-100 focus:outline-none focus:border-yellow-500 focus:ring-1 focus:ring-yellow-500/50 transition-all text-center font-mono"
                        />
                    </div>
                    <span className="text-yellow-600 font-bold mt-5">-</span>
                    <div className="flex-1">
                        <label className="block text-xs text-yellow-500/70 mb-1 uppercase">Max</label>
                        <input
                            type="number"
                            min={1}
                            max={120}
                            value={maxLevel}
                            onChange={(e) => setMaxLevel(Number(e.target.value))}
                            className="w-full bg-black/40 border border-yellow-700/50 rounded px-3 py-2 text-yellow-100 focus:outline-none focus:border-yellow-500 focus:ring-1 focus:ring-yellow-500/50 transition-all text-center font-mono"
                        />
                    </div>
                </div>
            </div>

            {/* Map Filter Section */}
            <div className="mb-8">
                <h3 className="text-lg font-semibold text-yellow-200/80 mb-4 flex items-center gap-2">
                    <span className="w-2 h-2 bg-yellow-500 rotate-45"></span>
                    Map Visibility
                </h3>
                <div className="space-y-2 max-h-60 overflow-y-auto pr-2 custom-scrollbar">
                    {COMMON_MAPS.map((map) => {
                        const isExcluded = excludedMaps.includes(map);
                        return (
                            <label
                                key={map}
                                className={`flex items-center gap-3 p-2 rounded cursor-pointer transition-all border ${!isExcluded
                                        ? 'bg-yellow-900/20 border-yellow-600/30 hover:bg-yellow-900/30'
                                        : 'bg-black/20 border-white/5 opacity-60 hover:opacity-80'
                                    }`}
                            >
                                <div className={`w-4 h-4 border rounded flex items-center justify-center transition-colors ${!isExcluded ? 'border-yellow-500 bg-yellow-500/20' : 'border-zinc-600'
                                    }`}>
                                    {!isExcluded && <div className="w-2 h-2 bg-yellow-400 rounded-sm" />}
                                </div>
                                <input
                                    type="checkbox"
                                    checked={!isExcluded}
                                    onChange={() => handleMapToggle(map)}
                                    className="hidden"
                                />
                                <span className={!isExcluded ? 'text-yellow-100' : 'text-zinc-500 line-through'}>
                                    {map}
                                </span>
                            </label>
                        );
                    })}
                </div>
            </div>

            {/* Actions */}
            <button
                onClick={resetFilters}
                className="w-full py-3 px-4 bg-red-900/30 hover:bg-red-900/50 border border-red-700/50 text-red-200 rounded transition-all uppercase tracking-wider text-sm font-bold hover:shadow-[0_0_10px_rgba(220,38,38,0.2)]"
            >
                Reset Filters
            </button>
        </div>
    );
};

==================================================
DOSYA YOLU: .\src\experiments\RoadmapFilter\useFilteredRoadmap.ts
==================================================
import { useMemo } from 'react';
import { useFilterContext } from './FilterContext';

export interface RoadmapItem {
    id: string | number;
    name: string;
    level: number;
    map: string;
    element?: string;
    [key: string]: any;
}

export const useFilteredRoadmap = (rawData: RoadmapItem[]) => {
    const { minLevel, maxLevel, excludedMaps, selectedElement } = useFilterContext();

    const filteredData = useMemo(() => {
        console.log(`Filtering ${rawData.length} items...`);
        console.log('Filter Criteria:', { minLevel, maxLevel, excludedMaps, selectedElement });

        const result = rawData.filter((item) => {
            // 1. Level Check
            if (item.level < minLevel || item.level > maxLevel) {
                return false;
            }

            // 2. Map Check (Excluded)
            if (excludedMaps.includes(item.map)) {
                return false;
            }

            // 3. Element Check (Optional)
            if (selectedElement && item.element !== selectedElement) {
                return false;
            }

            return true;
        });

        console.log(`Filtered down to ${result.length} items.`);
        return result;
    }, [rawData, minLevel, maxLevel, excludedMaps, selectedElement]);

    return filteredData;
};
