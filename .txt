=== PROJE DOSYA AƒûACI ===
./
    jsconfig.json
    kok124.py
    package.json
    README.md
    saveal.py
    app/
        globals.css
        layout.js
        page.js
        components/
            FinancialWidget.js
            InteractiveBackground.js
            LayoutWrapper.js
            PerformanceToggle.js
            WidgetCatalog.js
            WidgetDock.js
            WorkspaceDock.js
            widgets/
                AnalysisWidget.js
                CharacterWidget.js
                CraftingWidget.js
                DamageProgressionWidget.js
                MarketSupplyWidget.js
                MarketWidget.js
                MetinSettingsWidget.js
                analysis/
                    AnalysisChart.js
                    AnalysisKPIs.js
                    AnalysisSummaryView.js
                    AnalysisTable.js
                metin-settings/
                    ImportExportModal.js
                    MetinAccordionItem.js
                    MetinHeader.js
                    MetinList.js
                    MetinSummary.js
        data/
            initialData.js
        lib/
            calculator.js
            excelUtils.js
            marketUtils.js
        store/
            constants.js
            useWidgetStore.js
            slices/
                createCraftingSlice.js
                createMarketSlice.js
                createUISlice.js
    public/
    _eski_drop/
        eslint.config.js
        index.html
        metin2_drop_sim.html
        package.json
        project_context.md
        README.md
        vite.config.js


=== DOSYA ƒ∞√áERƒ∞KLERƒ∞ ===


==================================================
DOSYA YOLU: .\jsconfig.json
==================================================
{
  "compilerOptions": {
    "paths": {
      "@/*": ["./*"]
    }
  }
}


==================================================
DOSYA YOLU: .\kok124.py
==================================================
import os

# Yoksayƒ±lacak klas√∂rler ve dosyalar
IGNORE_DIRS = {'.git', 'node_modules', '__pycache__', 'dist', 'build', '.next', '.vscode'}
IGNORE_FILES = {'package-lock.json', 'yarn.lock', 'pnpm-lock.yaml', '.DS_Store', 'export_project.py'}
# Sadece bu uzantƒ±larƒ± al (Gereksiz binary dosyalarƒ± almamak i√ßin)
ALLOWED_EXTENSIONS = {'.ts', '.tsx', '.js', '.jsx', '.py', '.css', '.json', '.md', '.html', '.prisma', '.sql'}

def is_allowed_file(filename):
    return any(filename.endswith(ext) for ext in ALLOWED_EXTENSIONS) and filename not in IGNORE_FILES

def main():
    output_file = "tum_kodlar.txt"
    
    with open(output_file, "w", encoding="utf-8") as outfile:
        # √ñnce proje aƒüacƒ±nƒ± yazdƒ±ralƒ±m
        outfile.write("=== PROJE DOSYA AƒûACI ===\n")
        for root, dirs, files in os.walk("."):
            dirs[:] = [d for d in dirs if d not in IGNORE_DIRS]
            level = root.replace(os.getcwd(), '').count(os.sep)
            indent = ' ' * 4 * (level)
            outfile.write(f"{indent}{os.path.basename(root)}/\n")
            subindent = ' ' * 4 * (level + 1)
            for f in files:
                if is_allowed_file(f):
                    outfile.write(f"{subindent}{f}\n")
        
        outfile.write("\n\n=== DOSYA ƒ∞√áERƒ∞KLERƒ∞ ===\n\n")

        # Dosya i√ßeriklerini yazdƒ±ralƒ±m
        for root, dirs, files in os.walk("."):
            dirs[:] = [d for d in dirs if d not in IGNORE_DIRS] # Dizinleri filtrele
            
            for file in files:
                if is_allowed_file(file):
                    path = os.path.join(root, file)
                    try:
                        with open(path, "r", encoding="utf-8") as infile:
                            content = infile.read()
                            outfile.write(f"\n{'='*50}\n")
                            outfile.write(f"DOSYA YOLU: {path}\n")
                            outfile.write(f"{'='*50}\n")
                            outfile.write(content + "\n")
                    except Exception as e:
                        outfile.write(f"\n!!! HATA: {path} okunamadƒ±: {e}\n")

    print(f"ƒ∞≈ülem tamamlandƒ±! T√ºm kodlar '{output_file}' dosyasƒ±na kaydedildi.")

if __name__ == "__main__":
    main()

==================================================
DOSYA YOLU: .\package.json
==================================================
{
  "name": "distant-prominence",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "eslint"
  },
  "dependencies": {
    "framer-motion": "^12.23.24",
    "immer": "^10.2.0",
    "lucide-react": "^0.554.0",
    "next": "16.0.3",
    "react": "19.2.0",
    "react-dom": "19.2.0",
    "recharts": "^3.5.0",
    "xlsx": "^0.18.5",
    "zustand": "^5.0.8"
  },
  "devDependencies": {
    "@tailwindcss/postcss": "^4",
    "eslint": "^9",
    "eslint-config-next": "16.0.3",
    "tailwindcss": "^4"
  }
}


==================================================
DOSYA YOLU: .\README.md
==================================================
This is a [Next.js](https://nextjs.org) project bootstrapped with [`create-next-app`](https://github.com/vercel/next.js/tree/canary/packages/create-next-app).

## Getting Started

First, run the development server:

```bash
npm run dev
# or
yarn dev
# or
pnpm dev
# or
bun dev
```

Open [http://localhost:3000](http://localhost:3000) with your browser to see the result.

You can start editing the page by modifying `app/page.js`. The page auto-updates as you edit the file.

This project uses [`next/font`](https://nextjs.org/docs/app/building-your-application/optimizing/fonts) to automatically optimize and load [Geist](https://vercel.com/font), a new font family for Vercel.

## Learn More

To learn more about Next.js, take a look at the following resources:

- [Next.js Documentation](https://nextjs.org/docs) - learn about Next.js features and API.
- [Learn Next.js](https://nextjs.org/learn) - an interactive Next.js tutorial.

You can check out [the Next.js GitHub repository](https://github.com/vercel/next.js) - your feedback and contributions are welcome!

## Deploy on Vercel

The easiest way to deploy your Next.js app is to use the [Vercel Platform](https://vercel.com/new?utm_medium=default-template&filter=next.js&utm_source=create-next-app&utm_campaign=create-next-app-readme) from the creators of Next.js.

Check out our [Next.js deployment documentation](https://nextjs.org/docs/app/building-your-application/deploying) for more details.


==================================================
DOSYA YOLU: .\saveal.py
==================================================
import os
import zipfile
from datetime import datetime

def backup_project():
    # 1. Yedekleme ƒ∞smi Olu≈ütur (Tarih-Saat)
    timestamp = datetime.now().strftime("%Y-%m-%d_%H-%M-%S")
    zip_filename = f"Yedek_{timestamp}.zip"
    
    # 2. Yoksayƒ±lacak Klas√∂rler (Gereksiz aƒüƒ±rlƒ±k yapanlar)
    IGNORE_DIRS = {
        'node_modules', '.next', '.git', 'dist', 'build', '.vscode', 
        'coverage', '__pycache__'
    }
    
    # 3. Yoksayƒ±lacak Dosyalar
    IGNORE_FILES = {
        'package-lock.json', 'yarn.lock', 'pnpm-lock.yaml', 
        '.DS_Store', 'backup_project.py', zip_filename
    }

    print(f"üì¶ Yedekleme ba≈ülatƒ±lƒ±yor: {zip_filename}")
    
    try:
        with zipfile.ZipFile(zip_filename, 'w', zipfile.ZIP_DEFLATED) as zipf:
            for root, dirs, files in os.walk("."):
                # Gereksiz klas√∂rleri yerinde filtrele (i√ßine girmesin)
                dirs[:] = [d for d in dirs if d not in IGNORE_DIRS]
                
                for file in files:
                    # Kendi olu≈üturduƒüumuz zip'i veya scripti yedekleme
                    if file in IGNORE_FILES or file.endswith('.zip'):
                        continue
                        
                    file_path = os.path.join(root, file)
                    # Zip i√ßine dosyayƒ± ekle
                    zipf.write(file_path, arcname=os.path.relpath(file_path, "."))
                    
        print(f"‚úÖ Ba≈üarƒ±lƒ±! Dosya olu≈üturuldu: {zip_filename}")
        print(f"   (Node_modules ve gereksiz dosyalar hari√ß tutuldu)")
        
    except Exception as e:
        print(f"‚ùå Hata olu≈ütu: {e}")

if __name__ == "__main__":
    backup_project()

==================================================
DOSYA YOLU: .\app\globals.css
==================================================
@import "tailwindcss";

/* ============================================================================
   MODERN GLASSMORPHISM THEME
   ============================================================================ */

:root {
  /* Theme Colors */
  --background: #0a0a0f;
  --foreground: #f5f5f7;

  /* Abyss & Void Theme Colors */
  --abyss-primary: #06b6d4;
  --void-primary: #8b5cf6;

  /* Glass Effect Colors */
  --glass-bg: rgba(5, 5, 10, 0.7);
  --glass-border: rgba(255, 255, 255, 0.08);
  --glass-shadow: rgba(0, 0, 0, 0.3);
  --neon-shadow: 0 0 20px rgba(6, 182, 212, 0.1);

  /* Gradient Colors */
  --gradient-start: #1a1a2e;
  --gradient-mid: #16213e;
  --gradient-end: #0f3460;
  --gradient-accent-1: #533483;
  --gradient-accent-2: #e94560;
}

@theme inline {
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --font-sans: var(--font-geist-sans);
  --font-mono: var(--font-geist-mono);
}

/* ============================================================================
   ANIMATED MESH GRADIENT BACKGROUND
   ============================================================================ */

body {
  margin: 0;
  padding: 0;
  min-height: 100vh;
  overflow-x: hidden;

  /* Typography */
  color: var(--foreground);
  font-family: var(--font-sans, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-rendering: optimizeLegibility;

  /* Pure Black Background - Abyss & Void Theme */
  background-color: #000000;

  /* Subtle noise texture overlay */
  position: relative;
}

body::before {
  content: "";
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.03'/%3E%3C/svg%3E");
  opacity: 0.5;
  pointer-events: none;
  z-index: -1;
}

/* ============================================================================
   CUSTOM SCROLLBAR (Modern & Minimal)
   ============================================================================ */

/* Firefox */
* {
  scrollbar-width: thin;
  scrollbar-color: rgba(255, 255, 255, 0.2) transparent;
}

/* Webkit (Chrome, Safari, Edge) */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: transparent;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.15);
  border-radius: 10px;
  transition: background 0.2s ease;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* ============================================================================
   GLASS PANEL UTILITY CLASS
   ============================================================================ */

.glass-panel {
  /* Glassmorphism Effect - Abyss & Void */
  background: var(--glass-bg);
  backdrop-filter: blur(20px) saturate(180%);
  -webkit-backdrop-filter: blur(20px) saturate(180%);

  /* Border */
  border: 1px solid var(--glass-border);
  border-radius: 16px;

  /* Shadow */
  box-shadow:
    0 8px 32px 0 rgba(0, 0, 0, 0.5),
    inset 0 1px 0 0 rgba(255, 255, 255, 0.05);

  /* Smooth transitions */
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.glass-panel:hover {
  background: rgba(255, 255, 255, 0.08);
  border-color: rgba(255, 255, 255, 0.15);
  box-shadow:
    0 12px 48px 0 rgba(0, 0, 0, 0.4),
    inset 0 1px 0 0 rgba(255, 255, 255, 0.1);
}

/* ============================================================================
   ADDITIONAL UTILITY CLASSES
   ============================================================================ */

/* Glass Button */
.glass-button {
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  padding: 0.75rem 1.5rem;
  color: var(--foreground);
  font-weight: 500;
  cursor: pointer;
  transition: all 0.3s ease;
}

.glass-button:hover {
  background: rgba(255, 255, 255, 0.15);
  border-color: rgba(255, 255, 255, 0.3);
  transform: translateY(-2px);
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
}

/* Glass Input */
.glass-input {
  background: rgba(255, 255, 255, 0.05);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 8px;
  padding: 0.75rem 1rem;
  color: var(--foreground);
  outline: none;
  transition: all 0.3s ease;
}

.glass-input:focus {
  background: rgba(255, 255, 255, 0.08);
  border-color: rgba(255, 255, 255, 0.3);
  box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.1);
}

.glass-input::placeholder {
  color: rgba(255, 255, 255, 0.4);
}

/* Smooth text selection */
::selection {
  background: rgba(233, 69, 96, 0.3);
  color: var(--foreground);
}

::-moz-selection {
  background: rgba(233, 69, 96, 0.3);
  color: var(--foreground);
}

/* ============================================================================
   RESPONSIVE ADJUSTMENTS
   ============================================================================ */

@media (max-width: 768px) {
  body {
    background-size: 600% 600%;
  }

  .glass-panel {
    backdrop-filter: blur(12px) saturate(150%);
  }
}

/* Reduce motion for accessibility */
@media (prefers-reduced-motion: reduce) {
  body {
    animation: none;
    background-size: 100% 100%;
  }

  * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}

/* ============================================================================
   ABYSS & VOID THEME UTILITIES
   ============================================================================ */

/* Neon Text Effects */
.text-abyss {
  color: var(--abyss-primary);
  text-shadow: 0 0 10px rgba(6, 182, 212, 0.5);
}

.text-void {
  color: var(--void-primary);
  text-shadow: 0 0 10px rgba(139, 92, 246, 0.5);
}

/* Themed Borders */
.border-abyss {
  border-color: rgba(6, 182, 212, 0.3);
}

.border-void {
  border-color: rgba(139, 92, 246, 0.3);
}

==================================================
DOSYA YOLU: .\app\layout.js
==================================================
import { Geist, Geist_Mono } from "next/font/google";
import "./globals.css";
import LayoutWrapper from "./components/LayoutWrapper";

const geistSans = Geist({
  variable: "--font-geist-sans",
  subsets: ["latin"],
});

const geistMono = Geist_Mono({
  variable: "--font-geist-mono",
  subsets: ["latin"],
});

export const metadata = {
  title: "Create Next App",
  description: "Generated by create next app",
};

export default function RootLayout({ children }) {
  return (
    <html lang="en">
      <body
        className={`${geistSans.variable} ${geistMono.variable} antialiased`}
      >
        <LayoutWrapper>{children}</LayoutWrapper>
      </body>
    </html>
  );
}


==================================================
DOSYA YOLU: .\app\page.js
==================================================
"use client";

import { useState, useEffect } from "react";
import { motion, AnimatePresence } from "framer-motion";
import { LayoutTemplate } from "lucide-react";
import FinancialWidget from "./components/FinancialWidget";
import MarketWidget from "./components/widgets/MarketWidget";
import CharacterWidget from "./components/widgets/CharacterWidget";
import AnalysisWidget from "./components/widgets/AnalysisWidget";
import MetinSettingsWidget from "./components/widgets/MetinSettingsWidget";
import DamageProgressionWidget from "./components/widgets/DamageProgressionWidget";
import MarketSupplyWidget from "./components/widgets/MarketSupplyWidget";
import CraftingWidget from "./components/widgets/CraftingWidget";
import WorkspaceDock from "./components/WorkspaceDock";
import useWidgetStore from "./store/useWidgetStore";

// Widget component mapping
const WIDGET_COMPONENTS = {
  "market-prices": MarketWidget,
  "character-stats": CharacterWidget,
  "analysis-tool": AnalysisWidget,
  "metin-settings": MetinSettingsWidget,
  "damage-progression": DamageProgressionWidget,
  "market-supply": MarketSupplyWidget,
  "crafting-manager": CraftingWidget,
  // All other widgets use FinancialWidget
};

export default function Home() {
  const [selectedId, setSelectedId] = useState(null);

  // Store'dan workspace verilerini √ßek
  const activeWorkspaceId = useWidgetStore((state) => state.activeWorkspaceId);
  const workspaces = useWidgetStore((state) => state.workspaces);
  const toggleWidgetVisibility = useWidgetStore((state) => state.toggleWidgetVisibility);

  // Aktif workspace'i bul
  const activeWorkspace = workspaces.find((w) => w.id === activeWorkspaceId);

  // G√∂r√ºn√ºr widget'larƒ± filtrele (optional chaining ile g√ºvenli eri≈üim)
  const visibleWidgets = activeWorkspace?.widgets?.filter((w) => w.isVisible) || [];

  // FIX: Workspace deƒüi≈ütiƒüinde a√ßƒ±k olan widget'ƒ± kapat (Blur sorununu √ß√∂zer)
  useEffect(() => {
    setSelectedId(null);
  }, [activeWorkspaceId]);

  // Get the appropriate widget component
  const getWidgetComponent = (type) => {
    return WIDGET_COMPONENTS[type] || FinancialWidget;
  };

  return (
    <main className="min-h-screen p-6 md:p-8 lg:p-12">
      <div className="max-w-7xl mx-auto">
        <header className="mb-8">
          <h1 className="text-3xl md:text-4xl font-bold text-white mb-2">
            W2 - Metin2 Ekonomi Y√∂netimi
          </h1>
          <p className="text-white/80">
            Geli≈ümi≈ü analiz ara√ßlarƒ± ile oyun i√ßi ekonominizi optimize edin
          </p>
          {activeWorkspace && (
            <p className="text-sm text-white/60 mt-2">
              Aktif √áalƒ±≈üma Alanƒ±: <span className="font-semibold text-white">{activeWorkspace.name}</span>
            </p>
          )}
        </header>

        {visibleWidgets.length === 0 ? (
          /* Empty State */
          <div className="flex flex-col items-center justify-center h-[50vh] text-white/40 border-2 border-dashed border-white/20 rounded-3xl bg-white/5 backdrop-blur-sm">
            <div className="p-4 bg-white/10 rounded-full mb-4">
              <LayoutTemplate className="w-8 h-8 text-white/60" />
            </div>
            <h3 className="text-lg font-semibold text-white/80 mb-1">Bu √áalƒ±≈üma Alanƒ± Bo≈ü</h3>
            <p className="text-sm text-white/50">
              Widget eklemek i√ßin a≈üaƒüƒ±daki men√ºden Grid ikonuna tƒ±klayƒ±n.
            </p>
          </div>
        ) : (
          /* Widget Grid */
          <div key={activeWorkspaceId} className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 pb-32">
            <AnimatePresence mode="popLayout">
              {visibleWidgets.map((widget) => {
                const WidgetComponent = getWidgetComponent(widget.type);
                return (
                  <WidgetComponent
                    key={widget.id}
                    id={widget.id}
                    type={widget.type}
                    data={widget.data}
                    isSelected={selectedId === widget.id}
                    onClick={() => setSelectedId(selectedId === widget.id ? null : widget.id)}
                    onHide={() => toggleWidgetVisibility(widget.id)}
                  />
                );
              })}
            </AnimatePresence>
          </div>
        )}

        {/* Backdrop Overlay for Expanded Widget */}
        <AnimatePresence>
          {selectedId && (
            <motion.div
              initial={{ opacity: 0 }}
              animate={{ opacity: 1 }}
              exit={{ opacity: 0 }}
              onClick={() => setSelectedId(null)}
              className="fixed inset-0 bg-black/60 backdrop-blur-md z-[90]"
              transition={{ duration: 0.2 }}
            />
          )}
        </AnimatePresence>

        {/* Workspace Dock - Unified workspace and widget management */}
        <WorkspaceDock />
      </div>
    </main>
  );
}


==================================================
DOSYA YOLU: .\app\components\FinancialWidget.js
==================================================
"use client";

import { motion } from "framer-motion";
import { X, EyeOff } from "lucide-react";
import * as LucideIcons from "lucide-react";
import useWidgetStore, { useWidgetDefinition } from "../store/useWidgetStore";

// Helper: Compact Number Formatting (1.5M, 20K vb.)
const formatCompactNumber = (number) => {
    if (!number) return "0";
    return new Intl.NumberFormat('tr-TR', {
        notation: "compact",
        maximumFractionDigits: 1
    }).format(number);
};

// ============================================================================
// Widget Content Map (G√∂r√ºn√ºm Mantƒ±ƒüƒ±)
// ============================================================================
const WIDGET_CONTENTS = {
    "money-input": {
        Summary: ({ data }) => (
            <div className="flex flex-col items-center justify-center h-full w-full overflow-hidden">
                <span className="text-3xl font-bold text-white whitespace-nowrap">
                    {data.amount ? `${formatCompactNumber(data.amount)} TL` : "Deƒüer Girin"}
                </span>
                <span className="text-xs text-white/60 mt-1">Toplam Bakiye</span>
            </div>
        ),
        Detail: ({ data, onChange }) => (
            <div className="space-y-4">
                <div>
                    <label className="block text-sm font-medium text-white mb-2">Tutar Girin</label>
                    <div className="relative">
                        <input
                            type="number"
                            value={data.amount || ""}
                            onChange={(e) => onChange({ amount: e.target.value })}
                            className="w-full px-4 py-3 text-lg bg-black/20 border border-white/10 rounded-xl text-white placeholder:text-white/40 focus:outline-none focus:ring-2 focus:ring-white/30 focus:bg-black/30 backdrop-blur-sm transition-all"
                            placeholder="0"
                            autoFocus
                        />
                        <span className="absolute right-4 top-1/2 -translate-y-1/2 text-white/60 font-medium">TL</span>
                    </div>
                    <p className="text-sm text-white/60 mt-2">
                        Bu tutar genel bakiyenize eklenecektir. Ge√ßmi≈ü harcamalarƒ±nƒ±zƒ± grafikte g√∂rebilirsiniz.
                    </p>
                </div>
            </div>
        )
    },
    "note-taker": {
        Summary: ({ data }) => (
            <div className="flex flex-col items-center justify-center h-full text-center px-4 w-full overflow-hidden">
                <p className="text-lg font-medium text-white break-words line-clamp-4 w-full">
                    {data.notes || "Hen√ºz not eklenmedi..."}
                </p>
            </div>
        ),
        Detail: ({ data, onChange }) => (
            <div className="space-y-4 h-full">
                <label className="block text-sm font-medium text-white mb-2">Notlarƒ±nƒ±z</label>
                <textarea
                    value={data.notes || ""}
                    onChange={(e) => onChange({ notes: e.target.value })}
                    className="w-full h-64 px-4 py-3 bg-black/20 border border-white/10 rounded-xl text-white placeholder:text-white/40 focus:outline-none focus:ring-2 focus:ring-white/30 focus:bg-black/30 backdrop-blur-sm resize-none transition-all"
                    placeholder="Buraya notlarƒ±nƒ±zƒ± yazƒ±n..."
                    autoFocus
                />
            </div>
        )
    },
    // Diƒüer widgetlar i√ßin varsayƒ±lan ≈üablon
    "default": {
        Summary: ({ data, title }) => (
            <div className="flex flex-col items-center justify-center h-full w-full px-4 text-center">
                <span className="text-xl font-semibold text-white break-words w-full">{title}</span>
                <span className="text-sm text-white/60 mt-1">Detaylar i√ßin tƒ±klayƒ±n</span>
            </div>
        ),
        Detail: ({ data, onChange }) => (
            <div className="space-y-4">
                <p className="text-white/60">Bu widget i√ßin √∂zel bir g√∂r√ºn√ºm hen√ºz tanƒ±mlanmadƒ±.</p>
                <div className="p-4 bg-black/20 rounded-lg border border-white/10 backdrop-blur-sm">
                    <pre className="text-xs text-white/80 overflow-auto">
                        {JSON.stringify(data, null, 2)}
                    </pre>
                </div>
            </div>
        )
    }
};

export default function FinancialWidget({
    id,
    type,
    isSelected,
    onClick,
    data,
    onHide
}) {
    // Store'dan update fonksiyonunu √ßek
    const updateWidgetData = useWidgetStore((state) => state.updateWidgetData);

    // Registry'den widget tanƒ±mƒ±nƒ± al
    const definition = useWidgetDefinition(type);

    // Eƒüer definition yoksa render etme
    if (!definition) return null;

    const { title, icon: iconName } = definition;
    const Icon = LucideIcons[iconName] || LucideIcons.HelpCircle;

    // Widget i√ßeriƒüini se√ß (Summary/Detail)
    const Content = WIDGET_CONTENTS[type] || WIDGET_CONTENTS["default"];

    // Veri g√ºncelleme wrapper'ƒ±
    const handleChange = (newData) => {
        updateWidgetData(id, newData);
    };

    return (
        <motion.div
            layoutId={`card-${id}`}
            layout
            onClick={!isSelected ? onClick : undefined}
            className={`group rounded-3xl shadow-2xl cursor-pointer overflow-hidden backdrop-blur-xl border border-white/10 ${isSelected
                    ? "fixed inset-0 m-auto w-[90%] h-[90%] max-w-6xl z-[100] bg-black/90"
                    : "relative h-64 hover:-translate-y-1 hover:border-cyan-500/50 hover:shadow-[0_0_30px_rgba(6,182,212,0.1)] transition-all duration-300 bg-black/40 hover:bg-black/50"
                }`}
            transition={{ type: "spring", stiffness: 300, damping: 30 }}
        >
            {/* SUMMARY VIEW */}
            {!isSelected && (
                <>
                    {/* Gizle Butonu (Hover'da g√∂r√ºn√ºr) */}
                    <motion.button
                        whileHover={{ scale: 1.1 }}
                        whileTap={{ scale: 0.9 }}
                        onClick={(e) => {
                            e.stopPropagation();
                            onHide && onHide();
                        }}
                        className="absolute top-4 right-4 z-20 p-2 bg-white/10 backdrop-blur-sm shadow-lg rounded-full opacity-0 group-hover:opacity-100 transition-opacity text-white/60 hover:text-red-400 hover:bg-red-500/20 border border-white/20"
                    >
                        <EyeOff className="w-4 h-4" />
                    </motion.button>

                    {/* ƒ∞√ßerik */}
                    <div className="w-full h-full p-6 relative">
                        {/* Arkaplan ƒ∞konu (Dekoratif) */}
                        <Icon className="absolute -bottom-4 -right-4 w-32 h-32 text-white/5 opacity-50 rotate-12 pointer-events-none" />

                        {/* Summary Component */}
                        <Content.Summary data={data} title={title} />
                    </div>
                </>
            )}

            {/* DETAIL VIEW */}
            {isSelected && (
                <div className="flex flex-col h-full bg-transparent">
                    {/* Header */}
                    <div className="flex items-center justify-between p-8 border-b border-white/10 bg-transparent backdrop-blur-xl">
                        <div className="flex items-center gap-4">
                            <div className="p-3 bg-white/10 backdrop-blur-sm rounded-2xl border border-white/20">
                                <Icon className="w-8 h-8 text-white" />
                            </div>
                            <div>
                                <motion.h2 layoutId={`title-${id}`} className="text-2xl font-bold text-white">
                                    {title}
                                </motion.h2>
                                <p className="text-white/60">Detaylƒ± g√∂r√ºn√ºm ve d√ºzenleme modu</p>
                            </div>
                        </div>

                        {/* Kapat Butonu */}
                        <button
                            onClick={(e) => {
                                e.stopPropagation();
                                onClick();
                            }}
                            className="p-2 hover:bg-white/10 rounded-full transition-colors backdrop-blur-sm border border-white/10 hover:border-white/20"
                        >
                            <X className="w-6 h-6 text-white/80" />
                        </button>
                    </div>

                    {/* Content Grid */}
                    <div className="flex-1 p-8 overflow-y-auto">
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-8 h-full">
                            {/* Sol Kolon: Inputlar (Detail View) */}
                            <div className="bg-transparent backdrop-blur-xl p-6 rounded-2xl border border-white/10 shadow-xl">
                                <Content.Detail data={data} onChange={handleChange} />
                            </div>

                            {/* Saƒü Kolon: Grafik / Dashboard Placeholder */}
                            <div className="border-2 border-dashed border-white/10 rounded-2xl bg-transparent backdrop-blur-sm flex flex-col items-center justify-center text-white/50 p-6">
                                <div className="w-16 h-16 bg-white/10 backdrop-blur-sm rounded-full flex items-center justify-center mb-4 border border-white/20">
                                    <LucideIcons.BarChart3 className="w-8 h-8 text-white/70" />
                                </div>
                                <h4 className="font-medium text-white/80 mb-1">Analiz Grafiƒüi</h4>
                                <p className="text-sm text-center max-w-xs text-white/60">
                                    {type === "money-input" ? "Gelir/Gider daƒüƒ±lƒ±m grafiƒüi burada g√∂r√ºnt√ºlenecek." :
                                        type === "note-taker" ? "Kelime bulutu ve not analizi burada yer alacak." :
                                            "Bu widget i√ßin g√∂rselle≈ütirme mod√ºl√º hazƒ±rlanƒ±yor."}
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            )}
        </motion.div>
    );
}


==================================================
DOSYA YOLU: .\app\components\InteractiveBackground.js
==================================================
"use client";

import { useEffect, useRef } from 'react';

export default function InteractiveBackground() {
    const canvasRef = useRef(null);
    const animationFrameIdRef = useRef(null);
    const particlesArrayRef = useRef([]);
    const mouseRef = useRef({ x: null, y: null, radius: 300 });

    useEffect(() => {
        const canvas = canvasRef.current;
        if (!canvas) return;

        const ctx = canvas.getContext('2d');
        let isActive = true; // Flag to control animation loop

        // Mouse event handlers
        const handleMouseMove = (e) => {
            mouseRef.current.x = e.x;
            mouseRef.current.y = e.y;
        };

        const handleMouseOut = () => {
            mouseRef.current.x = undefined;
            mouseRef.current.y = undefined;
        };

        // Resize handler
        const handleResize = () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            init();
        };

        // Particle class with Force Field physics
        class Particle {
            constructor(x, y, directionX, directionY, size, color) {
                this.x = x;
                this.y = y;
                this.directionX = directionX;
                this.directionY = directionY;
                this.size = size;
                this.color = color;
                this.baseX = x;
                this.baseY = y;
                this.density = (Math.random() * 20) + 1;
            }

            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2, false);
                ctx.fillStyle = this.color;
                ctx.fill();
            }

            update() {
                const mouse = mouseRef.current;
                let dx = mouse.x - this.x;
                let dy = mouse.y - this.y;
                let distance = Math.sqrt(dx * dx + dy * dy);

                // 1. FORCE FIELD - Inner Shield (Repulsion Zone)
                const shieldRadius = 10;
                if (distance < shieldRadius && distance > 0) {
                    const forceDirectionX = dx / distance;
                    const forceDirectionY = dy / distance;
                    const force = (shieldRadius - distance) / shieldRadius;

                    // Strong repulsion - push particles AWAY from cursor
                    const repulsionStrength = 5;
                    const directionX = forceDirectionX * force * this.density * repulsionStrength;
                    const directionY = forceDirectionY * force * this.density * repulsionStrength;

                    this.x -= directionX; // Negative = push away
                    this.y -= directionY;
                }
                // 2. ATTRACTION ZONE - Outer Ring (Gentle Pull)
                else if (distance < mouse.radius) {
                    const forceDirectionX = dx / distance;
                    const forceDirectionY = dy / distance;
                    const force = (mouse.radius - distance) / mouse.radius;
                    const directionX = forceDirectionX * force * this.density;
                    const directionY = forceDirectionY * force * this.density;

                    // Gentle attraction
                    this.x += directionX * 0.05;
                    this.y += directionY * 0.05;
                }
                else {
                    // 3. RETURN TO BASE - Elastic return to original position
                    if (this.x !== this.baseX) {
                        let dx = this.x - this.baseX;
                        this.x -= dx / 20;
                    }
                    if (this.y !== this.baseY) {
                        let dy = this.y - this.baseY;
                        this.y -= dy / 20;
                    }
                }
                this.draw();
            }
        }

        // Initialize particles
        function init() {
            particlesArrayRef.current = [];
            const numberOfParticles = (canvas.width * canvas.height) / 25000;

            for (let i = 0; i < numberOfParticles; i++) {
                const size = (Math.random() * 2) + 0.5;
                const x = (Math.random() * (canvas.width - size * 2)) + size;
                const y = (Math.random() * (canvas.height - size * 2)) + size;
                const directionX = (Math.random() * 0.2) - 0.1;
                const directionY = (Math.random() * 0.2) - 0.1;
                const color = 'rgba(255, 255, 255, 0.8)'; // Bright white

                particlesArrayRef.current.push(new Particle(x, y, directionX, directionY, size, color));
            }
        }

        // Animation loop
        function animate() {
            if (!isActive || !canvasRef.current) return; // Safety check

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            for (let i = 0; i < particlesArrayRef.current.length; i++) {
                particlesArrayRef.current[i].update();
            }

            animationFrameIdRef.current = requestAnimationFrame(animate);
        }

        // Setup
        window.addEventListener('mousemove', handleMouseMove);
        window.addEventListener('mouseout', handleMouseOut);
        window.addEventListener('resize', handleResize);

        handleResize(); // Initialize
        animate(); // Start animation

        // Cleanup function - Prevent memory leaks
        return () => {
            isActive = false; // Stop animation loop

            // Remove all event listeners
            window.removeEventListener('mousemove', handleMouseMove);
            window.removeEventListener('mouseout', handleMouseOut);
            window.removeEventListener('resize', handleResize);

            // Cancel animation frame
            if (animationFrameIdRef.current) {
                cancelAnimationFrame(animationFrameIdRef.current);
                animationFrameIdRef.current = null;
            }

            // Clear particles array to free memory
            particlesArrayRef.current = [];

            // Reset mouse reference
            mouseRef.current = { x: null, y: null, radius: 300 };
        };
    }, []);

    return (
        <canvas
            ref={canvasRef}
            className="fixed inset-0 -z-50 pointer-events-none"
            style={{ background: 'transparent' }}
        />
    );
}


==================================================
DOSYA YOLU: .\app\components\LayoutWrapper.js
==================================================
"use client";

import { MotionConfig } from "framer-motion";
import useWidgetStore from "../store/useWidgetStore";
import InteractiveBackground from "./InteractiveBackground";
import PerformanceToggle from "./PerformanceToggle";

export default function LayoutWrapper({ children }) {
    const isPerformanceMode = useWidgetStore((state) => state.isPerformanceMode);

    return (
        <MotionConfig transition={isPerformanceMode ? { duration: 0 } : undefined}>
            {/* Conditional Background - Only render when performance mode is OFF */}
            {!isPerformanceMode && <InteractiveBackground />}

            {/* Performance Toggle Button */}
            <PerformanceToggle />

            {/* Main Content */}
            {children}
        </MotionConfig>
    );
}


==================================================
DOSYA YOLU: .\app\components\PerformanceToggle.js
==================================================
"use client";

import { motion } from "framer-motion";
import { Zap } from "lucide-react";
import { useState } from "react";
import useWidgetStore from "../store/useWidgetStore";

export default function PerformanceToggle() {
    const isPerformanceMode = useWidgetStore((state) => state.isPerformanceMode);
    const togglePerformanceMode = useWidgetStore((state) => state.togglePerformanceMode);
    const [showTooltip, setShowTooltip] = useState(false);

    return (
        <div className="fixed top-6 right-6 z-[120]">
            <motion.button
                onClick={togglePerformanceMode}
                onHoverStart={() => setShowTooltip(true)}
                onHoverEnd={() => setShowTooltip(false)}
                whileHover={{ scale: 1.05 }}
                whileTap={{ scale: 0.95 }}
                className={`
                    relative p-4 rounded-full backdrop-blur-xl border shadow-2xl
                    transition-all duration-300 ease-out
                    ${isPerformanceMode
                        ? "bg-yellow-500/20 border-yellow-400/50 shadow-yellow-500/30"
                        : "bg-white/10 border-white/20 shadow-black/20"
                    }
                `}
            >
                {/* Icon */}
                <motion.div
                    animate={{
                        rotate: isPerformanceMode ? [0, -10, 10, -10, 0] : 0,
                        scale: isPerformanceMode ? [1, 1.1, 1] : 1,
                    }}
                    transition={{
                        duration: 0.5,
                        ease: "easeInOut",
                    }}
                >
                    <Zap
                        className={`w-6 h-6 transition-colors duration-300 ${isPerformanceMode
                                ? "text-yellow-400 fill-yellow-400"
                                : "text-white/60"
                            }`}
                    />
                </motion.div>

                {/* Glow Effect (Active State) */}
                {isPerformanceMode && (
                    <motion.div
                        className="absolute inset-0 rounded-full bg-yellow-400/20 blur-xl"
                        animate={{
                            opacity: [0.5, 0.8, 0.5],
                            scale: [1, 1.2, 1],
                        }}
                        transition={{
                            duration: 2,
                            repeat: Infinity,
                            ease: "easeInOut",
                        }}
                    />
                )}

                {/* Tooltip */}
                {showTooltip && (
                    <motion.div
                        initial={{ opacity: 0, y: 10 }}
                        animate={{ opacity: 1, y: 0 }}
                        exit={{ opacity: 0, y: 10 }}
                        className="absolute top-full right-0 mt-2 px-3 py-2 bg-black/90 backdrop-blur-sm border border-white/20 rounded-lg whitespace-nowrap text-sm text-white shadow-xl"
                    >
                        Performans Modu: {isPerformanceMode ? "A√ßƒ±k" : "Kapalƒ±"}
                        <div className="absolute -top-1 right-4 w-2 h-2 bg-black/90 border-l border-t border-white/20 rotate-45" />
                    </motion.div>
                )}
            </motion.button>
        </div>
    );
}


==================================================
DOSYA YOLU: .\app\components\WidgetCatalog.js
==================================================
"use client";

import { motion, AnimatePresence } from "framer-motion";
import { X, Plus } from "lucide-react";
import * as LucideIcons from "lucide-react";
import useWidgetStore, { WIDGET_REGISTRY } from "../store/useWidgetStore";

export default function WidgetCatalog({ isOpen, onClose }) {
    const addWidget = useWidgetStore((state) => state.addWidget);

    const handleAdd = (type) => {
        addWidget(type);
        onClose();
    };

    return (
        <AnimatePresence>
            {isOpen && (
                <>
                    {/* Backdrop */}
                    <motion.div
                        initial={{ opacity: 0 }}
                        animate={{ opacity: 1 }}
                        exit={{ opacity: 0 }}
                        onClick={onClose}
                        className="fixed inset-0 bg-black/20 backdrop-blur-sm z-50"
                    />

                    {/* Modal */}
                    <motion.div
                        initial={{ opacity: 0, scale: 0.9, y: 20 }}
                        animate={{ opacity: 1, scale: 1, y: 0 }}
                        exit={{ opacity: 0, scale: 0.9, y: 20 }}
                        className="fixed inset-0 m-auto w-full max-w-2xl h-fit max-h-[80vh] bg-white rounded-2xl shadow-2xl border border-zinc-200 overflow-hidden z-50 flex flex-col"
                    >
                        {/* Header */}
                        <div className="p-6 border-b border-zinc-100 flex items-center justify-between bg-white">
                            <div>
                                <h2 className="text-xl font-bold text-zinc-800">Widget Ekle</h2>
                                <p className="text-zinc-500 text-sm mt-1">
                                    Panelinize eklemek i√ßin bir ara√ß se√ßin
                                </p>
                            </div>
                            <button
                                onClick={onClose}
                                className="p-2 hover:bg-zinc-100 rounded-full transition-colors"
                            >
                                <X className="w-5 h-5 text-zinc-500" />
                            </button>
                        </div>

                        {/* Grid */}
                        <div className="p-6 overflow-y-auto bg-zinc-50/50">
                            <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                {Object.entries(WIDGET_REGISTRY).map(([type, def]) => {
                                    const Icon = LucideIcons[def.icon] || LucideIcons.HelpCircle;

                                    return (
                                        <motion.button
                                            key={type}
                                            onClick={() => handleAdd(type)}
                                            whileHover={{ scale: 1.02, y: -2 }}
                                            whileTap={{ scale: 0.98 }}
                                            className="flex items-start gap-4 p-4 bg-white rounded-xl border border-zinc-200 shadow-sm hover:shadow-md hover:border-blue-200 transition-all text-left group"
                                        >
                                            <div className="p-3 bg-zinc-100 rounded-lg group-hover:bg-blue-50 group-hover:text-blue-600 transition-colors">
                                                <Icon className="w-6 h-6 text-zinc-600 group-hover:text-blue-600" />
                                            </div>
                                            <div className="flex-1">
                                                <h3 className="font-semibold text-zinc-800 group-hover:text-blue-700 transition-colors">
                                                    {def.title}
                                                </h3>
                                                <p className="text-xs text-zinc-500 mt-1 leading-relaxed">
                                                    {def.description || "Bu widget'ƒ± panelinize ekleyin."}
                                                </p>
                                            </div>
                                            <div className="mt-1 opacity-0 group-hover:opacity-100 transition-opacity">
                                                <Plus className="w-4 h-4 text-blue-500" />
                                            </div>
                                        </motion.button>
                                    );
                                })}
                            </div>
                        </div>
                    </motion.div>
                </>
            )}
        </AnimatePresence>
    );
}


==================================================
DOSYA YOLU: .\app\components\WidgetDock.js
==================================================
"use client";

import { useState } from "react";
import { motion, AnimatePresence } from "framer-motion";
import { LayoutGrid, Eye } from "lucide-react";
import * as LucideIcons from "lucide-react";
import useWidgetStore, { useWidgetDefinition } from "../store/useWidgetStore";

export default function WidgetDock() {
    const [isOpen, setIsOpen] = useState(false);

    // Store'dan workspace verilerini √ßek
    const activeWorkspaceId = useWidgetStore((state) => state.activeWorkspaceId);
    const workspaces = useWidgetStore((state) => state.workspaces);
    const toggleWidgetVisibility = useWidgetStore((state) => state.toggleWidgetVisibility);

    // Aktif workspace'i bul
    const activeWorkspace = workspaces.find((w) => w.id === activeWorkspaceId);

    // Gizli widget'larƒ± filtrele
    const hiddenWidgets = activeWorkspace?.widgets?.filter((w) => !w.isVisible) || [];

    return (
        <div className="fixed bottom-6 right-6 z-50">
            {/* Popover Menu */}
            <AnimatePresence>
                {isOpen && hiddenWidgets.length > 0 && (
                    <motion.div
                        initial={{ opacity: 0, y: 20, scale: 0.95 }}
                        animate={{ opacity: 1, y: 0, scale: 1 }}
                        exit={{ opacity: 0, y: 20, scale: 0.95 }}
                        transition={{ type: "spring", stiffness: 300, damping: 30 }}
                        className="absolute bottom-20 right-0 w-64 bg-white rounded-2xl shadow-lg border border-zinc-200 overflow-hidden"
                    >
                        <div className="p-4 border-b border-zinc-200 bg-zinc-50">
                            <h3 className="text-sm font-semibold text-zinc-800">Gizli Widget'lar</h3>
                            <p className="text-xs text-zinc-500 mt-1">
                                Geri getirmek i√ßin tƒ±klayƒ±n
                            </p>
                        </div>
                        <div className="max-h-64 overflow-y-auto">
                            {hiddenWidgets.map((widget) => {
                                // Registry'den widget bilgisini al
                                const definition = useWidgetDefinition(widget.type);
                                const Icon = definition ? LucideIcons[definition.icon] : LucideIcons.HelpCircle;
                                const title = definition?.title || "Bilinmeyen Widget";

                                return (
                                    <motion.button
                                        key={widget.id}
                                        initial={{ opacity: 0, x: -10 }}
                                        animate={{ opacity: 1, x: 0 }}
                                        exit={{ opacity: 0, x: -10 }}
                                        onClick={() => {
                                            toggleWidgetVisibility(widget.id);
                                        }}
                                        className="w-full px-4 py-3 flex items-center gap-3 hover:bg-zinc-50 transition-colors text-left border-b border-zinc-100 last:border-b-0"
                                    >
                                        <div className="p-2 bg-zinc-100 rounded-lg">
                                            <Icon className="w-4 h-4 text-zinc-600" />
                                        </div>
                                        <div className="flex-1">
                                            <p className="text-sm font-medium text-zinc-800">{title}</p>
                                        </div>
                                        <Eye className="w-4 h-4 text-zinc-400" />
                                    </motion.button>
                                );
                            })}
                        </div>
                    </motion.div>
                )}
            </AnimatePresence>

            {/* Dock Button */}
            <motion.button
                whileHover={{ scale: 1.05 }}
                whileTap={{ scale: 0.95 }}
                onClick={() => setIsOpen(!isOpen)}
                className="relative w-14 h-14 bg-zinc-800 hover:bg-zinc-900 text-white rounded-full shadow-lg flex items-center justify-center transition-colors"
                aria-label="Widget Dock"
            >
                <LayoutGrid className="w-6 h-6" />

                {/* Badge */}
                {hiddenWidgets.length > 0 && (
                    <motion.span
                        initial={{ scale: 0 }}
                        animate={{ scale: 1 }}
                        className="absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold rounded-full w-6 h-6 flex items-center justify-center"
                    >
                        {hiddenWidgets.length}
                    </motion.span>
                )}
            </motion.button>

            {/* Backdrop for closing */}
            <AnimatePresence>
                {isOpen && (
                    <motion.div
                        initial={{ opacity: 0 }}
                        animate={{ opacity: 1 }}
                        exit={{ opacity: 0 }}
                        onClick={() => setIsOpen(false)}
                        className="fixed inset-0 -z-10"
                    />
                )}
            </AnimatePresence>
        </div>
    );
}


==================================================
DOSYA YOLU: .\app\components\WorkspaceDock.js
==================================================
"use client";

import { useState, useRef, useEffect } from "react";
import { motion, AnimatePresence } from "framer-motion";
import { Plus, Archive, Eye, Check, X, Trash2, AlertTriangle } from "lucide-react";
import * as LucideIcons from "lucide-react";
import useWidgetStore, { useWidgetDefinition } from "../store/useWidgetStore";
import WidgetCatalog from "./WidgetCatalog";

export default function WorkspaceDock() {
    const [isArchiveOpen, setIsArchiveOpen] = useState(false);
    const [isCatalogOpen, setIsCatalogOpen] = useState(false);
    const [isCreating, setIsCreating] = useState(false);
    const [newWorkspaceName, setNewWorkspaceName] = useState("");

    // Confirmation Modal State
    const [confirmModal, setConfirmModal] = useState({
        isOpen: false,
        title: "",
        message: "",
        onConfirm: null
    });

    const inputRef = useRef(null);

    // Store'dan workspace verilerini √ßek
    const activeWorkspaceId = useWidgetStore((state) => state.activeWorkspaceId);
    const workspaces = useWidgetStore((state) => state.workspaces);
    const switchWorkspace = useWidgetStore((state) => state.switchWorkspace);
    const addWorkspace = useWidgetStore((state) => state.addWorkspace);
    const removeWorkspace = useWidgetStore((state) => state.removeWorkspace);
    const toggleWidgetVisibility = useWidgetStore((state) => state.toggleWidgetVisibility);
    const removeWidget = useWidgetStore((state) => state.removeWidget);

    // Aktif workspace'i bul
    const activeWorkspace = workspaces.find((w) => w.id === activeWorkspaceId);

    // Gizli widget'larƒ± filtrele
    const hiddenWidgets = activeWorkspace?.widgets?.filter((w) => !w.isVisible) || [];

    // Input focus y√∂netimi
    useEffect(() => {
        if (isCreating && inputRef.current) {
            inputRef.current.focus();
        }
    }, [isCreating]);

    // Helper: Onay ƒ∞ste
    const requestConfirmation = (title, message, action) => {
        setConfirmModal({
            isOpen: true,
            title,
            message,
            onConfirm: () => {
                action();
                setConfirmModal((prev) => ({ ...prev, isOpen: false }));
            }
        });
    };

    // Yeni workspace ekle
    const handleCreateConfirm = () => {
        if (newWorkspaceName.trim()) {
            addWorkspace(newWorkspaceName.trim());
            setNewWorkspaceName("");
            setIsCreating(false);
        }
    };

    const handleCreateCancel = () => {
        setNewWorkspaceName("");
        setIsCreating(false);
    };

    const handleKeyDown = (e) => {
        if (e.key === "Enter") {
            handleCreateConfirm();
        } else if (e.key === "Escape") {
            handleCreateCancel();
        }
    };

    // Workspace silme (Saƒü tƒ±k)
    const handleWorkspaceContextMenu = (e, workspaceId) => {
        e.preventDefault();
        requestConfirmation(
            "√áalƒ±≈üma Alanƒ±nƒ± Sil",
            "Bu i≈ülem geri alƒ±namaz. Devam etmek istiyor musun?",
            () => removeWorkspace(workspaceId)
        );
    };

    // Widget kalƒ±cƒ± silme
    const handlePermanentDeleteWidget = (e, widgetId) => {
        e.stopPropagation();
        requestConfirmation(
            "Widget'ƒ± Kalƒ±cƒ± Sil",
            "Bu widget ve i√ßindeki veriler yok edilecek.",
            () => removeWidget(widgetId)
        );
    };

    return (
        <>
            {/* Widget Catalog Modal */}
            <WidgetCatalog isOpen={isCatalogOpen} onClose={() => setIsCatalogOpen(false)} />

            {/* Ana Dock */}
            <motion.div
                initial={{ y: 100, opacity: 0 }}
                animate={{ y: 0, opacity: 1 }}
                transition={{ type: "spring", stiffness: 300, damping: 30 }}
                className="fixed bottom-8 left-1/2 -translate-x-1/2 z-50"
            >
                {/* ƒ∞simlendirme Balonu (Dock'un √ºst√ºnde) */}
                <AnimatePresence>
                    {isCreating && (
                        <motion.div
                            initial={{ opacity: 0, y: 10, scale: 0.9, x: "-50%" }}
                            animate={{ opacity: 1, y: 0, scale: 1, x: "-50%" }}
                            exit={{ opacity: 0, y: 10, scale: 0.9, x: "-50%" }}
                            className="absolute -top-16 left-1/2 bg-white rounded-xl shadow-xl border border-zinc-200 p-2 flex gap-2 items-center whitespace-nowrap"
                        >
                            <input
                                ref={inputRef}
                                type="text"
                                value={newWorkspaceName}
                                onChange={(e) => setNewWorkspaceName(e.target.value)}
                                onKeyDown={handleKeyDown}
                                placeholder="√áalƒ±≈üma alanƒ± adƒ±..."
                                className="w-40 px-3 py-1.5 text-sm bg-zinc-50 border border-zinc-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            />
                            <button
                                onClick={handleCreateConfirm}
                                className="p-1.5 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors"
                            >
                                <Check className="w-4 h-4" />
                            </button>
                            <button
                                onClick={handleCreateCancel}
                                className="p-1.5 bg-zinc-100 text-zinc-500 rounded-lg hover:bg-zinc-200 transition-colors"
                            >
                                <X className="w-4 h-4" />
                            </button>

                            {/* Ok i≈üareti (Triangle) */}
                            <div className="absolute -bottom-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-white border-b border-r border-zinc-200 rotate-45" />
                        </motion.div>
                    )}
                </AnimatePresence>

                <div className="bg-black/80 backdrop-blur-xl border border-white/10 shadow-[0_0_50px_rgba(6,182,212,0.15)] rounded-full px-4 py-3 flex items-center gap-2">
                    {/* Workspace Sekmeleri */}
                    <div className="flex items-center gap-2">
                        {workspaces.map((workspace) => {
                            const isActive = workspace.id === activeWorkspaceId;

                            return (
                                <motion.button
                                    key={workspace.id}
                                    onClick={() => switchWorkspace(workspace.id)}
                                    onContextMenu={(e) => handleWorkspaceContextMenu(e, workspace.id)}
                                    className={`relative px-4 py-2 rounded-full text-sm font-medium transition-colors ${isActive
                                        ? "text-cyan-400"
                                        : "text-white/40 hover:text-white/70"
                                        }`}
                                    whileHover={{ scale: 1.05 }}
                                    whileTap={{ scale: 0.95 }}
                                >
                                    {isActive && (
                                        <motion.div
                                            layoutId="activeTab"
                                            className="absolute inset-0 bg-gradient-to-r from-cyan-900/50 to-blue-900/50 border border-cyan-500/30 rounded-full shadow-lg"
                                            transition={{
                                                type: "spring",
                                                stiffness: 500,
                                                damping: 30,
                                            }}
                                        />
                                    )}
                                    <span className="relative z-10">{workspace.name}</span>
                                </motion.button>
                            );
                        })}
                    </div>

                    {/* Ayƒ±rƒ±cƒ± */}
                    <div className="w-px h-6 bg-white/10" />

                    {/* Yeni Workspace Ekle Butonu */}
                    <motion.button
                        onClick={() => setIsCreating(true)}
                        className={`p-2 rounded-full transition-colors ${isCreating ? "bg-cyan-500/20 text-cyan-400" : "hover:bg-white/10 text-white/60 hover:text-white"
                            }`}
                        whileHover={{ scale: 1.1 }}
                        whileTap={{ scale: 0.9 }}
                        aria-label="Yeni √ßalƒ±≈üma alanƒ± ekle"
                    >
                        <Plus className="w-5 h-5" />
                    </motion.button>

                    {/* Ayƒ±rƒ±cƒ± */}
                    <div className="w-px h-6 bg-white/10" />

                    {/* Widget Ekle Butonu */}
                    <motion.button
                        onClick={() => setIsCatalogOpen(true)}
                        className="p-2 rounded-full hover:bg-white/10 transition-colors group"
                        whileHover={{ scale: 1.1 }}
                        whileTap={{ scale: 0.9 }}
                        aria-label="Widget ekle"
                    >
                        <LucideIcons.LayoutGrid className="w-5 h-5 text-white/60 group-hover:text-cyan-400 transition-colors" />
                    </motion.button>

                    {/* Gizli Widgetlar (Ar≈üiv) Butonu */}
                    <motion.button
                        onClick={() => setIsArchiveOpen(!isArchiveOpen)}
                        className="relative p-2 rounded-full hover:bg-white/10 transition-colors"
                        whileHover={{ scale: 1.1 }}
                        whileTap={{ scale: 0.9 }}
                        aria-label="Gizli widget'lar"
                    >
                        <Archive className="w-5 h-5 text-white/60" />

                        {/* Badge - Gizli widget sayƒ±sƒ± */}
                        {hiddenWidgets.length > 0 && (
                            <motion.span
                                initial={{ scale: 0 }}
                                animate={{ scale: 1 }}
                                className="absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center"
                            >
                                {hiddenWidgets.length}
                            </motion.span>
                        )}
                    </motion.button>
                </div>
            </motion.div>

            {/* Gizli Widgetlar Popover */}
            <AnimatePresence>
                {isArchiveOpen && hiddenWidgets.length > 0 && (
                    <motion.div
                        initial={{ opacity: 0, y: 20, scale: 0.95 }}
                        animate={{ opacity: 1, y: 0, scale: 1 }}
                        exit={{ opacity: 0, y: 20, scale: 0.95 }}
                        transition={{ type: "spring", stiffness: 300, damping: 30 }}
                        className="fixed bottom-28 right-8 w-72 bg-white rounded-2xl shadow-2xl border border-zinc-200 overflow-hidden z-50"
                    >
                        {/* Header */}
                        <div className="p-4 border-b border-zinc-200 bg-zinc-50">
                            <h3 className="text-sm font-semibold text-zinc-800">Gizli Widget'lar</h3>
                            <p className="text-xs text-zinc-500 mt-1">
                                Geri getirmek i√ßin tƒ±klayƒ±n
                            </p>
                        </div>

                        {/* Widget Listesi */}
                        <div className="max-h-64 overflow-y-auto">
                            {hiddenWidgets.map((widget) => {
                                // Registry'den widget bilgisini al
                                const definition = useWidgetDefinition(widget.type);
                                const Icon = definition ? LucideIcons[definition.icon] : LucideIcons.HelpCircle;
                                const title = definition?.title || "Bilinmeyen Widget";

                                return (
                                    <motion.button
                                        key={widget.id}
                                        initial={{ opacity: 0, x: -10 }}
                                        animate={{ opacity: 1, x: 0 }}
                                        exit={{ opacity: 0, x: -10 }}
                                        onClick={() => {
                                            toggleWidgetVisibility(widget.id);
                                        }}
                                        className="w-full px-4 py-3 flex items-center gap-3 hover:bg-zinc-50 transition-colors text-left border-b border-zinc-100 last:border-b-0 group"
                                    >
                                        <div className="p-2 bg-zinc-100 rounded-lg">
                                            <Icon className="w-4 h-4 text-zinc-600" />
                                        </div>
                                        <div className="flex-1">
                                            <p className="text-sm font-medium text-zinc-800">{title}</p>
                                        </div>

                                        {/* Geri Getir Butonu */}
                                        <div className="p-1.5 hover:bg-blue-50 rounded-md transition-colors text-zinc-400 hover:text-blue-500">
                                            <Eye className="w-4 h-4" />
                                        </div>

                                        {/* Kalƒ±cƒ± Sil Butonu */}
                                        <div
                                            onClick={(e) => handlePermanentDeleteWidget(e, widget.id)}
                                            className="p-1.5 hover:bg-red-50 rounded-md transition-colors text-zinc-400 hover:text-red-500"
                                        >
                                            <Trash2 className="w-4 h-4" />
                                        </div>
                                    </motion.button>
                                );
                            })}
                        </div>
                    </motion.div>
                )}
            </AnimatePresence>

            {/* Backdrop - Popover kapatmak i√ßin */}
            <AnimatePresence>
                {isArchiveOpen && (
                    <motion.div
                        initial={{ opacity: 0 }}
                        animate={{ opacity: 1 }}
                        exit={{ opacity: 0 }}
                        onClick={() => setIsArchiveOpen(false)}
                        className="fixed inset-0 z-40"
                    />
                )}
            </AnimatePresence>

            {/* Custom Confirmation Modal */}
            <AnimatePresence>
                {confirmModal.isOpen && (
                    <div className="fixed inset-0 z-[60] flex items-center justify-center">
                        {/* Backdrop */}
                        <motion.div
                            initial={{ opacity: 0 }}
                            animate={{ opacity: 1 }}
                            exit={{ opacity: 0 }}
                            onClick={() => setConfirmModal((prev) => ({ ...prev, isOpen: false }))}
                            className="absolute inset-0 bg-black/20 backdrop-blur-sm"
                        />

                        {/* Modal Content */}
                        <motion.div
                            initial={{ opacity: 0, scale: 0.9, y: 20 }}
                            animate={{ opacity: 1, scale: 1, y: 0 }}
                            exit={{ opacity: 0, scale: 0.9, y: 20 }}
                            className="bg-black/90 rounded-2xl shadow-[0_0_50px_rgba(0,0,0,0.8)] border border-white/10 backdrop-blur-xl p-6 w-80 relative z-10"
                        >
                            <div className="flex flex-col items-center text-center">
                                <div className="w-12 h-12 bg-red-500/20 border border-red-500/30 rounded-full flex items-center justify-center mb-4">
                                    <AlertTriangle className="w-6 h-6 text-red-500" />
                                </div>
                                <h3 className="text-lg font-semibold text-white mb-2">
                                    {confirmModal.title}
                                </h3>
                                <p className="text-sm text-white/70 mb-6">
                                    {confirmModal.message}
                                </p>
                                <div className="flex gap-3 w-full">
                                    <button
                                        onClick={() => setConfirmModal((prev) => ({ ...prev, isOpen: false }))}
                                        className="flex-1 px-4 py-2 bg-white/5 text-white/60 hover:bg-white/10 hover:text-white border border-white/5 rounded-xl transition-colors font-medium"
                                    >
                                        ƒ∞ptal
                                    </button>
                                    <button
                                        onClick={confirmModal.onConfirm}
                                        className="flex-1 px-4 py-2 bg-red-600/80 hover:bg-red-600 text-white border border-red-500/50 shadow-lg shadow-red-900/20 rounded-xl transition-colors font-medium"
                                    >
                                        Sil
                                    </button>
                                </div>
                            </div>
                        </motion.div>
                    </div>
                )}
            </AnimatePresence>
        </>
    );
}


==================================================
DOSYA YOLU: .\app\components\widgets\AnalysisWidget.js
==================================================
"use client";

import { useState, useMemo } from "react";
import { motion } from "framer-motion";
import { X, EyeOff, Calculator } from "lucide-react";
import useWidgetStore from "../../store/useWidgetStore";
import {
    calculateAllMetins,
    getBestMetin,
    calculateMetinProfit
} from "../../lib/calculator";
import { initialMetinList } from "../../data/initialData";
import AnalysisKPIs from "./analysis/AnalysisKPIs";
import AnalysisSummaryView from "./analysis/AnalysisSummaryView";
import AnalysisChart from "./analysis/AnalysisChart";
import AnalysisTable from "./analysis/AnalysisTable";

// ============================================================================
// HELPER: FIND SIBLING WIDGETS (CONTEXT-AWARE)
// ============================================================================
function useSiblingWidgetData() {
    // 1. Global Store Verileri
    const activeWorkspaceId = useWidgetStore((state) => state.activeWorkspaceId);
    const workspaces = useWidgetStore((state) => state.workspaces);

    // Multi-Server Store Data
    const activeServerId = useWidgetStore((state) => state.activeServerId);
    const serverProfiles = useWidgetStore((state) => state.serverProfiles);

    const craftingItems = useWidgetStore((state) => state.craftingItems) || [];

    // 2. Karde≈ü Widgetlarƒ± Bulma
    const activeWorkspace = workspaces.find((ws) => ws.id === activeWorkspaceId);
    const widgets = activeWorkspace?.widgets || [];

    const characterWidget = widgets.find((w) => w.type === "character-stats");
    const metinWidget = widgets.find((w) => w.type === "metin-settings");

    // 3. Verileri Hazƒ±rlama (Fallback Korumalƒ±)
    const userStats = characterWidget?.data || { damage: 3000, hitsPerSecond: 2.5, findTime: 10 };
    const metinList = metinWidget?.data?.metins || initialMetinList;

    // 4. Store Data Paketle
    const storeData = { activeServerId, serverProfiles };

    // 5. Hepsini Paketle
    return { userStats, metinList, storeData, craftingItems };
}

// ============================================================================
// DETAIL VIEW CONTAINER (Logic Layer)
// ============================================================================
function AnalysisDetailView({ userStats, metinList, storeData, craftingItems }) {
    const [chartType, setChartType] = useState("comparison"); // 'comparison' | 'efficiency'
    const [hourlyCost, setHourlyCost] = useState(0);

    // 2. Hesaplama: T√ºm Metinler
    const calculations = useMemo(() => {
        return calculateAllMetins(metinList, storeData, userStats);
    }, [metinList, storeData, userStats]);

    const bestMetin = getBestMetin(calculations);
    const topMetins = calculations.slice(0, 5);

    // 2. Chart Data: Comparison (Top 5)
    const comparisonData = useMemo(() => {
        return topMetins.map(calc => ({
            name: calc.metinName,
            profit: calc.hourlyProfit
        }));
    }, [topMetins]);

    // 3. Chart Data: Efficiency Curve (Multi-Line for Top 5)
    const efficiencyData = useMemo(() => {
        if (!bestMetin || !storeData || !userStats || !userStats.damage) {
            return null;
        }

        const currentDamage = userStats.damage;
        const minDamage = 100; // Start from near zero
        const maxDamage = Math.max(currentDamage * 2, 10000); // Go up to 2x or at least 10k
        const step = Math.max(100, Math.floor(maxDamage / 50)); // Adaptive step

        const simulations = [];

        // Get full metin objects for top 5
        const targetMetins = topMetins.map(calc =>
            metinList.find(m => m.id === calc.metinId)
        ).filter(Boolean);

        for (let dmg = minDamage; dmg <= maxDamage; dmg += step) {
            const modifiedStats = { ...userStats, damage: dmg };

            const dataPoint = { damage: dmg };

            targetMetins.forEach(metin => {
                const result = calculateMetinProfit(metin, storeData, modifiedStats);
                // Store profit with metin name as key
                dataPoint[metin.name] = result.hourlyProfit - hourlyCost;
            });

            simulations.push(dataPoint);
        }

        return simulations;
    }, [bestMetin, storeData, userStats, hourlyCost, metinList, topMetins]);

    // 4. Softcap Detection
    const softcapWarning = useMemo(() => {
        if (!bestMetin || !userStats) return null;
        const killTime = bestMetin.killTime;
        const findTime = userStats.findTime;

        if (killTime < findTime * 0.1) {
            return {
                active: true,
                message: "Metin kesme s√ºreniz, bulma s√ºrenize g√∂re √ßok d√º≈ü√ºk. Hasar artƒ±≈üƒ± artƒ±k verimsiz."
            };
        }
        return { active: false };
    }, [bestMetin, userStats]);

    if (!bestMetin) {
        return (
            <div className="flex items-center justify-center h-full text-white/50">
                Veri bekleniyor...
            </div>
        );
    }

    const netHourlyProfit = bestMetin.hourlyProfit - hourlyCost;

    return (
        <div className="h-full flex flex-col space-y-6 overflow-y-auto pr-2">
            {/* KPI Cards */}
            <AnalysisKPIs
                bestMetin={bestMetin}
                netHourlyProfit={netHourlyProfit}
                hourlyCost={hourlyCost}
                setHourlyCost={setHourlyCost}
            />

            {/* Chart Section */}
            <AnalysisChart
                chartType={chartType}
                setChartType={setChartType}
                comparisonData={comparisonData}
                efficiencyData={efficiencyData}
                userStats={userStats}
                topMetins={topMetins}
            />

            {/* Softcap & Table Section */}
            <AnalysisTable
                calculations={calculations}
                softcapWarning={softcapWarning}
            />
        </div>
    );
}

// ============================================================================
// MAIN ANALYSIS WIDGET COMPONENT (Container)
// ============================================================================
export default function AnalysisWidget({ id, data, isSelected, onClick, onHide }) {
    // Get context-aware data from sibling widgets
    const { userStats, metinList, storeData, craftingItems } = useSiblingWidgetData();

    // Calculate best metin for summary view
    const calculations = useMemo(() => {
        return calculateAllMetins(metinList, storeData, userStats);
    }, [metinList, storeData, userStats]);

    const bestMetin = getBestMetin(calculations);

    return (
        <motion.div
            layoutId={`card-${id}`}
            layout
            onClick={!isSelected ? onClick : undefined}
            className={`group rounded-3xl shadow-2xl cursor-pointer overflow-hidden backdrop-blur-xl border border-white/10 ${isSelected
                ? "fixed inset-0 m-auto w-[90%] h-[90%] max-w-6xl z-[100] bg-black/90 border border-white/10"
                : "relative h-64 hover:-translate-y-1 hover:border-cyan-500/50 hover:shadow-[0_0_30px_rgba(6,182,212,0.1)] transition-all duration-300 bg-black/40 hover:bg-black/50 border border-white/10"
                }`}
            transition={{ type: "spring", stiffness: 300, damping: 30 }}
        >
            {/* SUMMARY VIEW (Collapsed) */}
            {!isSelected && (
                <>
                    <motion.button
                        whileHover={{ scale: 1.1 }}
                        whileTap={{ scale: 0.9 }}
                        onClick={(e) => {
                            e.stopPropagation();
                            onHide && onHide();
                        }}
                        className="absolute top-4 right-4 z-20 p-2 bg-white/10 backdrop-blur-sm shadow-lg rounded-full opacity-0 group-hover:opacity-100 transition-opacity text-white/60 hover:text-cyan-400 hover:bg-cyan-500/20 border border-white/20"
                    >
                        <EyeOff className="w-4 h-4" />
                    </motion.button>

                    <div className="w-full h-full p-6 relative">
                        <Calculator className="absolute -bottom-4 -right-4 w-32 h-32 text-white/5 opacity-50 rotate-12 pointer-events-none" />
                        <AnalysisSummaryView bestMetin={bestMetin} />
                    </div>
                </>
            )}

            {/* DETAIL VIEW (Expanded) */}
            {isSelected && (
                <div className="flex flex-col h-full bg-black/20">
                    {/* Header */}
                    <div className="flex items-center justify-between p-8 border-b border-white/20 bg-white/5 backdrop-blur-xl">
                        <div className="flex items-center gap-4">
                            <div className="p-3 bg-white/10 backdrop-blur-sm rounded-2xl border border-white/20">
                                <Calculator className="w-8 h-8 text-cyan-400" />
                            </div>
                            <div>
                                <motion.h2
                                    layoutId={`title-${id}`}
                                    className="text-2xl font-bold text-white"
                                >
                                    Analiz & Sim√ºlasyon
                                </motion.h2>
                                <p className="text-white/60">
                                    Karlƒ±lƒ±k analizi ve en iyi farming stratejisi
                                </p>
                            </div>
                        </div>

                        <button
                            onClick={(e) => {
                                e.stopPropagation();
                                onClick();
                            }}
                            className="p-2 hover:bg-white/10 rounded-full transition-colors backdrop-blur-sm border border-white/10 hover:border-white/20"
                        >
                            <X className="w-6 h-6 text-white/80" />
                        </button>
                    </div>

                    {/* Content */}
                    <div className="flex-1 p-8 overflow-hidden">
                        <AnalysisDetailView
                            userStats={userStats}
                            metinList={metinList}
                            storeData={storeData}
                            craftingItems={craftingItems}
                        />
                    </div>
                </div>
            )}
        </motion.div>
    );
}


==================================================
DOSYA YOLU: .\app\components\widgets\CharacterWidget.js
==================================================
"use client";

import { motion } from "framer-motion";
import { X, EyeOff, Sword, Zap, Clock } from "lucide-react";
import useWidgetStore from "../../store/useWidgetStore";

// Helper: Format compact with safety check
const formatCompact = (number) => {
    if (number === undefined || number === null || isNaN(number)) return "0";
    if (number >= 1000000) {
        return `${(number / 1000000).toFixed(1)}M`;
    } else if (number >= 1000) {
        return `${(number / 1000).toFixed(1)}k`;
    }
    return number.toString();
};

// ============================================================================
// SUMMARY VIEW
// ============================================================================
function CharacterSummaryView({ stats }) {
    return (
        <div className="flex flex-col items-center justify-center h-full w-full overflow-hidden px-4">
            <div className="flex items-center gap-3 mb-3">
                <div className="p-2 bg-white/10 backdrop-blur-sm rounded-lg border border-white/10">
                    <Sword className="w-8 h-8 text-violet-400" />
                </div>
            </div>
            <span className="text-3xl font-bold text-white whitespace-nowrap font-mono">
                {formatCompact(stats.damage)} Hasar
            </span>
            <div className="flex items-center gap-4 mt-2 text-sm text-white/60">
                <span className="flex items-center gap-1">
                    <Zap className="w-4 h-4 text-cyan-400" />
                    <span className="font-mono">{stats.hitsPerSecond || 0}</span> v/sn
                </span>
                <span className="flex items-center gap-1">
                    <Clock className="w-4 h-4 text-blue-400" />
                    <span className="font-mono">{stats.findTime || 0}</span>s
                </span>
            </div>
        </div>
    );
}

// ============================================================================
// DETAIL VIEW
// ============================================================================
function CharacterDetailView({ widgetId, stats }) {
    const updateWidgetData = useWidgetStore((state) => state.updateWidgetData);

    const handleChange = (field, value) => {
        const numValue = parseFloat(value);
        if (!isNaN(numValue) && numValue >= 0) {
            updateWidgetData(widgetId, { [field]: numValue });
        }
    };

    return (
        <div className="space-y-6 h-full flex flex-col">
            {/* Info Banner */}
            <div className="bg-black/20 backdrop-blur-xl p-4 rounded-xl border border-white/5">
                <div className="flex items-start gap-3">
                    <div className="p-2 bg-violet-500/10 backdrop-blur-sm rounded-lg border border-violet-500/20">
                        <Sword className="w-5 h-5 text-violet-400" />
                    </div>
                    <div>
                        <h3 className="font-semibold text-white mb-1">Karakter ƒ∞statistikleri</h3>
                        <p className="text-sm text-white/70">
                            Metin kesme hƒ±zƒ±nƒ±zƒ± ve karlƒ±lƒ±ƒüƒ±nƒ±zƒ± hesaplamak i√ßin gerekli bilgiler.
                            Deƒüerler anlƒ±k olarak kaydedilir.
                        </p>
                    </div>
                </div>
            </div>

            {/* Stats Inputs */}
            <div className="flex-1 space-y-4">
                {/* Damage */}
                <div className="bg-black/20 backdrop-blur-xl p-5 rounded-2xl border border-white/5 shadow-sm hover:border-violet-500/20 transition-colors">
                    <div className="flex items-center gap-3 mb-3">
                        <div className="p-2 bg-violet-500/10 backdrop-blur-sm rounded-lg border border-violet-500/20">
                            <Sword className="w-5 h-5 text-violet-400" />
                        </div>
                        <div className="flex-1">
                            <label className="block text-sm font-semibold text-white">
                                Ortalama Hasar (Vuru≈ü Ba≈üƒ±na)
                            </label>
                            <p className="text-xs text-white/60 mt-0.5">
                                Bir vuru≈üta verdiƒüiniz ortalama hasarƒ± girin
                            </p>
                        </div>
                    </div>
                    <input
                        type="number"
                        value={stats.damage || 0}
                        onChange={(e) => handleChange('damage', e.target.value)}
                        className="w-full px-4 py-3 text-lg font-mono font-semibold text-white bg-black/60 border border-white/10 rounded-xl focus:outline-none focus:ring-2 focus:ring-violet-500/20 focus:border-violet-500/50 transition-all placeholder:text-white/20"
                        placeholder="3000"
                        min="0"
                        step="100"
                    />
                </div>

                {/* Hits Per Second */}
                <div className="bg-black/20 backdrop-blur-xl p-5 rounded-2xl border border-white/5 shadow-sm hover:border-cyan-500/20 transition-colors">
                    <div className="flex items-center gap-3 mb-3">
                        <div className="p-2 bg-cyan-500/10 backdrop-blur-sm rounded-lg border border-cyan-500/20">
                            <Zap className="w-5 h-5 text-cyan-400" />
                        </div>
                        <div className="flex-1">
                            <label className="block text-sm font-semibold text-white">
                                Saniye Ba≈üƒ±na Vuru≈ü (Saldƒ±rƒ± Hƒ±zƒ±)
                            </label>
                            <p className="text-xs text-white/60 mt-0.5">
                                Bir saniyede ka√ß kez vurduƒüunuzu girin
                            </p>
                        </div>
                    </div>
                    <input
                        type="number"
                        value={stats.hitsPerSecond || 0}
                        onChange={(e) => handleChange('hitsPerSecond', e.target.value)}
                        className="w-full px-4 py-3 text-lg font-mono font-semibold text-white bg-black/60 border border-white/10 rounded-xl focus:outline-none focus:ring-2 focus:ring-cyan-500/20 focus:border-cyan-500/50 transition-all placeholder:text-white/20"
                        placeholder="2.5"
                        min="0"
                        step="0.1"
                    />
                </div>

                {/* Find Time */}
                <div className="bg-black/20 backdrop-blur-xl p-5 rounded-2xl border border-white/5 shadow-sm hover:border-blue-500/20 transition-colors">
                    <div className="flex items-center gap-3 mb-3">
                        <div className="p-2 bg-blue-500/10 backdrop-blur-sm rounded-lg border border-blue-500/20">
                            <Clock className="w-5 h-5 text-blue-400" />
                        </div>
                        <div className="flex-1">
                            <label className="block text-sm font-semibold text-white">
                                Metin Bulma S√ºresi (Saniye)
                            </label>
                            <p className="text-xs text-white/60 mt-0.5">
                                Bir metinden diƒüerine ge√ßi≈ü s√ºresi
                            </p>
                        </div>
                    </div>
                    <input
                        type="number"
                        value={stats.findTime || 0}
                        onChange={(e) => handleChange('findTime', e.target.value)}
                        className="w-full px-4 py-3 text-lg font-mono font-semibold text-white bg-black/60 border border-white/10 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500/50 transition-all placeholder:text-white/20"
                        placeholder="10"
                        min="0"
                        step="1"
                    />
                </div>
            </div>

            {/* Stats Summary */}
            <div className="bg-black/20 backdrop-blur-sm p-4 rounded-xl border border-white/5">
                <h4 className="text-sm font-semibold text-white/80 mb-2">Hesaplanan Deƒüerler</h4>
                <div className="grid grid-cols-2 gap-3 text-sm">
                    <div className="bg-black/40 backdrop-blur-sm p-3 rounded-lg border border-white/5">
                        <p className="text-white/60 text-xs">DPS (Saniye Ba≈üƒ±na)</p>
                        <p className="text-lg font-bold text-violet-400 font-mono">
                            {formatCompact((stats.damage || 0) * (stats.hitsPerSecond || 0))}
                        </p>
                    </div>
                    <div className="bg-black/40 backdrop-blur-sm p-3 rounded-lg border border-white/5">
                        <p className="text-white/60 text-xs">Toplam D√∂ng√º S√ºresi</p>
                        <p className="text-lg font-bold text-blue-400 font-mono">
                            ~{stats.findTime || 0}+ sn
                        </p>
                    </div>
                </div>
            </div>
        </div>
    );
}

// ============================================================================
// MAIN WIDGET
// ============================================================================
export default function CharacterWidget({ id, data, isSelected, onClick, onHide }) {
    // Use widget data or defaults (FALLBACK)
    const stats = data || { damage: 3000, hitsPerSecond: 2.5, findTime: 10 };

    return (
        <motion.div
            layoutId={`card-${id}`}
            layout
            onClick={!isSelected ? onClick : undefined}
            className={`group rounded-3xl shadow-2xl cursor-pointer overflow-hidden backdrop-blur-xl border border-white/10 ${isSelected
                ? "fixed inset-0 m-auto w-[90%] h-[90%] max-w-6xl z-[100] bg-black/80"
                : "relative h-64 hover:-translate-y-1 hover:border-violet-400/50 transition-all duration-300 bg-black/20 hover:bg-black/40"
                }`}
            transition={{ type: "spring", stiffness: 300, damping: 30 }}
        >
            {/* Hide Button */}
            <motion.button
                whileHover={{ scale: 1.1 }}
                whileTap={{ scale: 0.9 }}
                onClick={(e) => {
                    e.stopPropagation();
                    onHide && onHide();
                }}
                className="absolute top-4 right-4 z-20 p-2 bg-white/10 backdrop-blur-sm shadow-lg rounded-full opacity-0 group-hover:opacity-100 transition-opacity text-white/60 hover:text-violet-400 hover:bg-violet-500/20 border border-white/20"
            >
                <EyeOff className="w-4 h-4" />
            </motion.button>

            {/* Summary View */}
            {!isSelected && (
                <div className="w-full h-full p-6 relative">
                    <Sword className="absolute -bottom-4 -right-4 w-32 h-32 text-white/5 opacity-50 rotate-12 pointer-events-none" />
                    <CharacterSummaryView stats={stats} />
                </div>
            )}

            {/* Detail View */}
            {isSelected && (
                <div className="flex flex-col h-full bg-black/20">
                    <div className="flex items-center justify-between p-8 border-b border-white/10 bg-black/40 backdrop-blur-xl">
                        <div className="flex items-center gap-4">
                            <div className="p-3 bg-violet-500/10 backdrop-blur-sm rounded-2xl border border-violet-500/20">
                                <Sword className="w-8 h-8 text-violet-400" />
                            </div>
                            <div>
                                <motion.h2 layoutId={`title-${id}`} className="text-2xl font-bold text-white">
                                    Karakterim
                                </motion.h2>
                                <p className="text-white/60">Sava≈ü istatistiklerinizi y√∂netin</p>
                            </div>
                        </div>
                        <button
                            onClick={(e) => {
                                e.stopPropagation();
                                onClick();
                            }}
                            className="p-2 hover:bg-white/10 rounded-full transition-colors backdrop-blur-sm border border-white/10 hover:border-white/20"
                        >
                            <X className="w-6 h-6 text-white/80" />
                        </button>
                    </div>
                    <div className="flex-1 p-8 overflow-y-auto">
                        <CharacterDetailView widgetId={id} stats={stats} />
                    </div>
                </div>
            )}
        </motion.div>
    );
}


==================================================
DOSYA YOLU: .\app\components\widgets\CraftingWidget.js
==================================================
"use client";

import { useState, useMemo } from "react";
import { motion } from "framer-motion";
import { X, EyeOff, Wrench, Plus, Trash2, Package, Sparkles, PieChart } from "lucide-react";
import useWidgetStore from "../../store/useWidgetStore";
import { resolveItemPrice } from "../../lib/calculator";
import { initialMetinList } from "../../data/initialData";
import { mergeMarketData } from "../../lib/marketUtils";

// Helper: Format currency
const formatCurrency = (amount) => {
    return new Intl.NumberFormat('tr-TR', {
        minimumFractionDigits: 0,
        maximumFractionDigits: 0,
    }).format(amount);
};

// ============================================================================
// HELPER: FIND SIBLING WIDGETS (CONTEXT-AWARE)
// ============================================================================
function useSiblingWidgetData() {
    // 1. Global Store Verileri
    const activeWorkspaceId = useWidgetStore((state) => state.activeWorkspaceId);
    const workspaces = useWidgetStore((state) => state.workspaces);
    const activeServerId = useWidgetStore((state) => state.activeServerId);
    const serverProfiles = useWidgetStore((state) => state.serverProfiles);
    const itemRegistry = useWidgetStore((state) => state.masterRegistry); // createMarketSlice'dan gelir
    const craftingItems = useWidgetStore((state) => state.craftingItems) || [];

    // 2. Aktif Sunucu Fiyatlarƒ±nƒ± Bul (Sibling Widget yerine Store'dan)
    const activeProfile = serverProfiles.find(p => p.id === activeServerId);
    const localPrices = activeProfile?.prices || {};

    // 3. Diƒüer Store Verileri
    const activeWorkspace = workspaces.find((ws) => ws.id === activeWorkspaceId);
    const widgets = activeWorkspace?.widgets || [];

    const characterWidget = widgets.find((w) => w.type === "character-stats");
    const metinWidget = widgets.find((w) => w.type === "metin-settings");

    const userStats = characterWidget?.data || { damage: 3000, hitsPerSecond: 2.5, findTime: 10 };
    const metinList = metinWidget?.data?.metins || initialMetinList;

    // 4. Market Birle≈ütirme
    const marketItems = useMemo(() => {
        return mergeMarketData(itemRegistry, localPrices);
    }, [itemRegistry, localPrices]);

    return { userStats, metinList, marketItems, craftingItems };
}

// ============================================================================
// SUMMARY VIEW COMPONENT
// ============================================================================
function CraftingSummaryView() {
    const craftingItems = useWidgetStore((state) => state.craftingItems);

    const stats = useMemo(() => {
        const totalRecipes = craftingItems.filter(item => item.type === 'recipe').length;
        const totalContainers = craftingItems.filter(item => item.type === 'container').length;
        const totalFragments = craftingItems.filter(item => item.type === 'fragment').length;
        return { totalRecipes, totalContainers, totalFragments, total: craftingItems.length };
    }, [craftingItems]);

    return (
        <div className="flex flex-col items-center justify-center h-full w-full overflow-hidden">
            <div className="flex items-center gap-3 mb-2">
                <div className="p-2 bg-fuchsia-500/20 backdrop-blur-sm rounded-lg border border-fuchsia-500/30">
                    <Wrench className="w-8 h-8 text-fuchsia-400" />
                </div>
            </div>
            <span className="text-3xl font-bold text-white whitespace-nowrap">
                {stats.total} √ñƒüe
            </span>
            <div className="flex gap-3 mt-2 text-sm">
                <span className="text-cyan-300 font-mono">
                    {stats.totalRecipes} Re√ßete
                </span>
                <span className="text-white/30">‚Ä¢</span>
                <span className="text-violet-300 font-mono">
                    {stats.totalContainers} Sandƒ±k
                </span>
                <span className="text-white/30">‚Ä¢</span>
                <span className="text-amber-300 font-mono">
                    {stats.totalFragments} Par√ßa
                </span>
            </div>
        </div>
    );
}

// ============================================================================
// DETAIL VIEW COMPONENT
// ============================================================================
function CraftingDetailView({ metinList, marketItems }) {
    const craftingItems = useWidgetStore((state) => state.craftingItems);
    const addCraftingItem = useWidgetStore((state) => state.addCraftingItem);
    const removeCraftingItem = useWidgetStore((state) => state.removeCraftingItem);
    const updateCraftingItem = useWidgetStore((state) => state.updateCraftingItem);
    const addContentToItem = useWidgetStore((state) => state.addContentToItem);
    const removeContentFromItem = useWidgetStore((state) => state.removeContentFromItem);

    const [selectedItemId, setSelectedItemId] = useState(null);
    const [showAddModal, setShowAddModal] = useState(false);
    const [newItemType, setNewItemType] = useState('recipe');

    // New content form state
    const [newContent, setNewContent] = useState({
        sourceType: 'market',
        itemId: '',
        count: 1,
        chance: 100
    });

    const selectedItem = useMemo(() => {
        return craftingItems.find(item => item.id === selectedItemId);
    }, [craftingItems, selectedItemId]);

    // Calculate price for selected item
    const calculatedPrice = useMemo(() => {
        if (!selectedItem) return 0;
        return resolveItemPrice(
            selectedItem.id,
            'crafting',
            marketItems,
            craftingItems,
            metinList,
            0
        );
    }, [selectedItem, marketItems, craftingItems, metinList]);

    // Handle add new crafting item
    const handleAddItem = () => {
        const name = newItemType === 'recipe' ? 'Yeni Re√ßete' :
            newItemType === 'container' ? 'Yeni Sandƒ±k' : 'Yeni Par√ßa';
        addCraftingItem(name, newItemType);
        setShowAddModal(false);
    };

    // Handle delete item
    const handleDeleteItem = (id) => {
        if (confirm("Bu √∂ƒüeyi silmek istediƒüinizden emin misiniz?")) {
            removeCraftingItem(id);
            if (selectedItemId === id) {
                setSelectedItemId(null);
            }
        }
    };

    // Handle add content to selected item
    const handleAddContent = (e) => {
        e.preventDefault();
        if (!selectedItem || !newContent.itemId) return;

        addContentToItem(selectedItem.id, {
            itemId: newContent.itemId,
            sourceType: newContent.sourceType,
            count: parseInt(newContent.count) || 1,
            chance: parseFloat(newContent.chance) || 100
        });

        // Reset form
        setNewContent({
            sourceType: 'market',
            itemId: '',
            count: 1,
            chance: 100
        });
    };

    // Get available items for dropdown (based on sourceType)
    const availableItems = useMemo(() => {
        if (newContent.sourceType === 'market') {
            return marketItems;
        } else {
            // Crafting items, but exclude the selected item itself
            return craftingItems.filter(item => item.id !== selectedItemId);
        }
    }, [newContent.sourceType, marketItems, craftingItems, selectedItemId]);

    // Get item name by ID and type
    const getItemName = (itemId, sourceType) => {
        if (sourceType === 'market') {
            const item = marketItems.find(i => i.id === itemId);
            return item ? item.name : 'Bilinmeyen';
        } else {
            const item = craftingItems.find(i => i.id === itemId);
            return item ? item.name : 'Bilinmeyen';
        }
    };

    return (
        <div className="grid grid-cols-2 gap-6 h-full">
            {/* LEFT COLUMN - Item List */}
            <div className="flex flex-col space-y-4">
                <div className="flex items-center justify-between">
                    <h3 className="text-lg font-bold text-white">Sanal E≈üyalar</h3>
                    <button
                        onClick={() => setShowAddModal(true)}
                        className="flex items-center gap-2 px-3 py-2 bg-fuchsia-600/20 backdrop-blur-sm text-fuchsia-400 rounded-lg hover:bg-fuchsia-600/40 transition-colors font-medium border border-fuchsia-500/30"
                    >
                        <Plus className="w-4 h-4" />
                        Yeni Ekle
                    </button>
                </div>

                {/* Item List */}
                <div className="flex-1 overflow-auto space-y-2 pr-2">
                    {craftingItems.length === 0 ? (
                        <div className="text-center text-white/50 py-8">
                            Hen√ºz √∂ƒüe eklenmedi
                        </div>
                    ) : (
                        craftingItems.map((item) => (
                            <motion.div
                                key={item.id}
                                whileHover={{ scale: 1.02 }}
                                onClick={() => setSelectedItemId(item.id)}
                                className={`p-4 rounded-lg cursor-pointer transition-all border ${selectedItemId === item.id
                                    ? 'bg-fuchsia-600/20 border-fuchsia-500/50 shadow-lg shadow-fuchsia-500/20'
                                    : 'bg-white/5 border-white/10 hover:bg-white/10'
                                    }`}
                            >
                                <div className="flex items-center justify-between">
                                    <div className="flex items-center gap-3">
                                        {item.type === 'recipe' ? (
                                            <Sparkles className="w-5 h-5 text-cyan-400" />
                                        ) : item.type === 'container' ? (
                                            <Package className="w-5 h-5 text-violet-400" />
                                        ) : (
                                            <PieChart className="w-5 h-5 text-amber-400" />
                                        )}
                                        <div>
                                            <p className="text-sm font-medium text-white">{item.name}</p>
                                            <p className="text-xs text-white/50">
                                                {item.type === 'recipe' ? 'Re√ßete' : item.type === 'container' ? 'Sandƒ±k' : 'Par√ßa'} ‚Ä¢ {item.contents?.length || 0} i√ßerik
                                            </p>
                                        </div>
                                    </div>
                                    <button
                                        onClick={(e) => {
                                            e.stopPropagation();
                                            handleDeleteItem(item.id);
                                        }}
                                        className="p-1.5 text-red-400 hover:bg-red-500/10 rounded-lg transition-colors"
                                    >
                                        <Trash2 className="w-4 h-4" />
                                    </button>
                                </div>
                            </motion.div>
                        ))
                    )}
                </div>
            </div>

            {/* RIGHT COLUMN - Detail & Editor */}
            <div className="flex flex-col space-y-4 border-l border-white/10 pl-6">
                {!selectedItem ? (
                    <div className="flex items-center justify-center h-full text-white/50">
                        Bir √∂ƒüe se√ßin
                    </div>
                ) : (
                    <>
                        {/* Item Name Editor */}
                        <div className="bg-white/5 backdrop-blur-xl p-4 rounded-xl border border-white/10">
                            <label className="block text-sm text-white/70 mb-2">√ñƒüe Adƒ±</label>
                            <input
                                type="text"
                                value={selectedItem.name}
                                onChange={(e) => updateCraftingItem(selectedItem.id, { name: e.target.value })}
                                className="w-full px-3 py-2 font-medium text-white bg-black/50 border border-white/10 rounded-lg focus:outline-none focus:ring-2 focus:ring-fuchsia-500/20 focus:border-fuchsia-500/50 placeholder:text-white/20"
                            />
                        </div>

                        {/* Calculated Price Display */}
                        <div className="bg-gradient-to-br from-fuchsia-600/20 to-cyan-600/20 backdrop-blur-xl p-4 rounded-xl border border-fuchsia-500/30">
                            <div className="flex items-center justify-between">
                                <span className="text-sm text-white/70">Hesaplanan Deƒüer</span>
                                <span className="text-2xl font-bold text-fuchsia-400">
                                    {formatCurrency(calculatedPrice)} Yang
                                </span>
                            </div>
                            <p className="text-xs text-white/50 mt-1">Canlƒ± √∂nizleme ‚Ä¢ Otomatik hesaplama</p>
                        </div>

                        {/* Fragment-specific UI */}
                        {selectedItem.type === 'fragment' ? (
                            <>
                                {/* Target Item Selector */}
                                <div className="bg-white/5 backdrop-blur-xl p-4 rounded-xl border border-white/10">
                                    <label className="block text-sm text-white/70 mb-2">Hangi E≈üyanƒ±n Par√ßasƒ±?</label>
                                    <select
                                        value={selectedItem.targetId || ''}
                                        onChange={(e) => updateCraftingItem(selectedItem.id, { targetId: e.target.value })}
                                        className="w-full px-3 py-2 font-medium text-white bg-black/50 border border-white/10 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500/20 focus:border-amber-500/50"
                                    >
                                        <option value="" className="bg-zinc-900">Hedef E≈üya Se√ßiniz...</option>
                                        {craftingItems
                                            .filter(item => item.id !== selectedItem.id)
                                            .map((item) => (
                                                <option key={item.id} value={item.id} className="bg-zinc-900">
                                                    {item.name}
                                                </option>
                                            ))}
                                        {metinList && metinList.length > 0 && (
                                            <optgroup label="Metinler" className="bg-zinc-900 text-white/50">
                                                {metinList.map((metin) => (
                                                    <option key={metin.id} value={metin.id} className="bg-zinc-900 text-white">
                                                        {metin.name}
                                                    </option>
                                                ))}
                                            </optgroup>
                                        )}
                                    </select>
                                </div>

                                {/* Amount Input */}
                                <div className="bg-white/5 backdrop-blur-xl p-4 rounded-xl border border-white/10">
                                    <label className="block text-sm text-white/70 mb-2">Ka√ß Par√ßa Birle≈üiyor?</label>
                                    <input
                                        type="number"
                                        value={selectedItem.amount || 1}
                                        onChange={(e) => updateCraftingItem(selectedItem.id, { amount: parseInt(e.target.value) || 1 })}
                                        className="w-full px-3 py-2 font-semibold text-white bg-black/50 border border-white/10 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500/20 focus:border-amber-500/50"
                                        min="1"
                                    />
                                    <p className="text-xs text-white/50 mt-2">
                                        Bu kadar par√ßa birle≈üerek hedef e≈üyayƒ± olu≈üturur
                                    </p>
                                </div>
                            </>
                        ) : (
                            <div className="flex-1 flex flex-col space-y-4 overflow-hidden">
                                {/* Contents List */}
                                <div className="flex-1 overflow-auto">
                                    <h4 className="text-sm font-semibold text-white mb-3">ƒ∞√ßerik Listesi</h4>
                                    <div className="space-y-2">
                                        {selectedItem.contents?.length === 0 ? (
                                            <div className="text-center text-white/50 py-4 text-sm">
                                                ƒ∞√ßerik eklenmedi
                                            </div>
                                        ) : (
                                            selectedItem.contents?.map((content) => (
                                                <div
                                                    key={content.id}
                                                    className="bg-white/5 p-3 rounded-lg border border-white/10 flex items-center justify-between"
                                                >
                                                    <div className="flex-1">
                                                        <p className="text-sm font-medium text-white">
                                                            {getItemName(content.itemId, content.sourceType)}
                                                        </p>
                                                        <div className="flex gap-3 mt-1 text-xs text-white/60">
                                                            <span className={content.sourceType === 'market' ? 'text-cyan-400' : 'text-violet-400'}>
                                                                {content.sourceType === 'market' ? 'Market' : 'Crafting'}
                                                            </span>
                                                            <span>Adet: {content.count}</span>
                                                            {selectedItem.type === 'container' && (
                                                                <span>≈ûans: %{content.chance}</span>
                                                            )}
                                                        </div>
                                                    </div>
                                                    <button
                                                        onClick={() => removeContentFromItem(selectedItem.id, content.id)}
                                                        className="p-1.5 text-red-400 hover:bg-red-500/10 rounded-lg transition-colors"
                                                    >
                                                        <Trash2 className="w-4 h-4" />
                                                    </button>
                                                </div>
                                            ))
                                        )}
                                    </div>
                                </div>

                                {/* Add Content Form */}
                                <form onSubmit={handleAddContent} className="bg-white/5 backdrop-blur-xl p-4 rounded-xl border border-white/10 space-y-3">
                                    <h4 className="text-sm font-semibold text-white">Yeni ƒ∞√ßerik Ekle</h4>

                                    {/* Source Type Dropdown */}
                                    <div>
                                        <label className="block text-xs text-white/70 mb-1">Kaynak Tipi</label>
                                        <select
                                            value={newContent.sourceType}
                                            onChange={(e) => setNewContent({ ...newContent, sourceType: e.target.value, itemId: '' })}
                                            className="w-full px-3 py-2 font-medium text-white bg-black/50 border border-white/10 rounded-lg focus:outline-none focus:ring-2 focus:ring-fuchsia-500/20 focus:border-fuchsia-500/50"
                                        >
                                            <option value="market" className="bg-zinc-900">Market E≈üyasƒ±</option>
                                            <option value="crafting" className="bg-zinc-900">Crafting E≈üyasƒ±</option>
                                        </select>
                                    </div>

                                    {/* Item Selection Dropdown */}
                                    <div>
                                        <label className="block text-xs text-white/70 mb-1">E≈üya Se√ßimi</label>
                                        <select
                                            value={newContent.itemId}
                                            onChange={(e) => setNewContent({ ...newContent, itemId: e.target.value })}
                                            className="w-full px-3 py-2 font-medium text-white bg-black/50 border border-white/10 rounded-lg focus:outline-none focus:ring-2 focus:ring-fuchsia-500/20 focus:border-fuchsia-500/50"
                                            required
                                        >
                                            <option value="" className="bg-zinc-900">Se√ßiniz...</option>
                                            {availableItems.map((item) => (
                                                <option key={item.id} value={item.id} className="bg-zinc-900">
                                                    {item.name}
                                                </option>
                                            ))}
                                        </select>
                                    </div>

                                    {/* Count and Chance Inputs */}
                                    <div className="grid grid-cols-2 gap-3">
                                        <div>
                                            <label className="block text-xs text-white/70 mb-1">Adet</label>
                                            <input
                                                type="number"
                                                value={newContent.count}
                                                onChange={(e) => setNewContent({ ...newContent, count: e.target.value })}
                                                className="w-full px-3 py-2 font-semibold text-white bg-black/50 border border-white/10 rounded-lg focus:outline-none focus:ring-2 focus:ring-fuchsia-500/20 focus:border-fuchsia-500/50"
                                                min="1"
                                                required
                                            />
                                        </div>
                                        {selectedItem.type === 'container' && (
                                            <div>
                                                <label className="block text-xs text-white/70 mb-1">≈ûans (%)</label>
                                                <input
                                                    type="number"
                                                    value={newContent.chance}
                                                    onChange={(e) => setNewContent({ ...newContent, chance: e.target.value })}
                                                    className="w-full px-3 py-2 font-semibold text-white bg-black/50 border border-white/10 rounded-lg focus:outline-none focus:ring-2 focus:ring-fuchsia-500/20 focus:border-fuchsia-500/50"
                                                    min="0"
                                                    max="100"
                                                    step="0.01"
                                                    required
                                                />
                                            </div>
                                        )}
                                    </div>

                                    <button
                                        type="submit"
                                        className="w-full flex items-center justify-center gap-2 px-4 py-2 bg-cyan-600/20 backdrop-blur-sm text-cyan-400 rounded-lg hover:bg-cyan-600/40 transition-colors font-medium border border-cyan-500/30"
                                    >
                                        <Plus className="w-4 h-4" />
                                        Ekle
                                    </button>
                                </form>
                            </div>
                        )}
                    </>
                )}
            </div>

            {/* Add Item Modal */}
            {showAddModal && (
                <div className="fixed inset-0 z-[110] flex items-center justify-center p-4">
                    {/* Backdrop */}
                    <div
                        className="absolute inset-0 bg-black/60 backdrop-blur-sm"
                        onClick={() => setShowAddModal(false)}
                    />

                    {/* Modal */}
                    <motion.div
                        initial={{ opacity: 0, scale: 0.9 }}
                        animate={{ opacity: 1, scale: 1 }}
                        className="relative bg-black/80 backdrop-blur-xl border border-white/10 rounded-2xl p-6 max-w-md w-full shadow-2xl"
                    >
                        <h3 className="text-xl font-bold text-white mb-4">Yeni √ñƒüe Ekle</h3>

                        <div className="space-y-3">
                            <label className="block text-sm text-white/70 mb-2">√ñƒüe Tipi Se√ßin</label>

                            <button
                                onClick={() => setNewItemType('recipe')}
                                className={`w-full p-4 rounded-lg border transition-all ${newItemType === 'recipe'
                                    ? 'bg-cyan-600/20 border-cyan-500/50 text-cyan-400'
                                    : 'bg-white/5 border-white/10 text-white/70 hover:bg-white/10'
                                    }`}
                            >
                                <div className="flex items-center gap-3">
                                    <Sparkles className="w-6 h-6" />
                                    <div className="text-left">
                                        <p className="font-semibold">Re√ßete (Recipe)</p>
                                        <p className="text-xs opacity-70">X + Y = Z (D√∂n√º≈ü√ºm)</p>
                                    </div>
                                </div>
                            </button>

                            <button
                                onClick={() => setNewItemType('container')}
                                className={`w-full p-4 rounded-lg border transition-all ${newItemType === 'container'
                                    ? 'bg-violet-600/20 border-violet-500/50 text-violet-400'
                                    : 'bg-white/5 border-white/10 text-white/70 hover:bg-white/10'
                                    }`}
                            >
                                <div className="flex items-center gap-3">
                                    <Package className="w-6 h-6" />
                                    <div className="text-left">
                                        <p className="font-semibold">Sandƒ±k (Container)</p>
                                        <p className="text-xs opacity-70">%X ≈üansla Y √ßƒ±kar (Boss/Sandƒ±k)</p>
                                    </div>
                                </div>
                            </button>

                            <button
                                onClick={() => setNewItemType('fragment')}
                                className={`w-full p-4 rounded-lg border transition-all ${newItemType === 'fragment'
                                    ? 'bg-amber-600/20 border-amber-500/50 text-amber-400'
                                    : 'bg-white/5 border-white/10 text-white/70 hover:bg-white/10'
                                    }`}
                            >
                                <div className="flex items-center gap-3">
                                    <PieChart className="w-6 h-6" />
                                    <div className="text-left">
                                        <p className="font-semibold">Par√ßa / Hisse (Fragment)</p>
                                        <p className="text-xs opacity-70">B√ºt√ºn√ºn bir par√ßasƒ± (Tersine deƒüerleme)</p>
                                    </div>
                                </div>
                            </button>
                        </div>

                        <div className="flex gap-2 mt-6">
                            <button
                                onClick={handleAddItem}
                                className="flex-1 px-4 py-2 bg-fuchsia-600/20 text-fuchsia-400 rounded-lg hover:bg-fuchsia-600/40 transition-colors font-medium border border-fuchsia-500/30"
                            >
                                Olu≈ütur
                            </button>
                            <button
                                onClick={() => setShowAddModal(false)}
                                className="px-4 py-2 bg-white/5 text-white/80 rounded-lg hover:bg-white/10 transition-colors font-medium border border-white/10"
                            >
                                ƒ∞ptal
                            </button>
                        </div>
                    </motion.div>
                </div>
            )}
        </div>
    );
}

// ============================================================================
// MAIN WIDGET
// ============================================================================
export default function CraftingWidget({ id, data, isSelected, onClick, onHide }) {
    const { metinList, marketItems } = useSiblingWidgetData();

    return (
        <motion.div
            layoutId={`card-${id}`}
            layout
            onClick={!isSelected ? onClick : undefined}
            className={`group rounded-3xl shadow-2xl cursor-pointer overflow-hidden backdrop-blur-xl border border-white/10 ${isSelected
                ? "fixed inset-0 m-auto w-[90%] h-[90%] max-w-6xl z-[100] bg-black/80"
                : "relative h-64 hover:-translate-y-1 hover:border-fuchsia-400/50 transition-all duration-300 bg-white/5 hover:bg-white/10"
                }`}
            transition={{ type: "spring", stiffness: 300, damping: 30 }}
        >
            {/* Hide Button */}
            <motion.button
                whileHover={{ scale: 1.1 }}
                whileTap={{ scale: 0.9 }}
                onClick={(e) => {
                    e.stopPropagation();
                    onHide && onHide();
                }}
                className="absolute top-4 right-4 z-20 p-2 bg-white/10 backdrop-blur-sm shadow-lg rounded-full opacity-0 group-hover:opacity-100 transition-opacity text-white/60 hover:text-red-400 hover:bg-red-500/20 border border-white/20"
            >
                <EyeOff className="w-4 h-4" />
            </motion.button>

            {/* Summary View */}
            {!isSelected && (
                <div className="w-full h-full p-6 relative">
                    <Wrench className="absolute -bottom-4 -right-4 w-32 h-32 text-white/5 opacity-50 rotate-12 pointer-events-none" />
                    <CraftingSummaryView />
                </div>
            )}

            {/* Detail View */}
            {isSelected && (
                <div className="flex flex-col h-full bg-black/20">
                    <div className="flex items-center justify-between p-8 border-b border-white/20 bg-white/5 backdrop-blur-xl">
                        <div className="flex items-center gap-4">
                            <div className="p-3 bg-white/10 backdrop-blur-sm rounded-2xl border border-white/20">
                                <Wrench className="w-8 h-8 text-fuchsia-400" />
                            </div>
                            <div>
                                <motion.h2 layoutId={`title-${id}`} className="text-2xl font-bold text-white">
                                    Crafting Sistemi
                                </motion.h2>
                                <p className="text-white/60">Re√ßeteler ve sandƒ±klarƒ± y√∂net</p>
                            </div>
                        </div>
                        <button
                            onClick={(e) => {
                                e.stopPropagation();
                                onClick();
                            }}
                            className="p-2 hover:bg-white/10 rounded-full transition-colors backdrop-blur-sm border border-white/10 hover:border-white/20"
                        >
                            <X className="w-6 h-6 text-white/80" />
                        </button>
                    </div>
                    <div className="flex-1 p-8 overflow-hidden">
                        <CraftingDetailView metinList={metinList} marketItems={marketItems} />
                    </div>
                </div>
            )}
        </motion.div>
    );
}


==================================================
DOSYA YOLU: .\app\components\widgets\DamageProgressionWidget.js
==================================================
"use client";

import { useMemo } from "react";
import { motion } from "framer-motion";
import { X, EyeOff, TrendingUp, Target, ArrowDown, Check, Trophy, AlertCircle } from "lucide-react";
import useWidgetStore from "../../store/useWidgetStore";
import { calculateDamageZones, analyzeNextTier, formatCompactCurrency, formatCurrency } from "../../lib/calculator";
import { initialMetinList } from "../../data/initialData";
import { mergeMarketData } from "../../lib/marketUtils";

// ============================================================================
// HELPER: FIND SIBLING WIDGETS (CONTEXT-AWARE)
// ============================================================================
function useSiblingWidgetData() {
    // 1. Global Store Verileri
    const activeWorkspaceId = useWidgetStore((state) => state.activeWorkspaceId);
    const workspaces = useWidgetStore((state) => state.workspaces);
    const activeServerId = useWidgetStore((state) => state.activeServerId);
    const serverProfiles = useWidgetStore((state) => state.serverProfiles);
    const itemRegistry = useWidgetStore((state) => state.masterRegistry); // createMarketSlice'dan gelir
    const craftingItems = useWidgetStore((state) => state.craftingItems) || [];

    // 2. Aktif Sunucu Fiyatlarƒ±nƒ± Bul (Sibling Widget yerine Store'dan)
    const activeProfile = serverProfiles.find(p => p.id === activeServerId);
    const localPrices = activeProfile?.prices || {};

    // 3. Diƒüer Store Verileri
    const activeWorkspace = workspaces.find((ws) => ws.id === activeWorkspaceId);
    const widgets = activeWorkspace?.widgets || [];

    const characterWidget = widgets.find((w) => w.type === "character-stats");
    const metinWidget = widgets.find((w) => w.type === "metin-settings");

    const userStats = characterWidget?.data || { damage: 3000, hitsPerSecond: 2.5, findTime: 10 };
    const metinList = metinWidget?.data?.metins || initialMetinList;

    // 4. Market Birle≈ütirme
    const marketItems = useMemo(() => {
        return mergeMarketData(itemRegistry, localPrices);
    }, [itemRegistry, localPrices]);

    return { userStats, metinList, marketItems, craftingItems };
}

// ============================================================================
// SUMMARY VIEW
// ============================================================================
function DamageProgressionSummaryView({ userStats, metinList, marketItems, craftingItems }) {
    const zones = useMemo(() => {
        return calculateDamageZones(metinList, marketItems, userStats, craftingItems);
    }, [metinList, marketItems, userStats, craftingItems]);

    const currentDamage = userStats.damage || 0;
    const maxSimulationDamage = zones.length > 0 ? zones[zones.length - 1].maxDamage : 30000;
    const markerPosition = Math.min(100, Math.max(0, (currentDamage / maxSimulationDamage) * 100));

    return (
        <div className="flex flex-col items-center justify-center h-full w-full px-4">
            <div className="flex items-center gap-2 mb-4">
                <Target className="w-6 h-6 text-fuchsia-400 drop-shadow-[0_0_8px_rgba(232,121,249,0.5)]" />
                <span className="text-lg font-bold text-white drop-shadow-[0_0_10px_rgba(255,255,255,0.3)]">Hasar Analizi</span>
            </div>

            {/* Progress Bar Container */}
            <div className="w-full h-8 bg-black/60 rounded-full overflow-hidden relative flex border border-white/10 shadow-inner">
                {zones.map((zone, index) => {
                    const widthPercent = ((zone.maxDamage - zone.minDamage) / maxSimulationDamage) * 100;
                    return (
                        <div
                            key={index}
                            style={{ width: `${widthPercent}%` }}
                            className="h-full relative group first:rounded-l-full last:rounded-r-full hover:brightness-110 transition-all bg-gradient-to-r from-yellow-400/80 to-cyan-400/80 backdrop-blur-sm border-r border-white/10 last:border-r-0"
                        >
                            {/* Tooltip */}
                            <div className="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-2 py-1 bg-black/90 text-white text-xs rounded opacity-0 group-hover:opacity-100 whitespace-nowrap pointer-events-none transition-opacity z-10 border border-white/20">
                                {zone.bestMetinName}
                            </div>
                        </div>
                    );
                })}

                {/* User Marker */}
                <div
                    className="absolute top-0 bottom-0 w-1 bg-cyan-400 shadow-[0_0_10px_#06b6d4] z-10 transition-all duration-500"
                    style={{ left: `${markerPosition}%` }}
                >
                    <div className="absolute bottom-full left-1/2 -translate-x-1/2 mb-1">
                        <div className="bg-cyan-500 text-black text-[10px] font-bold px-1.5 py-0.5 rounded shadow-lg whitespace-nowrap">
                            Siz
                        </div>
                        <div className="w-0 h-0 border-l-[4px] border-l-transparent border-r-[4px] border-r-transparent border-t-[4px] border-t-cyan-500 mx-auto"></div>
                    </div>
                </div>
            </div>
        </div>
    );
}

// ============================================================================
// DETAIL VIEW
// ============================================================================
function DamageProgressionDetailView({ userStats, metinList, marketItems, craftingItems }) {
    const zones = useMemo(() => {
        return calculateDamageZones(metinList, marketItems, userStats, craftingItems);
    }, [metinList, marketItems, userStats, craftingItems]);

    const currentDamage = userStats.damage || 0;

    // Analyze next tier
    const analysis = useMemo(() => {
        return analyzeNextTier(currentDamage, zones);
    }, [currentDamage, zones]);

    // Find current zone for display
    const currentZone = zones.find(z => currentDamage >= z.minDamage && currentDamage <= z.maxDamage);

    if (!currentZone || !analysis) {
        return (
            <div className="flex items-center justify-center h-full text-white/50">
                Veri bekleniyor...
            </div>
        );
    }

    return (
        <div className="h-full flex flex-col items-center justify-center max-w-2xl mx-auto w-full py-4">

            {/* 1. CURRENT STATUS CARD */}
            <motion.div
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                className="w-full bg-black/40 backdrop-blur-xl p-6 rounded-2xl border border-cyan-500/30 shadow-[0_0_20px_rgba(6,182,212,0.1)] relative overflow-hidden hover:border-cyan-500/50 transition-colors"
            >
                <div className="absolute top-0 right-0 p-4 opacity-10">
                    <Check className="w-24 h-24 text-cyan-500" />
                </div>

                <div className="relative z-10">
                    <div className="flex items-center gap-3 mb-2">
                        <div className="p-2 bg-cyan-500/20 rounded-lg border border-cyan-500/30">
                            <Check className="w-6 h-6 text-cyan-400" />
                        </div>
                        <span className="text-cyan-400 font-bold tracking-wide uppercase text-sm">Mevcut Durum</span>
                    </div>

                    <h3 className="text-2xl font-bold text-white mb-1">
                        ≈ûu an <span className="text-cyan-400">{currentZone.bestMetinName}</span> kesiyorsun.
                    </h3>
                    <p className="text-white/60">
                        Ortalama Kazan√ß: <strong className="text-white">{formatCompactCurrency(currentZone.maxProfit)} Yang/Saat</strong>
                    </p>
                </div>
            </motion.div>

            {/* 2. PROGRESS INDICATOR */}
            <div className="h-16 flex items-center justify-center relative w-full my-2">
                <div className="absolute inset-0 flex items-center justify-center">
                    <div className="w-0.5 h-full bg-gradient-to-b from-cyan-500/50 to-fuchsia-500/50"></div>
                </div>

                {!analysis.isMaxLevel && (
                    <motion.div
                        initial={{ scale: 0 }}
                        animate={{ scale: 1 }}
                        className="relative z-10 bg-[#000000] border border-white/20 px-4 py-2 rounded-full shadow-xl flex items-center gap-2"
                    >
                        <ArrowDown className="w-4 h-4 text-white/60" />
                        <span className="text-sm font-bold text-white">
                            Sonraki Seviyeye: <span className="text-fuchsia-400">+{formatCompactCurrency(analysis.requiredDamage)} Hasar</span> Kaldƒ±
                        </span>
                    </motion.div>
                )}
            </div>

            {/* 3. TARGET CARD */}
            <motion.div
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ delay: 0.1 }}
                className={`w-full p-6 rounded-2xl border shadow-lg relative overflow-hidden ${analysis.isMaxLevel
                    ? "bg-gradient-to-br from-violet-900/40 to-blue-900/40 border-violet-500/30"
                    : "bg-gradient-to-br from-fuchsia-900/40 to-purple-900/40 border-fuchsia-500/30 shadow-[0_0_30px_rgba(217,70,239,0.15)]"
                    }`}
            >
                <div className="absolute top-0 right-0 p-4 opacity-10">
                    <Trophy className="w-24 h-24 text-fuchsia-500" />
                </div>

                <div className="relative z-10">
                    {analysis.isMaxLevel ? (
                        // MAX LEVEL VIEW
                        <div className="text-center py-4">
                            <div className="inline-flex p-3 bg-violet-500/20 rounded-full border border-violet-500/30 mb-4">
                                <Trophy className="w-8 h-8 text-violet-400" />
                            </div>
                            <h3 className="text-2xl font-bold text-white mb-2">Zirvedesiniz!</h3>
                            <p className="text-white/70 max-w-md mx-auto">
                                Tebrikler! Mevcut ekipmanƒ±nƒ±zla ula≈üabileceƒüiniz en y√ºksek verimlilik seviyesindesiniz.
                                Artƒ±k keyfini √ßƒ±karma vakti! üëë
                            </p>
                        </div>
                    ) : (
                        // NEXT GOAL VIEW
                        <>
                            <div className="flex items-center gap-3 mb-2">
                                <div className="p-2 bg-fuchsia-500/20 rounded-lg border border-fuchsia-500/30">
                                    <Target className="w-6 h-6 text-fuchsia-400" />
                                </div>
                                <span className="text-fuchsia-400 font-bold tracking-wide uppercase text-sm">Sonraki Hedef</span>
                            </div>

                            <h3 className="text-3xl font-bold text-white mb-2">
                                {analysis.nextMetin}
                            </h3>

                            <div className="flex items-start gap-3 mt-4 bg-black/20 p-3 rounded-xl border border-white/5">
                                <TrendingUp className="w-5 h-5 text-cyan-400 mt-0.5" />
                                <div>
                                    <p className="text-white/90 font-medium">
                                        Bu hedefe ula≈üƒ±rsan kazancƒ±n <span className="text-cyan-400 font-bold">%{analysis.percentGain.toFixed(1)}</span> artacak!
                                    </p>
                                    <p className="text-white/50 text-xs mt-1">
                                        Tahmini Artƒ±≈ü: +{formatCompactCurrency(analysis.profitIncrease)} Yang/Saat
                                    </p>
                                </div>
                            </div>
                        </>
                    )}
                </div>
            </motion.div>

            {/* Softcap Warning (if applicable) */}
            {currentZone.isSoftcap && (
                <motion.div
                    initial={{ opacity: 0 }}
                    animate={{ opacity: 1 }}
                    transition={{ delay: 0.5 }}
                    className="mt-4 flex items-center gap-2 text-xs text-red-400 bg-red-500/10 px-3 py-2 rounded-lg border border-red-500/20"
                >
                    <AlertCircle className="w-4 h-4" />
                    <span>Dikkat: ≈ûu an softcap b√∂lgesindesiniz. Hasar artƒ±≈üƒ± verimi d√º≈ü√ºrebilir.</span>
                </motion.div>
            )}
        </div>
    );
}

// ============================================================================
// MAIN WIDGET
// ============================================================================
export default function DamageProgressionWidget({ id, data, isSelected, onClick, onHide }) {
    // Get context-aware data from sibling widgets
    const { userStats, metinList, marketItems, craftingItems } = useSiblingWidgetData();

    return (
        <motion.div
            layoutId={`card-${id}`}
            layout
            onClick={!isSelected ? onClick : undefined}
            className={`group rounded-3xl shadow-2xl cursor-pointer overflow-hidden backdrop-blur-xl border border-white/10 ${isSelected
                ? "fixed inset-0 m-auto w-[90%] h-[90%] max-w-6xl z-[100] bg-black/90 border border-white/10"
                : "relative h-64 hover:-translate-y-1 hover:border-cyan-500/50 hover:shadow-[0_0_30px_rgba(6,182,212,0.1)] transition-all duration-300 bg-black/40 hover:bg-black/50 border border-white/10"
                }`}
            transition={{ type: "spring", stiffness: 300, damping: 30 }}
        >
            {/* Hide Button */}
            <motion.button
                whileHover={{ scale: 1.1 }}
                whileTap={{ scale: 0.9 }}
                onClick={(e) => {
                    e.stopPropagation();
                    onHide && onHide();
                }}
                className="absolute top-4 right-4 z-20 p-2 bg-white/10 backdrop-blur-sm shadow-lg rounded-full opacity-0 group-hover:opacity-100 transition-opacity text-white/60 hover:text-red-400 hover:bg-red-500/20 border border-white/20"
            >
                <EyeOff className="w-4 h-4" />
            </motion.button>

            {/* Summary View */}
            {!isSelected && (
                <div className="w-full h-full p-6 relative">
                    <TrendingUp className="absolute -bottom-4 -right-4 w-32 h-32 text-white/5 opacity-50 rotate-12 pointer-events-none" />
                    <DamageProgressionSummaryView
                        userStats={userStats}
                        metinList={metinList}
                        marketItems={marketItems}
                        craftingItems={craftingItems}
                    />
                </div>
            )}

            {/* Detail View */}
            {isSelected && (
                <div className="flex flex-col h-full bg-black/20">
                    <div className="flex items-center justify-between p-8 border-b border-white/20 bg-white/5 backdrop-blur-xl">
                        <div className="flex items-center gap-4">
                            <div className="p-3 bg-white/10 backdrop-blur-sm rounded-2xl border border-white/20">
                                <TrendingUp className="w-8 h-8 text-cyan-400" />
                            </div>
                            <div>
                                <motion.h2 layoutId={`title-${id}`} className="text-2xl font-bold text-white">
                                    Hasar Yol Haritasƒ±
                                </motion.h2>
                                <p className="text-white/60">Geli≈üim hedefleri ve sonraki adƒ±mlar</p>
                            </div>
                        </div>
                        <button
                            onClick={(e) => {
                                e.stopPropagation();
                                onClick();
                            }}
                            className="p-2 hover:bg-white/10 rounded-full transition-colors backdrop-blur-sm border border-white/10 hover:border-white/20"
                        >
                            <X className="w-6 h-6 text-white/80" />
                        </button>
                    </div>
                    <div className="flex-1 p-8 overflow-y-auto">
                        <DamageProgressionDetailView
                            userStats={userStats}
                            metinList={metinList}
                            marketItems={marketItems}
                            craftingItems={craftingItems}
                        />
                    </div>
                </div>
            )}
        </motion.div>
    );
}


==================================================
DOSYA YOLU: .\app\components\widgets\MarketSupplyWidget.js
==================================================
"use client";

import { useState, useMemo, useEffect } from "react";
import { motion } from "framer-motion";
import { X, EyeOff, Package, User, Users, ChevronDown, Clock } from "lucide-react";
import {
    BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer
} from "recharts";
import useWidgetStore from "../../store/useWidgetStore";
import {
    calculateItemYields,
    generatePlayerDistribution,
    calculateAllMetins,
    getBestMetin,
    formatCompactCurrency,
    formatCurrency
} from "../../lib/calculator";
import { initialMetinList } from "../../data/initialData";
import { mergeMarketData } from "../../lib/marketUtils";

// ============================================================================
// HELPER: FIND SIBLING WIDGETS (CONTEXT-AWARE)
// ============================================================================
function useSiblingWidgetData() {
    // 1. Global Store Verileri
    const activeWorkspaceId = useWidgetStore((state) => state.activeWorkspaceId);
    const workspaces = useWidgetStore((state) => state.workspaces);
    const activeServerId = useWidgetStore((state) => state.activeServerId);
    const serverProfiles = useWidgetStore((state) => state.serverProfiles);
    const itemRegistry = useWidgetStore((state) => state.masterRegistry); // createMarketSlice'dan gelir
    const craftingItems = useWidgetStore((state) => state.craftingItems) || [];

    // 2. Aktif Sunucu Fiyatlarƒ±nƒ± Bul (Sibling Widget yerine Store'dan)
    const activeProfile = serverProfiles.find(p => p.id === activeServerId);
    const localPrices = activeProfile?.prices || {};

    // 3. Diƒüer Store Verileri
    const activeWorkspace = workspaces.find((ws) => ws.id === activeWorkspaceId);
    const widgets = activeWorkspace?.widgets || [];

    const characterWidget = widgets.find((w) => w.type === "character-stats");
    const metinWidget = widgets.find((w) => w.type === "metin-settings");

    const userStats = characterWidget?.data || { damage: 3000, hitsPerSecond: 2.5, findTime: 10 };
    const metinList = metinWidget?.data?.metins || initialMetinList;

    // 4. Market Birle≈ütirme
    const marketItems = useMemo(() => {
        return mergeMarketData(itemRegistry, localPrices);
    }, [itemRegistry, localPrices]);

    return { userStats, metinList, marketItems, craftingItems };
}

// ============================================================================
// TAB 1: PERSONAL ACCUMULATION
// ============================================================================
function PersonalAccumulationTab({ userStats, metinList, marketItems }) {
    const [selectedMetinId, setSelectedMetinId] = useState(metinList[0]?.id || "");
    const [duration, setDuration] = useState(1);

    // Auto-select first metin if none selected
    useEffect(() => {
        if (!selectedMetinId && metinList?.length > 0) {
            setSelectedMetinId(metinList[0].id);
        }
    }, [metinList, selectedMetinId]);

    const selectedMetin = useMemo(() =>
        metinList.find(m => m.id === selectedMetinId),
        [metinList, selectedMetinId]);

    const results = useMemo(() => {
        if (!selectedMetin || !userStats) return null;
        return calculateItemYields(selectedMetin, userStats, duration);
    }, [selectedMetin, userStats, duration]);

    const getItemName = (originalId) => {
        const item = marketItems.find(i => i.originalId === originalId);
        return item ? item.name : originalId;
    };

    return (
        <div className="space-y-6 h-full flex flex-col">
            {/* Input Section */}
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div className="bg-black/20 p-4 rounded-xl border border-white/5">
                    <label className="block text-xs text-white/60 mb-2 font-medium">Hangi Metin?</label>
                    <div className="relative">
                        <select
                            value={selectedMetinId}
                            onChange={(e) => setSelectedMetinId(e.target.value)}
                            className="w-full appearance-none bg-black/60 border border-white/10 text-white px-4 py-2.5 rounded-lg focus:outline-none focus:ring-2 focus:ring-violet-500/20 focus:border-violet-500/50 font-medium transition-all"
                        >
                            {metinList.map(m => (
                                <option key={m.id} value={m.id} className="bg-zinc-900">{m.name}</option>
                            ))}
                        </select>
                        <ChevronDown className="absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-white/50 pointer-events-none" />
                    </div>
                </div>

                <div className="bg-black/20 p-4 rounded-xl border border-white/5">
                    <label className="block text-xs text-white/60 mb-2 font-medium">S√ºre (Saat)</label>
                    <div className="relative">
                        <input
                            type="number"
                            value={duration}
                            onChange={(e) => setDuration(Math.max(1, Number(e.target.value)))}
                            className="w-full bg-black/60 border border-white/10 text-white px-4 py-2.5 rounded-lg focus:outline-none focus:ring-2 focus:ring-violet-500/20 focus:border-violet-500/50 font-mono font-medium transition-all"
                            min="1"
                        />
                        <Clock className="absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-white/50 pointer-events-none" />
                    </div>
                </div>
            </div>

            {/* Results Section */}
            {results ? (
                <div className="flex-1 bg-black/20 backdrop-blur-sm rounded-2xl border border-white/5 overflow-hidden flex flex-col">
                    <div className="p-4 border-b border-white/5 bg-black/40 flex items-center justify-between">
                        <div className="flex items-center gap-3">
                            <div className="p-2 bg-violet-500/10 rounded-lg border border-violet-500/20">
                                <Package className="w-5 h-5 text-violet-400" />
                            </div>
                            <div>
                                <h4 className="font-bold text-white">Tahmini Getiri</h4>
                                <p className="text-xs text-white/50">
                                    {duration} saatte <span className="text-violet-400 font-bold font-mono">{Math.floor(results.metinsCount)}</span> adet {selectedMetin?.name}
                                </p>
                            </div>
                        </div>
                    </div>

                    <div className="flex-1 overflow-y-auto p-2">
                        <div className="space-y-1">
                            {results.yields.map((yieldData, idx) => (
                                <div key={idx} className="flex items-center justify-between p-3 hover:bg-white/5 rounded-lg transition-colors group">
                                    <div className="flex items-center gap-3">
                                        <div className="w-8 h-8 rounded-full bg-white/5 flex items-center justify-center text-xs font-bold text-white/70 border border-white/10">
                                            {getItemName(yieldData.itemId).charAt(0)}
                                        </div>
                                        <span className="text-white/90 font-medium">{getItemName(yieldData.itemId)}</span>
                                    </div>
                                    <div className="text-right">
                                        <div className="text-lg font-bold text-white font-mono">
                                            {formatCompactCurrency(yieldData.count)}
                                        </div>
                                        <div className="text-xs text-white/40 font-mono">
                                            %{yieldData.chance} ≈üans
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            ) : (
                <div className="flex-1 flex flex-col items-center justify-center text-white/40 border-2 border-dashed border-white/10 rounded-2xl bg-black/20 p-8">
                    <Package className="w-16 h-16 mb-4 opacity-50" />
                    <p className="text-lg font-medium text-white/60">Bir Metin Se√ßin</p>
                    <p className="text-sm">Sim√ºlasyon sonu√ßlarƒ±nƒ± g√∂rmek i√ßin yukarƒ±dan se√ßim yapƒ±n.</p>
                </div>
            )}
        </div>
    );
}

// ============================================================================
// TAB 2: MARKET ACCUMULATION
// ============================================================================
function MarketAccumulationTab({ userStats, metinList, marketItems, craftingItems }) {
    // Simulation Settings
    const [playerCount, setPlayerCount] = useState(1000);
    const [distributionType, setDistributionType] = useState("normal");
    const [timeStrategy, setTimeStrategy] = useState("constant");
    const [minDamage, setMinDamage] = useState(1000);
    const [maxDamage, setMaxDamage] = useState(30000);
    const [simulationHours, setSimulationHours] = useState(24);

    // Hybrid slider helper functions
    const sliderToPlayerCount = (val) => {
        if (val <= 100) return val;
        return 100 + (val - 100) * 100;
    };

    const playerCountToSlider = (count) => {
        if (count <= 100) return count;
        return 100 + Math.floor((count - 100) / 100);
    };

    // Run Simulation
    const simulationResults = useMemo(() => {
        const segments = generatePlayerDistribution(minDamage, maxDamage, playerCount, distributionType, timeStrategy);
        const totalSupply = {};
        const metinCounts = {};

        segments.forEach(segment => {
            const tempStats = { ...userStats, damage: segment.avgDamage };
            const calculations = calculateAllMetins(metinList, marketItems, tempStats, craftingItems);
            const bestMetinCalc = getBestMetin(calculations);

            if (bestMetinCalc) {
                const bestMetin = metinList.find(m => m.id === bestMetinCalc.metinId);
                if (bestMetin) {
                    const effectiveHours = segment.totalHours * (simulationHours / 24);
                    const yields = calculateItemYields(bestMetin, tempStats, effectiveHours);

                    metinCounts[bestMetin.name] = (metinCounts[bestMetin.name] || 0) + yields.metinsCount;

                    yields.yields.forEach(y => {
                        totalSupply[y.itemId] = (totalSupply[y.itemId] || 0) + y.count;
                    });
                }
            }
        });

        const supplyList = Object.entries(totalSupply)
            .map(([itemId, count]) => {
                const item = marketItems.find(i => i.originalId === itemId);
                return {
                    itemId,
                    name: item ? item.name : itemId,
                    count,
                    value: count * (item?.price || 0)
                };
            })
            .sort((a, b) => b.value - a.value);

        return { segments, supplyList, metinCounts };
    }, [minDamage, maxDamage, playerCount, distributionType, timeStrategy, simulationHours, userStats, metinList, marketItems, craftingItems]);

    return (
        <div className="h-full flex flex-col space-y-4 overflow-hidden">
            {/* Settings Panel */}
            <div className="bg-black/20 p-4 rounded-xl border border-white/5 grid grid-cols-2 md:grid-cols-5 gap-4">
                <div>
                    <label className="block text-xs text-white/60 mb-1">Oyuncu Sayƒ±sƒ±</label>
                    <input
                        type="range" min="0" max="149" step="1"
                        value={playerCountToSlider(playerCount)}
                        onChange={(e) => setPlayerCount(sliderToPlayerCount(Number(e.target.value)))}
                        className="w-full accent-cyan-500"
                    />
                    <div className="text-right text-xs text-white font-mono">{playerCount}</div>
                </div>
                <div>
                    <label className="block text-xs text-white/60 mb-1">Ortalama Oyuncu S√ºresi (Saat)</label>
                    <input
                        type="range" min="1" max="24" step="1"
                        value={simulationHours}
                        onChange={(e) => setSimulationHours(Number(e.target.value))}
                        className="w-full accent-cyan-500"
                    />
                    <div className="text-right text-xs text-white font-mono">{simulationHours}h</div>
                </div>
                <div>
                    <label className="block text-xs text-white/60 mb-1">Daƒüƒ±lƒ±m</label>
                    <select
                        value={distributionType}
                        onChange={(e) => setDistributionType(e.target.value)}
                        className="w-full bg-black/60 border border-white/10 text-white text-xs px-2 py-1 rounded focus:outline-none focus:ring-1 focus:ring-cyan-500/50"
                    >
                        <option value="normal">Normal (√áan Eƒürisi)</option>
                        <option value="uniform">E≈üit Daƒüƒ±lƒ±m</option>
                        <option value="left-skewed">D√º≈ü√ºk Hasar Yoƒüun</option>
                        <option value="right-skewed">Y√ºksek Hasar Yoƒüun</option>
                    </select>
                </div>
                <div className="relative group/tooltip">
                    <label className="block text-xs text-white/60 mb-1">Oynama S√ºresi Stratejisi</label>
                    <select
                        value={timeStrategy}
                        onChange={(e) => setTimeStrategy(e.target.value)}
                        className="w-full bg-black/60 border border-white/10 text-white text-xs px-2 py-1 rounded focus:outline-none focus:ring-1 focus:ring-cyan-500/50"
                    >
                        <option value="constant">Herkes E≈üit S√ºre</option>
                        <option value="linear">G√º√ßl√ºler Daha Fazla (Lineer)</option>
                        <option value="linear-inverse">Zayƒ±flar Daha Fazla (Lineer Ters)</option>
                        <option value="exponential">Elitler √áok Daha Fazla (√ústel)</option>
                        <option value="exponential-inverse">Yeniler √áok Daha Fazla (√ústel Ters)</option>
                    </select>
                    <div className="mt-1 text-[10px] text-cyan-400/80 leading-tight">
                        {timeStrategy === "constant" && "Herkes ortalama s√ºre kadar oynar."}
                        {timeStrategy === "linear" && "D√º≈ü√ºk hasarlƒ±lar ortalamanƒ±n yarƒ±sƒ±, y√ºksek hasarlƒ±lar 1.5 katƒ± kadar oynar."}
                        {timeStrategy === "linear-inverse" && "D√º≈ü√ºk hasarlƒ±lar ortalamanƒ±n 1.5 katƒ±, y√ºksek hasarlƒ±lar yarƒ±sƒ± kadar oynar."}
                        {timeStrategy === "exponential" && "Hasar arttƒ±k√ßa oynama s√ºresi karesel olarak artar (Elit odaklƒ±)."}
                        {timeStrategy === "exponential-inverse" && "Hasar azaldƒ±k√ßa oynama s√ºresi karesel olarak artar (Ba≈ülangƒ±√ß odaklƒ±)."}
                    </div>
                </div>
                <div>
                    <label className="block text-xs text-white/60 mb-1">Hasar Aralƒ±ƒüƒ±</label>
                    <div className="flex gap-2">
                        <input
                            type="number" value={minDamage}
                            onChange={(e) => setMinDamage(Number(e.target.value))}
                            className="w-full bg-black/60 border border-white/10 text-white text-xs px-1 py-1 rounded text-center font-mono focus:outline-none focus:ring-1 focus:ring-cyan-500/50"
                        />
                        <span className="text-white/40">-</span>
                        <input
                            type="number" value={maxDamage}
                            onChange={(e) => setMaxDamage(Number(e.target.value))}
                            className="w-full bg-black/60 border border-white/10 text-white text-xs px-1 py-1 rounded text-center font-mono focus:outline-none focus:ring-1 focus:ring-cyan-500/50"
                        />
                    </div>
                </div>
            </div>

            {/* Charts & Tables Split */}
            <div className="flex-1 grid grid-cols-1 lg:grid-cols-2 gap-4 overflow-hidden">
                {/* Left: Player Distribution Chart */}
                <div className="bg-black/20 rounded-xl border border-white/5 p-4 flex flex-col">
                    <h4 className="text-sm font-bold text-white mb-4 flex items-center gap-2">
                        <Users className="w-4 h-4 text-blue-400" />
                        Oyuncu Daƒüƒ±lƒ±mƒ±
                    </h4>
                    <div className="flex-1 min-h-[150px]">
                        <ResponsiveContainer width="100%" height="100%">
                            <BarChart data={simulationResults.segments}>
                                <CartesianGrid strokeDasharray="3 3" stroke="#ffffff05" vertical={false} />
                                <XAxis dataKey="avgDamage" hide />
                                <Tooltip
                                    contentStyle={{ backgroundColor: '#000000', border: '1px solid #333', borderRadius: '8px' }}
                                    formatter={(value, name) => [value, name === 'playerCount' ? 'Oyuncu' : name]}
                                    labelFormatter={(label) => `Ort. Hasar: ${formatCompactCurrency(label)}`}
                                />
                                <Bar dataKey="playerCount" fill="#06b6d4" radius={[4, 4, 0, 0]} />
                            </BarChart>
                        </ResponsiveContainer>
                    </div>
                </div>

                {/* Right: Supply Table */}
                <div className="bg-black/20 rounded-xl border border-white/5 p-4 flex flex-col overflow-hidden">
                    <h4 className="text-sm font-bold text-white mb-4 flex items-center gap-2">
                        <Package className="w-4 h-4 text-cyan-400" />
                        Sunucuya Giren Malzeme ({simulationHours} Saat)
                    </h4>
                    <div className="flex-1 overflow-y-auto pr-2">
                        <table className="w-full">
                            <thead className="sticky top-0 bg-black/80 z-10 backdrop-blur-sm">
                                <tr>
                                    <th className="text-left text-xs text-white/50 pb-2">E≈üya</th>
                                    <th className="text-right text-xs text-white/50 pb-2">Adet</th>
                                    <th className="text-right text-xs text-white/50 pb-2">Deƒüer</th>
                                </tr>
                            </thead>
                            <tbody className="divide-y divide-white/5">
                                {simulationResults.supplyList.map((item, idx) => (
                                    <tr key={idx} className="hover:bg-cyan-500/10 transition-colors">
                                        <td className="py-2 text-sm text-white font-medium">{item.name}</td>
                                        <td className="py-2 text-sm text-white/70 text-right font-mono">{formatCompactCurrency(item.count)}</td>
                                        <td className="py-2 text-sm text-cyan-400 text-right font-mono">{formatCompactCurrency(item.value)}</td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    );
}

// ============================================================================
// MAIN WIDGET
// ============================================================================
export default function MarketSupplyWidget({ id, data, isSelected, onClick, onHide }) {
    const { userStats, metinList, marketItems, craftingItems } = useSiblingWidgetData();
    const [activeTab, setActiveTab] = useState("personal");

    return (
        <motion.div
            layoutId={`card-${id}`}
            layout
            onClick={!isSelected ? onClick : undefined}
            className={`group rounded-3xl shadow-2xl cursor-pointer overflow-hidden backdrop-blur-xl border border-white/10 ${isSelected
                ? "fixed inset-0 m-auto w-[90%] h-[90%] max-w-6xl z-[100] bg-black/80"
                : "relative h-64 hover:-translate-y-1 hover:border-violet-400/50 transition-all duration-300 bg-black/20 hover:bg-black/40"
                }`}
            transition={{ type: "spring", stiffness: 300, damping: 30 }}
        >
            {/* Hide Button */}
            <motion.button
                whileHover={{ scale: 1.1 }}
                whileTap={{ scale: 0.9 }}
                onClick={(e) => {
                    e.stopPropagation();
                    onHide && onHide();
                }}
                className="absolute top-4 right-4 z-20 p-2 bg-white/10 backdrop-blur-sm shadow-lg rounded-full opacity-0 group-hover:opacity-100 transition-opacity text-white/60 hover:text-violet-400 hover:bg-violet-500/20 border border-white/20"
            >
                <EyeOff className="w-4 h-4" />
            </motion.button>

            {/* Summary View */}
            {!isSelected && (
                <div className="w-full h-full p-6 relative flex flex-col items-center justify-center">
                    <Package className="absolute -bottom-4 -right-4 w-32 h-32 text-white/5 opacity-50 rotate-12 pointer-events-none" />
                    <div className="flex items-center gap-3 mb-3">
                        <div className="p-2 bg-white/10 backdrop-blur-sm rounded-lg border border-white/10">
                            <Package className="w-8 h-8 text-violet-400" />
                        </div>
                    </div>
                    <span className="text-2xl font-bold text-white whitespace-nowrap">
                        Arz Sim√ºlasyonu
                    </span>
                    <span className="text-sm text-white/60 mt-2 text-center">
                        Ki≈üisel ve Piyasa Birikimi
                    </span>
                </div>
            )}

            {/* Detail View */}
            {isSelected && (
                <div className="flex flex-col h-full bg-black/20">
                    {/* Header */}
                    <div className="flex items-center justify-between p-8 border-b border-white/10 bg-black/40 backdrop-blur-xl">
                        <div className="flex items-center gap-4">
                            <div className="p-3 bg-violet-500/10 backdrop-blur-sm rounded-2xl border border-violet-500/20">
                                <Package className="w-8 h-8 text-violet-400" />
                            </div>
                            <div>
                                <motion.h2 layoutId={`title-${id}`} className="text-2xl font-bold text-white">
                                    Arz Sim√ºlasyonu
                                </motion.h2>
                                <p className="text-white/60">E≈üya birikimi ve piyasa arz analizi</p>
                            </div>
                        </div>
                        <button
                            onClick={(e) => {
                                e.stopPropagation();
                                onClick();
                            }}
                            className="p-2 hover:bg-white/10 rounded-full transition-colors backdrop-blur-sm border border-white/10 hover:border-white/20"
                        >
                            <X className="w-6 h-6 text-white/80" />
                        </button>
                    </div>

                    {/* Tabs */}
                    <div className="flex border-b border-white/10 px-8 bg-black/40">
                        <button
                            onClick={() => setActiveTab("personal")}
                            className={`px-6 py-4 text-sm font-medium transition-colors relative ${activeTab === "personal" ? "text-white" : "text-white/50 hover:text-white/80"
                                }`}
                        >
                            <div className="flex items-center gap-2">
                                <User className="w-4 h-4" />
                                Ki≈üisel Birikim
                            </div>
                            {activeTab === "personal" && (
                                <motion.div layoutId="activeTab" className="absolute bottom-0 left-0 right-0 h-0.5 bg-violet-500" />
                            )}
                        </button>
                        <button
                            onClick={() => setActiveTab("market")}
                            className={`px-6 py-4 text-sm font-medium transition-colors relative ${activeTab === "market" ? "text-white" : "text-white/50 hover:text-white/80"
                                }`}
                        >
                            <div className="flex items-center gap-2">
                                <Users className="w-4 h-4" />
                                Piyasa Arzƒ±
                            </div>
                            {activeTab === "market" && (
                                <motion.div layoutId="activeTab" className="absolute bottom-0 left-0 right-0 h-0.5 bg-violet-500" />
                            )}
                        </button>
                    </div>

                    {/* Content */}
                    <div className="flex-1 p-8 overflow-hidden bg-black/20">
                        {activeTab === "personal" ? (
                            <PersonalAccumulationTab
                                userStats={userStats}
                                metinList={metinList}
                                marketItems={marketItems}
                            />
                        ) : (
                            <MarketAccumulationTab
                                userStats={userStats}
                                metinList={metinList}
                                marketItems={marketItems}
                                craftingItems={craftingItems}
                            />
                        )}
                    </div>
                </div>
            )}
        </motion.div>
    );
}


==================================================
DOSYA YOLU: .\app\components\widgets\MarketWidget.js
==================================================
"use client";

import { useState, useMemo } from "react";
import { motion, AnimatePresence } from "framer-motion";
import { X, EyeOff, Coins, Plus, Trash2, Search, Filter, Download, Upload, FileSpreadsheet, FileJson, CheckCircle, Save, FolderOpen } from "lucide-react";
import * as LucideIcons from "lucide-react";
import useWidgetStore from "../../store/useWidgetStore";
import { exportToFile, parseImportFile } from "../../lib/excelUtils";
import { syncLocalMarketItems } from "../../lib/marketUtils";

// ============================================================================
// HELPER FUNCTIONS
// ============================================================================

const formatCurrency = (amount) => {
    return new Intl.NumberFormat('tr-TR', {
        minimumFractionDigits: 0,
        maximumFractionDigits: 0,
    }).format(amount);
};

const formatCompactNumber = (number) => {
    if (!number) return "0";
    return new Intl.NumberFormat('tr-TR', {
        notation: "compact",
        maximumFractionDigits: 1
    }).format(number);
};

// ============================================================================
// SUMMARY VIEW COMPONENT
// ============================================================================
function MarketSummaryView() {
    // Store Data
    const masterRegistry = useWidgetStore((state) => state.masterRegistry);
    const activeServerId = useWidgetStore((state) => state.activeServerId);
    const serverProfiles = useWidgetStore((state) => state.serverProfiles);

    // Get Active Server Prices
    const activeProfile = useMemo(() =>
        serverProfiles.find(p => p.id === activeServerId),
        [serverProfiles, activeServerId]
    );
    const prices = activeProfile?.prices || {};

    const stats = useMemo(() => {
        const totalItems = masterRegistry.length;
        const itemsWithPrice = masterRegistry.filter(item => (prices[item.id] || 0) > 0).length;
        const totalValue = masterRegistry.reduce((sum, item) => sum + (prices[item.id] || 0), 0);
        return { totalItems, itemsWithPrice, totalValue };
    }, [masterRegistry, prices]);

    return (
        <div className="flex flex-col items-center justify-center h-full w-full overflow-hidden">
            <div className="flex items-center gap-3 mb-2">
                <div className="p-2 bg-violet-500/20 backdrop-blur-sm rounded-lg border border-white/5">
                    <Coins className="w-8 h-8 text-violet-400" />
                </div>
            </div>
            <span className="text-3xl font-bold text-white whitespace-nowrap drop-shadow-[0_0_10px_rgba(255,255,255,0.3)]">
                {stats.itemsWithPrice} Fiyatlƒ±
            </span>
            <span className="text-sm text-violet-300 mt-1 font-mono drop-shadow-[0_0_8px_rgba(167,139,250,0.5)]">
                Toplam: {formatCompactNumber(stats.totalValue)} {activeProfile?.currency || "Won"}
            </span>
            <span className="text-xs text-white/40 mt-2 bg-white/5 px-2 py-1 rounded">
                Sunucu: {activeProfile?.name || "Bilinmiyor"}
            </span>
        </div>
    );
}

// ============================================================================
// DETAIL VIEW COMPONENT
// ============================================================================
function MarketDetailView({ id }) {
    // Global Store Data
    const masterRegistry = useWidgetStore((state) => state.masterRegistry);
    const activeServerId = useWidgetStore((state) => state.activeServerId);
    const serverProfiles = useWidgetStore((state) => state.serverProfiles);

    // Actions
    const updatePrice = useWidgetStore((state) => state.updatePrice);
    const registerItem = useWidgetStore((state) => state.registerItem);
    const setActiveServer = useWidgetStore((state) => state.setActiveServer);
    const addServerProfile = useWidgetStore((state) => state.addServerProfile);

    // Derived State
    const activeProfile = useMemo(() =>
        serverProfiles.find(p => p.id === activeServerId),
        [serverProfiles, activeServerId]
    );
    const prices = activeProfile?.prices || {};

    // Local State
    const [selectedCategory, setSelectedCategory] = useState("T√ºm√º");
    const [searchQuery, setSearchQuery] = useState("");
    const [showAddForm, setShowAddForm] = useState(false);
    const [showDataModal, setShowDataModal] = useState(false);
    const [showProfileModal, setShowProfileModal] = useState(false);
    const [dataModalTab, setDataModalTab] = useState("export");
    const [successMessage, setSuccessMessage] = useState("");
    const [isDragging, setIsDragging] = useState(false);
    const [profileName, setProfileName] = useState("");
    const [newItem, setNewItem] = useState({
        name: "",
        category: "genel",
        icon: "Circle"
    });

    // Merge registry with local prices to create display items
    const displayItems = useMemo(() => {
        return masterRegistry.map(item => ({
            ...item,
            price: prices[item.id] || 0
        }));
    }, [masterRegistry, prices]);

    // Get unique categories
    const categories = useMemo(() => {
        const cats = ["T√ºm√º", ...new Set(masterRegistry.map(item => item.category))];
        return cats;
    }, [masterRegistry]);

    // Filter items
    const filteredItems = useMemo(() => {
        return displayItems.filter(item => {
            const matchesCategory = selectedCategory === "T√ºm√º" || item.category === selectedCategory;
            const matchesSearch = item.name.toLowerCase().includes(searchQuery.toLowerCase());
            return matchesCategory && matchesSearch;
        });
    }, [displayItems, selectedCategory, searchQuery]);

    // Calculate total value
    const totalValue = useMemo(() => {
        return filteredItems.reduce((sum, item) => sum + item.price, 0);
    }, [filteredItems]);

    // ========================================================================
    // HANDLERS
    // ========================================================================

    // Handle price update
    const handlePriceChange = (itemId, newPrice) => {
        const price = parseFloat(newPrice);
        if (!isNaN(price) && price >= 0) {
            updatePrice(itemId, price);
        }
    };

    // Handle add new item to registry
    const handleAddItem = (e) => {
        e.preventDefault();
        if (newItem.name) {
            registerItem({
                name: newItem.name,
                category: newItem.category,
                icon: newItem.icon
            });

            setNewItem({ name: "", category: "genel", icon: "Circle" });
            setShowAddForm(false);
            setSuccessMessage("‚úÖ Yeni e≈üya kataloƒüa eklendi!");
            setTimeout(() => setSuccessMessage(""), 3000);
        }
    };

    // Handle load profile (Switch Server)
    const handleSwitchServer = (serverId) => {
        setActiveServer(serverId);
        const server = serverProfiles.find(p => p.id === serverId);
        setSuccessMessage(`‚úÖ Sunucu deƒüi≈ütirildi: ${server?.name}`);
        setTimeout(() => setSuccessMessage(""), 3000);
    };

    // Handle save profile (Add New Server)
    const handleAddServer = () => {
        if (profileName.trim()) {
            addServerProfile(profileName);
            setProfileName("");
            setShowProfileModal(false);
            setSuccessMessage(`‚úÖ Yeni sunucu eklendi: ${profileName}`);
            setTimeout(() => setSuccessMessage(""), 3000);
        }
    };

    // Handle export
    const handleExport = async (format) => {
        const result = await exportToFile(displayItems, `piyasa-${activeProfile?.name}-${Date.now()}`, format);
        if (result.success) {
            setSuccessMessage(`‚úÖ ${format.toUpperCase()} dosyasƒ± indirildi!`);
            setTimeout(() => setSuccessMessage(""), 3000);
        }
    };

    // Handle import
    const handleImport = async (file) => {
        try {
            // 1. Parse file
            const result = await parseImportFile(file);
            if (!result.success) {
                alert(result.message);
                return;
            }

            const importedData = result.data;

            // 2. Sync with registry (Add new items if any)
            const { newRegistryItems, idMap } = syncLocalMarketItems(importedData, masterRegistry);

            // 3. Register new items
            if (newRegistryItems.length > 0) {
                newRegistryItems.forEach(item => registerItem(item));
            }

            // 4. Update prices
            let updatedCount = 0;
            importedData.forEach(item => {
                const itemId = idMap[item.name] || item.id; // Try to find ID
                if (itemId) {
                    const price = parseFloat(item.price) || 0;
                    updatePrice(itemId, price);
                    updatedCount++;
                }
            });

            // Success message
            setSuccessMessage(
                `‚úÖ ${updatedCount} fiyat g√ºncellendi${newRegistryItems.length > 0 ? `, ${newRegistryItems.length} yeni e≈üya eklendi` : ''}.`
            );
            setTimeout(() => setSuccessMessage(""), 4000);
            setShowDataModal(false);
        } catch (error) {
            console.error("Import hatasƒ±:", error);
            alert("Dosya y√ºklenirken bir hata olu≈ütu. L√ºtfen dosya formatƒ±nƒ± kontrol edin.");
        }
    };

    // File handlers
    const handleFileChange = (e) => {
        const file = e.target.files?.[0];
        if (file) handleImport(file);
    };

    const handleDragOver = (e) => {
        e.preventDefault();
        setIsDragging(true);
    };

    const handleDragLeave = () => {
        setIsDragging(false);
    };

    const handleDrop = (e) => {
        e.preventDefault();
        setIsDragging(false);
        const file = e.dataTransfer.files?.[0];
        if (file) handleImport(file);
    };

    const iconOptions = [
        "Circle", "Star", "Diamond", "Gem", "Crown", "Shield", "Sword",
        "Zap", "Heart", "Sparkles", "Award", "Package", "Gift"
    ];

    return (
        <div className="space-y-6 h-full flex flex-col">
            {/* Success Message */}
            <AnimatePresence>
                {successMessage && (
                    <motion.div
                        initial={{ opacity: 0, y: -20 }}
                        animate={{ opacity: 1, y: 0 }}
                        exit={{ opacity: 0, y: -20 }}
                        className="bg-green-600/90 backdrop-blur-sm text-white px-4 py-3 rounded-lg flex items-center gap-2 border border-green-500/30"
                    >
                        <CheckCircle className="w-5 h-5" />
                        <span className="font-medium">{successMessage}</span>
                    </motion.div>
                )}
            </AnimatePresence>

            {/* Header Stats & Profile Management */}
            <div className="bg-white/5 backdrop-blur-xl p-4 rounded-xl border border-white/10">
                <div className="flex items-center justify-between mb-3">
                    <div>
                        <p className="text-sm text-white/70">Toplam Piyasa Deƒüeri ({activeProfile?.name})</p>
                        <p className="text-2xl font-bold text-cyan-400">
                            {formatCurrency(totalValue)} {activeProfile?.currency}
                        </p>
                    </div>
                    <div className="flex items-center gap-3">
                        <button
                            onClick={() => setShowDataModal(true)}
                            className="p-2 bg-violet-600/20 backdrop-blur-sm text-violet-400 rounded-lg hover:bg-violet-600/40 transition-colors border border-violet-500/30"
                            title="Veri ƒ∞≈ülemleri"
                        >
                            <Download className="w-5 h-5" />
                        </button>
                        <div className="text-right">
                            <p className="text-sm text-white/70">G√∂sterilen</p>
                            <p className="text-2xl font-bold text-white">
                                {filteredItems.length} / {displayItems.length}
                            </p>
                        </div>
                    </div>
                </div>

                {/* Server Selection */}
                <div className="flex items-center gap-2 pt-3 border-t border-white/10">
                    <FolderOpen className="w-4 h-4 text-white/60" />
                    <select
                        value={activeServerId}
                        onChange={(e) => handleSwitchServer(e.target.value)}
                        className="flex-1 px-3 py-2 text-sm font-medium text-white bg-black/50 border border-white/10 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500/20 focus:border-cyan-500/50"
                    >
                        {serverProfiles.map(profile => (
                            <option key={profile.id} value={profile.id} className="bg-zinc-900">
                                {profile.name}
                            </option>
                        ))}
                    </select>
                    <button
                        onClick={() => setShowProfileModal(true)}
                        className="px-4 py-2 bg-cyan-600/20 backdrop-blur-sm text-cyan-400 rounded-lg hover:bg-cyan-600/40 transition-colors text-sm font-medium border border-cyan-500/30 flex items-center gap-2"
                    >
                        <Plus className="w-4 h-4" />
                        Yeni Sunucu
                    </button>
                </div>
            </div>

            {/* Search and Filter */}
            <div className="space-y-3">
                <div className="relative">
                    <Search className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-white/50" />
                    <input
                        type="text"
                        value={searchQuery}
                        onChange={(e) => setSearchQuery(e.target.value)}
                        placeholder="E≈üya ara..."
                        className="w-full pl-10 pr-4 py-2 font-medium text-white bg-black/50 border border-white/10 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500/20 focus:border-cyan-500/50 placeholder:text-white/20 backdrop-blur-sm transition-all"
                    />
                </div>

                <div className="flex items-center gap-2 flex-wrap">
                    <Filter className="w-4 h-4 text-white/60" />
                    {categories.map((cat) => (
                        <button
                            key={cat}
                            onClick={() => setSelectedCategory(cat)}
                            className={`px-3 py-1 rounded-lg text-sm font-medium transition-all backdrop-blur-sm ${selectedCategory === cat
                                ? "bg-cyan-600/20 text-cyan-400 border border-cyan-500/30 shadow-md"
                                : "bg-white/5 text-white/70 hover:bg-white/10 border border-white/10"
                                }`}
                        >
                            {cat.charAt(0).toUpperCase() + cat.slice(1)}
                        </button>
                    ))}
                </div>

                <button
                    onClick={() => setShowAddForm(!showAddForm)}
                    className="w-full flex items-center justify-center gap-2 px-4 py-2 bg-cyan-600/20 backdrop-blur-sm text-cyan-400 rounded-lg hover:bg-cyan-600/40 transition-colors font-medium border border-cyan-500/30"
                >
                    <Plus className="w-5 h-5" />
                    Yeni E≈üya Ekle
                </button>
            </div>

            {/* Add Form */}
            <AnimatePresence>
                {showAddForm && (
                    <motion.form
                        initial={{ opacity: 0, height: 0 }}
                        animate={{ opacity: 1, height: "auto" }}
                        exit={{ opacity: 0, height: 0 }}
                        onSubmit={handleAddItem}
                        className="bg-white/5 backdrop-blur-xl p-4 rounded-xl border border-white/10 space-y-3"
                    >
                        <h3 className="font-semibold text-white mb-2">Yeni E≈üya Bilgileri</h3>
                        <div className="grid grid-cols-2 gap-3">
                            <input
                                type="text"
                                value={newItem.name}
                                onChange={(e) => setNewItem({ ...newItem, name: e.target.value })}
                                className="px-3 py-2 font-medium text-white bg-black/50 border border-white/10 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500/20 focus:border-cyan-500/50 placeholder:text-white/20"
                                placeholder="E≈üya adƒ±"
                                required
                            />
                            <input
                                type="text"
                                value={newItem.category}
                                onChange={(e) => setNewItem({ ...newItem, category: e.target.value })}
                                className="px-3 py-2 font-medium text-white bg-black/50 border border-white/10 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500/20 focus:border-cyan-500/50 placeholder:text-white/20"
                                placeholder="Kategori"
                            />
                            <select
                                value={newItem.icon}
                                onChange={(e) => setNewItem({ ...newItem, icon: e.target.value })}
                                className="col-span-2 px-3 py-2 font-medium text-white bg-black/50 border border-white/10 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500/20 focus:border-cyan-500/50"
                            >
                                {iconOptions.map((icon) => (
                                    <option key={icon} value={icon} className="bg-zinc-900">{icon}</option>
                                ))}
                            </select>
                        </div>
                        <div className="flex gap-2">
                            <button
                                type="submit"
                                className="flex-1 px-4 py-2 bg-cyan-600/20 text-cyan-400 rounded-lg hover:bg-cyan-600/40 transition-colors text-sm font-medium border border-cyan-500/30"
                            >
                                Ekle
                            </button>
                            <button
                                type="button"
                                onClick={() => setShowAddForm(false)}
                                className="px-4 py-2 bg-white/5 text-white/80 rounded-lg hover:bg-white/10 transition-colors text-sm font-medium border border-white/10"
                            >
                                ƒ∞ptal
                            </button>
                        </div>
                    </motion.form>
                )}
            </AnimatePresence>

            {/* Server Add Modal */}
            {showProfileModal && (
                <div className="fixed inset-0 z-[110] flex items-center justify-center p-4">
                    <div
                        className="absolute inset-0 bg-black/60 backdrop-blur-sm"
                        onClick={() => setShowProfileModal(false)}
                    />
                    <motion.div
                        initial={{ opacity: 0, scale: 0.9 }}
                        animate={{ opacity: 1, scale: 1 }}
                        className="relative bg-black/80 backdrop-blur-xl border border-white/10 rounded-2xl p-6 max-w-md w-full shadow-2xl"
                    >
                        <div className="flex items-center justify-between mb-4">
                            <h3 className="text-xl font-bold text-white">Yeni Sunucu Ekle</h3>
                            <button
                                onClick={() => setShowProfileModal(false)}
                                className="p-1 hover:bg-white/10 rounded-lg transition-colors"
                            >
                                <X className="w-5 h-5 text-white/70" />
                            </button>
                        </div>
                        <p className="text-sm text-white/70 mb-4">
                            Yeni bir sunucu profili olu≈üturun.
                        </p>
                        <input
                            type="text"
                            value={profileName}
                            onChange={(e) => setProfileName(e.target.value)}
                            placeholder="Sunucu adƒ±..."
                            className="w-full px-3 py-2 font-medium text-white bg-black/50 border border-white/10 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500/20 focus:border-cyan-500/50 placeholder:text-white/20 mb-4"
                        />
                        <div className="flex gap-2">
                            <button
                                onClick={handleAddServer}
                                disabled={!profileName.trim()}
                                className="flex-1 px-4 py-2 bg-cyan-600/20 text-cyan-400 rounded-lg hover:bg-cyan-600/40 transition-colors font-medium border border-cyan-500/30 disabled:opacity-50 disabled:cursor-not-allowed"
                            >
                                Ekle
                            </button>
                            <button
                                onClick={() => setShowProfileModal(false)}
                                className="px-4 py-2 bg-white/5 text-white/80 rounded-lg hover:bg-white/10 transition-colors font-medium border border-white/10"
                            >
                                ƒ∞ptal
                            </button>
                        </div>
                    </motion.div>
                </div>
            )}

            {/* Data Import/Export Modal */}
            {showDataModal && (
                <div className="fixed inset-0 z-[110] flex items-center justify-center p-4">
                    <div
                        className="absolute inset-0 bg-black/60 backdrop-blur-sm"
                        onClick={() => setShowDataModal(false)}
                    />
                    <motion.div
                        initial={{ opacity: 0, scale: 0.9 }}
                        animate={{ opacity: 1, scale: 1 }}
                        className="relative bg-black/80 backdrop-blur-xl border border-white/10 rounded-2xl p-6 max-w-md w-full shadow-2xl"
                    >
                        <div className="flex items-center justify-between mb-4">
                            <h3 className="text-xl font-bold text-white">Veri ƒ∞≈ülemleri</h3>
                            <button
                                onClick={() => setShowDataModal(false)}
                                className="p-1 hover:bg-white/10 rounded-lg transition-colors"
                            >
                                <X className="w-5 h-5 text-white/70" />
                            </button>
                        </div>

                        {/* Tabs */}
                        <div className="flex gap-2 mb-4">
                            <button
                                onClick={() => setDataModalTab("export")}
                                className={`flex-1 px-4 py-2 rounded-lg font-medium transition-all ${dataModalTab === "export"
                                    ? "bg-violet-600/20 text-violet-400 border border-violet-500/30"
                                    : "bg-white/5 text-white/70 hover:bg-white/10 border border-white/10"
                                    }`}
                            >
                                <Download className="w-4 h-4 inline mr-2" />
                                ƒ∞ndir
                            </button>
                            <button
                                onClick={() => setDataModalTab("import")}
                                className={`flex-1 px-4 py-2 rounded-lg font-medium transition-all ${dataModalTab === "import"
                                    ? "bg-violet-600/20 text-violet-400 border border-violet-500/30"
                                    : "bg-white/5 text-white/70 hover:bg-white/10 border border-white/10"
                                    }`}
                            >
                                <Upload className="w-4 h-4 inline mr-2" />
                                Y√ºkle
                            </button>
                        </div>

                        {/* Export Tab */}
                        {dataModalTab === "export" && (
                            <div className="space-y-3">
                                <p className="text-sm text-white/70 mb-3">
                                    Piyasa fiyatlarƒ±nƒ±zƒ± Excel veya JSON formatƒ±nda indirin.
                                </p>
                                <button
                                    onClick={() => handleExport("excel")}
                                    className="w-full flex items-center justify-center gap-3 px-4 py-3 bg-green-600/20 backdrop-blur-sm text-green-400 rounded-lg hover:bg-green-600/40 transition-colors font-medium border border-green-500/30"
                                >
                                    <FileSpreadsheet className="w-5 h-5" />
                                    Excel (.xlsx) ƒ∞ndir
                                </button>
                                <button
                                    onClick={() => handleExport("json")}
                                    className="w-full flex items-center justify-center gap-3 px-4 py-3 bg-purple-600/20 backdrop-blur-sm text-purple-400 rounded-lg hover:bg-purple-600/40 transition-colors font-medium border border-purple-500/30"
                                >
                                    <FileJson className="w-5 h-5" />
                                    JSON ƒ∞ndir
                                </button>
                            </div>
                        )}

                        {/* Import Tab */}
                        {dataModalTab === "import" && (
                            <div className="space-y-3">
                                <p className="text-sm text-white/70 mb-3">
                                    Excel (.xlsx) veya JSON dosyasƒ± y√ºkleyin.
                                </p>
                                <div
                                    onDragOver={handleDragOver}
                                    onDragLeave={handleDragLeave}
                                    onDrop={handleDrop}
                                    className={`border-2 border-dashed rounded-lg p-8 text-center transition-all ${isDragging
                                        ? "border-violet-500 bg-violet-500/10"
                                        : "border-white/10 bg-white/5 hover:bg-white/10"
                                        }`}
                                >
                                    <Upload className="w-12 h-12 text-white/50 mx-auto mb-3" />
                                    <p className="text-white/70 mb-2">Dosyayƒ± buraya s√ºr√ºkleyin</p>
                                    <p className="text-white/50 text-sm mb-4">veya</p>
                                    <label className="inline-block px-4 py-2 bg-violet-600/20 backdrop-blur-sm text-violet-400 rounded-lg hover:bg-violet-600/40 transition-colors cursor-pointer font-medium border border-violet-500/30">
                                        Dosya Se√ß
                                        <input
                                            type="file"
                                            accept=".xlsx,.xls,.json,.csv"
                                            onChange={handleFileChange}
                                            className="hidden"
                                        />
                                    </label>
                                    <p className="text-white/40 text-xs mt-3">
                                        Desteklenen formatlar: .xlsx, .xls, .json, .csv
                                    </p>
                                </div>
                            </div>
                        )}
                    </motion.div>
                </div>
            )}

            {/* Items Table */}
            <div className="flex-1 overflow-auto rounded-xl border border-white/10 backdrop-blur-sm">
                <table className="w-full">
                    <thead className="bg-black/80 sticky top-0 backdrop-blur-xl">
                        <tr>
                            <th className="px-4 py-3 text-left text-xs font-semibold text-cyan-400 uppercase">ƒ∞kon</th>
                            <th className="px-4 py-3 text-left text-xs font-semibold text-cyan-400 uppercase">E≈üya Adƒ±</th>
                            <th className="px-4 py-3 text-left text-xs font-semibold text-cyan-400 uppercase">Kategori</th>
                            <th className="px-4 py-3 text-left text-xs font-semibold text-cyan-400 uppercase">Fiyat ({activeProfile?.currency})</th>
                        </tr>
                    </thead>
                    <tbody className="bg-transparent divide-y divide-white/5">
                        {filteredItems.length === 0 ? (
                            <tr>
                                <td colSpan="4" className="px-4 py-8 text-center text-white/60">
                                    E≈üya bulunamadƒ±
                                </td>
                            </tr>
                        ) : (
                            filteredItems.map((item) => {
                                const ItemIcon = LucideIcons[item.icon] || LucideIcons.Circle;
                                return (
                                    <tr key={item.id} className="hover:bg-cyan-500/10 transition-colors group">
                                        <td className="px-4 py-3">
                                            <div className="p-2 bg-white/5 rounded-lg w-fit group-hover:bg-cyan-500/20 transition-colors border border-white/10">
                                                <ItemIcon className="w-5 h-5 text-white/70 group-hover:text-cyan-400" />
                                            </div>
                                        </td>
                                        <td className="px-4 py-3">
                                            <p className="text-sm font-medium text-white">{item.name}</p>
                                        </td>
                                        <td className="px-4 py-3">
                                            <span className="px-2 py-1 bg-white/5 text-white/80 rounded text-xs font-medium border border-white/10">
                                                {item.category}
                                            </span>
                                        </td>
                                        <td className="px-4 py-3">
                                            <input
                                                type="number"
                                                value={item.price}
                                                onChange={(e) => handlePriceChange(item.id, e.target.value)}
                                                className="w-32 px-2 py-1 text-sm font-semibold text-white bg-black/50 border border-white/10 rounded focus:outline-none focus:ring-2 focus:ring-cyan-500/20 focus:border-cyan-500/50 placeholder:text-white/20"
                                                min="0"
                                            />
                                        </td>
                                    </tr>
                                );
                            })
                        )}
                    </tbody>
                </table>
            </div>

            {/* Footer */}
            <div className="bg-white/5 backdrop-blur-sm p-3 rounded-lg border border-white/10 flex items-center justify-between text-sm">
                <span className="text-white/70">
                    Toplam <strong className="text-white">{filteredItems.length}</strong> e≈üya g√∂steriliyor
                </span>
                <span className="text-white/70">
                    Deƒüer: <strong className="text-cyan-400">{formatCurrency(totalValue)}</strong> {activeProfile?.currency}
                </span>
            </div>
        </div>
    );
}

// ============================================================================
// MAIN WIDGET
// ============================================================================
export default function MarketWidget({ id, type, data, isSelected, onClick, onHide }) {
    return (
        <motion.div
            layoutId={`card-${id}`}
            layout
            onClick={!isSelected ? onClick : undefined}
            className={`group rounded-3xl shadow-2xl cursor-pointer overflow-hidden backdrop-blur-xl border border-white/10 ${isSelected
                ? "fixed inset-0 m-auto w-[90%] h-[90%] max-w-6xl z-[100] bg-black/90 border border-white/10"
                : "relative h-64 hover:-translate-y-1 hover:border-cyan-500/50 hover:shadow-[0_0_30px_rgba(6,182,212,0.1)] transition-all duration-300 bg-black/40 hover:bg-black/50 border border-white/10"
                }`}
            transition={{ type: "spring", stiffness: 300, damping: 30 }}
        >
            {/* Hide Button */}
            <motion.button
                whileHover={{ scale: 1.1 }}
                whileTap={{ scale: 0.9 }}
                onClick={(e) => {
                    e.stopPropagation();
                    onHide && onHide();
                }}
                className="absolute top-4 right-4 z-20 p-2 bg-white/10 backdrop-blur-sm shadow-lg rounded-full opacity-0 group-hover:opacity-100 transition-opacity text-white/60 hover:text-red-400 hover:bg-red-500/20 border border-white/20"
            >
                <EyeOff className="w-4 h-4" />
            </motion.button>

            {/* Summary View */}
            {!isSelected && (
                <div className="w-full h-full p-6 relative">
                    <Coins className="absolute -bottom-4 -right-4 w-32 h-32 text-white/5 opacity-50 rotate-12 pointer-events-none" />
                    <MarketSummaryView />
                </div>
            )}

            {/* Detail View */}
            {isSelected && (
                <div className="flex flex-col h-full bg-black/20">
                    <div className="flex items-center justify-between p-8 border-b border-white/20 bg-white/5 backdrop-blur-xl">
                        <div className="flex items-center gap-4">
                            <div className="p-3 bg-white/10 backdrop-blur-sm rounded-2xl border border-white/20">
                                <Coins className="w-8 h-8 text-cyan-400" />
                            </div>
                            <div>
                                <motion.h2 layoutId={`title-${id}`} className="text-2xl font-bold text-white">
                                    Piyasa Fiyatlarƒ±
                                </motion.h2>
                                <p className="text-white/60">E≈üya fiyatlarƒ±nƒ± g√∂r√ºnt√ºle ve y√∂net</p>
                            </div>
                        </div>
                        <button
                            onClick={(e) => {
                                e.stopPropagation();
                                onClick();
                            }}
                            className="p-2 hover:bg-white/10 rounded-full transition-colors backdrop-blur-sm border border-white/10 hover:border-white/20"
                        >
                            <X className="w-6 h-6 text-white/80" />
                        </button>
                    </div>
                    <div className="flex-1 p-8 overflow-hidden">
                        <MarketDetailView id={id} />
                    </div>
                </div>
            )}
        </motion.div>
    );
}


==================================================
DOSYA YOLU: .\app\components\widgets\MetinSettingsWidget.js
==================================================
"use client";

import { useState } from "react";
import { motion } from "framer-motion";
import { X, EyeOff, Settings, CheckCircle } from "lucide-react";
import useWidgetStore from "../../store/useWidgetStore";
import { initialMetinList } from "../../data/initialData";
import { exportMetinsToExcel, parseMetinImport } from "../../lib/excelUtils";
import { syncLocalMarketItems } from "../../lib/marketUtils";

// Import modular components
import MetinSummary from "./metin-settings/MetinSummary";
import MetinHeader from "./metin-settings/MetinHeader";
import ImportExportModal from "./metin-settings/ImportExportModal";
import MetinList from "./metin-settings/MetinList";

// ============================================================================
// DETAIL VIEW CONTAINER
// ============================================================================
function MetinSettingsDetailView({ widgetId, metins, marketItems, craftingItems }) {
    const updateWidgetData = useWidgetStore((state) => state.updateWidgetData);
    const itemRegistry = useWidgetStore((state) => state.masterRegistry);
    const registerItems = useWidgetStore((state) => state.registerItems);

    const [showDataModal, setShowDataModal] = useState(false);
    const [successMessage, setSuccessMessage] = useState("");

    // Export handler
    const handleExport = async (format) => {
        if (format === 'excel') {
            const result = await exportMetinsToExcel(metins, marketItems, `metin-listesi-${Date.now()}`);
            if (result.success) {
                setSuccessMessage('Excel dosyasƒ± ba≈üarƒ±yla indirildi!');
                setTimeout(() => setSuccessMessage(""), 3000);
            }
        } else if (format === 'json') {
            // JSON export
            const jsonString = JSON.stringify(metins, null, 2);
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `metin-listesi-${Date.now()}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            setSuccessMessage('JSON dosyasƒ± ba≈üarƒ±yla indirildi!');
            setTimeout(() => setSuccessMessage(""), 3000);
        }
    };

    // Import handler
    const handleImport = async (file) => {
        try {
            // Step 1: Parse file
            const result = await parseMetinImport(file);

            if (!result.success) {
                alert(result.message);
                return;
            }

            const { metinList, detectedItems } = result;

            // Step 2: Sync imported items with registry using marketUtils
            const { newRegistryItems, profilePrices } = syncLocalMarketItems(detectedItems, itemRegistry);

            // Step 3: Create ID mapping (tempId -> realId)
            const idMap = {};
            detectedItems.forEach(item => {
                // Normalize name for matching
                const cleanName = item.originalName.trim().toLowerCase();

                // Find in existing registry
                const existing = itemRegistry.find(r => r.name.trim().toLowerCase() === cleanName);

                // Find in new items
                const newItem = newRegistryItems.find(n => n.name.trim().toLowerCase() === cleanName);

                if (existing) {
                    idMap[item.tempId] = existing.id;
                } else if (newItem) {
                    idMap[item.tempId] = newItem.id;
                }
            });

            // Step 4: Add new items to registry
            if (newRegistryItems.length > 0) {
                registerItems(newRegistryItems);
            }

            // Step 5: Replace temp IDs with real market IDs
            const updatedMetinList = metinList.map(metin => ({
                ...metin,
                drops: metin.drops.map(drop => ({
                    ...drop,
                    itemId: idMap[drop.itemId] || drop.itemId
                }))
            }));

            // Step 6: Save to widget data
            updateWidgetData(widgetId, { metins: updatedMetinList });

            // Step 7: Show success message
            setSuccessMessage(
                `‚úÖ ${metinList.length} metin y√ºklendi. ${newRegistryItems.length} yeni e≈üya kataloƒüa eklendi.`
            );
            setTimeout(() => setSuccessMessage(""), 5000);
            setShowDataModal(false);

        } catch (error) {
            console.error('Import error:', error);
            alert('ƒ∞√ße aktarma sƒ±rasƒ±nda hata olu≈ütu: ' + error.message);
        }
    };

    return (
        <div className="space-y-6 h-full flex flex-col">
            {/* Success Message */}
            {successMessage && (
                <motion.div
                    initial={{ opacity: 0, y: -20 }}
                    animate={{ opacity: 1, y: 0 }}
                    exit={{ opacity: 0, y: -20 }}
                    className="bg-green-600/90 backdrop-blur-sm text-white px-4 py-3 rounded-lg flex items-center gap-2 border border-green-500/30"
                >
                    <CheckCircle className="w-5 h-5" />
                    <span className="font-medium">{successMessage}</span>
                </motion.div>
            )}

            {/* Header with Import/Export Button */}
            <MetinHeader
                onImportExportClick={() => setShowDataModal(true)}
            />

            {/* Metins List */}
            <MetinList
                metins={metins}
                marketItems={marketItems}
                craftingItems={craftingItems}
                updateWidgetData={updateWidgetData}
                widgetId={widgetId}
            />

            {/* Import/Export Modal */}
            <ImportExportModal
                isOpen={showDataModal}
                onClose={() => setShowDataModal(false)}
                onImport={handleImport}
                onExport={handleExport}
            />
        </div>
    );
}

// ============================================================================
// MAIN WIDGET (Container)
// ============================================================================
export default function MetinSettingsWidget({ id, data, isSelected, onClick, onHide }) {
    // Get data from store
    const marketItems = useWidgetStore((state) => state.marketItems);
    const craftingItems = useWidgetStore((state) => state.craftingItems);

    // Use widget data or initialize with default metins
    const metins = data?.metins?.length > 0 ? data.metins : initialMetinList;

    return (
        <motion.div
            layoutId={`card-${id}`}
            layout
            onClick={!isSelected ? onClick : undefined}
            className={`group rounded-3xl shadow-2xl cursor-pointer overflow-hidden backdrop-blur-xl border border-white/10 ${isSelected
                ? "fixed inset-0 m-auto w-[90%] h-[90%] max-w-6xl z-[100] bg-black/80"
                : "relative h-64 hover:-translate-y-1 hover:border-cyan-400/50 transition-all duration-300 bg-black/20 hover:bg-black/40"
                }`}
            transition={{ type: "spring", stiffness: 300, damping: 30 }}
        >
            {/* Hide Button */}
            <motion.button
                whileHover={{ scale: 1.1 }}
                whileTap={{ scale: 0.9 }}
                onClick={(e) => {
                    e.stopPropagation();
                    onHide && onHide();
                }}
                className="absolute top-4 right-4 z-20 p-2 bg-white/10 backdrop-blur-sm shadow-lg rounded-full opacity-0 group-hover:opacity-100 transition-opacity text-white/60 hover:text-cyan-400 hover:bg-cyan-500/20 border border-white/20"
            >
                <EyeOff className="w-4 h-4" />
            </motion.button>

            {/* Summary View */}
            {!isSelected && (
                <div className="w-full h-full p-6 relative">
                    <Settings className="absolute -bottom-4 -right-4 w-32 h-32 text-white/5 opacity-50 rotate-12 pointer-events-none" />
                    <MetinSummary metins={metins} />
                </div>
            )}

            {/* Detail View */}
            {isSelected && (
                <div className="flex flex-col h-full bg-black/20">
                    {/* Header */}
                    <div className="flex items-center justify-between p-8 border-b border-white/10 bg-black/40 backdrop-blur-xl">
                        <div className="flex items-center gap-4">
                            <div className="p-3 bg-cyan-500/10 backdrop-blur-sm rounded-2xl border border-cyan-500/20">
                                <Settings className="w-8 h-8 text-cyan-400" />
                            </div>
                            <div>
                                <motion.h2 layoutId={`title-${id}`} className="text-2xl font-bold text-white">
                                    Metin Ayarlarƒ±
                                </motion.h2>
                                <p className="text-white/60">HP ve drop ayarlarƒ±nƒ± d√ºzenleyin</p>
                            </div>
                        </div>
                        <button
                            onClick={(e) => {
                                e.stopPropagation();
                                onClick();
                            }}
                            className="p-2 hover:bg-white/10 rounded-full transition-colors backdrop-blur-sm border border-white/10 hover:border-white/20"
                        >
                            <X className="w-6 h-6 text-white/80" />
                        </button>
                    </div>

                    {/* Content */}
                    <div className="flex-1 p-8 overflow-y-auto">
                        <MetinSettingsDetailView
                            widgetId={id}
                            metins={metins}
                            marketItems={marketItems}
                            craftingItems={craftingItems}
                        />
                    </div>
                </div>
            )}
        </motion.div>
    );
}


==================================================
DOSYA YOLU: .\app\components\widgets\analysis\AnalysisChart.js
==================================================
"use client";

import { BarChart3, ChevronDown } from "lucide-react";
import {
    BarChart, Bar, LineChart, Line,
    XAxis, YAxis, CartesianGrid, Tooltip, Legend,
    ResponsiveContainer, Cell, ReferenceLine
} from "recharts";
import { formatCurrency, formatCompactCurrency } from "../../../lib/calculator";

// Chart Colors
const CHART_COLORS = ['#06b6d4', '#8b5cf6', '#d946ef', '#f43f5e', '#eab308'];

export default function AnalysisChart({ chartType, setChartType, comparisonData, efficiencyData, userStats, topMetins }) {
    return (
        <div className="bg-black/40 backdrop-blur-xl p-6 rounded-2xl border border-white/5 hover:border-cyan-500/30 transition-colors shadow-sm min-h-[350px] flex flex-col">
            <div className="flex items-center justify-between mb-6">
                <h3 className="text-lg font-semibold text-white flex items-center gap-2">
                    <BarChart3 className="w-5 h-5 text-white/70" />
                    Analiz Grafiƒüi
                </h3>

                {/* Chart Type Selector */}
                <div className="relative">
                    <select
                        value={chartType}
                        onChange={(e) => setChartType(e.target.value)}
                        className="appearance-none bg-black/50 border border-white/10 text-white px-4 py-2 pr-10 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500/50 cursor-pointer font-medium"
                    >
                        <option value="comparison">Metin Kar≈üƒ±la≈ütƒ±rmasƒ±</option>
                        <option value="efficiency">Hasar Verimliliƒüi (Top 5)</option>
                    </select>
                    <ChevronDown className="absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-white/50 pointer-events-none" />
                </div>
            </div>

            <div className="flex-1 w-full h-full min-h-[250px]">
                <ResponsiveContainer width="100%" height="100%">
                    {chartType === "comparison" ? (
                        <BarChart data={comparisonData}>
                            <CartesianGrid strokeDasharray="3 3" stroke="#ffffff05" vertical={false} />
                            <XAxis
                                dataKey="name"
                                tick={{ fontSize: 12, fill: '#ffffff80' }}
                                axisLine={false}
                                tickLine={false}
                                interval={0}
                                height={50}
                                angle={-15}
                                textAnchor="end"
                            />
                            <YAxis
                                tick={{ fontSize: 12, fill: '#ffffff80' }}
                                tickFormatter={(value) => formatCompactCurrency(value)}
                                axisLine={false}
                                tickLine={false}
                            />
                            <Tooltip
                                cursor={{ fill: '#ffffff05' }}
                                formatter={(value) => [`${formatCurrency(value)} Yang`, 'Saatlik Kazan√ß']}
                                contentStyle={{
                                    backgroundColor: '#000000',
                                    border: '1px solid rgba(6, 182, 212, 0.3)',
                                    borderRadius: '8px',
                                    color: '#fff'
                                }}
                            />
                            <Bar dataKey="profit" radius={[4, 4, 0, 0]}>
                                {comparisonData.map((entry, index) => (
                                    <Cell
                                        key={`cell-${index}`}
                                        fill={entry.isBest ? "#06b6d4" : "#4b5563"}
                                    />
                                ))}
                            </Bar>
                        </BarChart>
                    ) : (
                        <LineChart data={efficiencyData}>
                            <CartesianGrid strokeDasharray="3 3" stroke="#ffffff05" />
                            <XAxis
                                dataKey="damage"
                                tick={{ fontSize: 12, fill: '#ffffff80' }}
                                tickFormatter={(value) => formatCompactCurrency(value)}
                                label={{ value: 'Hasar', position: 'insideBottom', offset: -5, fill: '#ffffff60', fontSize: 12 }}
                            />
                            <YAxis
                                tick={{ fontSize: 12, fill: '#ffffff80' }}
                                tickFormatter={(value) => formatCompactCurrency(value)}
                            />
                            <Tooltip
                                formatter={(value, name) => [`${formatCurrency(value)} Yang`, name]}
                                labelFormatter={(label) => `Hasar: ${formatCurrency(label)}`}
                                contentStyle={{
                                    backgroundColor: '#000000',
                                    border: '1px solid rgba(6, 182, 212, 0.3)',
                                    borderRadius: '8px',
                                    color: '#fff'
                                }}
                                itemSorter={(item) => -item.value} // Sort by profit descending
                            />
                            <Legend wrapperStyle={{ paddingTop: '10px' }} />
                            <ReferenceLine
                                x={userStats.damage}
                                stroke="#ffffff"
                                strokeDasharray="3 3"
                                label={{ value: 'Siz', position: 'top', fill: '#ffffff', fontSize: 12 }}
                            />
                            {topMetins.map((metin, index) => (
                                <Line
                                    key={metin.metinId}
                                    type="monotone"
                                    dataKey={metin.metinName}
                                    stroke={CHART_COLORS[index % CHART_COLORS.length]}
                                    strokeWidth={index === 0 ? 3 : 2}
                                    dot={false}
                                    activeDot={{ r: 6 }}
                                />
                            ))}
                        </LineChart>
                    )}
                </ResponsiveContainer>
            </div>
        </div>
    );
}


==================================================
DOSYA YOLU: .\app\components\widgets\analysis\AnalysisKPIs.js
==================================================
"use client";

import { Award, TrendingUp } from "lucide-react";
import { formatCompactCurrency } from "../../../lib/calculator";

export default function AnalysisKPIs({ bestMetin, netHourlyProfit, hourlyCost, setHourlyCost }) {
    return (
        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
            {/* Best Metin Card */}
            <div className="bg-black/40 backdrop-blur-xl p-6 rounded-2xl border border-white/5 hover:border-cyan-500/30 transition-colors shadow-sm flex items-center justify-between relative overflow-hidden">
                <div className="absolute -right-6 -bottom-6 opacity-10">
                    <Award className="w-32 h-32 text-cyan-400" />
                </div>
                <div>
                    <p className="text-sm text-white/70 mb-1 flex items-center gap-2">
                        <Award className="w-4 h-4 text-cyan-400" />
                        En Karlƒ± Se√ßim
                    </p>
                    <h3 className="text-3xl font-bold text-white">
                        {bestMetin.metinName}
                    </h3>
                </div>
                <div className="text-right z-10">
                    <p className="text-sm text-white/60">Metin Ba≈üƒ±</p>
                    <p className="text-xl font-bold text-cyan-400">
                        {formatCompactCurrency(bestMetin.dropValuePerMetin)}
                    </p>
                </div>
            </div>

            {/* Profit Card */}
            <div className="bg-black/40 backdrop-blur-xl p-6 rounded-2xl border border-white/5 hover:border-cyan-500/30 transition-colors shadow-sm flex items-center justify-between relative overflow-hidden">
                <div className="absolute -right-6 -bottom-6 opacity-10">
                    <TrendingUp className="w-32 h-32 text-violet-400" />
                </div>
                <div>
                    <p className="text-sm text-white/70 mb-1 flex items-center gap-2">
                        <TrendingUp className="w-4 h-4 text-violet-400" />
                        Tahmini Net Kazan√ß
                    </p>
                    <h3 className="text-3xl font-bold text-white">
                        {formatCompactCurrency(netHourlyProfit)}
                    </h3>
                    <p className="text-xs text-white/50">Yang / Saat</p>
                </div>
                <div className="z-10 bg-black/20 p-2 rounded-lg border border-white/10">
                    <label className="block text-xs text-white/60 mb-1">Saatlik Masraf</label>
                    <input
                        type="number"
                        value={hourlyCost}
                        onChange={(e) => setHourlyCost(Number(e.target.value))}
                        className="w-24 bg-transparent text-right text-white font-bold focus:outline-none border-b border-white/20 focus:border-violet-400 transition-colors"
                        placeholder="0"
                    />
                </div>
            </div>
        </div>
    );
}


==================================================
DOSYA YOLU: .\app\components\widgets\analysis\AnalysisSummaryView.js
==================================================
"use client";

import { useMemo } from "react";
import { Award, TrendingUp } from "lucide-react";
import { BarChart, Bar, ResponsiveContainer } from "recharts";
import { formatCompactCurrency } from "../../../lib/calculator";

export default function AnalysisSummaryView({ bestMetin }) {
    // Prepare mini chart data (top 5)
    const miniChartData = useMemo(() => {
        if (!bestMetin) return [];
        // Since we only have bestMetin, create a simple single-bar chart
        return [{
            name: bestMetin.metinName.substring(0, 6),
            profit: bestMetin.hourlyProfit,
        }];
    }, [bestMetin]);

    if (!bestMetin) {
        return (
            <div className="flex items-center justify-center h-full text-white/50">
                <p>Veri bekleniyor...</p>
            </div>
        );
    }

    return (
        <div className="flex flex-col items-center justify-center h-full w-full overflow-hidden px-4 relative">
            {/* Mini Background Chart */}
            <div className="absolute inset-0 opacity-[0.05] pointer-events-none">
                <ResponsiveContainer width="100%" height="100%">
                    <BarChart data={miniChartData}>
                        <Bar dataKey="profit" fill="#06b6d4" />
                    </BarChart>
                </ResponsiveContainer>
            </div>

            {/* Best Metin Badge */}
            <div className="flex items-center gap-2 mb-3 relative z-10">
                <Award className="w-6 h-6 text-cyan-400" />
                <span className="text-xs font-bold text-cyan-400 uppercase tracking-wide drop-shadow-[0_0_8px_rgba(34,211,238,0.5)]">
                    En Karlƒ± Metin
                </span>
            </div>

            {/* Metin Name */}
            <h3 className="text-2xl font-bold text-white mb-4 text-center relative z-10 drop-shadow-[0_0_10px_rgba(6,182,212,0.5)]">
                {bestMetin.metinName}
            </h3>

            {/* Split Stats */}
            <div className="grid grid-cols-2 gap-6 w-full max-w-xs relative z-10">
                <div className="flex flex-col items-center border-r border-white/10 pr-4">
                    <span className="text-xs text-white/60 mb-1">Metin Ba≈üƒ±</span>
                    <span className="text-xl font-bold text-white font-mono">
                        {formatCompactCurrency(bestMetin.dropValuePerMetin)}
                    </span>
                    <span className="text-xs text-white/50">Yang</span>
                </div>
                <div className="flex flex-col items-center pl-4">
                    <span className="text-xs text-white/60 mb-1 flex items-center gap-1">
                        <TrendingUp className="w-3 h-3 text-violet-400" />
                        Saatte
                    </span>
                    <span className="text-xl font-bold text-white font-mono">
                        {bestMetin.metinsPerHour.toFixed(1)}
                    </span>
                    <span className="text-xs text-white/50">Adet</span>
                </div>
            </div>
        </div>
    );
}


==================================================
DOSYA YOLU: .\app\components\widgets\analysis\AnalysisTable.js
==================================================
"use client";

import { AlertCircle, Target } from "lucide-react";
import { formatTime, formatCompactCurrency } from "../../../lib/calculator";

export default function AnalysisTable({ calculations, softcapWarning }) {
    return (
        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
            {/* Softcap Status */}
            <div className="lg:col-span-1">
                {softcapWarning?.active ? (
                    <div className="bg-red-500/10 backdrop-blur-xl p-6 rounded-2xl border border-red-500/30 h-full">
                        <div className="flex items-center gap-3 mb-3">
                            <AlertCircle className="w-6 h-6 text-red-400" />
                            <h4 className="font-bold text-white">Softcap Uyarƒ±sƒ±</h4>
                        </div>
                        <p className="text-sm text-white/80 leading-relaxed">
                            {softcapWarning.message}
                        </p>
                        <div className="mt-4 p-3 bg-black/20 rounded-lg border border-red-500/20">
                            <p className="text-xs text-red-300">
                                √ñneri: Hasar artƒ±rmak yerine metin bulma s√ºrenizi (hareket hƒ±zƒ±) iyile≈ütirmeye odaklanƒ±n.
                            </p>
                        </div>
                    </div>
                ) : (
                    <div className="bg-cyan-500/10 backdrop-blur-xl p-6 rounded-2xl border border-cyan-500/30 h-full flex flex-col justify-center items-center text-center">
                        <div className="p-3 bg-cyan-500/20 rounded-full mb-3">
                            <Target className="w-6 h-6 text-cyan-400" />
                        </div>
                        <h4 className="font-bold text-white mb-1">Verimlilik ƒ∞yi</h4>
                        <p className="text-sm text-white/70">
                            Mevcut hasarƒ±nƒ±zla hen√ºz softcap sƒ±nƒ±rƒ±na ula≈ümadƒ±nƒ±z. Hasar artƒ±≈üƒ± k√¢rƒ±nƒ±zƒ± artƒ±rmaya devam edecektir.
                        </p>
                    </div>
                )}
            </div>

            {/* Detailed Table */}
            <div className="lg:col-span-2 bg-black/40 backdrop-blur-xl p-6 rounded-2xl border border-white/5 hover:border-cyan-500/30 transition-colors shadow-sm overflow-hidden flex flex-col">
                <h3 className="text-lg font-semibold text-white mb-4">Detaylƒ± Sƒ±ralama</h3>
                <div className="overflow-auto max-h-[300px] -mr-2 pr-2">
                    <table className="w-full">
                        <thead className="bg-black/60 sticky top-0 backdrop-blur-md z-10">
                            <tr>
                                <th className="px-3 py-2 text-left text-xs font-semibold text-white/60">Sƒ±ra</th>
                                <th className="px-3 py-2 text-left text-xs font-semibold text-white/60">Metin</th>
                                <th className="px-3 py-2 text-right text-xs font-semibold text-white/60">Kesim S√ºresi</th>
                                <th className="px-3 py-2 text-right text-xs font-semibold text-white/60">Adet/Saat</th>
                                <th className="px-3 py-2 text-right text-xs font-semibold text-white/60">Kazan√ß</th>
                            </tr>
                        </thead>
                        <tbody className="divide-y divide-white/5">
                            {calculations.map((calc, index) => (
                                <tr
                                    key={calc.metinId}
                                    className={`hover:bg-cyan-500/5 transition-colors ${index === 0 ? "bg-cyan-500/10" : ""}`}
                                >
                                    <td className="px-3 py-3 text-sm text-white/50">#{index + 1}</td>
                                    <td className="px-3 py-3">
                                        <span className={`text-sm font-medium ${index === 0 ? "text-cyan-400" : "text-white"}`}>
                                            {calc.metinName}
                                        </span>
                                    </td>
                                    <td className="px-3 py-3 text-sm text-white/70 text-right font-mono">
                                        {formatTime(calc.killTime)}
                                    </td>
                                    <td className="px-3 py-3 text-sm text-violet-300 text-right font-mono">
                                        {calc.metinsPerHour.toFixed(1)}
                                    </td>
                                    <td className="px-3 py-3 text-right">
                                        <span className={`text-sm font-bold font-mono ${index === 0 ? "text-cyan-400" : "text-white/90"}`}>
                                            {formatCompactCurrency(calc.hourlyProfit)}
                                        </span>
                                    </td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    );
}


==================================================
DOSYA YOLU: .\app\components\widgets\metin-settings\ImportExportModal.js
==================================================
"use client";

import { useState } from "react";
import { motion } from "framer-motion";
import { X, Download, Upload, FileSpreadsheet, FileJson } from "lucide-react";
import useWidgetStore from "../../../store/useWidgetStore";
import { syncLocalMarketItems } from "../../../lib/marketUtils";
import { parseMetinImport } from "../../../lib/excelUtils";

export default function ImportExportModal({ isOpen, onClose, onImport, onExport }) {
    const [dataModalTab, setDataModalTab] = useState("export");
    const [isDragging, setIsDragging] = useState(false);

    // Enhanced file input handler with global registry and market sync
    const handleFileChange = async (e) => {
        const file = e.target.files?.[0];
        if (!file) return;

        try {
            // 1. Get store data
            const itemRegistry = useWidgetStore.getState().masterRegistry;
            const registerItems = useWidgetStore.getState().registerItems;
            const updateWidgetData = useWidgetStore.getState().updateWidgetData;
            const activeWorkspaceId = useWidgetStore.getState().activeWorkspaceId;
            const workspaces = useWidgetStore.getState().workspaces;

            // 2. Parse the file
            const result = await parseMetinImport(file);

            if (!result.success) {
                alert(result.message);
                return;
            }

            const { metinList, detectedItems } = result;

            // 3. Sync with global registry
            const { newRegistryItems, idMap } = syncLocalMarketItems(detectedItems, itemRegistry);

            // 4. Register new items to global catalog (CRITICAL STEP)
            if (newRegistryItems.length > 0) {
                registerItems(newRegistryItems);
                console.log(`‚úÖ ${newRegistryItems.length} new items registered to catalog`);
            }

            // 5. Update Market Widget with new items (Optional but recommended)
            const activeWorkspace = workspaces.find(w => w.id === activeWorkspaceId);
            if (activeWorkspace) {
                const marketWidget = activeWorkspace.widgets.find(w => w.type === 'market-prices');

                if (marketWidget && newRegistryItems.length > 0) {
                    // Add new items to market widget with 0 price
                    const newPrices = {};
                    newRegistryItems.forEach(item => {
                        newPrices[item.id] = 0;
                    });

                    updateWidgetData(marketWidget.id, {
                        prices: {
                            ...marketWidget.data.prices,
                            ...newPrices
                        }
                    });

                    console.log(`‚úÖ ${newRegistryItems.length} items added to Market Widget with 0 price`);
                }
            }

            // 6. Update metin list with real IDs
            const updatedMetinList = metinList.map(metin => ({
                ...metin,
                drops: metin.drops.map(drop => ({
                    ...drop,
                    itemId: idMap[drop.itemId] || drop.itemId
                }))
            }));

            // 7. Call parent's onImport with updated data
            // Pass the file object to maintain compatibility with parent handler
            // The parent will handle the actual widget data update
            onImport(file);

            // Close modal
            onClose();

        } catch (error) {
            console.error('Import error:', error);
            alert('ƒ∞√ße aktarma sƒ±rasƒ±nda hata olu≈ütu: ' + error.message);
        }
    };

    // Drag and drop handlers
    const handleDragOver = (e) => {
        e.preventDefault();
        setIsDragging(true);
    };

    const handleDragLeave = () => {
        setIsDragging(false);
    };

    const handleDrop = (e) => {
        e.preventDefault();
        setIsDragging(false);
        const file = e.dataTransfer.files?.[0];
        if (file) {
            // Create a fake event object to reuse handleFileChange
            handleFileChange({ target: { files: [file] } });
        }
    };

    if (!isOpen) return null;

    return (
        <div className="fixed inset-0 z-[110] flex items-center justify-center p-4">
            {/* Backdrop */}
            <div
                className="absolute inset-0 bg-black/60 backdrop-blur-sm"
                onClick={onClose}
            />

            {/* Modal */}
            <motion.div
                initial={{ opacity: 0, scale: 0.9 }}
                animate={{ opacity: 1, scale: 1 }}
                className="relative bg-black/80 backdrop-blur-xl border border-white/10 rounded-2xl p-6 max-w-md w-full shadow-2xl"
            >
                <div className="flex items-center justify-between mb-4">
                    <h3 className="text-xl font-bold text-white">Metin Preset Y√∂netimi</h3>
                    <button
                        onClick={onClose}
                        className="p-1 hover:bg-white/10 rounded-lg transition-colors"
                    >
                        <X className="w-5 h-5 text-white/70" />
                    </button>
                </div>

                {/* Tabs */}
                <div className="flex gap-2 mb-4">
                    <button
                        onClick={() => setDataModalTab("export")}
                        className={`flex-1 px-4 py-2 rounded-lg font-medium transition-all ${dataModalTab === "export"
                            ? "bg-violet-600/20 text-violet-400 border border-violet-500/30"
                            : "bg-white/5 text-white/70 hover:bg-white/10 border border-white/10"
                            }`}
                    >
                        <Download className="w-4 h-4 inline mr-2" />
                        Kaydet
                    </button>
                    <button
                        onClick={() => setDataModalTab("import")}
                        className={`flex-1 px-4 py-2 rounded-lg font-medium transition-all ${dataModalTab === "import"
                            ? "bg-violet-600/20 text-violet-400 border border-violet-500/30"
                            : "bg-white/5 text-white/70 hover:bg-white/10 border border-white/10"
                            }`}
                    >
                        <Upload className="w-4 h-4 inline mr-2" />
                        Y√ºkle
                    </button>
                </div>

                {/* Export Tab */}
                {dataModalTab === "export" && (
                    <div className="space-y-3">
                        <p className="text-sm text-white/70 mb-3">
                            Metin ayarlarƒ±nƒ±zƒ± Excel veya JSON formatƒ±nda kaydedin.
                        </p>
                        <button
                            onClick={() => onExport("excel")}
                            className="w-full flex items-center justify-center gap-3 px-4 py-3 bg-green-600/20 backdrop-blur-sm text-green-400 rounded-lg hover:bg-green-600/40 transition-colors font-medium border border-green-500/30"
                        >
                            <FileSpreadsheet className="w-5 h-5" />
                            Excel (.xlsx) ƒ∞ndir
                        </button>
                        <button
                            onClick={() => onExport("json")}
                            className="w-full flex items-center justify-center gap-3 px-4 py-3 bg-purple-600/20 backdrop-blur-sm text-purple-400 rounded-lg hover:bg-purple-600/40 transition-colors font-medium border border-purple-500/30"
                        >
                            <FileJson className="w-5 h-5" />
                            JSON ƒ∞ndir
                        </button>
                    </div>
                )}

                {/* Import Tab */}
                {dataModalTab === "import" && (
                    <div className="space-y-3">
                        <p className="text-sm text-white/70 mb-3">
                            Excel (.xlsx) veya JSON dosyasƒ± y√ºkleyin. Yeni e≈üyalar otomatik olarak kataloƒüa ve markete eklenecek.
                        </p>
                        <div
                            onDragOver={handleDragOver}
                            onDragLeave={handleDragLeave}
                            onDrop={handleDrop}
                            className={`border-2 border-dashed rounded-lg p-8 text-center transition-all ${isDragging
                                ? "border-violet-500 bg-violet-500/10"
                                : "border-white/10 bg-white/5 hover:bg-white/10"
                                }`}
                        >
                            <Upload className="w-12 h-12 text-white/50 mx-auto mb-3" />
                            <p className="text-white/70 mb-2">Dosyayƒ± buraya s√ºr√ºkleyin</p>
                            <p className="text-white/50 text-sm mb-4">veya</p>
                            <label className="inline-block px-4 py-2 bg-violet-600/20 backdrop-blur-sm text-violet-400 rounded-lg hover:bg-violet-600/40 transition-colors cursor-pointer font-medium border border-violet-500/30">
                                Dosya Se√ß
                                <input
                                    type="file"
                                    accept=".xlsx,.xls,.json,.csv"
                                    onChange={handleFileChange}
                                    className="hidden"
                                />
                            </label>
                            <p className="text-white/40 text-xs mt-3">
                                Desteklenen formatlar: .xlsx, .xls, .json, .csv
                            </p>
                        </div>
                    </div>
                )}
            </motion.div>
        </div>
    );
}


==================================================
DOSYA YOLU: .\app\components\widgets\metin-settings\MetinAccordionItem.js
==================================================
"use client";

import { useState } from "react";
import { motion, AnimatePresence } from "framer-motion";
import { ChevronDown, Plus, Trash2 } from "lucide-react";

const formatNumber = (num) => {
    return new Intl.NumberFormat('tr-TR').format(num);
};

export default function MetinAccordionItem({
    metin,
    isOpen,
    onToggle,
    onUpdateHP,
    onAddDrop,
    onRemoveDrop,
    onUpdateDrop,
    marketItems,
    craftingItems
}) {
    const [selectedItemId, setSelectedItemId] = useState("");
    const [selectedSourceType, setSelectedSourceType] = useState("market");
    const [error, setError] = useState(null);

    // Combine market and crafting items for dropdown
    const allAvailableItems = [
        ...marketItems.map(item => ({
            id: item.originalId || item.id,
            name: item.name,
            sourceType: 'market',
            displayName: item.name
        })),
        ...craftingItems.map(item => ({
            id: item.id,
            name: item.name,
            sourceType: 'crafting',
            displayName: `üì¶ ${item.name}` // Add box icon for crafting items
        }))
    ];

    const getItemByIdAndType = (itemId, sourceType) => {
        if (sourceType === 'market') {
            return marketItems.find((item) => (item.originalId || item.id) === itemId);
        } else {
            return craftingItems.find((item) => item.id === itemId);
        }
    };

    const handleHpChange = (newHp) => {
        const hp = parseFloat(newHp);
        if (!isNaN(hp) && hp > 0) {
            onUpdateHP(metin.id, hp);
        }
    };

    const handleDropChange = (dropId, field, value) => {
        const numValue = parseFloat(value);
        if (!isNaN(numValue) && numValue >= 0) {
            onUpdateDrop(metin.id, dropId, field, numValue);
        }
    };

    const handleAddDrop = () => {
        if (selectedItemId) {
            const exists = metin.drops.some((d) => d.itemId === selectedItemId);
            if (exists) {
                setError("Bu e≈üya zaten bu metinde ekli!");
                return;
            }
            onAddDrop(metin.id, selectedItemId, selectedSourceType);
        }
    };

    const handleRemoveDrop = (dropId) => {
        if (confirm("Bu drop'u silmek istediƒüinizden emin misiniz?")) {
            onRemoveDrop(metin.id, dropId);
        }
    };

    return (
        <div className={`backdrop-blur-xl rounded-xl border overflow-hidden transition-all ${isOpen
            ? "bg-violet-900/20 border-violet-500/20 shadow-[0_0_20px_rgba(139,92,246,0.1)]"
            : "bg-black/20 border-white/5 hover:bg-white/5"
            }`}>
            <button
                onClick={onToggle}
                className="w-full flex items-center justify-between p-4 hover:bg-white/5 transition-colors"
            >
                <div className="flex items-center gap-3">
                    <motion.div
                        animate={{ rotate: isOpen ? 180 : 0 }}
                        transition={{ duration: 0.2 }}
                    >
                        <ChevronDown className="w-5 h-5 text-white/60" />
                    </motion.div>
                    <h3 className="text-lg font-semibold text-white">{metin.name}</h3>
                </div>
                <div className="flex items-center gap-3">
                    <span className="text-sm text-white/60">
                        HP: <span className="text-cyan-300 font-bold font-mono">{formatNumber(metin.hp)}</span>
                    </span>
                    <span className="text-sm text-white/60">
                        {metin.drops.length} Drop
                    </span>
                </div>
            </button>

            <AnimatePresence>
                {isOpen && (
                    <motion.div
                        initial={{ height: 0, opacity: 0 }}
                        animate={{ height: "auto", opacity: 1 }}
                        exit={{ height: 0, opacity: 0 }}
                        className="bg-black/30 border-t border-white/5"
                    >
                        <div className="p-4 space-y-4">
                            {/* HP Input */}
                            <div>
                                <label className="block text-sm font-semibold text-white/80 mb-2">
                                    Metin HP
                                </label>
                                <input
                                    type="number"
                                    value={metin.hp}
                                    onChange={(e) => handleHpChange(e.target.value)}
                                    className="w-full px-3 py-2 font-mono font-semibold text-white bg-black/60 border border-white/10 rounded-lg focus:outline-none focus:ring-2 focus:ring-violet-500/20 focus:border-violet-500/50 placeholder:text-white/40 transition-all"
                                    min="1"
                                    step="1000"
                                />
                            </div>

                            {/* Drops List */}
                            <div>
                                <h4 className="text-sm font-semibold text-white/80 mb-2">
                                    Drop Listesi
                                </h4>
                                <div className="space-y-2">
                                    {metin.drops.map((drop) => {
                                        const item = getItemByIdAndType(drop.itemId, drop.sourceType || 'market');
                                        return (
                                            <div
                                                key={drop.id}
                                                className="bg-black/40 backdrop-blur-sm p-3 rounded-lg border border-white/5 hover:border-white/10 transition-colors"
                                            >
                                                <div className="flex items-center justify-between mb-2">
                                                    <span className="text-white font-medium">
                                                        {drop.sourceType === 'crafting' && 'üì¶ '}
                                                        {item?.name || drop.itemId}
                                                    </span>
                                                    <button
                                                        onClick={() => handleRemoveDrop(drop.id)}
                                                        className="p-1 hover:bg-red-500/20 rounded transition-colors"
                                                    >
                                                        <Trash2 className="w-4 h-4 text-red-400" />
                                                    </button>
                                                </div>
                                                <div className="grid grid-cols-2 gap-2">
                                                    <div>
                                                        <label className="block text-xs text-white/60 mb-1">
                                                            Adet
                                                        </label>
                                                        <input
                                                            type="number"
                                                            value={drop.count}
                                                            onChange={(e) =>
                                                                handleDropChange(drop.id, "count", e.target.value)
                                                            }
                                                            className="w-full px-2 py-1 text-sm font-mono font-medium text-white bg-black/60 border border-white/10 rounded focus:outline-none focus:ring-1 focus:ring-violet-500/50 focus:border-violet-500/50"
                                                            min="1"
                                                        />
                                                    </div>
                                                    <div>
                                                        <label className="block text-xs text-white/60 mb-1">
                                                            ≈ûans (%)
                                                        </label>
                                                        <input
                                                            type="number"
                                                            value={drop.chance}
                                                            onChange={(e) =>
                                                                handleDropChange(drop.id, "chance", e.target.value)
                                                            }
                                                            className="w-full px-2 py-1 text-sm font-mono font-medium text-white bg-black/60 border border-white/10 rounded focus:outline-none focus:ring-1 focus:ring-violet-500/50 focus:border-violet-500/50"
                                                            min="0"
                                                            max="100"
                                                        />
                                                    </div>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>

                            {/* Add Drop */}
                            <div className="pt-2 border-t border-white/10">
                                <h4 className="text-sm font-semibold text-white/80 mb-2">
                                    Yeni Drop Ekle
                                </h4>
                                <div className="flex gap-2">
                                    <select
                                        value={selectedItemId}
                                        onChange={(e) => {
                                            const selected = allAvailableItems.find(item => item.id === e.target.value);
                                            setSelectedItemId(e.target.value);
                                            setSelectedSourceType(selected?.sourceType || 'market');
                                        }}
                                        className="flex-1 px-3 py-2 font-medium text-white bg-black/60 border border-white/10 rounded-lg focus:outline-none focus:ring-2 focus:ring-violet-500/20 focus:border-violet-500/50"
                                    >
                                        <option value="" className="bg-zinc-900">Se√ßiniz...</option>
                                        {allAvailableItems.map((item) => (
                                            <option
                                                key={`${item.sourceType}-${item.id}`}
                                                value={item.id}
                                                className="bg-zinc-900"
                                            >
                                                {item.displayName}
                                            </option>
                                        ))}
                                    </select>
                                    <button
                                        onClick={handleAddDrop}
                                        className="px-4 py-2 bg-cyan-600/20 backdrop-blur-sm text-cyan-400 rounded-lg hover:bg-cyan-600/40 transition-colors font-medium border border-cyan-500/30 flex items-center gap-2"
                                    >
                                        <Plus className="w-4 h-4" />
                                        Ekle
                                    </button>
                                </div>
                            </div>
                        </div>
                    </motion.div>
                )}
            </AnimatePresence>

            {/* Error Popup */}
            {error && (
                <div
                    className="fixed inset-0 z-[150] flex items-center justify-center bg-black/50 backdrop-blur-sm"
                    onClick={() => setError(null)}
                >
                    <motion.div
                        initial={{ opacity: 0, scale: 0.9 }}
                        animate={{ opacity: 1, scale: 1 }}
                        className="bg-red-900/90 border border-red-500/50 text-white p-6 rounded-xl shadow-2xl"
                        onClick={() => setError(null)}
                    >
                        {error}
                    </motion.div>
                </div>
            )}
        </div>
    );
}


==================================================
DOSYA YOLU: .\app\components\widgets\metin-settings\MetinHeader.js
==================================================
"use client";

import { Settings, Download } from "lucide-react";

export default function MetinHeader({ onImportExportClick, onClose }) {
    return (
        <div className="bg-black/20 backdrop-blur-xl p-4 rounded-xl border border-white/5">
            <div className="flex items-start justify-between">
                <div className="flex items-start gap-3">
                    <div className="p-2 bg-cyan-500/10 backdrop-blur-sm rounded-lg border border-cyan-500/20">
                        <Settings className="w-5 h-5 text-cyan-400" />
                    </div>
                    <div>
                        <h3 className="font-semibold text-white mb-1">Metin Ayarlarƒ±</h3>
                        <p className="text-sm text-white/70">
                            Her metinin HP deƒüerini ve drop listesini d√ºzenleyin.
                            Deƒüi≈üiklikler anlƒ±k olarak kaydedilir.
                        </p>
                    </div>
                </div>
                <button
                    onClick={onImportExportClick}
                    className="p-2 bg-violet-600/20 backdrop-blur-sm text-violet-400 rounded-lg hover:bg-violet-600/40 transition-colors border border-violet-500/30"
                    title="ƒ∞√ße/Dƒ±≈üa Aktar"
                >
                    <Download className="w-5 h-5" />
                </button>
            </div>
        </div>
    );
}


==================================================
DOSYA YOLU: .\app\components\widgets\metin-settings\MetinList.js
==================================================
"use client";

import { useState } from "react";
import MetinAccordionItem from "./MetinAccordionItem";

export default function MetinList({ metins, marketItems, craftingItems, updateWidgetData, widgetId }) {
    const [openMetinId, setOpenMetinId] = useState(null);

    const handleUpdateHP = (metinId, newHP) => {
        const updated = metins.map((m) =>
            m.id === metinId ? { ...m, hp: newHP } : m
        );
        updateWidgetData(widgetId, { metins: updated });
    };

    const handleAddDrop = (metinId, itemId, sourceType) => {
        const updated = metins.map((m) => {
            if (m.id === metinId) {
                return {
                    ...m,
                    drops: [
                        ...m.drops,
                        {
                            id: crypto.randomUUID(),
                            itemId,
                            sourceType: sourceType || 'market', // Track source type
                            count: 1,
                            chance: 10,
                        },
                    ],
                };
            }
            return m;
        });
        updateWidgetData(widgetId, { metins: updated });
    };

    const handleRemoveDrop = (metinId, dropId) => {
        const updated = metins.map((m) => {
            if (m.id === metinId) {
                return {
                    ...m,
                    drops: m.drops.filter((d) => d.id !== dropId),
                };
            }
            return m;
        });
        updateWidgetData(widgetId, { metins: updated });
    };

    const handleUpdateDrop = (metinId, dropId, field, value) => {
        const updated = metins.map((m) => {
            if (m.id === metinId) {
                return {
                    ...m,
                    drops: m.drops.map((d) =>
                        d.id === dropId ? { ...d, [field]: value } : d
                    ),
                };
            }
            return m;
        });
        updateWidgetData(widgetId, { metins: updated });
    };

    return (
        <div className="flex-1 overflow-y-auto pr-2 space-y-3">
            {metins.map((metin) => (
                <MetinAccordionItem
                    key={metin.id}
                    metin={metin}
                    isOpen={openMetinId === metin.id}
                    onToggle={() =>
                        setOpenMetinId(openMetinId === metin.id ? null : metin.id)
                    }
                    onUpdateHP={handleUpdateHP}
                    onAddDrop={handleAddDrop}
                    onRemoveDrop={handleRemoveDrop}
                    onUpdateDrop={handleUpdateDrop}
                    marketItems={marketItems}
                    craftingItems={craftingItems}
                />
            ))}
        </div>
    );
}


==================================================
DOSYA YOLU: .\app\components\widgets\metin-settings\MetinSummary.js
==================================================
"use client";

import { Settings } from "lucide-react";

export default function MetinSummary({ metins }) {
    return (
        <div className="flex flex-col items-center justify-center h-full w-full overflow-hidden px-4">
            <div className="flex items-center gap-3 mb-3">
                <div className="p-2 bg-white/10 backdrop-blur-sm rounded-lg border border-white/10">
                    <Settings className="w-8 h-8 text-cyan-400" />
                </div>
            </div>
            <span className="text-3xl font-bold text-white whitespace-nowrap">
                Metin Ayarlarƒ±
            </span>
            <span className="text-sm text-white/60 mt-2 font-mono">
                {metins.length} Metin Tanƒ±mlƒ±
            </span>
        </div>
    );
}


==================================================
DOSYA YOLU: .\app\data\initialData.js
==================================================
/**
 * ============================================================================
 * INITIAL DATA - MULTI-SERVER ARCHITECTURE (VNUM/SLUG BASED)
 * ============================================================================
 */

// 1. MASTER REGISTRY (Global Sabit Katalog)
export const MASTER_REGISTRY = {
  items: [
    // --- Y√ºkseltme Malzemeleri ---
    { id: "71084", name: "Efsun Nesnesi (Ye≈üil)", category: "upgrades", icon: "Circle", isSystemItem: true },
    { id: "71085", name: "Arttƒ±rma Kaƒüƒ±dƒ± (Ye≈üil)", category: "upgrades", icon: "Circle", isSystemItem: true },
    { id: "71084_n", name: "Efsun Nesnesi", category: "upgrades", icon: "Circle", isSystemItem: true },
    { id: "50513", name: "Ruh Ta≈üƒ±", category: "upgrades", icon: "Diamond", isSystemItem: true },
    { id: "70102", name: "Zen Fasulyesi", category: "upgrades", icon: "Circle", isSystemItem: true },
    { id: "71094", name: "M√ºnzevi Tavsiyesi", category: "upgrades", icon: "Book", isSystemItem: true },

    // --- Simya & Enerji ---
    { id: "cor_draconis", name: "Cor Draconis (Ham)", category: "alchemy", icon: "Gem", isSystemItem: true },
    { id: "energy_frag", name: "Enerji Par√ßasƒ±", category: "crafting", icon: "Zap", isSystemItem: true },

    // --- Basma Malzemeleri ---
    { id: "27992", name: "Beyaz ƒ∞nci", category: "upgrade_mat", icon: "Circle", isSystemItem: true },
    { id: "27993", name: "Mavi ƒ∞nci", category: "upgrade_mat", icon: "Circle", isSystemItem: true },
    { id: "27994", name: "Kankƒ±rmƒ±zƒ± ƒ∞nci", category: "upgrade_mat", icon: "Circle", isSystemItem: true },
  ],

  // Metin ≈ûablonlarƒ± (Drop listeleri sabit ID referanslƒ±dƒ±r)
  metinTemplates: [
    {
      id: "metin_ruh",
      name: "Ruh Metni (Lv.40)",
      baseHp: 119700,
      drops: [
        { itemId: "71084", count: 4, chance: 100 },
        { itemId: "71085", count: 2, chance: 100 },
        { itemId: "50513", count: 1, chance: 20 }
      ]
    },
    {
      id: "metin_golge",
      name: "G√∂lge Metni (Lv.45)",
      baseHp: 142350,
      drops: [
        { itemId: "71084_n", count: 1, chance: 100 },
        { itemId: "50513", count: 1, chance: 35 }
      ]
    },
    {
      id: "metin_katil",
      name: "Katil Metni (Lv.70)",
      baseHp: 296550,
      drops: [
        { itemId: "71084_n", count: 2, chance: 100 },
        { itemId: "50513", count: 2, chance: 50 },
        { itemId: "cor_draconis", count: 1, chance: 20 },
        { itemId: "70102", count: 1, chance: 15 }
      ]
    }
  ]
};

// 2. SERVER CONFIGURATIONS (Ba≈ülangƒ±√ß Profilleri)
export const INITIAL_SERVERS = [
  {
    id: "server_marmara",
    name: "Marmara (TR)",
    currency: "Won",
    prices: {
      "71084": 2500000,
      "71085": 1500000,
      "71084_n": 6000000,
      "50513": 5000000,
      "cor_draconis": 25000000,
      "zen_bean": 80000000
    },
    multipliers: { drop: 1.0, yang: 1.0 }
  },
  {
    id: "server_ruby",
    name: "Ruby (Etkinlik)",
    currency: "Won",
    prices: {
      "71084": 500000,   // Ruby'de daha ucuz
      "71084_n": 1000000,
      "50513": 2000000,
      "cor_draconis": 15000000
    },
    multipliers: { drop: 2.0, yang: 1.5 }
  }
];


==================================================
DOSYA YOLU: .\app\lib\calculator.js
==================================================
/**
 * Metin2 Drop Simulator - Calculation Engine
 * Calculates profitability for each Metin based on user stats and market prices
 */

/**
 * Calculate profit metrics for a single Metin
 */
export function calculateMetinProfit(metin, storeData, userStats) {
    const { activeServerId, serverProfiles } = storeData;

    // Aktif sunucunun fiyatlarƒ±nƒ± ve √ßarpanlarƒ±nƒ± al
    const activeProfile = serverProfiles.find(p => p.id === activeServerId);
    const prices = activeProfile?.prices || {};
    const multipliers = activeProfile?.multipliers || { drop: 1.0 };

    let totalDropValue = 0;

    if (metin && metin.drops) {
        metin.drops.forEach(drop => {
            const price = prices[drop.itemId] || 0;
            // Drop √ßarpanƒ±nƒ± hesaba kat
            const count = drop.count * multipliers.drop;

            totalDropValue += count * (drop.chance / 100) * price;
        });
    }

    const { damage, hitsPerSecond, findTime } = userStats;

    // 1. Calculate Kill Time (seconds)
    const dps = damage * hitsPerSecond;
    const killTime = dps > 0 ? metin.hp / dps : 0;

    // 2. Calculate Cycle Time (Kill + Find)
    const cycleTime = killTime + findTime;

    // 3. Calculate Metins Per Hour
    const metinsPerHour = cycleTime > 0 ? 3600 / cycleTime : 0;

    // 5. Calculate Hourly Profit
    const hourlyProfit = metinsPerHour * totalDropValue;

    return {
        metinId: metin.id,
        metinName: metin.name,
        killTime,
        cycleTime,
        metinsPerHour,
        dropValuePerMetin: totalDropValue,
        hourlyProfit,
    };
}

/**
 * Calculate profit metrics for all Metins and sort by hourly profit
 */
export function calculateAllMetins(metinList = [], storeData = {}, userStats = {}) {
    // G√ºvenlik: Bo≈ü veri kontrol√º
    if (!metinList || !Array.isArray(metinList) || metinList.length === 0) {
        console.warn('calculateAllMetins: metinList is empty or invalid');
        return [];
    }

    const calculations = metinList.map((metin) =>
        calculateMetinProfit(metin, storeData, userStats)
    );
    // Sort by hourly profit (descending)
    return calculations.sort((a, b) => b.hourlyProfit - a.hourlyProfit);
}

/**
 * Get the best (most profitable) Metin
 */
export function getBestMetin(calculations) {
    return calculations.length > 0 ? calculations[0] : null;
}

/**
 * Format currency (Yang) with proper separators
 */
export function formatCurrency(amount) {
    return new Intl.NumberFormat('tr-TR', {
        minimumFractionDigits: 0,
        maximumFractionDigits: 0,
    }).format(amount);
}

/**
 * Format currency compactly (e.g., 1.5M, 20k)
 */
export function formatCompactCurrency(amount) {
    if (amount >= 1000000000) {
        return `${(amount / 1000000000).toFixed(1)}B`;
    } else if (amount >= 1000000) {
        return `${(amount / 1000000).toFixed(1)}M`;
    } else if (amount >= 1000) {
        return `${(amount / 1000).toFixed(1)}k`;
    }
    return amount.toString();
}

/**
 * Format time in seconds to readable format
 */
export function formatTime(seconds) {
    if (seconds >= 60) {
        const minutes = Math.floor(seconds / 60);
        const secs = Math.round(seconds % 60);
        return `${minutes}m ${secs}s`;
    }
    return `${seconds.toFixed(1)}s`;
}

/**
 * Helper: Calculate a smart upper limit for damage simulation
 */
function calculateSmartLimit(metinList, hitsPerSecond) {
    if (!metinList || metinList.length === 0) return 30000;

    const maxHp = Math.max(...metinList.map(m => m.hp));
    const hps = hitsPerSecond || 1;
    const limit = (maxHp / hps) * 1.2; // +20% buffer

    // Clamp between reasonable bounds
    return Math.max(5000, Math.min(200000, Math.ceil(limit / 500) * 500));
}

/**
 * Recursive Price Resolver (√ñzyinelemeli Fiyat √á√∂z√ºc√º)
 * 
 * Calculates the price of an item by recursively resolving its dependencies.
 * Supports both market items and crafting items (recipes, containers, fragments).
 * 
 * @param {string} itemId - ID of the item to resolve
 * @param {'market'|'crafting'} sourceType - Source type of the item
 * @param {Array} marketItems - Array of market items with prices
 * @param {Array} craftingItems - Array of crafting items (recipes/containers/fragments)
 * @param {Array} metinList - Array of metins with drop data
 * @param {number} depth - Recursion depth counter (prevents infinite loops)
 * @returns {number} Calculated unit price of the item
 */
export function resolveItemPrice(itemId, sourceType, marketItems = [], craftingItems = [], metinList = [], depth = 0) {
    // 1. Safety: Prevent infinite recursion
    if (depth > 10) {
        console.warn(`Max recursion depth reached for item ${itemId}`);
        return 0;
    }

    // G√ºvenlik: Bo≈ü veri kontrol√º
    if (!itemId) {
        console.warn('resolveItemPrice: itemId is missing');
        return 0;
    }

    // G√ºvenlik: marketItems, craftingItems, metinList null/undefined kontrol√º
    const safeMarketItems = marketItems || [];
    const safeCraftingItems = craftingItems || [];
    const safeMetinList = metinList || [];

    // 2. Market Item: Direct price lookup
    if (sourceType === 'market') {
        // G√ºvenlik: originalId veya id ile e≈üle≈ütir
        const marketItem = safeMarketItems.find(item => item.id === itemId || item.originalId === itemId);
        if (marketItem) {
            return marketItem.price || 0;
        }
        console.warn(`Market item ${itemId} not found`);
        return 0;
    }

    // 3. Crafting Item: Recursive calculation
    if (sourceType === 'crafting') {
        const craftingItem = safeCraftingItems.find(item => item.id === itemId);

        if (!craftingItem) {
            console.warn(`Crafting item ${itemId} not found`);
            return 0;
        }

        // No contents means no cost (shouldn't happen, but handle gracefully)
        if (!craftingItem.contents || craftingItem.contents.length === 0) {
            return 0;
        }

        // Handle based on crafting type
        if (craftingItem.type === 'recipe') {
            // Recipe (D√∂n√º≈ü√ºm): X + Y = Z
            // Total cost = Sum of all input costs
            let totalCost = 0;

            for (const content of craftingItem.contents) {
                // Recursively resolve each ingredient's price
                const ingredientPrice = resolveItemPrice(
                    content.itemId,
                    content.sourceType,
                    safeMarketItems,
                    safeCraftingItems,
                    safeMetinList,
                    depth + 1
                );

                // Add to total cost (price * count)
                totalCost += ingredientPrice * (content.count || 1);
            }

            // Return cost per unit (if recipe produces multiple outputs, adjust here)
            return totalCost;

        } else if (craftingItem.type === 'container') {
            // Container (Sandƒ±k/Boss): Weighted average of drops
            // Expected value = Sum of (Item Value * Drop Chance)
            let expectedValue = 0;

            for (const content of craftingItem.contents) {
                // Recursively resolve each drop's price
                const dropPrice = resolveItemPrice(
                    content.itemId,
                    content.sourceType,
                    safeMarketItems,
                    safeCraftingItems,
                    safeMetinList,
                    depth + 1
                );

                // Calculate weighted value (price * count * chance%)
                const chance = (content.chance || 0) / 100;
                const weightedValue = dropPrice * (content.count || 1) * chance;
                expectedValue += weightedValue;
            }

            return expectedValue;

        } else if (craftingItem.type === 'fragment') {
            // Fragment (Par√ßa): Reverse valuation from parent item or metin
            // Fragment price = Parent value / Fragment amount

            // Scenario A: Target is a Crafting Item
            if (craftingItem.targetType === 'crafting' || !craftingItem.targetType) {
                const targetItem = safeCraftingItems.find(i => i.id === craftingItem.targetId);

                if (!targetItem) {
                    console.warn(`Fragment target crafting item ${craftingItem.targetId} not found for fragment ${itemId}`);
                    return 0;
                }

                // Recursively resolve the parent item's price
                const parentPrice = resolveItemPrice(
                    targetItem.id,
                    'crafting',
                    safeMarketItems,
                    safeCraftingItems,
                    safeMetinList,
                    depth + 1
                );

                // Return price per fragment unit
                return parentPrice / (craftingItem.amount || 1);
            }

            // Scenario B: Target is a Metin
            if (craftingItem.targetType === 'metin') {
                const targetMetin = safeMetinList.find(m => m.id === craftingItem.targetId);

                if (!targetMetin) {
                    console.warn(`Fragment target metin ${craftingItem.targetId} not found for fragment ${itemId}`);
                    return 0;
                }

                // Calculate Expected Drop Value for the Metin
                let totalDropValue = 0;

                if (targetMetin.drops && targetMetin.drops.length > 0) {
                    targetMetin.drops.forEach((drop) => {
                        // Find the item price from market items
                        // G√ºvenlik: originalId veya id ile e≈üle≈ütir
                        const item = safeMarketItems.find(i => i.originalId === drop.itemId || i.id === drop.itemId);
                        if (item) {
                            // Expected value = count * (chance / 100) * price
                            const expectedValue = drop.count * (drop.chance / 100) * item.price;
                            totalDropValue += expectedValue;
                        }
                    });
                }

                // Return price per fragment unit
                return totalDropValue / (craftingItem.amount || 1);
            }

            console.warn(`Fragment ${itemId} has invalid or missing targetType`);
            return 0;
        }
    }

    // Fallback: Unknown type or error
    console.warn(`Unable to resolve price for item ${itemId} (type: ${sourceType})`);
    return 0;
}

/**
 * Calculate Virtual Prices for All Crafting Items
 * 
 * Iterates through all crafting items and calculates their prices using
 * the recursive resolver. Returns a map of itemId -> calculatedPrice.
 * 
 * @param {Array} craftingItems - Array of crafting items
 * @param {Array} marketItems - Array of market items with prices
 * @returns {Object} Map of { itemId: price }
 */
export function calculateVirtualPrices(craftingItems, marketItems) {
    const virtualPrices = {};

    // G√ºvenlik: Bo≈ü veri kontrol√º
    if (!craftingItems || !Array.isArray(craftingItems) || craftingItems.length === 0) {
        console.warn('calculateVirtualPrices: craftingItems is empty or invalid');
        return virtualPrices;
    }

    // G√ºvenlik: marketItems null/undefined kontrol√º
    const safeMarketItems = marketItems || [];

    // Calculate price for each crafting item
    for (const craftingItem of craftingItems) {
        const price = resolveItemPrice(
            craftingItem.id,
            'crafting',
            safeMarketItems,
            craftingItems,
            [], // Empty metinList for now (can be passed as parameter if needed)
            0 // Start at depth 0
        );

        virtualPrices[craftingItem.id] = price;
    }

    return virtualPrices;
}

/**
 * Calculate damage progression zones
 */
export function calculateDamageZones(metinList, marketItems, userStats) {
    const zones = [];
    let currentZone = null;

    // Helper colors
    const colors = ["#ef4444", "#f97316", "#eab308", "#22c55e", "#06b6d4", "#3b82f6", "#a855f7", "#ec4899"];
    const getColor = (name) => {
        let hash = 0;
        for (let i = 0; i < name.length; i++) hash = name.charCodeAt(i) + ((hash << 5) - hash);
        return colors[Math.abs(hash) % colors.length];
    };

    const maxDamage = calculateSmartLimit(metinList, userStats.hitsPerSecond);
    let step = 100;

    for (let damage = 1000; damage <= maxDamage; damage += step) {
        // Smart Step
        if (damage > 50000) step = 500;
        if (damage > 200000) step = 1000;

        const tempStats = { ...userStats, damage };
        const calculations = calculateAllMetins(metinList, marketItems, tempStats);
        const bestMetin = getBestMetin(calculations);

        if (!bestMetin) continue;

        const isSoftcap = bestMetin.killTime < (userStats.findTime * 0.1);

        // Start new zone if metin changes
        if (!currentZone || currentZone.bestMetinName !== bestMetin.metinName) {
            currentZone = {
                minDamage: damage,
                maxDamage: damage,
                bestMetinName: bestMetin.metinName,
                minProfit: bestMetin.hourlyProfit,
                maxProfit: bestMetin.hourlyProfit,
                color: getColor(bestMetin.metinName),
                isSoftcap: isSoftcap,
                // Top 3 rankings for this zone start
                rankings: calculations.slice(0, 3).map(c => ({
                    name: c.metinName,
                    profit: c.hourlyProfit,
                    efficiency: (c.hourlyProfit / bestMetin.hourlyProfit) * 100
                }))
            };
            zones.push(currentZone);
        } else {
            // Extend existing zone
            currentZone.maxDamage = damage;
            currentZone.maxProfit = bestMetin.hourlyProfit;
            if (isSoftcap) currentZone.isSoftcap = true;
        }
    }

    return zones;
}

/**
 * Analyze next tier requirements and potential gains
 */
export function analyzeNextTier(currentDamage, zones) {
    if (!zones || zones.length === 0) return null;

    // Find current zone
    const currentZoneIndex = zones.findIndex(
        z => currentDamage >= z.minDamage && currentDamage <= z.maxDamage
    );

    // If damage is beyond max calculated range or in the last zone
    if (currentZoneIndex === -1 || currentZoneIndex === zones.length - 1) {
        // Check if damage is higher than the last zone's max
        const lastZone = zones[zones.length - 1];
        if (currentDamage > lastZone.maxDamage) {
            return { isMaxLevel: true, message: "Zirvedesiniz! Daha verimli bir metin yok." };
        }
        // If inside the last zone
        return { isMaxLevel: true, message: "En verimli metin b√∂lgesindesiniz." };
    }

    const currentZone = zones[currentZoneIndex];
    const nextZone = zones[currentZoneIndex + 1];

    // Calculate requirements
    const requiredDamage = nextZone.minDamage - currentDamage;

    // Calculate profit potential (using averages for smoother comparison)
    const currentAvgProfit = (currentZone.minProfit + currentZone.maxProfit) / 2;
    const nextAvgProfit = (nextZone.minProfit + nextZone.maxProfit) / 2;

    const profitIncrease = nextAvgProfit - currentAvgProfit;
    const percentGain = currentAvgProfit > 0
        ? (profitIncrease / currentAvgProfit) * 100
        : 0;

    return {
        isMaxLevel: false,
        nextMetin: nextZone.bestMetinName,
        requiredDamage: requiredDamage,
        profitIncrease: profitIncrease,
        percentGain: percentGain
    };
}

/**
 * Calculate expected item yields for a specific duration
 */
export function calculateItemYields(metin, userStats, durationHours) {
    const { damage, hitsPerSecond, findTime } = userStats;

    // Calculate Metins Per Hour (reusing logic for consistency)
    const dps = damage * hitsPerSecond;
    const killTime = dps > 0 ? metin.hp / dps : 0;
    const cycleTime = killTime + findTime;
    const metinsPerHour = cycleTime > 0 ? 3600 / cycleTime : 0;

    const totalMetins = metinsPerHour * durationHours;
    const yields = [];

    metin.drops.forEach(drop => {
        // Expected count = Total Metins * Count per drop * Chance
        const expectedCount = totalMetins * drop.count * (drop.chance / 100);

        yields.push({
            itemId: drop.itemId,
            count: expectedCount,
            // Note: We don't have item names here directly, caller should map them
            chance: drop.chance
        });
    });

    return {
        metinsCount: totalMetins,
        yields: yields
    };
}

/**
 * Generate simulated player distribution across damage ranges
 */
export function generatePlayerDistribution(minDmg, maxDmg, playerCount, type, timeStrategy, baseHours = 4) {
    const segments = [];
    const segmentCount = 20; // Number of buckets
    const range = maxDmg - minDmg;
    const step = range / segmentCount;

    let totalWeight = 0;
    const weights = [];

    // 1. Calculate weights based on distribution type
    for (let i = 0; i < segmentCount; i++) {
        const normalizedPos = i / (segmentCount - 1); // 0 to 1
        let weight = 0;

        switch (type) {
            case "normal": // Bell curve
                // Gaussian function centered at 0.5
                weight = Math.exp(-Math.pow(normalizedPos - 0.5, 2) / 0.1);
                break;
            case "left-skewed": // Majority low damage (Gamma-like)
                weight = Math.pow(1 - normalizedPos, 2);
                break;
            case "right-skewed": // Majority high damage
                weight = Math.pow(normalizedPos, 2);
                break;
            case "uniform":
            default:
                weight = 1;
                break;
        }
        weights.push(weight);
        totalWeight += weight;
    }

    // 2. Distribute players and calculate play time
    for (let i = 0; i < segmentCount; i++) {
        const segmentMid = minDmg + (step * i) + (step / 2);
        const normalizedPos = i / (segmentCount - 1);

        // Player Count for this segment
        const count = Math.round(playerCount * (weights[i] / totalWeight));

        // Average Play Time (Hours) based on strategy
        let avgPlayTime = baseHours;

        switch (timeStrategy) {
            case "linear": // Stronger players play more
                // Weak: 50%, Strong: 150%
                avgPlayTime = baseHours * (0.5 + normalizedPos);
                break;
            case "linear-inverse": // Weaker players play more
                // Weak: 150%, Strong: 50%
                avgPlayTime = baseHours * (1.5 - normalizedPos);
                break;
            case "exponential": // Elites play significantly more
                // Quadratic increase
                avgPlayTime = baseHours * (0.2 + 1.8 * Math.pow(normalizedPos, 2));
                break;
            case "exponential-inverse": // Beginners play significantly more
                // Quadratic increase for low damage
                avgPlayTime = baseHours * (0.2 + 1.8 * Math.pow(1 - normalizedPos, 2));
                break;
            case "constant":
            default:
                avgPlayTime = baseHours;
                break;
        }

        if (count > 0) {
            segments.push({
                minDamage: minDmg + (step * i),
                maxDamage: minDmg + (step * (i + 1)),
                avgDamage: segmentMid,
                playerCount: count,
                avgPlayTime: avgPlayTime,
                totalHours: count * avgPlayTime
            });
        }
    }

    return segments;
}


==================================================
DOSYA YOLU: .\app\lib\excelUtils.js
==================================================
/**
 * Excel and JSON Import/Export Utilities
 * Handles file operations for market data and other spreadsheet-based data
 */

import * as XLSX from 'xlsx';

/**
 * Column name mappings for Excel export/import
 */
const COLUMN_MAPPINGS = {
    // English to Turkish (for export)
    toTurkish: {
        name: 'E≈üya Adƒ±',
        price: 'Fiyat',
        originalId: 'ID'
    },
    // Turkish to English (for import)
    toEnglish: {
        'E≈üya Adƒ±': 'name',
        'Fiyat': 'price',
        'ID': 'originalId'
    }
};

/**
 * Export data to Excel or JSON file
 * @param {Array} data - Array of objects to export
 * @param {string} filename - Name of the file (without extension)
 * @param {string} format - 'excel' or 'json'
 */
export async function exportToFile(data, filename, format = 'excel') {
    try {
        if (!data || data.length === 0) {
            throw new Error('Dƒ±≈üa aktarƒ±lacak veri bulunamadƒ±.');
        }

        if (format === 'excel') {
            // Convert data to Turkish column names
            const translatedData = data.map(item => {
                const translated = {};
                Object.keys(item).forEach(key => {
                    const turkishKey = COLUMN_MAPPINGS.toTurkish[key] || key;
                    translated[turkishKey] = item[key];
                });
                return translated;
            });

            // Create worksheet
            const worksheet = XLSX.utils.json_to_sheet(translatedData);

            // Auto-size columns
            const maxWidth = 30;
            const colWidths = Object.keys(translatedData[0] || {}).map(key => ({
                wch: Math.min(
                    Math.max(
                        key.length,
                        ...translatedData.map(row => String(row[key] || '').length)
                    ),
                    maxWidth
                )
            }));
            worksheet['!cols'] = colWidths;

            // Create workbook and add worksheet
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, 'Veriler');

            // Generate Excel file and trigger download
            XLSX.writeFile(workbook, `${filename}.xlsx`);

        } else if (format === 'json') {
            // Create JSON blob
            const jsonString = JSON.stringify(data, null, 2);
            const blob = new Blob([jsonString], { type: 'application/json' });

            // Create download link and trigger
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `${filename}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);

        } else {
            throw new Error(`Desteklenmeyen format: ${format}`);
        }

        return { success: true, message: 'Dosya ba≈üarƒ±yla indirildi.' };

    } catch (error) {
        console.error('Export error:', error);
        return { success: false, message: error.message || 'Dƒ±≈üa aktarma sƒ±rasƒ±nda hata olu≈ütu.' };
    }
}

/**
 * Parse and import data from Excel or JSON file
 * @param {File} file - File object from input
 * @returns {Promise<Object>} - { success: boolean, data: Array, message: string }
 */
export async function parseImportFile(file) {
    try {
        if (!file) {
            throw new Error('Dosya se√ßilmedi.');
        }

        const fileName = file.name.toLowerCase();
        const fileExtension = fileName.split('.').pop();

        if (fileExtension === 'json') {
            // Parse JSON file
            return new Promise((resolve, reject) => {
                const reader = new FileReader();

                reader.onload = (e) => {
                    try {
                        const jsonData = JSON.parse(e.target.result);

                        if (!Array.isArray(jsonData)) {
                            throw new Error('JSON dosyasƒ± bir dizi i√ßermelidir.');
                        }

                        resolve({
                            success: true,
                            data: jsonData,
                            message: `${jsonData.length} kayƒ±t ba≈üarƒ±yla y√ºklendi.`
                        });
                    } catch (parseError) {
                        reject(new Error('JSON dosyasƒ± okunamadƒ±: ' + parseError.message));
                    }
                };

                reader.onerror = () => {
                    reject(new Error('Dosya okuma hatasƒ±.'));
                };

                reader.readAsText(file);
            });

        } else if (fileExtension === 'xlsx' || fileExtension === 'xls' || fileExtension === 'csv') {
            // Parse Excel/CSV file
            return new Promise((resolve, reject) => {
                const reader = new FileReader();

                reader.onload = (e) => {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });

                        // Get first sheet
                        const firstSheetName = workbook.SheetNames[0];
                        const worksheet = workbook.Sheets[firstSheetName];

                        // Convert to JSON
                        const jsonData = XLSX.utils.sheet_to_json(worksheet);

                        if (jsonData.length === 0) {
                            throw new Error('Excel dosyasƒ± bo≈ü.');
                        }

                        // Map Turkish column names back to English
                        const translatedData = jsonData.map(item => {
                            const translated = {};
                            Object.keys(item).forEach(key => {
                                const englishKey = COLUMN_MAPPINGS.toEnglish[key] || key;
                                translated[englishKey] = item[key];
                            });
                            return translated;
                        });

                        resolve({
                            success: true,
                            data: translatedData,
                            message: `${translatedData.length} kayƒ±t ba≈üarƒ±yla y√ºklendi.`
                        });
                    } catch (parseError) {
                        reject(new Error('Excel dosyasƒ± okunamadƒ±: ' + parseError.message));
                    }
                };

                reader.onerror = () => {
                    reject(new Error('Dosya okuma hatasƒ±.'));
                };

                reader.readAsArrayBuffer(file);
            });

        } else {
            throw new Error(`Desteklenmeyen dosya formatƒ±: .${fileExtension}\nSadece .json, .xlsx, .xls veya .csv dosyalarƒ± desteklenir.`);
        }

    } catch (error) {
        console.error('Import error:', error);
        return { success: false, data: [], message: error.message || 'ƒ∞√ße aktarma sƒ±rasƒ±nda hata olu≈ütu.' };
    }
}

// ============================================================================
// METIN LIST IMPORT/EXPORT
// ============================================================================

/**
 * Export metin list to Excel with flattened drop data
 * @param {Array} metinList - Array of metin objects with drops
 * @param {Array} marketItems - Market items for name lookup
 * @param {string} filename - Name of the file (without extension)
 */
export async function exportMetinsToExcel(metinList, marketItems, filename = 'metin-listesi') {
    try {
        if (!metinList || metinList.length === 0) {
            throw new Error('Dƒ±≈üa aktarƒ±lacak metin bulunamadƒ±.');
        }

        // Flatten data: one row per drop
        const flattenedData = [];

        metinList.forEach(metin => {
            if (metin.drops && metin.drops.length > 0) {
                metin.drops.forEach(drop => {
                    // Find item name from market items
                    const item = marketItems.find(i => i.originalId === drop.itemId);
                    const itemName = item ? item.name : drop.itemId;

                    flattenedData.push({
                        'Metin Adƒ±': metin.name,
                        'HP': metin.hp,
                        'E≈üya Adƒ±': itemName,
                        'Adet': drop.count,
                        '≈ûans': drop.chance
                    });
                });
            } else {
                // Metin with no drops - add one row with empty drop data
                flattenedData.push({
                    'Metin Adƒ±': metin.name,
                    'HP': metin.hp,
                    'E≈üya Adƒ±': '',
                    'Adet': 0,
                    '≈ûans': 0
                });
            }
        });

        // Create worksheet
        const worksheet = XLSX.utils.json_to_sheet(flattenedData);

        // Auto-size columns
        const colWidths = [
            { wch: 20 }, // Metin Adƒ±
            { wch: 12 }, // HP
            { wch: 25 }, // E≈üya Adƒ±
            { wch: 8 },  // Adet
            { wch: 8 }   // ≈ûans
        ];
        worksheet['!cols'] = colWidths;

        // Create workbook and add worksheet
        const workbook = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(workbook, worksheet, 'Metin Listesi');

        // Generate Excel file and trigger download
        XLSX.writeFile(workbook, `${filename}.xlsx`);

        return { success: true, message: 'Metin listesi ba≈üarƒ±yla indirildi.' };

    } catch (error) {
        console.error('Metin export error:', error);
        return { success: false, message: error.message || 'Metin dƒ±≈üa aktarma sƒ±rasƒ±nda hata olu≈ütu.' };
    }
}

/**
 * Parse and import metin list from Excel or JSON file
 * Groups rows by metin name and detects new items
 * @param {File} file - File object from input
 * @returns {Promise<Object>} - { success: boolean, metinList: Array, detectedItems: Array, message: string }
 */
export async function parseMetinImport(file) {
    try {
        if (!file) {
            throw new Error('Dosya se√ßilmedi.');
        }

        const fileName = file.name.toLowerCase();
        const fileExtension = fileName.split('.').pop();

        let rawData = [];

        // Read file based on extension
        if (fileExtension === 'json') {
            // Parse JSON file
            const result = await new Promise((resolve, reject) => {
                const reader = new FileReader();

                reader.onload = (e) => {
                    try {
                        const jsonData = JSON.parse(e.target.result);
                        if (!Array.isArray(jsonData)) {
                            throw new Error('JSON dosyasƒ± bir dizi i√ßermelidir.');
                        }
                        resolve(jsonData);
                    } catch (parseError) {
                        reject(new Error('JSON dosyasƒ± okunamadƒ±: ' + parseError.message));
                    }
                };

                reader.onerror = () => reject(new Error('Dosya okuma hatasƒ±.'));
                reader.readAsText(file);
            });

            rawData = result;

        } else if (fileExtension === 'xlsx' || fileExtension === 'xls' || fileExtension === 'csv') {
            // Parse Excel/CSV file
            const result = await new Promise((resolve, reject) => {
                const reader = new FileReader();

                reader.onload = (e) => {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });

                        // Get first sheet
                        const firstSheetName = workbook.SheetNames[0];
                        const worksheet = workbook.Sheets[firstSheetName];

                        // Convert to JSON
                        const jsonData = XLSX.utils.sheet_to_json(worksheet);

                        if (jsonData.length === 0) {
                            throw new Error('Excel dosyasƒ± bo≈ü.');
                        }

                        resolve(jsonData);
                    } catch (parseError) {
                        reject(new Error('Excel dosyasƒ± okunamadƒ±: ' + parseError.message));
                    }
                };

                reader.onerror = () => reject(new Error('Dosya okuma hatasƒ±.'));
                reader.readAsArrayBuffer(file);
            });

            rawData = result;

        } else {
            throw new Error(`Desteklenmeyen dosya formatƒ±: .${fileExtension}\nSadece .json, .xlsx, .xls veya .csv dosyalarƒ± desteklenir.`);
        }

        // Group rows by metin name and detect items
        const metinMap = new Map();
        const detectedItemsMap = new Map();

        rawData.forEach(row => {
            const metinName = row['Metin Adƒ±'] || row.metinName || row.name;
            const hp = parseInt(row['HP'] || row.hp) || 100000;
            const itemName = row['E≈üya Adƒ±'] || row.itemName || row.item;
            const count = parseInt(row['Adet'] || row.count) || 1;
            const chance = parseFloat(row['≈ûans'] || row.chance) || 100;

            if (!metinName) {
                console.warn('Satƒ±rda metin adƒ± bulunamadƒ±, atlanƒ±yor:', row);
                return;
            }

            // Get or create metin entry
            if (!metinMap.has(metinName)) {
                metinMap.set(metinName, {
                    id: `metin-${crypto.randomUUID()}`,
                    name: metinName,
                    hp: hp,
                    drops: []
                });
            }

            const metin = metinMap.get(metinName);

            // Add drop if item name exists
            if (itemName && itemName.trim() !== '') {
                // Detect and register item
                if (!detectedItemsMap.has(itemName)) {
                    detectedItemsMap.set(itemName, {
                        originalName: itemName,
                        tempId: `temp-item-${crypto.randomUUID()}`,
                        icon: 'Circle'
                    });
                }

                const detectedItem = detectedItemsMap.get(itemName);

                // Add drop to metin
                metin.drops.push({
                    id: `drop-${crypto.randomUUID()}`,
                    itemId: detectedItem.tempId,
                    count: count,
                    chance: chance
                });
            }
        });

        // Convert maps to arrays
        const metinList = Array.from(metinMap.values());
        const detectedItems = Array.from(detectedItemsMap.values());

        return {
            success: true,
            metinList: metinList,
            detectedItems: detectedItems,
            message: `${metinList.length} metin ve ${detectedItems.length} benzersiz e≈üya y√ºklendi.`
        };

    } catch (error) {
        console.error('Metin import error:', error);
        return {
            success: false,
            metinList: [],
            detectedItems: [],
            message: error.message || 'Metin i√ße aktarma sƒ±rasƒ±nda hata olu≈ütu.'
        };
    }
}


==================================================
DOSYA YOLU: .\app\lib\marketUtils.js
==================================================
/**
 * ============================================================================
 * MARKET UTILITIES - Global Catalog + Profile Price Architecture
 * ============================================================================
 * 
 * Bu mod√ºl, "Global Katalog + Profil Fiyatƒ±" mimarisine tam uyumlu
 * yardƒ±mcƒ± fonksiyonlar saƒülar.
 */

/**
 * Global item kataloƒüu ile se√ßili profildeki fiyatlarƒ± birle≈ütirir.
 * 
 * @param {Array} registry - Global item kataloƒüu (t√ºm item tanƒ±mlarƒ±)
 * @param {Object} priceMap - Se√ßili profildeki fiyat objesi { itemId: price }
 * @returns {Array} Birle≈ütirilmi≈ü market verileri
 * 
 * @example
 * const registry = [
 *   { id: '1', name: 'Kƒ±lƒ±√ß', category: 'silah' },
 *   { id: '2', name: 'Kalkan', category: 'zƒ±rh' }
 * ];
 * const priceMap = { '1': 5000, '2': 3000 };
 * const merged = mergeMarketData(registry, priceMap);
 * // Result: [
 * //   { id: '1', name: 'Kƒ±lƒ±√ß', category: 'silah', price: 5000, originalId: '1' },
 * //   { id: '2', name: 'Kalkan', category: 'zƒ±rh', price: 3000, originalId: '2' }
 * // ]
 */
export function mergeMarketData(registry, priceMap) {
    // G√ºvenlik: Bo≈ü registry gelirse bo≈ü dizi d√∂nd√ºr
    if (!registry || !Array.isArray(registry)) {
        console.warn('mergeMarketData: registry is empty or invalid');
        return [];
    }

    // G√ºvenlik: priceMap yoksa bo≈ü obje olarak kullan
    const safePriceMap = priceMap || {};

    // Registry'deki her item i√ßin fiyat bilgisini ekle
    return registry.map(item => ({
        ...item,
        price: safePriceMap[item.id] ?? 0, // Fiyat yoksa 0
        originalId: item.id // Calculator uyumluluƒüu i√ßin
    }));
}

/**
 * Excel'den gelen ham veriyi i≈üler, katalogla e≈üle≈ütirir ve sonu√ß √ºretir.
 * 
 * @param {Array} importedData - Excel'den gelen item listesi
 *   Market Import: [{name, price, category}]
 *   Metin Import: [{tempId, originalName}]
 * @param {Array} registry - Global item kataloƒüu
 * @returns {Object} { newRegistryItems, idMap }
 * 
 * @example
 * // Market Import
 * const importedData = [
 *   { name: 'Kƒ±lƒ±√ß', price: 5000, category: 'silah' },
 *   { name: 'Yeni Item', price: 2000, category: 'genel' }
 * ];
 * const result = syncLocalMarketItems(importedData, registry);
 * // Result: {
 * //   newRegistryItems: [{ id: 'uuid', name: 'Yeni Item', ... }],
 * //   idMap: { 'Kƒ±lƒ±√ß': 'existing-id', 'Yeni Item': 'uuid' }
 * // }
 * 
 * @example
 * // Metin Import
 * const importedData = [
 *   { tempId: 'temp-1', originalName: 'Efsun Nesnesi' }
 * ];
 * const result = syncLocalMarketItems(importedData, registry);
 * // Result: {
 * //   newRegistryItems: [],
 * //   idMap: { 'temp-1': 'existing-id' }
 * // }
 */
export function syncLocalMarketItems(importedData, registry) {
    const newRegistryItems = [];
    const idMap = {}; // TempID/Name -> RealID

    // G√ºvenlik: Bo≈ü veri gelirse i≈ülem yapma
    if (!importedData || !Array.isArray(importedData)) {
        console.warn('syncLocalMarketItems: importedData is empty or invalid');
        return { newRegistryItems: [], idMap: {} };
    }

    // G√ºvenlik: Registry yoksa bo≈ü dizi olarak kullan
    const safeRegistry = registry || [];

    // Her import edilen item'ƒ± i≈üle
    importedData.forEach((importedItem) => {
        // Determine the name field (supports both 'name' and 'originalName')
        const itemName = importedItem.originalName || importedItem.name;

        // G√ºvenlik: ƒ∞sim yoksa atla
        if (!itemName) {
            console.warn('syncLocalMarketItems: Skipping item without name', importedItem);
            return;
        }

        // 1. ƒ∞sim Normalizasyonu (B√ºy√ºk/K√º√ß√ºk harf ve bo≈üluk temizliƒüi)
        const cleanName = itemName.toString().trim().toLowerCase();

        // 2. Katalogda Ara
        let match = safeRegistry.find(
            (regItem) => regItem.name.trim().toLowerCase() === cleanName
        );

        // 3. Eƒüer katalogda yoksa, ≈üu an olu≈üturduƒüumuz "yeni eklenecekler" listesinde var mƒ±?
        // (Aynƒ± Excel i√ßinde m√ºkerrer kayƒ±t varsa engellemek i√ßin)
        if (!match) {
            match = newRegistryItems.find(
                (newItem) => newItem.name.trim().toLowerCase() === cleanName
            );
        }

        let itemId;
        const mapKey = importedItem.tempId || itemName; // Use tempId if available, otherwise use name

        if (match) {
            // E≈üle≈üme Var: Mevcut ID'yi kullan
            itemId = match.id;
            idMap[mapKey] = itemId;
        } else {
            // E≈üle≈üme Yok: Yeni Item Olu≈ütur
            itemId = crypto.randomUUID();
            newRegistryItems.push({
                id: itemId,
                originalId: null,
                name: itemName.trim(), // Orijinal yazƒ±mƒ± koru (√ñrn: "Zehir Kƒ±lƒ±cƒ±")
                category: importedItem.category || 'ithal',
                icon: 'Circle', // Varsayƒ±lan ikon
                isSystemItem: false
            });
            idMap[mapKey] = itemId;
        }
    });

    return { newRegistryItems, idMap };
}

/**
 * Validate merged market data
 * 
 * @param {Array} marketItems - Merged market items
 * @returns {boolean} True if valid
 */
export function validateMarketData(marketItems) {
    if (!marketItems || !Array.isArray(marketItems)) {
        console.error('validateMarketData: marketItems is not an array');
        return false;
    }

    const hasInvalidItems = marketItems.some(item => {
        if (!item.id || !item.name) {
            console.error('validateMarketData: Item missing id or name', item);
            return true;
        }
        if (typeof item.price !== 'number' || item.price < 0) {
            console.error('validateMarketData: Item has invalid price', item);
            return true;
        }
        return false;
    });

    return !hasInvalidItems;
}

/**
 * Get items by category from merged market data
 * 
 * @param {Array} marketItems - Merged market items
 * @param {string} category - Category to filter by
 * @returns {Array} Filtered items
 */
export function getItemsByCategory(marketItems, category) {
    if (!marketItems || !Array.isArray(marketItems)) {
        return [];
    }

    if (!category) {
        return marketItems;
    }

    return marketItems.filter(item => item.category === category);
}

/**
 * Search items by name
 * 
 * @param {Array} marketItems - Merged market items
 * @param {string} query - Search query
 * @returns {Array} Matching items
 */
export function searchItems(marketItems, query) {
    if (!marketItems || !Array.isArray(marketItems)) {
        return [];
    }

    if (!query || query.trim() === '') {
        return marketItems;
    }

    const cleanQuery = query.trim().toLowerCase();

    return marketItems.filter(item =>
        item.name.toLowerCase().includes(cleanQuery)
    );
}


==================================================
DOSYA YOLU: .\app\store\constants.js
==================================================
/**
 * ============================================================================
 * WIDGET REGISTRY - Sabit Widget Tanƒ±mlarƒ±
 * ============================================================================
 * 
 * Bu dosya, uygulamadaki t√ºm widget tiplerinin katalogunu i√ßerir.
 * Her widget i√ßin ba≈ülƒ±k, ikon ve varsayƒ±lan veri yapƒ±sƒ± tanƒ±mlanmƒ±≈ütƒ±r.
 */

import { initialMetinList } from "../data/initialData";

export const WIDGET_REGISTRY = {
    "market-prices": {
        title: "Piyasa Fiyatlarƒ±",
        icon: "Coins",
        defaultData: { prices: {} },
        description: "E≈üya fiyatlarƒ±nƒ± g√∂r√ºnt√ºle ve d√ºzenle"
    },
    "character-stats": {
        title: "Karakterim",
        icon: "Sword",
        defaultData: {
            damage: 5000,
            hitsPerSecond: 2.5,
            findTime: 10
        },
        description: "Karakter istatistiklerini y√∂net"
    },
    "metin-settings": {
        title: "Metin Ayarlarƒ±",
        icon: "Settings",
        defaultData: {
            metins: initialMetinList
        },
        description: "Metin HP ve drop ayarlarƒ±nƒ± d√ºzenle"
    },
    "analysis-tool": {
        title: "Analiz & Sim√ºlasyon",
        icon: "Calculator",
        defaultData: {},
        description: "Karlƒ±lƒ±k analizi ve farming stratejisi"
    },
    "damage-progression": {
        title: "Hasar Yol Haritasƒ±",
        icon: "Map",
        defaultData: {},
        description: "Hasarƒ±nƒ±za g√∂re en verimli metin b√∂lgelerini g√∂sterir."
    },
    "market-supply": {
        title: "Piyasa Arzƒ±",
        icon: "Package",
        defaultData: {},
        description: "Ki≈üisel ve sunucu geneli e≈üya birikim sim√ºlasyonu"
    },
    "crafting-manager": {
        title: "√úretim & Boss",
        icon: "Hammer",
        defaultData: { items: [] },
        description: "D√∂n√º≈ü√ºm re√ßeteleri ve boss sandƒ±k i√ßeriklerini y√∂netin."
    },
};


==================================================
DOSYA YOLU: .\app\store\useWidgetStore.js
==================================================
"use client";

import { create } from "zustand";
import { persist } from "zustand/middleware";
import { immer } from "zustand/middleware/immer";

// Slice'larƒ± i√ße aktar
import { createUISlice } from "./slices/createUISlice";
import { createMarketSlice } from "./slices/createMarketSlice";
import { createCraftingSlice } from "./slices/createCraftingSlice";

// Sabitleri i√ße aktar (Eƒüer app/store/constants.js olu≈üturmadƒ±ysan, WIDGET_REGISTRY'yi app/data/constants.js yolundan alabilirsin)
// Not: Eƒüer constants dosyan yoksa bu satƒ±rƒ± kontrol et.
import { WIDGET_REGISTRY } from "../store/constants";

// ============================================================================
// STORE OLU≈ûTURMA (Slice Pattern)
// ============================================================================
const useWidgetStore = create(
  persist(
    immer((...a) => ({
      ...createUISlice(...a),
      ...createMarketSlice(...a),
      ...createCraftingSlice(...a),
    })),
    {
      name: "financial-dashboard-storage", // LocalStorage Key
      version: 4, // √ñNEMLƒ∞: Versiyon 4'e ge√ßtik, crafting slice eklendi.

      // Migration: Versiyon deƒüi≈üirse state'i temizle
      migrate: (persistedState, version) => {
        if (version < 4) {
          return persistedState; // Eski veriyi koru, yeni alanlar otomatik eklenecek
        }
        return persistedState;
      },
    }
  )
);

// ============================================================================
// HELPER HOOKS (Geriye D√∂n√ºk Uyumluluk - Componentler Kƒ±rƒ±lmasƒ±n Diye)
// ============================================================================

/**
 * Verilen widget tipine g√∂re Registry'den tanƒ±m d√∂nd√ºr√ºr
 */
export const useWidgetDefinition = (type) => {
  return WIDGET_REGISTRY[type] || null;
};

/**
 * Aktif workspace'i d√∂nd√ºr√ºr
 */
export const useActiveWorkspace = () => {
  return useWidgetStore((state) => {
    const activeId = state.activeWorkspaceId;
    return state.workspaces.find((ws) => ws.id === activeId);
  });
};

/**
 * Aktif workspace'teki g√∂r√ºn√ºr widget'larƒ± d√∂nd√ºr√ºr
 */
export const useVisibleWidgets = () => {
  return useWidgetStore((state) => {
    const activeWorkspace = state.workspaces.find(
      (ws) => ws.id === state.activeWorkspaceId
    );
    return activeWorkspace?.widgets.filter((w) => w.isVisible) || [];
  });
};

/**
 * Aktif workspace'teki gizli widget'larƒ± d√∂nd√ºr√ºr
 */
export const useHiddenWidgets = () => {
  return useWidgetStore((state) => {
    const activeWorkspace = state.workspaces.find(
      (ws) => ws.id === state.activeWorkspaceId
    );
    return activeWorkspace?.widgets.filter((w) => !w.isVisible) || [];
  });
};

/**
 * T√ºm workspace'leri d√∂nd√ºr√ºr
 */
export const useWorkspaces = () => {
  return useWidgetStore((state) => state.workspaces);
};

/**
 * Aktif workspace ID'sini d√∂nd√ºr√ºr
 */
export const useActiveWorkspaceId = () => {
  return useWidgetStore((state) => state.activeWorkspaceId);
};

// ============================================================================
// EXPORTS
// ============================================================================
export { WIDGET_REGISTRY };
export default useWidgetStore;


==================================================
DOSYA YOLU: .\app\store\slices\createCraftingSlice.js
==================================================
/**
 * Crafting Slice - √úretim, Boss Sandƒ±klarƒ± ve D√∂n√º≈ü√ºm Zincirleri
 * 
 * Bu slice, oyun i√ßi crafting sistemini y√∂netir:
 * - 'recipe' tipi: Re√ßete (X + Y = Z)
 * - 'container' tipi: Sandƒ±k/Boss (ƒ∞√ßinden %X ≈üansla Y √ßƒ±kar)
 */
export const createCraftingSlice = (set) => ({
    craftingItems: [],

    /**
     * Yeni bo≈ü bir crafting √∂ƒüesi olu≈üturur
     * @param {string} name - √ñƒüenin adƒ± (√ñrn: "Azrail Sandƒ±ƒüƒ±")
     * @param {'recipe'|'container'} type - √ñƒüe tipi
     */
    addCraftingItem: (name, type) =>
        set((state) => {
            const newItem = {
                id: crypto.randomUUID(),
                name: name || 'Yeni √ñƒüe',
                type: type || 'recipe',
                contents: [],
            };
            state.craftingItems.push(newItem);
        }),

    /**
     * Crafting √∂ƒüesini siler
     * @param {string} id - Silinecek √∂ƒüenin ID'si
     */
    removeCraftingItem: (id) =>
        set((state) => {
            const index = state.craftingItems.findIndex((item) => item.id === id);
            if (index !== -1) {
                state.craftingItems.splice(index, 1);
            }
        }),

    /**
     * Crafting √∂ƒüesini g√ºnceller (isim, tip vb.)
     * @param {string} id - G√ºncellenecek √∂ƒüenin ID'si
     * @param {object} updates - G√ºncellenecek alanlar (name, type vb.)
     */
    updateCraftingItem: (id, updates) =>
        set((state) => {
            const item = state.craftingItems.find((item) => item.id === id);
            if (item) {
                Object.assign(item, updates);
            }
        }),

    /**
     * Bir crafting √∂ƒüesinin i√ßine hammadde/i√ßerik ekler
     * @param {string} parentId - Ana √∂ƒüenin ID'si
     * @param {object} content - Eklenecek i√ßerik
     * @param {string} content.itemId - Baƒülanan e≈üyanƒ±n ID'si
     * @param {'market'|'crafting'} content.sourceType - Kaynak tipi (market veya crafting)
     * @param {number} content.count - Adet
     * @param {number} content.chance - ≈ûans (0-100 arasƒ±, container i√ßin)
     */
    addContentToItem: (parentId, content) =>
        set((state) => {
            const parentItem = state.craftingItems.find((item) => item.id === parentId);
            if (parentItem) {
                const newContent = {
                    id: crypto.randomUUID(),
                    itemId: content.itemId,
                    sourceType: content.sourceType || 'market', // 'market' veya 'crafting'
                    count: content.count || 1,
                    chance: content.chance || 100, // Container i√ßin ≈üans (%)
                };
                parentItem.contents.push(newContent);
            }
        }),

    /**
     * Bir crafting √∂ƒüesinden hammadde/i√ßerik siler
     * @param {string} parentId - Ana √∂ƒüenin ID'si
     * @param {string} contentId - Silinecek i√ßeriƒüin ID'si
     */
    removeContentFromItem: (parentId, contentId) =>
        set((state) => {
            const parentItem = state.craftingItems.find((item) => item.id === parentId);
            if (parentItem) {
                const index = parentItem.contents.findIndex((c) => c.id === contentId);
                if (index !== -1) {
                    parentItem.contents.splice(index, 1);
                }
            }
        }),

    /**
     * Bir crafting √∂ƒüesinin i√ßeriƒüini g√ºnceller (adet, ≈üans vb.)
     * @param {string} parentId - Ana √∂ƒüenin ID'si
     * @param {string} contentId - G√ºncellenecek i√ßeriƒüin ID'si
     * @param {object} updates - G√ºncellenecek alanlar (count, chance vb.)
     */
    updateContentInItem: (parentId, contentId, updates) =>
        set((state) => {
            const parentItem = state.craftingItems.find((item) => item.id === parentId);
            if (parentItem) {
                const content = parentItem.contents.find((c) => c.id === contentId);
                if (content) {
                    Object.assign(content, updates);
                }
            }
        }),
});


==================================================
DOSYA YOLU: .\app\store\slices\createMarketSlice.js
==================================================
import { MASTER_REGISTRY, INITIAL_SERVERS } from "../../data/initialData";

export const createMarketSlice = (set, get) => ({
    // --- STATE ---
    masterRegistry: MASTER_REGISTRY.items, // Global Katalog
    serverProfiles: INITIAL_SERVERS,       // Sunucu Listesi
    activeServerId: INITIAL_SERVERS[0]?.id || "server_marmara", // Se√ßili Sunucu

    // --- ACTIONS ---

    // 1. Sunucu Y√∂netimi
    setActiveServer: (serverId) => set((state) => {
        const exists = state.serverProfiles.some(p => p.id === serverId);
        if (exists) state.activeServerId = serverId;
    }),

    addServerProfile: (name) => set((state) => {
        state.serverProfiles.push({
            id: `server_${Date.now()}`,
            name: name,
            currency: "Won",
            prices: {},
            multipliers: { drop: 1.0 }
        });
    }),

    // 2. Fiyat Y√∂netimi (Sadece Aktif Sunucuya Yazar)
    updatePrice: (itemId, newPrice) => set((state) => {
        const activeProfile = state.serverProfiles.find(p => p.id === state.activeServerId);
        if (activeProfile) {
            activeProfile.prices[itemId] = parseFloat(newPrice) || 0;
        }
    }),

    // 3. Katalog Y√∂netimi (Yeni Item Ekleme)
    registerItem: (item) => set((state) => {
        const generatedId = item.id || item.name.toLowerCase().trim().replace(/\s+/g, '_');
        const exists = state.masterRegistry.some(i => i.id === generatedId);

        if (!exists) {
            state.masterRegistry.push({
                id: generatedId,
                name: item.name,
                category: item.category || "genel",
                icon: item.icon || "Circle",
                isSystemItem: false
            });
        }
    }),
});


==================================================
DOSYA YOLU: .\app\store\slices\createUISlice.js
==================================================
import { WIDGET_REGISTRY } from "../constants";

export const createUISlice = (set, get) => ({
    // State
    activeWorkspaceId: "default-workspace",
    isPerformanceMode: false,
    workspaces: [
        {
            id: "default-workspace",
            name: "Ana Panel",
            activeMarketProfileId: "default-profile", // Default profile selection
            widgets: [
                {
                    id: "default-money-input-widget",
                    type: "money-input",
                    isVisible: true,
                    data: { amount: "" },
                },
                {
                    id: "default-note-taker-widget",
                    type: "note-taker",
                    isVisible: true,
                    data: { notes: "" },
                },
            ],
        },
    ],

    // Actions
    addWorkspace: (name) =>
        set((state) => {
            // Get the first available market profile ID
            const defaultProfileId = state.marketProfiles?.[0]?.id || "default-profile";

            const newWorkspace = {
                id: crypto.randomUUID(),
                name: name || "Yeni Panel",
                activeMarketProfileId: defaultProfileId, // Assign default profile
                widgets: [],
            };
            state.workspaces.push(newWorkspace);
            state.activeWorkspaceId = newWorkspace.id;
        }),

    switchWorkspace: (id) =>
        set((state) => {
            state.activeWorkspaceId = id;
        }),

    renameWorkspace: (workspaceId, newName) =>
        set((state) => {
            const workspace = state.workspaces.find((ws) => ws.id === workspaceId);
            if (workspace) {
                workspace.name = newName;
            }
        }),

    removeWorkspace: (workspaceId) =>
        set((state) => {
            if (state.workspaces.length <= 1) {
                console.warn("Son workspace silinemez!");
                return;
            }
            const workspaceIndex = state.workspaces.findIndex((ws) => ws.id === workspaceId);
            if (workspaceIndex === -1) return;

            if (state.activeWorkspaceId === workspaceId) {
                const newActiveIndex = workspaceIndex === state.workspaces.length - 1
                    ? workspaceIndex - 1
                    : workspaceIndex + 1;
                state.activeWorkspaceId = state.workspaces[newActiveIndex].id;
            }
            state.workspaces.splice(workspaceIndex, 1);
        }),

    addWidget: (type) =>
        set((state) => {
            if (!WIDGET_REGISTRY[type]) {
                console.error(`Widget tipi "${type}" registry'de bulunamadƒ±!`);
                return;
            }
            const activeWorkspace = state.workspaces.find(
                (ws) => ws.id === state.activeWorkspaceId
            );
            if (activeWorkspace) {
                const defaultData = { ...WIDGET_REGISTRY[type].defaultData };
                activeWorkspace.widgets.push({
                    id: crypto.randomUUID(),
                    type,
                    isVisible: true,
                    data: defaultData,
                });
            }
        }),

    removeWidget: (widgetId) =>
        set((state) => {
            const activeWorkspace = state.workspaces.find(
                (ws) => ws.id === state.activeWorkspaceId
            );
            if (activeWorkspace) {
                const index = activeWorkspace.widgets.findIndex((w) => w.id === widgetId);
                if (index !== -1) {
                    activeWorkspace.widgets.splice(index, 1);
                }
            }
        }),

    toggleWidgetVisibility: (widgetId) =>
        set((state) => {
            const activeWorkspace = state.workspaces.find(
                (ws) => ws.id === state.activeWorkspaceId
            );
            const widget = activeWorkspace?.widgets.find((w) => w.id === widgetId);
            if (widget) {
                widget.isVisible = !widget.isVisible;
            }
        }),

    updateWidgetData: (widgetId, partialData) =>
        set((state) => {
            const activeWorkspace = state.workspaces.find(
                (ws) => ws.id === state.activeWorkspaceId
            );
            const widget = activeWorkspace?.widgets.find((w) => w.id === widgetId);
            if (widget) {
                widget.data = { ...widget.data, ...partialData };
            }
        }),

    togglePerformanceMode: () =>
        set((state) => {
            state.isPerformanceMode = !state.isPerformanceMode;
        }),

    /**
     * Set the active market profile for a workspace
     * @param {string} workspaceId - Workspace ID
     * @param {string} profileId - Market profile ID
     */
    setWorkspaceMarketProfile: (workspaceId, profileId) =>
        set((state) => {
            const workspace = state.workspaces.find((ws) => ws.id === workspaceId);
            if (workspace) {
                workspace.activeMarketProfileId = profileId;
            }
        }),
});


==================================================
DOSYA YOLU: .\_eski_drop\eslint.config.js
==================================================
import js from '@eslint/js'
import globals from 'globals'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import { defineConfig, globalIgnores } from 'eslint/config'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{js,jsx}'],
    extends: [
      js.configs.recommended,
      reactHooks.configs.flat.recommended,
      reactRefresh.configs.vite,
    ],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
      parserOptions: {
        ecmaVersion: 'latest',
        ecmaFeatures: { jsx: true },
        sourceType: 'module',
      },
    },
    rules: {
      'no-unused-vars': ['error', { varsIgnorePattern: '^[A-Z_]' }],
    },
  },
])


==================================================
DOSYA YOLU: .\_eski_drop\index.html
==================================================
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>crystal-rosette</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>


==================================================
DOSYA YOLU: .\_eski_drop\metin2_drop_sim.html
==================================================
<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Metin2 Drop Sim√ºlat√∂r√º</title>
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        :root {
            --bg-dark: #1a1a2e;
            --bg-card: #16213e;
            --primary: #e94560;
            --text-main: #ffffff;
            --text-muted: #a0a0a0;
            --border: #0f3460;
            --accent: #533483;
            --success: #4caf50;
            --danger: #f44336;
            --font-main: 'Inter', sans-serif;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            background-color: var(--bg-dark);
            color: var(--text-main);
            font-family: var(--font-main);
            line-height: 1.6;
        }

        #root {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            width: 100%;
        }

        /* Header & Navigation */
        header {
            background-color: var(--bg-card);
            padding: 20px 0;
            border-bottom: 2px solid var(--border);
            margin-bottom: 30px;
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }

        .nav-btn {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-muted);
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.3s ease;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .nav-btn:hover {
            background: rgba(233, 69, 96, 0.1);
            color: var(--primary);
            border-color: var(--primary);
        }

        .nav-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            box-shadow: 0 0 15px rgba(233, 69, 96, 0.4);
        }

        /* Cards & Layout */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .card {
            background-color: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            transition: transform 0.2s;
        }

        .card:hover {
            transform: translateY(-2px);
            border-color: var(--primary);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            border-bottom: 1px solid var(--border);
            padding-bottom: 10px;
        }

        .card-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary);
        }

        /* Forms & Inputs */
        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        input[type="number"],
        input[type="text"] {
            width: 100%;
            padding: 10px;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-main);
            font-size: 1rem;
        }

        input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(233, 69, 96, 0.2);
        }

        /* Tables */
        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th,
        td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        th {
            color: var(--primary);
            font-weight: 600;
        }

        tr:hover {
            background-color: rgba(255, 255, 255, 0.02);
        }

        /* Utilities */
        .text-primary {
            color: var(--primary);
        }

        .text-success {
            color: var(--success);
        }

        .text-center {
            text-align: center;
        }

        .mt-4 {
            margin-top: 2rem;
        }

        .mb-4 {
            margin-bottom: 2rem;
        }

        .flex-between {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: opacity 0.2s;
        }

        .btn:hover {
            opacity: 0.9;
        }

        .btn-sm {
            padding: 4px 8px;
            font-size: 0.8rem;
        }

        .badge {
            background: var(--accent);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            color: white;
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- DATA ---
        const initialItems = [
            { id: "yefsun", name: "Efsun Nesnesi (Ye≈üil)", price: 3000000 },
            { id: "yart", name: "Arttƒ±rma Kaƒüƒ±dƒ± (Ye≈üil)", price: 1500000 },
            { id: "efsun", name: "Efsun Nesnesi", price: 6000000 },
            { id: "art", name: "Arttƒ±rma Kaƒüƒ±dƒ±", price: 800000 },
            { id: "tas", name: "Ruh Ta≈üƒ±", price: 5000000 },
            { id: "cor", name: "Cor Draconis", price: 25000000 },
            { id: "munzevi", name: "M√ºnzevi Tavsiyesi", price: 40000000 },
            { id: "zen", name: "Zen Fasulyesi", price: 80000000 },
            { id: "enerji", name: "Enerji Par√ßasƒ±", price: 450000 }
        ];

        const initialMetins = [
            {
                name: "Ruh Metni", hp: 119700,
                drops: [
                    { itemId: "yefsun", count: 4, chance: 100 },
                    { itemId: "yart", count: 2, chance: 100 },
                    { itemId: "munzevi", count: 1, chance: 25 },
                    { itemId: "zen", count: 1, chance: 15 }
                ]
            },
            {
                name: "G√∂lge Metni", hp: 142350,
                drops: [
                    { itemId: "yefsun", count: 1, chance: 100 },
                    { itemId: "yart", count: 1, chance: 100 },
                    { itemId: "efsun", count: 1, chance: 100 },
                    { itemId: "art", count: 1, chance: 100 },
                    { itemId: "munzevi", count: 1, chance: 25 }
                ]
            },
            {
                name: "≈ûeytan Metni", hp: 195900,
                drops: [
                    { itemId: "yefsun", count: 1, chance: 100 },
                    { itemId: "yart", count: 1, chance: 100 },
                    { itemId: "efsun", count: 1, chance: 100 },
                    { itemId: "art", count: 1, chance: 100 },
                    { itemId: "cor", count: 1, chance: 10 },
                    { itemId: "munzevi", count: 1, chance: 25 }
                ]
            },
            {
                name: "√ñl√ºm Metni", hp: 260250,
                drops: [
                    { itemId: "yefsun", count: 2, chance: 100 },
                    { itemId: "yart", count: 2, chance: 100 },
                    { itemId: "efsun", count: 2, chance: 100 },
                    { itemId: "art", count: 2, chance: 100 },
                    { itemId: "cor", count: 1, chance: 20 },
                    { itemId: "munzevi", count: 1, chance: 60 },
                    { itemId: "zen", count: 1, chance: 15 }
                ]
            },
            {
                name: "Katil Metni", hp: 296550,
                drops: [
                    { itemId: "yefsun", count: 2, chance: 100 },
                    { itemId: "yart", count: 2, chance: 100 },
                    { itemId: "efsun", count: 2, chance: 100 },
                    { itemId: "art", count: 2, chance: 100 },
                    { itemId: "cor", count: 1, chance: 10 },
                    { itemId: "munzevi", count: 1, chance: 25 },
                    { itemId: "zen", count: 1, chance: 15 }
                ]
            },
            {
                name: "B√ºy√ºl√º Metin", hp: 1500000,
                drops: [
                    { itemId: "efsun", count: 9, chance: 100 },
                    { itemId: "cor", count: 1, chance: 50 },
                    { itemId: "zen", count: 1, chance: 15 }
                ]
            }
        ];

        // --- COMPONENTS ---

        function CharacterStats({ stats, setStats }) {
            const handleChange = (e) => {
                const { name, value } = e.target;
                setStats(prev => ({
                    ...prev,
                    [name]: parseFloat(value) || 0
                }));
            };

            return (
                <div className="card">
                    <div className="card-header">
                        <h3 className="card-title">Karakter ƒ∞statistikleri</h3>
                    </div>
                    <div className="grid">
                        <div className="form-group">
                            <label>Ortalama Hasar (Vuru≈ü Ba≈üƒ±na)</label>
                            <input
                                type="number"
                                name="damage"
                                value={stats.damage}
                                onChange={handleChange}
                                min="1"
                            />
                        </div>
                        <div className="form-group">
                            <label>Saniye Ba≈üƒ±na Vuru≈ü (Saldƒ±rƒ± Hƒ±zƒ±)</label>
                            <input
                                type="number"
                                name="hitsPerSecond"
                                value={stats.hitsPerSecond}
                                onChange={handleChange}
                                step="0.1"
                                min="0.1"
                            />
                        </div>
                        <div className="form-group">
                            <label>Metin Bulma S√ºresi (Saniye)</label>
                            <input
                                type="number"
                                name="findTime"
                                value={stats.findTime}
                                onChange={handleChange}
                                min="0"
                            />
                        </div>
                    </div>
                </div>
            );
        }

        function ItemEditor({ items, setItems }) {
            const handlePriceChange = (id, newPrice) => {
                setItems(prev => prev.map(item =>
                    item.id === id ? { ...item, price: parseFloat(newPrice) || 0 } : item
                ));
            };

            const formatPrice = (price) => {
                return new Intl.NumberFormat('tr-TR').format(price);
            };

            return (
                <div className="card">
                    <div className="card-header">
                        <h3 className="card-title">E≈üya Fiyatlarƒ±</h3>
                    </div>
                    <div className="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>E≈üya Adƒ±</th>
                                    <th>Birim Fiyat (Yang)</th>
                                    <th>D√ºzenle</th>
                                </tr>
                            </thead>
                            <tbody>
                                {items.map(item => (
                                    <tr key={item.id}>
                                        <td>{item.name}</td>
                                        <td>{formatPrice(item.price)}</td>
                                        <td>
                                            <input
                                                type="number"
                                                value={item.price}
                                                onChange={(e) => handlePriceChange(item.id, e.target.value)}
                                                style={{ width: '150px' }}
                                            />
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        }

        function MetinCard({ metin, mIndex, items, onHpChange, onDropChange, onRemoveDrop, onAddDrop }) {
            const [selectedItemId, setSelectedItemId] = useState(items[0]?.id || '');

            const getItemName = (id) => {
                const item = items.find(i => i.id === id);
                return item ? item.name : id;
            };

            const handleAddClick = () => {
                if (selectedItemId) {
                    onAddDrop(mIndex, selectedItemId);
                }
            };

            return (
                <div className="card">
                    <div className="card-header">
                        <h3 className="card-title">{metin.name}</h3>
                        <div className="badge">HP: {new Intl.NumberFormat('tr-TR').format(metin.hp)}</div>
                    </div>

                    <div className="form-group">
                        <label>Metin Canƒ± (HP)</label>
                        <input
                            type="number"
                            value={metin.hp}
                            onChange={(e) => onHpChange(mIndex, e.target.value)}
                        />
                    </div>

                    <div className="table-container">
                        <label style={{ marginBottom: '10px', display: 'block' }}>D√º≈üen E≈üyalar</label>
                        <table style={{ fontSize: '0.9rem' }}>
                            <thead>
                                <tr>
                                    <th>E≈üya</th>
                                    <th>Adet</th>
                                    <th>% ≈ûans</th>
                                    <th style={{ width: '40px' }}></th>
                                </tr>
                            </thead>
                            <tbody>
                                {metin.drops.map((drop, dIndex) => (
                                    <tr key={dIndex}>
                                        <td>{getItemName(drop.itemId)}</td>
                                        <td>
                                            <input
                                                type="number"
                                                value={drop.count}
                                                onChange={(e) => onDropChange(mIndex, dIndex, 'count', e.target.value)}
                                                style={{ width: '60px', padding: '5px' }}
                                            />
                                        </td>
                                        <td>
                                            <input
                                                type="number"
                                                value={drop.chance}
                                                onChange={(e) => onDropChange(mIndex, dIndex, 'chance', e.target.value)}
                                                style={{ width: '60px', padding: '5px' }}
                                                max="100"
                                            />
                                        </td>
                                        <td>
                                            <button
                                                className="btn btn-sm"
                                                style={{ backgroundColor: 'var(--danger)', padding: '5px 10px' }}
                                                onClick={() => onRemoveDrop(mIndex, dIndex)}
                                                title="Sil"
                                            >
                                                ‚úï
                                            </button>
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>

                    {/* Add New Item Section */}
                    <div style={{ marginTop: '15px', padding: '10px', backgroundColor: 'rgba(255,255,255,0.03)', borderRadius: '6px' }}>
                        <label style={{ fontSize: '0.85rem', marginBottom: '8px' }}>Yeni E≈üya Ekle</label>
                        <div style={{ display: 'flex', gap: '10px' }}>
                            <select
                                value={selectedItemId}
                                onChange={(e) => setSelectedItemId(e.target.value)}
                                style={{
                                    flex: 1,
                                    padding: '8px',
                                    backgroundColor: 'var(--bg-dark)',
                                    border: '1px solid var(--border)',
                                    color: 'var(--text-main)',
                                    borderRadius: '4px'
                                }}
                            >
                                {items.map(item => (
                                    <option key={item.id} value={item.id}>
                                        {item.name}
                                    </option>
                                ))}
                            </select>
                            <button
                                className="btn btn-sm"
                                onClick={handleAddClick}
                                style={{ backgroundColor: 'var(--success)' }}
                            >
                                Ekle
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        function MetinEditor({ metins, setMetins, items }) {
            const handleHpChange = (metinIndex, newHp) => {
                const newMetins = [...metins];
                newMetins[metinIndex].hp = parseFloat(newHp) || 0;
                setMetins(newMetins);
            };

            const handleDropChange = (metinIndex, dropIndex, field, value) => {
                const newMetins = [...metins];
                newMetins[metinIndex].drops[dropIndex][field] = parseFloat(value) || 0;
                setMetins(newMetins);
            };

            const handleRemoveDrop = (metinIndex, dropIndex) => {
                const newMetins = [...metins];
                newMetins[metinIndex].drops.splice(dropIndex, 1);
                setMetins(newMetins);
            };

            const handleAddDrop = (metinIndex, itemId) => {
                const newMetins = [...metins];
                // Optional: Check if item already exists
                const exists = newMetins[metinIndex].drops.some(d => d.itemId === itemId);
                if (exists) {
                    alert("Bu e≈üya zaten bu metinde ekli!");
                    return;
                }

                newMetins[metinIndex].drops.push({
                    itemId: itemId,
                    count: 1,
                    chance: 10
                });
                setMetins(newMetins);
            };

            return (
                <div className="grid">
                    {metins.map((metin, mIndex) => (
                        <MetinCard
                            key={mIndex}
                            metin={metin}
                            mIndex={mIndex}
                            items={items}
                            onHpChange={handleHpChange}
                            onDropChange={handleDropChange}
                            onRemoveDrop={handleRemoveDrop}
                            onAddDrop={handleAddDrop}
                        />
                    ))}
                </div>
            );
        }

        function Dashboard({ items, metins, stats }) {
            const calculations = useMemo(() => {
                return metins.map(metin => {
                    // 1. Calculate Total Drop Value per Metin
                    let totalDropValue = 0;
                    metin.drops.forEach(drop => {
                        const item = items.find(i => i.id === drop.itemId);
                        if (item) {
                            // Expected value = Price * Count * (Chance / 100)
                            totalDropValue += item.price * drop.count * (drop.chance / 100);
                        }
                    });

                    // 2. Calculate Time to Kill (seconds)
                    const dps = stats.damage * stats.hitsPerSecond;
                    const killTime = metin.hp / dps;

                    // 3. Total Time per Cycle (Kill + Find)
                    const totalTime = killTime + stats.findTime;

                    // 4. Metins per Hour
                    const metinsPerHour = 3600 / totalTime;

                    // 5. Hourly Profit
                    const hourlyProfit = totalDropValue * metinsPerHour;

                    return {
                        ...metin,
                        totalDropValue,
                        killTime,
                        metinsPerHour,
                        hourlyProfit
                    };
                }).sort((a, b) => b.hourlyProfit - a.hourlyProfit); // Sort by best profit
            }, [items, metins, stats]);

            const bestMetin = calculations[0];
            const formatMoney = (amount) => new Intl.NumberFormat('tr-TR', { style: 'currency', currency: 'TRY' }).format(amount).replace('‚Ç∫', '') + ' Yang';

            return (
                <div>
                    {/* Summary Cards */}
                    <div className="grid mb-4">
                        <div className="card" style={{ borderColor: 'var(--success)' }}>
                            <div className="card-header">
                                <h3 className="card-title text-success">En Karlƒ± Metin</h3>
                            </div>
                            <div className="text-center">
                                <h2 style={{ fontSize: '2rem', color: 'var(--text-main)' }}>{bestMetin?.name || '-'}</h2>
                                <p className="text-success" style={{ fontSize: '1.5rem', fontWeight: 'bold' }}>
                                    {bestMetin ? formatMoney(bestMetin.hourlyProfit) : 0} / Saat
                                </p>
                            </div>
                        </div>

                        <div className="card">
                            <div className="card-header">
                                <h3 className="card-title">Ortalama Metin Deƒüeri</h3>
                            </div>
                            <div className="text-center">
                                <h2 style={{ fontSize: '1.5rem' }}>{bestMetin ? formatMoney(bestMetin.totalDropValue) : 0}</h2>
                                <p className="text-muted">Metin Ba≈üƒ±na Ortalama Kazan√ß</p>
                            </div>
                        </div>

                        <div className="card">
                            <div className="card-header">
                                <h3 className="card-title">Verimlilik</h3>
                            </div>
                            <div className="text-center">
                                <h2 style={{ fontSize: '1.5rem' }}>{bestMetin ? bestMetin.metinsPerHour.toFixed(1) : 0}</h2>
                                <p className="text-muted">Kesilen Metin / Saat</p>
                            </div>
                        </div>
                    </div>

                    {/* Detailed Table */}
                    <div className="card">
                        <div className="card-header">
                            <h3 className="card-title">Detaylƒ± Analiz</h3>
                        </div>
                        <div className="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Metin Adƒ±</th>
                                        <th>Metin Deƒüeri</th>
                                        <th>Kesme S√ºresi</th>
                                        <th>Saatlik Adet</th>
                                        <th>Saatlik Kazan√ß</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {calculations.map((row, index) => (
                                        <tr key={index} style={index === 0 ? { background: 'rgba(76, 175, 80, 0.1)' } : {}}>
                                            <td style={{ fontWeight: index === 0 ? 'bold' : 'normal' }}>
                                                {row.name} {index === 0 && <span className="badge" style={{ marginLeft: '10px', background: 'var(--success)' }}>EN ƒ∞Yƒ∞</span>}
                                            </td>
                                            <td>{formatMoney(row.totalDropValue)}</td>
                                            <td>{row.killTime.toFixed(1)} sn</td>
                                            <td>{row.metinsPerHour.toFixed(1)}</td>
                                            <td className="text-success" style={{ fontWeight: 'bold' }}>{formatMoney(row.hourlyProfit)}</td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            );
        }

        function App() {
            const [activeTab, setActiveTab] = useState('dashboard');

            // Global State
            const [items, setItems] = useState(initialItems);
            const [metins, setMetins] = useState(initialMetins);
            const [stats, setStats] = useState({
                damage: 3000,
                hitsPerSecond: 2.5,
                findTime: 10
            });

            return (
                <div className="container">
                    <header>
                        <h1 className="text-center text-primary" style={{ fontSize: '2.5rem', textShadow: '0 0 20px rgba(233, 69, 96, 0.5)' }}>
                            METƒ∞N2 DROP Sƒ∞M√úLAT√ñR√ú
                        </h1>
                        <div className="nav-tabs">
                            <button
                                className={`nav-btn ${activeTab === 'dashboard' ? 'active' : ''}`}
                                onClick={() => setActiveTab('dashboard')}
                            >
                                Analiz & Sim√ºlasyon
                            </button>
                            <button
                                className={`nav-btn ${activeTab === 'metins' ? 'active' : ''}`}
                                onClick={() => setActiveTab('metins')}
                            >
                                Metin Ayarlarƒ±
                            </button>
                            <button
                                className={`nav-btn ${activeTab === 'items' ? 'active' : ''}`}
                                onClick={() => setActiveTab('items')}
                            >
                                Piyasa Fiyatlarƒ±
                            </button>
                            <button
                                className={`nav-btn ${activeTab === 'character' ? 'active' : ''}`}
                                onClick={() => setActiveTab('character')}
                            >
                                Karakterim
                            </button>
                        </div>
                    </header>

                    <main>
                        {activeTab === 'dashboard' && (
                            <Dashboard items={items} metins={metins} stats={stats} />
                        )}
                        {activeTab === 'metins' && (
                            <MetinEditor metins={metins} setMetins={setMetins} items={items} />
                        )}
                        {activeTab === 'items' && (
                            <ItemEditor items={items} setItems={setItems} />
                        )}
                        {activeTab === 'character' && (
                            <CharacterStats stats={stats} setStats={setStats} />
                        )}
                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>

==================================================
DOSYA YOLU: .\_eski_drop\package.json
==================================================
{
  "name": "crystal-rosette",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "lint": "eslint .",
    "preview": "vite preview"
  },
  "dependencies": {
    "react": "^19.2.0",
    "react-dom": "^19.2.0"
  },
  "devDependencies": {
    "@eslint/js": "^9.39.1",
    "@types/react": "^19.2.5",
    "@types/react-dom": "^19.2.3",
    "@vitejs/plugin-react": "^5.1.1",
    "eslint": "^9.39.1",
    "eslint-plugin-react-hooks": "^7.0.1",
    "eslint-plugin-react-refresh": "^0.4.24",
    "globals": "^16.5.0",
    "vite": "^7.2.4"
  }
}


==================================================
DOSYA YOLU: .\_eski_drop\project_context.md
==================================================
# Project Context ‚Äì Metin2 Drop Simulator

## `src/App.jsx`
```jsx
import React, { useState, useEffect } from 'react';
import { initialItems, initialMetins } from './data/initialData';
import Dashboard from './components/Dashboard';
import MetinEditor from './components/MetinEditor';
import ItemEditor from './components/ItemEditor';
import CharacterStats from './components/CharacterStats';
import './styles/main.css';

function App() {
  const [activeTab, setActiveTab] = useState('dashboard');

  // Global State
  const [items, setItems] = useState(initialItems);
  const [metins, setMetins] = useState(initialMetins);
  const [stats, setStats] = useState({
    damage: 3000,
    hitsPerSecond: 2.5,
    findTime: 10
  });

  return (
    <div className="container">
      <header>
        <h1 className="text-center text-primary" style={{ fontSize: '2.5rem', textShadow: '0 0 20px rgba(233, 69, 96, 0.5)' }}>
          METƒ∞N2 DROP Sƒ∞M√úLAT√ñR√ú
        </h1>
        <div className="nav-tabs">
          <button
            className={`nav-btn ${activeTab === 'dashboard' ? 'active' : ''}`}
            onClick={() => setActiveTab('dashboard')}
          >
            Analiz & Sim√ºlasyon
          </button>
          <button
            className={`nav-btn ${activeTab === 'metins' ? 'active' : ''}`}
            onClick={() => setActiveTab('metins')}
          >
            Metin Ayarlarƒ±
          </button>
          <button
            className={`nav-btn ${activeTab === 'items' ? 'active' : ''}`}
            onClick={() => setActiveTab('items')}
          >
            Piyasa Fiyatlarƒ±
          </button>
          <button
            className={`nav-btn ${activeTab === 'character' ? 'active' : ''}`}
            onClick={() => setActiveTab('character')}
          >
            Karakterim
          </button>
        </div>
      </header>

      <main>
        {activeTab === 'dashboard' && (
          <Dashboard items={items} metins={metins} stats={stats} />
        )}
        {activeTab === 'metins' && (
          <MetinEditor metins={metins} setMetins={setMetins} items={items} />
        )}
        {activeTab === 'items' && (
          <ItemEditor items={items} setItems={setItems} />
        )}
        {activeTab === 'character' && (
          <CharacterStats stats={stats} setStats={setStats} />
        )}
      </main>
    </div>
  );
}

export default App;
```

## `src/components/CharacterStats.jsx`
```jsx
import React from 'react';

export default function CharacterStats({ stats, setStats }) {
    const handleChange = (e) => {
        const { name, value } = e.target;
        setStats(prev => ({
            ...prev,
            [name]: parseFloat(value) || 0
        }));
    };

    return (
        <div className="card">
            <div className="card-header">
                <h3 className="card-title">Karakter ƒ∞statistikleri</h3>
            </div>
            <div className="grid">
                <div className="form-group">
                    <label>Ortalama Hasar (Vuru≈ü Ba≈üƒ±na)</label>
                    <input
                        type="number"
                        name="damage"
                        value={stats.damage}
                        onChange={handleChange}
                        min="1"
                    />
                </div>
                <div className="form-group">
                    <label>Saniye Ba≈üƒ±na Vuru≈ü (Saldƒ±rƒ± Hƒ±zƒ±)</label>
                    <input
                        type="number"
                        name="hitsPerSecond"
                        value={stats.hitsPerSecond}
                        onChange={handleChange}
                        step="0.1"
                        min="0.1"
                    />
                </div>
                <div className="form-group">
                    <label>Metin Bulma S√ºresi (Saniye)</label>
                    <input
                        type="number"
                        name="findTime"
                        value={stats.findTime}
                        onChange={handleChange}
                        min="0"
                    />
                </div>
            </div>
        </div>
    );
}
```

## `src/components/Dashboard.jsx`
```jsx
import React, { useMemo } from 'react';

export default function Dashboard({ items, metins, stats }) {
    const calculations = useMemo(() => {
        return metins.map(metin => {
            // 1. Calculate Total Drop Value per Metin
            let totalDropValue = 0;
            metin.drops.forEach(drop => {
                const item = items.find(i => i.id === drop.itemId);
                if (item) {
                    // Expected value = Price * Count * (Chance / 100)
                    totalDropValue += item.price * drop.count * (drop.chance / 100);
                }
            });

            // 2. Calculate Time to Kill (seconds)
            const dps = stats.damage * stats.hitsPerSecond;
            const killTime = metin.hp / dps;

            // 3. Total Time per Cycle (Kill + Find)
            const totalTime = killTime + stats.findTime;

            // 4. Metins per Hour
            const metinsPerHour = 3600 / totalTime;

            // 5. Hourly Profit
            const hourlyProfit = totalDropValue * metinsPerHour;

            return {
                ...metin,
                totalDropValue,
                killTime,
                metinsPerHour,
                hourlyProfit
            };
        }).sort((a, b) => b.hourlyProfit - a.hourlyProfit);
    }, [items, metins, stats]);

    const bestMetin = calculations[0];
    const formatMoney = amount => new Intl.NumberFormat('tr-TR', { style: 'currency', currency: 'TRY' }).format(amount).replace('‚Ç∫', '') + ' Yang';

    return (
        <div>
            {/* Summary Cards */}
            <div className="grid mb-4">
                <div className="card" style={{ borderColor: 'var(--success)' }}>
                    <div className="card-header">
                        <h3 className="card-title text-success">En Karlƒ± Metin</h3>
                    </div>
                    <div className="text-center">
                        <h2 style={{ fontSize: '2rem', color: 'var(--text-main)' }}>{bestMetin?.name || '-'}</h2>
                        <p className="text-success" style={{ fontSize: '1.5rem', fontWeight: 'bold' }}>
                            {bestMetin ? formatMoney(bestMetin.hourlyProfit) : 0} / Saat
                        </p>
                    </div>
                </div>

                <div className="card">
                    <div className="card-header">
                        <h3 className="card-title">Ortalama Metin Deƒüeri</h3>
                    </div>
                    <div className="text-center">
                        <h2 style={{ fontSize: '1.5rem' }}>{bestMetin ? formatMoney(bestMetin.totalDropValue) : 0}</h2>
                        <p className="text-muted">Metin Ba≈üƒ±na Ortalama Kazan√ß</p>
                    </div>
                </div>

                <div className="card">
                    <div className="card-header">
                        <h3 className="card-title">Verimlilik</h3>
                    </div>
                    <div className="text-center">
                        <h2 style={{ fontSize: '1.5rem' }}>{bestMetin ? bestMetin.metinsPerHour.toFixed(1) : 0}</h2>
                        <p className="text-muted">Kesilen Metin / Saat</p>
                    </div>
                </div>
            </div>

            {/* Detailed Table */}
            <div className="card">
                <div className="card-header">
                    <h3 className="card-title">Detaylƒ± Analiz</h3>
                </div>
                <div className="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Metin Adƒ±</th>
                                <th>Metin Deƒüeri</th>
                                <th>Kesme S√ºresi</th>
                                <th>Saatlik Adet</th>
                                <th>Saatlik Kazan√ß</th>
                            </tr>
                        </thead>
                        <tbody>
                            {calculations.map((row, index) => (
                                <tr key={index} style={index === 0 ? { background: 'rgba(76, 175, 80, 0.1)' } : {}}>
                                    <td style={{ fontWeight: index === 0 ? 'bold' : 'normal' }}>
                                        {row.name} {index === 0 && <span className="badge" style={{ marginLeft: '10px', background: 'var(--success)' }}>EN ƒ∞Yƒ∞</span>}
                                    </td>
                                    <td>{formatMoney(row.totalDropValue)}</td>
                                    <td>{row.killTime.toFixed(1)} sn</td>
                                    <td>{row.metinsPerHour.toFixed(1)}</td>
                                    <td className="text-success" style={{ fontWeight: 'bold' }}>{formatMoney(row.hourlyProfit)}</td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    );
}
```

## `src/components/ItemEditor.jsx`
```jsx
import React from 'react';

export default function ItemEditor({ items, setItems }) {
    const handlePriceChange = (id, newPrice) => {
        setItems(prev => prev.map(item =>
            item.id === id ? { ...item, price: parseFloat(newPrice) || 0 } : item
        ));
    };

    const formatPrice = price => new Intl.NumberFormat('tr-TR').format(price);

    return (
        <div className="card">
            <div className="card-header">
                <h3 className="card-title">E≈üya Fiyatlarƒ±</h3>
            </div>
            <div className="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>E≈üya Adƒ±</th>
                            <th>Birim Fiyat (Yang)</th>
                            <th>D√ºzenle</th>
                        </tr>
                    </thead>
                    <tbody>
                        {items.map(item => (
                            <tr key={item.id}>
                                <td>{item.name}</td>
                                <td>{formatPrice(item.price)}</td>
                                <td>
                                    <input
                                        type="number"
                                        value={item.price}
                                        onChange={e => handlePriceChange(item.id, e.target.value)}
                                        style={{ width: '150px' }}
                                    />
                                </td>
                            </tr>
                        ))}
                    </tbody>
                </table>
            </div>
        </div>
    );
}
```

## `src/components/MetinEditor.jsx`
```jsx
import React, { useState } from 'react';

function MetinCard({ metin, mIndex, items, onHpChange, onDropChange, onRemoveDrop, onAddDrop }) {
    const [selectedItemId, setSelectedItemId] = useState(items[0]?.id || '');

    const getItemName = id => {
        const item = items.find(i => i.id === id);
        return item ? item.name : id;
    };

    const handleAddClick = () => {
        if (selectedItemId) {
            onAddDrop(mIndex, selectedItemId);
        }
    };

    return (
        <div className="card">
            <div className="card-header">
                <h3 className="card-title">{metin.name}</h3>
                <div className="badge">HP: {new Intl.NumberFormat('tr-TR').format(metin.hp)}</div>
            </div>

            <div className="form-group">
                <label>Metin Canƒ± (HP)</label>
                <input
                    type="number"
                    value={metin.hp}
                    onChange={e => onHpChange(mIndex, e.target.value)}
                />
            </div>

            <div className="table-container">
                <label style={{ marginBottom: '10px', display: 'block' }}>D√º≈üen E≈üyalar</label>
                <table style={{ fontSize: '0.9rem' }}>
                    <thead>
                        <tr>
                            <th>E≈üya</th>
                            <th>Adet</th>
                            <th>% ≈ûans</th>
                            <th style={{ width: '40px' }}></th>
                        </tr>
                    </thead>
                    <tbody>
                        {metin.drops.map((drop, dIndex) => (
                            <tr key={dIndex}>
                                <td>{getItemName(drop.itemId)}</td>
                                <td>
                                    <input
                                        type="number"
                                        value={drop.count}
                                        onChange={e => onDropChange(mIndex, dIndex, 'count', e.target.value)}
                                        style={{ width: '60px', padding: '5px' }}
                                    />
                                </td>
                                <td>
                                    <input
                                        type="number"
                                        value={drop.chance}
                                        onChange={e => onDropChange(mIndex, dIndex, 'chance', e.target.value)}
                                        style={{ width: '60px', padding: '5px' }}
                                        max="100"
                                    />
                                </td>
                                <td>
                                    <button
                                        className="btn btn-sm"
                                        style={{ backgroundColor: 'var(--danger)', padding: '5px 10px' }}
                                        onClick={() => onRemoveDrop(mIndex, dIndex)}
                                        title="Sil"
                                    >
                                        ‚úï
                                    </button>
                                </td>
                            </tr>
                        ))}
                    </tbody>
                </table>
            </div>

            {/* Add New Item Section */}
            <div style={{ marginTop: '15px', padding: '10px', backgroundColor: 'rgba(255,255,255,0.03)', borderRadius: '6px' }}>
                <label style={{ fontSize: '0.85rem', marginBottom: '8px' }}>Yeni E≈üya Ekle</label>
                <div style={{ display: 'flex', gap: '10px' }}>
                    <select
                        value={selectedItemId}
                        onChange={e => setSelectedItemId(e.target.value)}
                        style={{
                            flex: 1,
                            padding: '8px',
                            backgroundColor: 'var(--bg-dark)',
                            border: '1px solid var(--border)',
                            color: 'var(--text-main)',
                            borderRadius: '4px'
                        }}
                    >
                        {items.map(item => (
                            <option key={item.id} value={item.id}>
                                {item.name}
                            </option>
                        ))}
                    </select>
                    <button
                        className="btn btn-sm"
                        onClick={handleAddClick}
                        style={{ backgroundColor: 'var(--success)' }}
                    >
                        Ekle
                    </button>
                </div>
            </div>
        </div>
    );
}

export default function MetinEditor({ metins, setMetins, items }) {
    const handleHpChange = (metinIndex, newHp) => {
        const newMetins = [...metins];
        newMetins[metinIndex].hp = parseFloat(newHp) || 0;
        setMetins(newMetins);
    };

    const handleDropChange = (metinIndex, dropIndex, field, value) => {
        const newMetins = [...metins];
        newMetins[metinIndex].drops[dropIndex][field] = parseFloat(value) || 0;
        setMetins(newMetins);
    };

    const handleRemoveDrop = (metinIndex, dropIndex) => {
        const newMetins = [...metins];
        newMetins[metinIndex].drops.splice(dropIndex, 1);
        setMetins(newMetins);
    };

    const handleAddDrop = (metinIndex, itemId) => {
        const newMetins = [...metins];
        const exists = newMetins[metinIndex].drops.some(d => d.itemId === itemId);
        if (exists) {
            alert("Bu e≈üya zaten bu metinde ekli!");
            return;
        }
        newMetins[metinIndex].drops.push({
            itemId,
            count: 1,
            chance: 10
        });
        setMetins(newMetins);
    };

    return (
        <div className="grid">
            {metins.map((metin, mIndex) => (
                <MetinCard
                    key={mIndex}
                    metin={metin}
                    mIndex={mIndex}
                    items={items}
                    onHpChange={handleHpChange}
                    onDropChange={handleDropChange}
                    onRemoveDrop={handleRemoveDrop}
                    onAddDrop={handleAddDrop}
                />
            ))}
        </div>
    );
}
```

## `src/data/initialData.js`
```js
export const initialItems = [
    { id: "yefsun", name: "Efsun Nesnesi (Ye≈üil)", price: 3000000 },
    { id: "yart", name: "Arttƒ±rma Kaƒüƒ±dƒ± (Ye≈üil)", price: 1500000 },
    { id: "efsun", name: "Efsun Nesnesi", price: 6000000 },
    { id: "art", name: "Arttƒ±rma Kaƒüƒ±dƒ±", price: 800000 },
    { id: "tas", name: "Ruh Ta≈üƒ±", price: 5000000 },
    { id: "cor", name: "Cor Draconis", price: 25000000 },
    { id: "munzevi", name: "M√ºnzevi Tavsiyesi", price: 40000000 },
    { id: "zen", name: "Zen Fasulyesi", price: 80000000 },
    { id: "enerji", name: "Enerji Par√ßasƒ±", price: 450000 }
];

export const initialMetins = [
    {
        name: "Ruh Metni",
        hp: 119700,
        drops: [
            { itemId: "yefsun", count: 4, chance: 100 },
            { itemId: "yart", count: 2, chance: 100 },
            { itemId: "munzevi", count: 1, chance: 25 },
            { itemId: "zen", count: 1, chance: 15 }
        ]
    },
    {
        name: "G√∂lge Metni",
        hp: 142350,
        drops: [
            { itemId: "yefsun", count: 1, chance: 100 },
            { itemId: "yart", count: 1, chance: 100 },
            { itemId: "efsun", count: 1, chance: 100 },
            { itemId: "art", count: 1, chance: 100 },
            { itemId: "munzevi", count: 1, chance: 25 }
        ]
    },
    {
        name: "≈ûeytan Metni",
        hp: 195900,
        drops: [
            { itemId: "yefsun", count: 1, chance: 100 },
            { itemId: "yart", count: 1, chance: 100 },
            { itemId: "efsun", count: 1, chance: 100 },
            { itemId: "art", count: 1, chance: 100 },
            { itemId: "cor", count: 1, chance: 10 },
            { itemId: "munzevi", count: 1, chance: 25 }
        ]
    },
    {
        name: "√ñl√ºm Metni",
        hp: 260250,
        drops: [
            { itemId: "yefsun", count: 2, chance: 100 },
            { itemId: "yart", count: 2, chance: 100 },
            { itemId: "efsun", count: 2, chance: 100 },
            { itemId: "art", count: 2, chance: 100 },
            { itemId: "cor", count: 1, chance: 20 },
            { itemId: "munzevi", count: 1, chance: 60 },
            { itemId: "zen", count: 1, chance: 15 }
        ]
    },
    {
        name: "Katil Metni",
        hp: 296550,
        drops: [
            { itemId: "yefsun", count: 2, chance: 100 },
            { itemId: "yart", count: 2, chance: 100 },
            { itemId: "efsun", count: 2, chance: 100 },
            { itemId: "art", count: 2, chance: 100 },
            { itemId: "cor", count: 1, chance: 10 },
            { itemId: "munzevi", count: 1, chance: 25 },
            { itemId: "zen", count: 1, chance: 15 }
        ]
    },
    {
        name: "B√ºy√ºl√º Metin",
        hp: 1500000,
        drops: [
            { itemId: "efsun", count: 9, chance: 100 },
            { itemId: "cor", count: 1, chance: 50 },
            { itemId: "zen", count: 1, chance: 15 }
        ]
    }
];
```

## `src/styles/main.css`
```css
:root {
    --bg-dark: #1a1a2e;
    --bg-card: #16213e;
    --primary: #e94560;
    --text-main: #ffffff;
    --text-muted: #a0a0a0;
    --border: #0f3460;
    --accent: #533483;
    --success: #4caf50;
    --danger: #f44336;
    --font-main: 'Inter', sans-serif;
}

* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

body {
    background-color: var(--bg-dark);
    color: var(--text-main);
    font-family: var(--font-main);
    line-height: 1.6;
}

#root {
    min-height: 100vh;
    display: flex;
    flex-direction: column;
}

.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
    width: 100%;
}

/* Header & Navigation */
header {
    background-color: var(--bg-card);
    padding: 20px 0;
    border-bottom: 2px solid var(--border);
    margin-bottom: 30px;
}

.nav-tabs {
    display: flex;
    gap: 10px;
    justify-content: center;
    margin-top: 20px;
}

.nav-btn {
    background: transparent;
    border: 1px solid var(--border);
    color: var(--text-muted);
    padding: 10px 20px;
    cursor: pointer;
    border-radius: 6px;
    transition: all 0.3s ease;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.nav-btn:hover {
    background: rgba(233, 69, 96, 0.1);
    color: var(--primary);
    border-color: var(--primary);
}

.nav-btn.active {
    background: var(--primary);
    color: white;
    border-color: var(--primary);
    box-shadow: 0 0 15px rgba(233, 69, 96, 0.4);
}

/* Cards & Layout */
.grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
}

.card {
    background-color: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 20px;
    transition: transform 0.2s;
}

.card:hover {
    transform: translateY(-2px);
    border-color: var(--primary);
}

.card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    border-bottom: 1px solid var(--border);
    padding-bottom: 10px;
}

.card-title {
    font-size: 1.2rem;
    font-weight: 700;
    color: var(--primary);
}

/* Forms & Inputs */
.form-group {
    margin-bottom: 15px;
}

label {
    display: block;
    margin-bottom: 5px;
    color: var(--text-muted);
    font-size: 0.9rem;
}

input[type="number"], input[type="text"] {
    width: 100%;
    padding: 10px;
    background: var(--bg-dark);
    border: 1px solid var(--border);
    border-radius: 6px;
    color: var(--text-main);
    font-size: 1rem;
}

input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 2px rgba(233, 69, 96, 0.2);
}

/* Tables */
.table-container {
    overflow-x: auto;
}

table {
    width: 100%;
    border-collapse: collapse;
}

th, td {
    padding: 12px;
    text-align: left;
    border-bottom: 1px solid var(--border);
}

th {
    color: var(--primary);
    font-weight: 600;
}

tr:hover {
    background-color: rgba(255, 255, 255, 0.02);
}

/* Utilities */
.text-primary { color: var(--primary); }
.text-success { color: var(--success); }
.text-center { text-align: center; }
.mt-4 { margin-top: 2rem; }
.mb-4 { margin-bottom: 2rem; }
.flex-between { display: flex; justify-content: space-between; align-items: center; }

.btn {
    background: var(--primary);
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 600;
    transition: opacity 0.2s;
}

.btn:hover { opacity: 0.9; }

.btn-sm { padding: 4px 8px; font-size: 0.8rem; }

.badge {
    background: var(--accent);
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 0.8rem;
    color: white;
}
```

## `src/index.css`
```css
:root {
  font-family: system-ui, Avenir, Helvetica, Arial, sans-serif;
  line-height: 1.5;
  font-weight: 400;

  color-scheme: light dark;
  color: rgba(255, 255, 255, 0.87);
  background-color: #242424;

  font-synthesis: none;
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

a {
  font-weight: 500;
  color: #646cff;
  text-decoration: inherit;
}
a:hover { color: #535bf2; }

body {
  margin: 0;
  display: flex;
  place-items: center;
  min-width: 320px;
  min-height: 100vh;
}

h1 { font-size: 3.2em; line-height: 1.1; }

button {
  border-radius: 8px;
  border: 1px solid transparent;
  padding: 0.6em 1.2em;
  font-size: 1em;
  font-weight: 500;
  font-family: inherit;
  background-color: #1a1a1a;
  cursor: pointer;
  transition: border-color 0.25s;
}
button:hover { border-color: #646cff; }
button:focus, button:focus-visible { outline: 4px auto -webkit-focus-ring-color; }

@media (prefers-color-scheme: light) {
  :root { color: #213547; background-color: #ffffff; }
  a:hover { color: #747bff; }
  button { background-color: #f9f9f9; }
}
```

## `metin2_drop_sim.html`
```html
<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Metin2 Drop Sim√ºlat√∂r√º</title>
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        /* Inline copy of main.css for the single‚Äëfile version */
        :root { --bg-dark: #1a1a2e; --bg-card: #16213e; --primary: #e94560; --text-main: #ffffff; --text-muted: #a0a0a0; --border: #0f3460; --accent: #533483; --success: #4caf50; --danger: #f44336; --font-main: 'Inter', sans-serif; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { background-color: var(--bg-dark); color: var(--text-main); font-family: var(--font-main); line-height: 1.6; }
        #root { min-height: 100vh; display: flex; flex-direction: column; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; width: 100%; }
        header { background-color: var(--bg-card); padding: 20px 0; border-bottom: 2px solid var(--border); margin-bottom: 30px; }
        .nav-tabs { display: flex; gap: 10px; justify-content: center; margin-top: 20px; }
        .nav-btn { background: transparent; border: 1px solid var(--border); color: var(--text-muted); padding: 10px 20px; cursor: pointer; border-radius: 6px; transition: all 0.3s ease; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; }
        .nav-btn:hover { background: rgba(233, 69, 96, 0.1); color: var(--primary); border-color: var(--primary); }
        .nav-btn.active { background: var(--primary); color: white; border-color: var(--primary); box-shadow: 0 0 15px rgba(233, 69, 96, 0.4); }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .card { background-color: var(--bg-card); border: 1px solid var(--border); border-radius: 12px; padding: 20px; transition: transform 0.2s; }
        .card:hover { transform: translateY(-2px); border-color: var(--primary); }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; border-bottom: 1px solid var(--border); padding-bottom: 10px; }
        .card-title { font-size: 1.2rem; font-weight: 700; color: var(--primary); }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; color: var(--text-muted); font-size: 0.9rem; }
        input[type="number"], input[type="text"] { width: 100%; padding: 10px; background: var(--bg-dark); border: 1px solid var(--border); border-radius: 6px; color: var(--text-main); font-size: 1rem; }
        input:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 2px rgba(233, 69, 96, 0.2); }
        .table-container { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid var(--border); }
        th { color: var(--primary); font-weight: 600; }
        tr:hover { background-color: rgba(255, 255, 255, 0.02); }
        .btn { background: var(--primary); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: 600; transition: opacity 0.2s; }
        .btn:hover { opacity: 0.9; }
        .btn-sm { padding: 4px 8px; font-size: 0.8rem; }
        .badge { background: var(--accent); padding: 4px 8px; border-radius: 4px; font-size: 0.8rem; color: white; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useMemo } = React;
        // --- DATA ---
        const initialItems = [
            { id: "yefsun", name: "Efsun Nesnesi (Ye≈üil)", price: 3000000 },
            { id: "yart", name: "Arttƒ±rma Kaƒüƒ±dƒ± (Ye≈üil)", price: 1500000 },
            { id: "efsun", name: "Efsun Nesnesi", price: 6000000 },
            { id: "art", name: "Arttƒ±rma Kaƒüƒ±dƒ±", price: 800000 },
            { id: "tas", name: "Ruh Ta≈üƒ±", price: 5000000 },
            { id: "cor", name: "Cor Draconis", price: 25000000 },
            { id: "munzevi", name: "M√ºnzevi Tavsiyesi", price: 40000000 },
            { id: "zen", name: "Zen Fasulyesi", price: 80000000 },
            { id: "enerji", name: "Enerji Par√ßasƒ±", price: 450000 }
        ];
        const initialMetins = [
            { name: "Ruh Metni", hp: 119700, drops: [ { itemId: "yefsun", count: 4, chance: 100 }, { itemId: "yart", count: 2, chance: 100 }, { itemId: "munzevi", count: 1, chance: 25 }, { itemId: "zen", count: 1, chance: 15 } ] },
            // ... other metins omitted for brevity ...
        ];
        // --- COMPONENTS ---
        // (Components are the same as the separate files, omitted here for brevity)
        // ...
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
```

---

*All files are now collected in this markdown document, ready for AI analysis. If you spot any inconsistency or bug, let me know and we can fix it.*


==================================================
DOSYA YOLU: .\_eski_drop\README.md
==================================================
# React + Vite

This template provides a minimal setup to get React working in Vite with HMR and some ESLint rules.

Currently, two official plugins are available:

- [@vitejs/plugin-react](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react) uses [Babel](https://babeljs.io/) (or [oxc](https://oxc.rs) when used in [rolldown-vite](https://vite.dev/guide/rolldown)) for Fast Refresh
- [@vitejs/plugin-react-swc](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react-swc) uses [SWC](https://swc.rs/) for Fast Refresh

## React Compiler

The React Compiler is not enabled on this template because of its impact on dev & build performances. To add it, see [this documentation](https://react.dev/learn/react-compiler/installation).

## Expanding the ESLint configuration

If you are developing a production application, we recommend using TypeScript with type-aware lint rules enabled. Check out the [TS template](https://github.com/vitejs/vite/tree/main/packages/create-vite/template-react-ts) for information on how to integrate TypeScript and [`typescript-eslint`](https://typescript-eslint.io) in your project.


==================================================
DOSYA YOLU: .\_eski_drop\vite.config.js
==================================================
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

// https://vite.dev/config/
export default defineConfig({
  plugins: [react()],
})

